<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Models\Trees\MenuItem.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.ComponentModel.DataAnnotations;
using System.Runtime.Serialization;
using Umbraco.Core.Models.EntityBase;
using Umbraco.Web.Trees;
using umbraco;
using umbraco.interfaces;
using System.Collections.Generic;
using Umbraco.Core;

namespace Umbraco.Web.Models.Trees
{
    /// &lt;summary&gt;
    /// A context menu item
    /// &lt;/summary&gt;
    [DataContract(Name = &quot;menuItem&quot;, Namespace = &quot;&quot;)]
    public class MenuItem
    {
        #region Constructors
        public MenuItem()
        {
            AdditionalData = new Dictionary&lt;string, object&gt;();
            Icon = &quot;folder&quot;;
        }

        public MenuItem(string alias, string name)
            : this()
        {
            Alias = alias;
            Name = name;
        }

        public MenuItem(IAction legacyMenu, string name = &quot;&quot;)
            : this()
        {
            Name = name.IsNullOrWhiteSpace() ? legacyMenu.Alias : name;
            Alias = legacyMenu.Alias;
            SeperatorBefore = false;
            Icon = legacyMenu.Icon;
            Action = legacyMenu;
        } 
        #endregion

        #region Properties
        internal IAction Action { get; set; }

        /// &lt;summary&gt;
        /// A dictionary to support any additional meta data that should be rendered for the node which is 
        /// useful for custom action commands such as &#39;create&#39;, &#39;copy&#39;, etc...
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// We will also use the meta data collection for dealing with legacy menu items (i.e. for loading custom URLs or
        /// executing custom JS).
        /// &lt;/remarks&gt;
        [DataMember(Name = &quot;metaData&quot;)]
        public Dictionary&lt;string, object&gt; AdditionalData { get; private set; }

        [DataMember(Name = &quot;name&quot;, IsRequired = true)]
        [Required]
        public string Name { get; set; }

        [DataMember(Name = &quot;alias&quot;, IsRequired = true)]
        [Required]
        public string Alias { get; set; }

        /// &lt;summary&gt;
        /// Ensures a menu separator will exist before this menu item
        /// &lt;/summary&gt;
        [DataMember(Name = &quot;seperator&quot;)]
        public bool SeperatorBefore { get; set; }

        [DataMember(Name = &quot;cssclass&quot;)]
        public string Icon { get; set; } 
        #endregion

        #region Constants

        /// &lt;summary&gt;
        /// Used as a key for the AdditionalData to specify a specific dialog title instead of the menu title
        /// &lt;/summary&gt;
        internal const string DialogTitleKey = &quot;dialogTitle&quot;;

        /// &lt;summary&gt;
        /// Used to specify the URL that the dialog will launch to in an iframe
        /// &lt;/summary&gt;
        internal const string ActionUrlKey = &quot;actionUrl&quot;;

        //TODO: some action&#39;s want to launch a new window like live editing, we support this in the menu item&#39;s metadata with
        // a key called: &quot;actionUrlMethod&quot; which can be set to either: Dialog, BlankWindow. Normally this is always set to Dialog 
        // if a URL is specified in the &quot;actionUrl&quot; metadata. For now I&#39;m not going to implement launching in a blank window, 
        // though would be v-easy, just not sure we want to ever support that?
        internal const string ActionUrlMethodKey = &quot;actionUrlMethod&quot;;

        /// &lt;summary&gt;
        /// Used to specify the angular view that the dialog will launch
        /// &lt;/summary&gt;
        internal const string ActionViewKey = &quot;actionView&quot;;

        /// &lt;summary&gt;
        /// Used to specify the js method to execute for the menu item 
        /// &lt;/summary&gt;
        internal const string JsActionKey = &quot;jsAction&quot;;

        /// &lt;summary&gt;
        /// Used to specify an angular route to go to for the menu item
        /// &lt;/summary&gt;
        internal const string ActionRouteKey = &quot;actionRoute&quot;; 

        #endregion

        #region Methods

        /// &lt;summary&gt;
        /// Sets the menu item to navigate to the specified angular route path
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;route&quot;&gt;&lt;/param&gt;
        public void NavigateToRoute(string route)
        {
            AdditionalData[ActionRouteKey] = route;
        }

        /// &lt;summary&gt;
        /// Adds the required meta data to the menu item so that angular knows to attempt to call the Js method.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;jsToExecute&quot;&gt;&lt;/param&gt;
        public void ExecuteLegacyJs(string jsToExecute)
        {
            SetJsAction(jsToExecute);
        }

        /// &lt;summary&gt;
        /// Sets the menu item to display a dialog based on an angular view path
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;view&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dialogTitle&quot;&gt;&lt;/param&gt;
        public void LaunchDialogView(string view, string dialogTitle)
        {
            SetDialogTitle(dialogTitle);
            AdditionalData[ActionViewKey] = view;
        }

        /// &lt;summary&gt;
        /// Sets the menu item to display a dialog based on a url path in an iframe
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dialogTitle&quot;&gt;&lt;/param&gt;
        public void LaunchDialogUrl(string url, string dialogTitle)
        {
            SetDialogTitle(dialogTitle);
            SetActionUrl(url);
        }

        private void SetJsAction(string jsToExecute)
        {
            AdditionalData[JsActionKey] = jsToExecute;
        }

        /// &lt;summary&gt;
        /// Puts a dialog title into the meta data to be displayed on the dialog of the menu item (if there is one)
        /// instead of the menu name
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dialogTitle&quot;&gt;&lt;/param&gt;
        private void SetDialogTitle(string dialogTitle)
        {
            AdditionalData[DialogTitleKey] = dialogTitle;
        }

        /// &lt;summary&gt;
        /// Configures the menu item to launch a URL with the specified action (dialog or new window)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;method&quot;&gt;&lt;/param&gt;
        private void SetActionUrl(string url, ActionUrlMethod method = ActionUrlMethod.Dialog)
        {
            AdditionalData[ActionUrlKey] = url;
            AdditionalData[ActionUrlMethodKey] = method;
        }

        internal void ConvertLegacyMenuItem(IUmbracoEntity item, string nodeType, string currentSection)
        {
            //First try to get a URL/title from the legacy action,
            // if that doesn&#39;t work, try to get the legacy confirm view

            //in some edge cases, item can be null so we&#39;ll just convert those to &quot;-1&quot; and &quot;&quot; for id and name since these edge cases don&#39;t need that.
            Attempt
                .Try(LegacyTreeDataConverter.GetUrlAndTitleFromLegacyAction(Action,
                                                                            item == null ? &quot;-1&quot; : item.Id.ToInvariantString(),
                                                                            nodeType,
                                                                            item == null ? &quot;&quot; : item.Name, currentSection),
                     action =&gt; LaunchDialogUrl(action.Url, action.DialogTitle))
                .OnFailure(() =&gt; LegacyTreeDataConverter.GetLegacyConfirmView(Action, currentSection),
                           view =&gt; LaunchDialogView(
                               view,
                               ui.GetText(&quot;defaultdialogs&quot;, &quot;confirmdelete&quot;) + &quot; &#39;&quot; + (item == null ? &quot;&quot; : item.Name) + &quot;&#39; ?&quot;));
        } 
        #endregion

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,26,0],[20,9,20,10,0],[21,13,21,63,0],[22,13,22,29,0],[23,9,23,10,0],[26,15,26,21,0],[27,9,27,10,0],[28,13,28,27,0],[29,13,29,25,0],[30,9,30,10,0],[33,15,33,21,0],[34,9,34,10,0],[35,13,35,72,0],[36,13,36,38,0],[37,13,37,37,0],[38,13,38,36,0],[39,13,39,33,0],[40,9,40,10,0],[44,35,44,39,0],[44,40,44,44,0],[55,60,55,64,0],[55,65,55,77,0],[59,30,59,34,0],[59,35,59,39,0],[63,31,63,35,0],[63,36,63,40,0],[69,39,69,43,0],[69,44,69,48,0],[72,30,72,34,0],[72,35,72,39,0],[117,9,117,10,0],[118,13,118,52,0],[119,9,119,10,0],[126,9,126,10,0],[127,13,127,38,0],[128,9,128,10,0],[136,9,136,10,0],[137,13,137,41,0],[138,13,138,50,0],[139,9,139,10,0],[147,9,147,10,0],[148,13,148,41,0],[149,13,149,31,0],[150,9,150,10,0],[153,9,153,10,0],[154,13,154,55,0],[155,9,155,10,0],[163,9,163,10,0],[164,13,164,58,0],[165,9,165,10,0],[173,9,173,10,0],[174,13,174,48,0],[175,13,175,57,0],[176,9,176,10,0],[179,9,179,10,0],[184,13,189,32,0],[189,32,189,79,0],[189,79,190,34,0],[190,34,190,102,0],[190,102,191,36,0],[191,36,193,127,0],[193,127,193,129,0],[184,13,193,129,0],[194,9,194,10,0]]);
    </script>
  </body>
</html>