<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Routing\ContentFinderByProfile.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Umbraco.Core.Configuration;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core;

namespace Umbraco.Web.Routing
{
	/// &lt;summary&gt;
	/// Provides an implementation of &lt;see cref=&quot;IContentFinder&quot;/&gt; that handles profiles.
	/// &lt;/summary&gt;
	/// &lt;remarks&gt;
	/// &lt;para&gt;Handles &lt;c&gt;/profile/login&lt;/c&gt; where &lt;c&gt;/profile&lt;/c&gt; is the profile page nice url and &lt;c&gt;login&lt;/c&gt; the login of a member.&lt;/para&gt;
	/// &lt;para&gt;This should rather be done with a rewriting rule. There would be multiple profile pages in multi-sites/multi-langs setups.
	/// We keep it for backward compatility reasons.&lt;/para&gt;
	/// &lt;/remarks&gt;
    public class ContentFinderByProfile : ContentFinderByNiceUrl
    {
		/// &lt;summary&gt;
		/// Tries to find and assign an Umbraco document to a &lt;c&gt;PublishedContentRequest&lt;/c&gt;.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;docRequest&quot;&gt;The &lt;c&gt;PublishedContentRequest&lt;/c&gt;.&lt;/param&gt;		
		/// &lt;returns&gt;A value indicating whether an Umbraco document was found and assigned.&lt;/returns&gt;
		public override bool TryFindContent(PublishedContentRequest docRequest)
        {
            IPublishedContent node = null;
			var path = docRequest.Uri.GetAbsolutePathDecoded();

            bool isProfile = false;
			var pos = path.LastIndexOf(&#39;/&#39;);
            if (pos &gt; 0)
            {
				var memberLogin = path.Substring(pos + 1);
				path = path.Substring(0, pos);

                if (path == GlobalSettings.ProfileUrl)
                {
                    isProfile = true;
					LogHelper.Debug&lt;ContentFinderByProfile&gt;(&quot;Path \&quot;{0}\&quot; is the profile path&quot;, () =&gt; path);

					var route = docRequest.HasDomain ? (docRequest.Domain.RootNodeId.ToString() + path) : path;
					node = FindContent(docRequest, route);

                    if (node != null)
                    {
						//TODO: Should be handled by Context Items class manager (http://issues.umbraco.org/issue/U4-61)
						docRequest.RoutingContext.UmbracoContext.HttpContext.Items[&quot;umbMemberLogin&quot;] = memberLogin;	
                    }                        
                    else
                    {
						LogHelper.Debug&lt;ContentFinderByProfile&gt;(&quot;No document matching profile path?&quot;);
                    }
                }
            }

            if (!isProfile)
            {
				LogHelper.Debug&lt;ContentFinderByProfile&gt;(&quot;Not the profile path&quot;);
            }

            return node != null;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[24,9,24,10,0],[25,13,25,43,0],[26,4,26,55,0],[28,13,28,36,0],[29,4,29,36,0],[30,13,30,25,0],[31,13,31,14,0],[32,5,32,47,0],[33,5,33,35,0],[35,17,35,55,0],[36,17,36,18,0],[37,21,37,38,0],[38,6,38,88,0],[38,88,38,92,0],[38,92,38,94,0],[38,6,38,94,0],[40,6,40,97,0],[41,6,41,44,0],[43,21,43,38,0],[44,21,44,22,0],[46,7,46,98,0],[47,21,47,22,0],[49,21,49,22,0],[50,7,50,85,0],[51,21,51,22,0],[52,17,52,18,0],[53,13,53,14,0],[55,13,55,28,0],[56,13,56,14,0],[57,5,57,69,0],[58,13,58,14,0],[60,13,60,33,0],[61,9,61,10,0]]);
    </script>
  </body>
</html>