<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Models\Mapping\UserModelMapper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using AutoMapper;
using Umbraco.Core;
using Umbraco.Core.Models.Mapping;
using Umbraco.Core.Models.Membership;
using Umbraco.Web.Models.ContentEditing;
using umbraco;
using Umbraco.Core.Models;
using Umbraco.Core.Models.Identity;
using Umbraco.Core.Security;

namespace Umbraco.Web.Models.Mapping
{
    internal class UserModelMapper : MapperConfiguration
    {
        public override void ConfigureMappings(IConfiguration config, ApplicationContext applicationContext)
        {
            config.CreateMap&lt;IUser, UserDetail&gt;()
                .ForMember(detail =&gt; detail.UserId, opt =&gt; opt.MapFrom(user =&gt; GetIntId(user.Id)))
                .ForMember(detail =&gt; detail.UserType, opt =&gt; opt.MapFrom(user =&gt; user.UserType.Alias))
                .ForMember(detail =&gt; detail.StartContentId, opt =&gt; opt.MapFrom(user =&gt; user.StartContentId))
                .ForMember(detail =&gt; detail.StartMediaId, opt =&gt; opt.MapFrom(user =&gt; user.StartMediaId))
                .ForMember(detail =&gt; detail.Culture, opt =&gt; opt.MapFrom(user =&gt; user.GetUserCulture(applicationContext.Services.TextService)))
                .ForMember(
                    detail =&gt; detail.EmailHash,
                    opt =&gt; opt.MapFrom(user =&gt; user.Email.ToLowerInvariant().Trim().ToMd5()))
                .ForMember(detail =&gt; detail.SecondsUntilTimeout, opt =&gt; opt.Ignore());

            config.CreateMap&lt;BackOfficeIdentityUser, UserDetail&gt;()
                .ForMember(detail =&gt; detail.UserId, opt =&gt; opt.MapFrom(user =&gt; user.Id))
                .ForMember(detail =&gt; detail.UserType, opt =&gt; opt.MapFrom(user =&gt; user.UserTypeAlias))
                .ForMember(detail =&gt; detail.StartContentId, opt =&gt; opt.MapFrom(user =&gt; user.StartContentId))
                .ForMember(detail =&gt; detail.StartMediaId, opt =&gt; opt.MapFrom(user =&gt; user.StartMediaId))
                .ForMember(detail =&gt; detail.Culture, opt =&gt; opt.MapFrom(user =&gt; user.Culture))
                .ForMember(detail =&gt; detail.AllowedSections, opt =&gt; opt.MapFrom(user =&gt; user.AllowedSections))
                .ForMember(
                    detail =&gt; detail.EmailHash,
                    opt =&gt; opt.MapFrom(user =&gt; user.Email.ToLowerInvariant().Trim().ToMd5()))
                .ForMember(detail =&gt; detail.SecondsUntilTimeout, opt =&gt; opt.Ignore());

            config.CreateMap&lt;IProfile, UserBasic&gt;()
                  .ForMember(detail =&gt; detail.UserId, opt =&gt; opt.MapFrom(profile =&gt; GetIntId(profile.Id)));

            config.CreateMap&lt;IUser, UserData&gt;()
                .ConstructUsing((IUser user) =&gt; new UserData())
                .ForMember(detail =&gt; detail.Id, opt =&gt; opt.MapFrom(user =&gt; user.Id))
                .ForMember(detail =&gt; detail.AllowedApplications, opt =&gt; opt.MapFrom(user =&gt; user.AllowedSections))
                .ForMember(detail =&gt; detail.RealName, opt =&gt; opt.MapFrom(user =&gt; user.Name))
                .ForMember(detail =&gt; detail.Roles, opt =&gt; opt.MapFrom(user =&gt; new[] {user.UserType.Alias}))
                .ForMember(detail =&gt; detail.StartContentNode, opt =&gt; opt.MapFrom(user =&gt; user.StartContentId))
                .ForMember(detail =&gt; detail.StartMediaNode, opt =&gt; opt.MapFrom(user =&gt; user.StartMediaId))
                .ForMember(detail =&gt; detail.Username, opt =&gt; opt.MapFrom(user =&gt; user.Username))
                .ForMember(detail =&gt; detail.Culture, opt =&gt; opt.MapFrom(user =&gt; user.GetUserCulture(applicationContext.Services.TextService)))
                .ForMember(detail =&gt; detail.SessionId, opt =&gt; opt.MapFrom(user =&gt; user.SecurityStamp.IsNullOrWhiteSpace() ? Guid.NewGuid().ToString(&quot;N&quot;) : user.SecurityStamp));
            
        } 
     
        private static int GetIntId(object id)
        {
            var result = id.TryConvertTo&lt;int&gt;();
            if (result.Success == false)
            {
                throw new InvalidOperationException(
                    &quot;Cannot convert the profile to a &quot; + typeof(UserDetail).Name + &quot; object since the id is not an integer&quot;);
            }
            return result.Result;
        } 
 
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[18,13,19,60,1],[19,60,19,98,1],[19,98,20,62,1],[20,62,20,102,1],[20,102,21,68,1],[21,68,21,108,1],[21,108,22,66,1],[22,66,22,104,1],[22,104,23,61,1],[23,61,23,142,1],[23,142,26,28,1],[26,28,26,93,1],[26,93,27,73,1],[27,73,27,85,1],[27,85,27,87,1],[18,13,27,87,1],[29,13,30,60,1],[30,60,30,88,1],[30,88,31,62,1],[31,62,31,101,1],[31,101,32,68,1],[32,68,32,108,1],[32,108,33,66,1],[33,66,33,104,1],[33,104,34,61,1],[34,61,34,94,1],[34,94,35,69,1],[35,69,35,110,1],[35,110,38,28,1],[38,28,38,93,1],[38,93,39,73,1],[39,73,39,85,1],[39,85,39,87,1],[29,13,39,87,1],[41,13,42,62,1],[42,62,42,106,1],[42,106,42,108,1],[41,13,42,108,1],[44,13,45,49,1],[45,49,45,63,0],[45,63,46,56,1],[46,56,46,84,1],[46,84,47,73,1],[47,73,47,114,1],[47,114,48,62,1],[48,62,48,92,1],[48,92,49,59,1],[49,59,49,107,1],[49,107,50,70,1],[50,70,50,110,1],[50,110,51,68,1],[51,68,51,106,1],[51,106,52,62,1],[52,62,52,96,1],[52,96,53,61,1],[53,61,53,142,1],[53,142,54,63,1],[54,63,54,175,1],[54,175,54,177,1],[44,13,54,177,1],[56,9,56,10,1],[59,9,59,10,1],[60,13,60,49,1],[61,13,61,41,1],[62,13,62,14,0],[63,17,64,126,0],[66,13,66,34,1],[67,9,67,10,1]]);
    </script>
  </body>
</html>