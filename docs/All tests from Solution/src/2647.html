<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\tinyMCE3\webcontrol\plugin\JSONWriter.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
/*
 * $Id: JSONWriter.cs 439 2007-11-26 13:26:10Z spocke $
 *
 * Copyright ï¿½ 2007, Moxiecode Systems AB, All rights reserved. 
 */

using System;
using System.Text;
using System.IO;
using System.Collections;

namespace umbraco.editorControls.tinyMCE3.webcontrol.plugin
{
    /// &lt;summary&gt;
	/// 
	/// &lt;/summary&gt;
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public enum JSONLocation
    {
		/// &lt;summary&gt; &lt;/summary&gt;
		InArray,

		/// &lt;summary&gt; &lt;/summary&gt;
		InObject,

		/// &lt;summary&gt; &lt;/summary&gt;
		Normal
	}

	/// &lt;summary&gt;
	/// Description of JSONWriter.
	/// &lt;/summary&gt;
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public class JSONWriter
    {
		private TextWriter writer;
		private JSONLocation location;
		private Stack lastLocations;
		private int index, lastIndex;
		private bool isProp = false;

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;writer&quot;&gt;&lt;/param&gt;
		public JSONWriter(TextWriter writer) {
			this.writer = writer;
			this.location = JSONLocation.Normal;
			this.lastLocations = new Stack();
			this.index = 0;
			this.lastIndex = 0;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteStartObject() {
			this.WriteDelim();
			this.writer.Write(&#39;{&#39;);
			this.lastLocations.Push(this.location);
			this.lastIndex = this.index;
			this.location = JSONLocation.InObject;
			this.index = 0;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteEndObject() {
			this.writer.Write(&#39;}&#39;);
			this.location = (JSONLocation) lastLocations.Pop();
			this.index = this.lastIndex;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteStartArray() {
			this.WriteDelim();
			this.writer.Write(&#39;[&#39;);
			this.lastLocations.Push(this.location);
			this.lastIndex = this.index;
			this.location = JSONLocation.InArray;
			this.index = 0;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteEndArray() {
			this.writer.Write(&#39;]&#39;);
			this.location = (JSONLocation) lastLocations.Pop();
			this.index = this.lastIndex;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
		public void WritePropertyName(string name) {
			this.WriteDelim();
			this.isProp = true;
			this.WriteObject(EncodeString(name));
			this.writer.Write(&#39;:&#39;);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;
		public void WriteProperty(string name, object obj) {
			this.WritePropertyName(name);
			this.WriteObject(obj);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;
		public void WriteValue(object obj) {
			this.WriteDelim();
			this.WriteObject(obj);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteNull() {
			this.WriteDelim();
			this.writer.Write(&quot;null&quot;);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void Close() {
			this.writer.Close();
		}

		#region private methods

		private void WriteObject(object obj) {
			if (obj == null) {
				this.writer.Write(&quot;null&quot;);
				return;
			}

			if (obj is bool) {
				this.writer.Write(((bool) obj) == true ? &quot;true&quot; : &quot;false&quot;);
				return;
			}

			if (obj is int) {
				this.writer.Write(((int) obj));
				return;
			}

			if (obj is long) {
				this.writer.Write(((long) obj));
				return;
			}

			if (obj is float || obj is double) {
				string str = Convert.ToString(obj);
				this.writer.Write(str.Replace(&#39;,&#39;, &#39;.&#39;));
				return;
			}

			if (obj is string) {
				this.writer.Write(&#39;&quot;&#39;);
				this.writer.Write(EncodeString((string) obj));
				this.writer.Write(&#39;&quot;&#39;);
				return;
			}
		}

		private void WriteDelim() {
			if (this.index &gt; 0 &amp;&amp; !this.isProp)
				this.writer.Write(&#39;,&#39;);

			this.isProp = false;
			this.index++;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;str&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static string EncodeString(string str) {
			if (str == null)
				return null;

			StringBuilder strBuilder = new StringBuilder(str.Length);
			char[] chars = str.ToCharArray();

			for (int i=0; i&lt;chars.Length; i++) {
				// Unicode it if needed
				if (chars[i] &gt; 128 || Char.IsControl(chars[i])) {
					strBuilder.Append(&quot;\\u&quot;);
					strBuilder.Append(((int) chars[i]).ToString(&quot;X4&quot;));
					continue;
				}

				switch (chars[i]) {
					case &#39;\&#39;&#39;:
						strBuilder.Append(&quot;\\\&#39;&quot;);
						break;

					case &#39;\&quot;&#39;:
						strBuilder.Append(&quot;\\\&quot;&quot;);
						break;

					case &#39;\\&#39;:
						strBuilder.Append(&quot;\\\\&quot;);
						break;

					default:
						strBuilder.Append(chars[i]);
						break;
				}
			}

			return strBuilder.ToString();
		}

		#endregion
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[40,3,40,31,0],[46,3,46,39,0],[46,40,46,41,0],[47,4,47,25,0],[48,4,48,40,0],[49,4,49,37,0],[50,4,50,19,0],[51,4,51,23,0],[52,3,52,4,0],[57,34,57,35,0],[58,4,58,22,0],[59,4,59,27,0],[60,4,60,43,0],[61,4,61,32,0],[62,4,62,42,0],[63,4,63,19,0],[64,3,64,4,0],[69,32,69,33,0],[70,4,70,27,0],[71,4,71,55,0],[72,4,72,32,0],[73,3,73,4,0],[78,33,78,34,0],[79,4,79,22,0],[80,4,80,27,0],[81,4,81,43,0],[82,4,82,32,0],[83,4,83,41,0],[84,4,84,19,0],[85,3,85,4,0],[90,31,90,32,0],[91,4,91,27,0],[92,4,92,55,0],[93,4,93,32,0],[94,3,94,4,0],[100,46,100,47,0],[101,4,101,22,0],[102,4,102,23,0],[103,4,103,41,0],[104,4,104,27,0],[105,3,105,4,0],[112,54,112,55,0],[113,4,113,33,0],[114,4,114,26,0],[115,3,115,4,0],[121,38,121,39,0],[122,4,122,22,0],[123,4,123,26,0],[124,3,124,4,0],[129,27,129,28,0],[130,4,130,22,0],[131,4,131,30,0],[132,3,132,4,0],[137,23,137,24,0],[138,4,138,24,0],[139,3,139,4,0],[143,40,143,41,0],[144,4,144,20,0],[144,21,144,22,0],[145,5,145,31,0],[146,5,146,12,0],[149,4,149,20,0],[149,21,149,22,0],[150,5,150,64,0],[151,5,151,12,0],[154,4,154,19,0],[154,20,154,21,0],[155,5,155,36,0],[156,5,156,12,0],[159,4,159,20,0],[159,21,159,22,0],[160,5,160,37,0],[161,5,161,12,0],[164,4,164,38,0],[164,39,164,40,0],[165,5,165,40,0],[166,5,166,46,0],[167,5,167,12,0],[170,4,170,22,0],[170,23,170,24,0],[171,5,171,28,0],[172,5,172,51,0],[173,5,173,28,0],[174,5,174,12,0],[176,3,176,4,0],[178,29,178,30,0],[179,4,179,39,0],[180,5,180,28,0],[182,4,182,24,0],[183,4,183,17,0],[184,3,184,4,0],[191,49,191,50,0],[192,4,192,20,0],[193,5,193,17,0],[195,4,195,61,0],[196,4,196,37,0],[198,9,198,16,0],[198,18,198,32,0],[198,34,198,37,0],[198,39,198,40,0],[200,5,200,52,0],[200,53,200,54,0],[201,6,201,31,0],[202,6,202,57,0],[203,6,203,15,0],[206,5,206,22,0],[208,7,208,33,0],[209,7,209,13,0],[212,7,212,33,0],[213,7,213,13,0],[216,7,216,33,0],[217,7,217,13,0],[220,7,220,35,0],[221,7,221,13,0],[223,4,223,5,0],[225,4,225,33,0],[226,3,226,4,0]]);
    </script>
  </body>
</html>