<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\helpers\DeepLink.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using umbraco.BusinessLogic;
using System.Web;
using Umbraco.Core;

namespace umbraco.cms.helpers
{
    public class DeepLink
    {
        public static string GetTreePathFromFilePath(string filePath)
        {
            List&lt;string&gt; treePath = new List&lt;string&gt;();
            treePath.Add(&quot;-1&quot;);
            treePath.Add(&quot;init&quot;);
            string[] pathPaths = filePath.Split(&#39;/&#39;);
            
            for (int p = 0; p &lt; pathPaths.Length; p++)
            {
                treePath.Add(string.Join(&quot;/&quot;, pathPaths.Take(p + 1).ToArray()));
            }
            string sPath = string.Join(&quot;,&quot;, treePath.ToArray());
            return sPath;
        }
        public static string GetAnchor(DeepLinkType type, string idOrFilePath, bool useJavascript)
        {
            string url = GetUrl(type, idOrFilePath, useJavascript);
            if (!string.IsNullOrEmpty(url))
            {
                if (!useJavascript)
                {
                    return string.Format(&quot;&lt;a href=\&quot;{0}\&quot; target=\&quot;_blank\&quot;&gt;{1}&amp;nbsp;&amp;gt;&lt;/a&gt;&quot;, url, ui.GetText(&quot;general&quot;, &quot;edit&quot;));
                }
                else
                {
                    return string.Format(&quot;&lt;a href=\&quot;{0}\&quot;&gt;{1}&amp;nbsp;&amp;gt;&lt;/a&gt;&quot;, url, ui.GetText(&quot;general&quot;, &quot;edit&quot;));
                }
            }
            return null;
        }
        public static string GetUrl(DeepLinkType type, string idOrFilePath, bool useJavascript)
        {
            string basePath = &quot;/umbraco/umbraco.aspx&quot;;

            string section = string.Empty;
            string editorUrl = string.Empty;
            string idKey = string.Empty;

            switch (type)
            {
                case DeepLinkType.Content:
                    section = Constants.Applications.Content;
                    editorUrl = &quot;editContent.aspx&quot;;
                    idKey = &quot;id&quot;;
                    break;
                case DeepLinkType.Css:
                    section = Constants.Applications.Settings;
                    editorUrl = &quot;settings/stylesheet/editStylesheet.aspx&quot;;
                    idKey = &quot;id&quot;;
                    break;
                case DeepLinkType.DataType:
                    section = Constants.Applications.Developer;
                    editorUrl = &quot;developer/datatypes/editDataType.aspx&quot;;
                    idKey = &quot;id&quot;;
                    break;
                case DeepLinkType.DocumentType:
                    section = Constants.Applications.Settings;
                    editorUrl = &quot;settings/editNodeTypeNew.aspx&quot;;
                    idKey = &quot;id&quot;;
                    break;
                case DeepLinkType.Javascript:
                    section = Constants.Applications.Settings;
                    editorUrl = &quot;settings/scripts/editScript.aspx&quot;;
                    idKey = &quot;file&quot;;
                    break;
                case DeepLinkType.Macro:
                    section = Constants.Applications.Developer;
                    editorUrl = &quot;developer/macros/editMacro.aspx&quot;;
                    idKey = &quot;macroID&quot;;
                    break;
                case DeepLinkType.Media:
                    section = Constants.Applications.Media;
                    editorUrl = &quot;editMedia.aspx&quot;;
                    idKey = &quot;id&quot;;
                    break;
                case DeepLinkType.MediaType:
                    section = Constants.Applications.Settings;
                    editorUrl = &quot;settings/editMediaType.aspx&quot;;
                    idKey = &quot;id&quot;;
                    break;
                case DeepLinkType.RazorScript:
                    section = Constants.Applications.Developer;
                    editorUrl = &quot;developer/python/editPython.aspx&quot;;
                    idKey = &quot;file&quot;;
                    break;
                case DeepLinkType.Template:
                    section = Constants.Applications.Settings;
                    editorUrl = &quot;settings/editTemplate.aspx&quot;;
                    idKey = &quot;templateId&quot;;
                    break;
                case DeepLinkType.XSLT:
                    section = Constants.Applications.Developer;
                    editorUrl = &quot;developer/xslt/editXslt.aspx&quot;;
                    idKey = &quot;file&quot;;
                    break;
            }
            if (section != string.Empty)
            {
                User currentUser = User.GetCurrent();
                if (currentUser != null)
                {
                    //does the current user have access to this section
                    if (currentUser.Applications.Any(app =&gt; app.alias == section))
                    {
                        string rightAction = string.Format(&quot;{0}?{1}={2}&quot;, editorUrl, idKey, idOrFilePath);
                        if (!useJavascript)
                        {
                            string rightActionEncoded = HttpContext.Current.Server.UrlEncode(rightAction);
                            return string.Format(&quot;{0}?app={1}&amp;rightAction={2}#{1}&quot;, basePath, section, rightActionEncoded);
                        }
                        else
                        {
                            return string.Format(&quot;javascript:UmbClientMgr.contentFrameAndSection(&#39;{0}&#39;,&#39;{1}&#39;);&quot;, section, rightAction);
                        }
                    }
                }
            }
            return null;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,10,0],[15,13,15,56,0],[16,13,16,32,0],[17,13,17,34,0],[18,13,18,54,0],[20,18,20,27,0],[20,29,20,49,0],[20,51,20,54,0],[21,13,21,14,0],[22,17,22,81,0],[23,13,23,14,0],[24,13,24,65,0],[25,13,25,26,0],[26,9,26,10,0],[28,9,28,10,0],[29,13,29,68,0],[30,13,30,44,0],[31,13,31,14,0],[32,17,32,36,0],[33,17,33,18,0],[34,21,34,133,0],[37,17,37,18,0],[38,21,38,115,0],[41,13,41,25,0],[42,9,42,10,0],[44,9,44,10,0],[45,13,45,55,0],[47,13,47,43,0],[48,13,48,45,0],[49,13,49,41,0],[51,13,51,26,0],[54,21,54,62,0],[55,21,55,52,0],[56,21,56,34,0],[57,21,57,27,0],[59,21,59,63,0],[60,21,60,75,0],[61,21,61,34,0],[62,21,62,27,0],[64,21,64,64,0],[65,21,65,73,0],[66,21,66,34,0],[67,21,67,27,0],[69,21,69,63,0],[70,21,70,65,0],[71,21,71,34,0],[72,21,72,27,0],[74,21,74,63,0],[75,21,75,68,0],[76,21,76,36,0],[77,21,77,27,0],[79,21,79,64,0],[80,21,80,67,0],[81,21,81,39,0],[82,21,82,27,0],[84,21,84,60,0],[85,21,85,50,0],[86,21,86,34,0],[87,21,87,27,0],[89,21,89,63,0],[90,21,90,63,0],[91,21,91,34,0],[92,21,92,27,0],[94,21,94,64,0],[95,21,95,68,0],[96,21,96,36,0],[97,21,97,27,0],[99,21,99,63,0],[100,21,100,62,0],[101,21,101,42,0],[102,21,102,27,0],[104,21,104,64,0],[105,21,105,64,0],[106,21,106,36,0],[107,21,107,27,0],[109,13,109,41,0],[110,13,110,14,0],[111,17,111,54,0],[112,17,112,41,0],[113,17,113,18,0],[115,21,115,61,0],[115,61,115,81,0],[115,81,115,83,0],[115,21,115,83,0],[116,21,116,22,0],[117,25,117,107,0],[118,25,118,44,0],[119,25,119,26,0],[120,29,120,107,0],[121,29,121,124,0],[124,25,124,26,0],[125,29,125,136,0],[128,17,128,18,0],[129,13,129,14,0],[130,13,130,25,0],[131,9,131,10,0]]);
    </script>
  </body>
</html>