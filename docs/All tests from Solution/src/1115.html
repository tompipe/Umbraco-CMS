<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Install\DatabaseHelper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Umbraco.Core;
using Umbraco.Core.Persistence;
using Umbraco.Web.Install.Models;

namespace Umbraco.Web.Install
{
    internal class DatabaseHelper
    {
        internal bool CheckConnection(DatabaseModel database, ApplicationContext applicationContext)
        {
            string connectionString;
            DatabaseProviders provider;
            var dbContext = applicationContext.DatabaseContext;

            if (database.ConnectionString.IsNullOrWhiteSpace() == false)
            {
                connectionString = database.ConnectionString;
                provider = DbConnectionExtensions.DetectProviderFromConnectionString(connectionString);
            }
            else if (database.DatabaseType == DatabaseType.SqlCe)
            {
                //we do not test this connection
                return true;
                //connectionString = dbContext.GetEmbeddedDatabaseConnectionString();
            }
            else if (database.IntegratedAuth)
            {
                connectionString = dbContext.GetIntegratedSecurityDatabaseConnectionString(
                    database.Server, database.DatabaseName);
                provider = DatabaseProviders.SqlServer;;
            }
            else
            {
                string providerName;
                connectionString = dbContext.GetDatabaseConnectionString(
                    database.Server, database.DatabaseName, database.Login, database.Password,
                    database.DatabaseType.ToString(),
                    out providerName);

                provider = database.DatabaseType == DatabaseType.MySql ? DatabaseProviders.MySql : DatabaseProviders.SqlServer;
            }

            return DbConnectionExtensions.IsConnectionAvailable(connectionString, provider);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,0],[18,13,18,64,0],[20,13,20,73,0],[21,13,21,14,0],[22,17,22,62,0],[23,17,23,104,0],[24,13,24,14,0],[25,18,25,66,0],[26,13,26,14,0],[28,17,28,29,0],[31,18,31,46,0],[32,13,32,14,0],[33,17,34,61,0],[35,17,35,56,0],[35,56,35,57,0],[36,13,36,14,0],[38,13,38,14,0],[40,17,43,39,0],[45,17,45,128,0],[46,13,46,14,0],[48,13,48,93,0],[49,9,49,10,0]]);
    </script>
  </body>
</html>