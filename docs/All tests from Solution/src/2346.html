<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\UmbracoExamine\LegacyLibrary.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Reflection;
using System.Xml.XPath;

namespace UmbracoExamine
{
	/// &lt;summary&gt;
	/// This is only used for backward compatibility to get access to the umbraco.library object but this needs to be done
	/// via reflection because of the circular reference we have between Umbraco.Web and UmbracoExamine. 
	/// &lt;/summary&gt;
	internal static class LegacyLibrary
	{
		private static volatile Type _libraryType;
		private static readonly object Locker = new object();
		private static Type LibraryType
		{
			get
			{
				if (_libraryType == null)
				{
					lock (Locker)
					{
						if (_libraryType == null)
						{
							var ass = Assembly.Load(&quot;umbraco&quot;);
							if (ass == null)
								throw new InvalidOperationException(&quot;Could not load assembly umbraco.dll, the umbraco.dll needs to be loaded in the current app domain&quot;);
							var lib = ass.GetType(&quot;umbraco.library&quot;);
							if (lib == null)
								throw new InvalidOperationException(&quot;Could not load type umbraco.library, the umbraco.dll needs to be loaded in the current app domain&quot;);
							_libraryType = lib;
						}
					}
				}
				return _libraryType;
			}
		}

		internal static XPathNodeIterator GetXmlNodeById(string id)
		{
			var meth = LibraryType.GetMethod(&quot;GetXmlNodeById&quot;, BindingFlags.Public | BindingFlags.Static);
			return (XPathNodeIterator)meth.Invoke(null, new object[] { id });
		}

		internal static XPathNodeIterator GetMember(int id)
		{
			var meth = LibraryType.GetMethod(&quot;GetMember&quot;, BindingFlags.Public | BindingFlags.Static);
			return (XPathNodeIterator)meth.Invoke(null, new object[] { id });
		}

		internal static XPathNodeIterator GetXmlNodeByXPath(string xpathQuery)
		{
			var meth = LibraryType.GetMethod(&quot;GetXmlNodeByXPath&quot;, BindingFlags.Public | BindingFlags.Static);
			return (XPathNodeIterator)meth.Invoke(null, new object[] { xpathQuery });
		}
		
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,3,14,56,0],[18,4,18,5,0],[19,5,19,30,0],[20,5,20,6,0],[21,6,21,19,0],[22,6,22,7,0],[23,7,23,32,0],[24,7,24,8,0],[25,8,25,43,0],[26,8,26,24,0],[27,9,27,146,0],[28,8,28,49,0],[29,8,29,24,0],[30,9,30,146,0],[31,8,31,27,0],[32,7,32,8,0],[33,6,33,7,0],[34,5,34,6,0],[35,5,35,25,0],[36,4,36,5,0],[40,3,40,4,0],[41,4,41,98,0],[42,4,42,69,0],[43,3,43,4,0],[46,3,46,4,0],[47,4,47,93,0],[48,4,48,69,0],[49,3,49,4,0],[52,3,52,4,0],[53,4,53,101,0],[54,4,54,77,0],[55,3,55,4,0]]);
    </script>
  </body>
</html>