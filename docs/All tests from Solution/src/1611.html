<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\PropertyEditors\PropertyValueConvertersResolver.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading;
using Umbraco.Core.Logging;
using Umbraco.Core.ObjectResolution;

namespace Umbraco.Core.PropertyEditors
{
    /// &lt;summary&gt;
    /// Resolves the IPropertyValueConverter objects.
    /// &lt;/summary&gt;
    public sealed class PropertyValueConvertersResolver : ManyObjectsResolverBase&lt;PropertyValueConvertersResolver, IPropertyValueConverter&gt;
	{
        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;PropertyValueConvertersResolver&quot;/&gt; class with 
        /// an initial list of converter types.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;serviceProvider&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;logger&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;converters&quot;&gt;The list of converter types&lt;/param&gt;
        /// &lt;remarks&gt;The resolver is created by the &lt;c&gt;WebBootManager&lt;/c&gt; and thus the constructor remains internal.&lt;/remarks&gt;
        internal PropertyValueConvertersResolver(IServiceProvider serviceProvider, ILogger logger, IEnumerable&lt;Type&gt; converters)
            : base(serviceProvider, logger, converters)
		{ }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;PropertyValueConvertersResolver&quot;/&gt; class with 
        /// an initial list of converter types.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;serviceProvider&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;logger&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;converters&quot;&gt;The list of converter types&lt;/param&gt;
        /// &lt;remarks&gt;The resolver is created by the &lt;c&gt;WebBootManager&lt;/c&gt; and thus the constructor remains internal.&lt;/remarks&gt;
        internal PropertyValueConvertersResolver(IServiceProvider serviceProvider, ILogger logger, params Type[] converters)
            : base(serviceProvider, logger, converters)
        { }

        /// &lt;summary&gt;
        /// Gets the converters.
        /// &lt;/summary&gt;
        public IEnumerable&lt;IPropertyValueConverter&gt; Converters
        {
            get { return Values; }
        }

        private readonly ReaderWriterLockSlim _lock = new ReaderWriterLockSlim();
        private Tuple&lt;IPropertyValueConverter, DefaultPropertyValueConverterAttribute&gt;[] _defaults = null;

        /// &lt;summary&gt;
        /// Caches and gets the default converters with their metadata
        /// &lt;/summary&gt;
        internal Tuple&lt;IPropertyValueConverter, DefaultPropertyValueConverterAttribute&gt;[] DefaultConverters
        {
            get
            {
                using (var locker = new UpgradeableReadLock(_lock))
                {
                    if (_defaults == null)
                    {
                        locker.UpgradeToWriteLock();

                        var defaultConvertersWithAttributes = Converters
                            .Select(x =&gt; new
                                {
                                    attribute = x.GetType().GetCustomAttribute&lt;DefaultPropertyValueConverterAttribute&gt;(false),
                                    converter = x
                                })
                            .Where(x =&gt; x.attribute != null)
                            .ToArray();

                        _defaults = defaultConvertersWithAttributes
                            .Select(
                                x =&gt; new Tuple&lt;IPropertyValueConverter, DefaultPropertyValueConverterAttribute&gt;(x.converter, x.attribute))
                            .ToArray();
                    }

                    return _defaults;
                }
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[24,15,24,56,1],[25,3,25,4,1],[25,5,25,6,1],[36,15,36,56,1],[37,9,37,10,1],[37,11,37,12,1],[44,17,44,18,1],[44,19,44,33,1],[44,34,44,35,1],[47,9,47,82,1],[47,9,47,82,1],[48,9,48,107,1],[48,9,48,107,1],[56,13,56,14,1],[57,24,57,67,1],[58,17,58,18,1],[59,21,59,43,1],[60,21,60,22,1],[61,25,61,53,1],[63,25,64,42,1],[64,42,68,34,1],[68,34,69,41,1],[69,41,69,60,1],[69,60,70,40,1],[63,25,70,40,1],[72,25,74,38,1],[74,38,74,138,0],[74,138,75,40,1],[72,25,75,40,1],[76,21,76,22,1],[78,21,78,38,1],[80,13,80,14,1]]);
    </script>
  </body>
</html>