<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\dialogs\imageViewer.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;

using System.IO;
using umbraco.BusinessLogic;
using Umbraco.Core.IO;
using Umbraco.Core;

namespace umbraco.dialogs
{
	[Obsolete(&quot;Use the ImageViewer user control instead&quot;)]
	public partial class imageViewer : BasePages.UmbracoEnsuredPage
	{

	    public imageViewer()
	    {
	        CurrentApp = DefaultApps.media.ToString();
	    }
	
		protected void Page_Load(object sender, EventArgs e)
		{
			//Response.Write(umbraco.helper.Request(&quot;id&quot;));
			//Response.End();
			// Put user code to initialize the page here
			if (Request.QueryString[&quot;id&quot;] != null) 
			{
				if (Request.QueryString[&quot;id&quot;] != &quot;&quot;)  
				{
					//TODO: fix Nasty FAST&#39;N&#39;CANELINE HACK. ..
					var mediaId = int.Parse(Request.QueryString[&quot;id&quot;]);
					
					image.Controls.Clear();
					var fileWidth = 0;
					var fileHeight = 0;
					var fileName = &quot;/blank.gif&quot;;
					var altText = &quot;&quot;;

				    try
				    {
				        var m = new cms.businesslogic.media.Media(mediaId);

				        // TODO: Remove &quot;Magic strings&quot; from code.
				        try
				        {
				            fileName = m.getProperty(&quot;fileName&quot;).Value.ToString();
				        }
				        catch
				        {
				            try
				            {
								fileName = m.getProperty(Constants.Conventions.Media.File).Value.ToString();
				            }
				            catch
				            {
				                fileName = m.getProperty(&quot;file&quot;).Value.ToString();
				            }
				        }

				        altText = m.Text;
				        try
				        {
								fileWidth = int.Parse(m.getProperty(Constants.Conventions.Media.Width).Value.ToString());
								fileHeight = int.Parse(m.getProperty(Constants.Conventions.Media.Height).Value.ToString());
				        }
				        catch
				        {

				        }
				        var fileNameOrg = fileName;
				        var ext = fileNameOrg.Substring(fileNameOrg.LastIndexOf(&quot;.&quot;) + 1, fileNameOrg.Length - fileNameOrg.LastIndexOf(&quot;.&quot;) - 1);
                        var fileNameThumb = SystemDirectories.Root + fileNameOrg.Replace(&quot;.&quot; + ext, &quot;_thumb.&quot; + ext);
				        image.Controls.Add(new LiteralControl(&quot;&lt;a href=\&quot;&quot; + SystemDirectories.Root + fileNameOrg + &quot;\&quot; title=\&quot;Zoom\&quot;&gt;&lt;img src=\&quot;&quot; + fileNameThumb + &quot;\&quot; border=\&quot;0\&quot;/&gt;&lt;/a&gt;&quot;));
				    }
				    catch
				    {
				    }

				    image.Controls.Add(new LiteralControl(&quot;&lt;script&gt;\nparent.updateImageSource(&#39;&quot; + SystemDirectories.Root  + fileName.Replace(&quot;&#39;&quot;, &quot;\\&#39;&quot;) + &quot;&#39;,&#39;&quot; + altText + &quot;&#39;,&#39;&quot; + fileWidth.ToString() + &quot;&#39;,&#39;&quot; + fileHeight.ToString() + &quot;&#39;)\n&lt;/script&gt;&quot;));

				}
			}
		}

	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,6,23,26,0],[24,6,24,7,0],[25,10,25,52,0],[26,6,26,7,0],[29,3,29,4,0],[33,4,33,42,0],[34,4,34,5,0],[35,5,35,41,0],[36,5,36,6,0],[38,6,38,57,0],[40,6,40,29,0],[41,6,41,24,0],[42,6,42,25,0],[43,6,43,34,0],[44,6,44,23,0],[47,9,47,10,0],[48,13,48,64,0],[52,13,52,14,0],[53,17,53,71,0],[54,13,54,14,0],[55,13,55,18,0],[56,13,56,14,0],[58,17,58,18,0],[59,9,59,85,0],[60,17,60,18,0],[61,17,61,22,0],[62,17,62,18,0],[63,21,63,71,0],[64,17,64,18,0],[65,13,65,14,0],[67,13,67,30,0],[69,13,69,14,0],[70,9,70,98,0],[71,9,71,100,0],[72,13,72,14,0],[73,13,73,18,0],[74,13,74,14,0],[76,13,76,14,0],[77,13,77,40,0],[78,13,78,134,0],[79,25,79,118,0],[80,13,80,181,0],[81,9,81,10,0],[82,9,82,14,0],[83,9,83,10,0],[84,9,84,10,0],[86,9,86,244,0],[88,5,88,6,0],[89,4,89,5,0],[90,3,90,4,0]]);
    </script>
  </body>
</html>