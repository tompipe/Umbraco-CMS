<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\users\tom pipe\documents\hexadigital\code\umbraco\umbraco-cms\src\umbraco.web.ui\umbraco\install\legacy\loadstarterkits.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Web.Routing;
using System.Web.UI;
using Umbraco.Core.Logging;
using Umbraco.Web.Install;

namespace Umbraco.Web.UI.Install.Steps.Skinning
{
    public delegate void StarterKitInstalledEventHandler();

    public partial class LoadStarterKits : UserControl
    {
        /// &lt;summary&gt;
        /// Returns the string for the package installer web service base url
        /// &lt;/summary&gt;
        protected string PackageInstallServiceBaseUrl { get; private set; }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            //Get the URL for the package install service base url
            var umbracoPath = Core.Configuration.GlobalSettings.UmbracoMvcArea;
            var urlHelper = new UrlHelper(Context.Request.RequestContext);
            //PackageInstallServiceBaseUrl = urlHelper.Action(&quot;Index&quot;, &quot;InstallPackage&quot;, new { area = &quot;UmbracoInstall&quot; });
            PackageInstallServiceBaseUrl = urlHelper.GetUmbracoApiService(&quot;Index&quot;, &quot;InstallPackage&quot;, &quot;UmbracoInstall&quot;);
        }

        /// &lt;summary&gt;
		/// Flag to show if we can connect to the repo or not
		/// &lt;/summary&gt;
		protected bool CannotConnect { get; private set; }

		public event StarterKitInstalledEventHandler StarterKitInstalled;

		protected virtual void OnStarterKitInstalled()
		{
			StarterKitInstalled();
		}


		private readonly global::umbraco.cms.businesslogic.packager.repositories.Repository _repo;
        private const string RepoGuid = &quot;65194810-1f85-11dd-bd0b-0800200c9a66&quot;;

        public LoadStarterKits()
		{
            _repo = global::umbraco.cms.businesslogic.packager.repositories.Repository.getByGuid(RepoGuid);
		}

		protected void Page_Load(object sender, EventArgs e)
		{

		}

        //protected void NextStep(object sender, EventArgs e)
        //{
        //    var p = (Default)this.Page;
        //    //InstallHelper.RedirectToNextStep(Page, Request.GetItemAsString(&quot;installStep&quot;));
        //}

		protected override void OnInit(EventArgs e)
		{
			base.OnInit(e);

            if (_repo == null)
            {
                throw new InvalidOperationException(&quot;Could not find repository with id &quot; + RepoGuid);
            }

			//clear progressbar cache
            //InstallHelper.ClearProgress();

			if (_repo.HasConnection())
			{
				try
				{
                    var r = new org.umbraco.our.Repository();

                    rep_starterKits.DataSource = r.Modules();
					rep_starterKits.DataBind();
				}
				catch (Exception ex)
				{
					LogHelper.Error&lt;LoadStarterKits&gt;(&quot;Cannot connect to package repository&quot;, ex);
					CannotConnect = true;

				}
			}
			else
			{
				CannotConnect = true;
			}
		}


		protected void GotoLastStep(object sender, EventArgs e)
		{
            //InstallHelper.RedirectToLastStep(Page);
		}

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,57,20,61,0],[20,62,20,74,0],[23,9,23,10,0],[24,13,24,28,0],[27,13,27,80,0],[28,13,28,75,0],[30,13,30,120,0],[31,9,31,10,0],[36,34,36,38,0],[36,39,36,51,0],[41,3,41,4,0],[42,4,42,26,0],[43,3,43,4,0],[49,9,49,33,0],[50,3,50,4,0],[51,13,51,108,0],[52,3,52,4,0],[55,3,55,4,0],[57,3,57,4,0],[66,3,66,4,0],[67,4,67,19,0],[69,13,69,31,0],[70,13,70,14,0],[71,17,71,102,0],[77,4,77,30,0],[78,4,78,5,0],[80,5,80,6,0],[81,21,81,62,0],[83,21,83,62,0],[84,6,84,33,0],[85,5,85,6,0],[86,5,86,25,0],[87,5,87,6,0],[88,6,88,83,0],[89,6,89,27,0],[91,5,91,6,0],[92,4,92,5,0],[94,4,94,5,0],[95,5,95,26,0],[96,4,96,5,0],[97,3,97,4,0],[101,3,101,4,0],[103,3,103,4,0]]);
    </script>
  </body>
</html>