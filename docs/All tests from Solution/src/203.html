<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Models\DeepCloneHelperTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using NUnit.Framework;
using Umbraco.Core.Models;

namespace Umbraco.Tests.Models
{
    [TestFixture]
    public class DeepCloneHelperTests
    {
        [Test]
        public void Deep_Clone_Ref_Properties()
        {
            var test1 = new Test1()
            {
                MyTest1 = new Test1(),
                MyTest2 = new Test2()
            };

            var clone = (Test1)test1.DeepClone();

            Assert.AreNotSame(test1, clone);
            Assert.AreNotSame(test1.MyTest1, clone.MyTest1);
            Assert.AreSame(test1.MyTest2, clone.MyTest2);
        }

        [Test]
        public void Deep_Clone_Array_Property()
        {
            var test1 = new Test3()
            {
                MyTest1 = new object[] { new Test1(), new Test1() }
            };

            var clone = (Test3)test1.DeepClone();

            Assert.AreNotSame(test1, clone);
            Assert.AreEqual(test1.MyTest1.Count(), clone.MyTest1.Count());
            for (int i = 0; i &lt; test1.MyTest1.Count(); i++)
            {
                Assert.IsNotNull(clone.MyTest1.ElementAt(i));
                Assert.AreNotSame(clone.MyTest1.ElementAt(i), test1.MyTest1.ElementAt(i));
            }
        }

        [Test]
        public void Deep_Clone_Typed_Array_Property()
        {
            var test1 = new Test4()
            {
                MyTest1 = new[] { new Test1(), new Test1() }
            };

            var clone = (Test4)test1.DeepClone();

            Assert.AreNotSame(test1, clone);
            Assert.AreEqual(test1.MyTest1.Count(), clone.MyTest1.Count());
            for (int i = 0; i &lt; test1.MyTest1.Count(); i++)
            {
                Assert.IsNotNull(clone.MyTest1.ElementAt(i));
                Assert.AreNotSame(clone.MyTest1.ElementAt(i), test1.MyTest1.ElementAt(i));
            }
        }

        [Test]
        public void Deep_Clone_Enumerable_Property()
        {
            var test1 = new Test5()
            {
                MyTest1 = new[] { new Test1(), new Test1() }
            };

            var clone = (Test5)test1.DeepClone();

            Assert.AreNotSame(test1, clone);

            Assert.AreEqual(test1.MyTest1.Cast&lt;object&gt;().Count(), clone.MyTest1.Cast&lt;object&gt;().Count());
            for (int i = 0; i &lt; test1.MyTest1.Cast&lt;object&gt;().Count(); i++)
            {
                Assert.IsNotNull(clone.MyTest1.Cast&lt;object&gt;().ElementAt(i));
                Assert.AreNotSame(clone.MyTest1.Cast&lt;object&gt;().ElementAt(i), test1.MyTest1.Cast&lt;object&gt;().ElementAt(i));
            }
        }

        [Test]
        public void Deep_Clone_Typed_Enumerable_Property()
        {
            var test1 = new Test6()
            {
                MyTest1 = new[] { new Test1(), new Test1() }
            };

            var clone = (Test6)test1.DeepClone();

            Assert.AreNotSame(test1, clone);
            Assert.AreEqual(test1.MyTest1.Count(), clone.MyTest1.Count());
            for (int i = 0; i &lt; test1.MyTest1.Count(); i++)
            {
                Assert.IsNotNull(clone.MyTest1.ElementAt(i));
                Assert.AreNotSame(clone.MyTest1.ElementAt(i), test1.MyTest1.ElementAt(i));
            }
        }

        [Test]
        public void Deep_Clone_Custom_Enumerable_Property()
        {
            var test1 = new Test7()
            {
                MyTest1 = new List&lt;Test1&gt; { new Test1(), new Test1() }
            };

            var clone = (Test7)test1.DeepClone();

            Assert.AreNotSame(test1, clone);
            Assert.AreEqual(test1.MyTest1.Count(), clone.MyTest1.Count());
            for (int i = 0; i &lt; test1.MyTest1.Count(); i++)
            {
                Assert.IsNotNull(clone.MyTest1.ElementAt(i));
                Assert.AreNotSame(clone.MyTest1.ElementAt(i), test1.MyTest1.ElementAt(i));
            }
        }

        [Test]
        public void Deep_Clone_Custom_Enumerable_Interface_Property()
        {
            var test1 = new Test8()
            {
                MyTest1 = new List&lt;Test1&gt; { new Test1(), new Test1() }
            };

            var clone = (Test8)test1.DeepClone();

            Assert.AreNotSame(test1, clone);
            Assert.AreEqual(test1.MyTest1.Count(), clone.MyTest1.Count());
            for (int i = 0; i &lt; test1.MyTest1.Count(); i++)
            {
                Assert.IsNotNull(clone.MyTest1.ElementAt(i));
                Assert.AreNotSame(clone.MyTest1.ElementAt(i), test1.MyTest1.ElementAt(i));
            }
        }

        [Test]
        public void Cannot_Deep_Clone_Collection_Properties_That_Are_Not_Cloneable()
        {
            var test1 = new Test3()
            {
                MyTest1 = new object[]
                {
                    new Test1(), &quot;hello&quot;,
                    //not cloneable so this property will get skipped
                    new Test2()
                }
            };

            var clone = (Test3)test1.DeepClone();

            //it skipped this property so these will now be the same
            Assert.AreSame(clone.MyTest1, test1.MyTest1);

        }

        public class Test1 : BaseCloneable
        {
            public string Name { get; set; }
            public int Age { get; set; }

            public Test1 MyTest1 { get; set; }
            public Test2 MyTest2 { get; set; }

        }

        public class Test2
        {
            public string Name { get; set; }
            public Test1 MyTest1 { get; set; }
        }

        public class Test3 : BaseCloneable
        {
            public string Name { get; set; }
            public object[] MyTest1 { get; set; }
            
        }

        public class Test4 : BaseCloneable
        {
            public string Name { get; set; }
            public Test1[] MyTest1 { get; set; }

        }

        public class Test5 : BaseCloneable
        {
            public string Name { get; set; }
            public IEnumerable MyTest1 { get; set; }

        }

        public class Test6 : BaseCloneable
        {
            public string Name { get; set; }
            public IEnumerable&lt;Test1&gt; MyTest1 { get; set; }

        }

        public class Test7 : BaseCloneable
        {
            public string Name { get; set; }
            public List&lt;Test1&gt; MyTest1 { get; set; }

        }

        public class Test8 : BaseCloneable
        {
            public string Name { get; set; }
            public ICollection&lt;Test1&gt; MyTest1 { get; set; }

        }

        public abstract class BaseCloneable : IDeepCloneable
        {
            public object DeepClone()
            {
                var clone = (IDeepCloneable)MemberwiseClone();
                DeepCloneHelper.DeepCloneRefProperties(this, clone);
                return clone;
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,1],[16,13,20,15,1],[22,13,22,50,1],[24,13,24,45,1],[25,13,25,61,1],[26,13,26,58,1],[27,9,27,10,1],[31,9,31,10,1],[32,13,35,15,1],[37,13,37,50,1],[39,13,39,45,1],[40,13,40,75,1],[41,18,41,27,1],[41,29,41,54,1],[41,56,41,59,1],[42,13,42,14,1],[43,17,43,62,1],[44,17,44,91,1],[45,13,45,14,1],[46,9,46,10,1],[50,9,50,10,1],[51,13,54,15,1],[56,13,56,50,1],[58,13,58,45,1],[59,13,59,75,1],[60,18,60,27,1],[60,29,60,54,1],[60,56,60,59,1],[61,13,61,14,1],[62,17,62,62,1],[63,17,63,91,1],[64,13,64,14,1],[65,9,65,10,1],[69,9,69,10,1],[70,13,73,15,1],[75,13,75,50,1],[77,13,77,45,1],[79,13,79,105,1],[80,18,80,27,1],[80,29,80,69,1],[80,71,80,74,1],[81,13,81,14,1],[82,17,82,77,1],[83,17,83,121,1],[84,13,84,14,1],[85,9,85,10,1],[89,9,89,10,1],[90,13,93,15,1],[95,13,95,50,1],[97,13,97,45,1],[98,13,98,75,1],[99,18,99,27,1],[99,29,99,54,1],[99,56,99,59,1],[100,13,100,14,1],[101,17,101,62,1],[102,17,102,91,1],[103,13,103,14,1],[104,9,104,10,1],[108,9,108,10,1],[109,13,112,15,1],[114,13,114,50,1],[116,13,116,45,1],[117,13,117,75,1],[118,18,118,27,1],[118,29,118,54,1],[118,56,118,59,1],[119,13,119,14,1],[120,17,120,62,1],[121,17,121,91,1],[122,13,122,14,1],[123,9,123,10,1],[127,9,127,10,1],[128,13,131,15,1],[133,13,133,50,1],[135,13,135,45,1],[136,13,136,75,1],[137,18,137,27,1],[137,29,137,54,1],[137,56,137,59,1],[138,13,138,14,1],[139,17,139,62,1],[140,17,140,91,1],[141,13,141,14,1],[142,9,142,10,1],[146,9,146,10,1],[147,13,155,15,1],[157,13,157,50,1],[160,13,160,58,1],[162,9,162,10,1],[166,34,166,38,0],[166,39,166,43,0],[167,30,167,34,0],[167,35,167,39,0],[169,36,169,40,1],[169,41,169,45,1],[170,36,170,40,1],[170,41,170,45,1],[176,34,176,38,0],[176,39,176,43,0],[177,36,177,40,0],[177,41,177,45,0],[182,34,182,38,0],[182,39,182,43,0],[183,39,183,43,1],[183,44,183,48,1],[189,34,189,38,0],[189,39,189,43,0],[190,38,190,42,1],[190,43,190,47,1],[196,34,196,38,0],[196,39,196,43,0],[197,42,197,46,1],[197,47,197,51,1],[203,34,203,38,0],[203,39,203,43,0],[204,49,204,53,1],[204,54,204,58,1],[210,34,210,38,0],[210,39,210,43,0],[211,42,211,46,1],[211,47,211,51,1],[217,34,217,38,0],[217,39,217,43,0],[218,49,218,53,1],[218,54,218,58,1],[225,13,225,14,1],[226,17,226,63,1],[227,17,227,69,1],[228,17,228,30,1],[229,13,229,14,1]]);
    </script>
  </body>
</html>