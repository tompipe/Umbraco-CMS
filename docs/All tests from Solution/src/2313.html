<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.MacroEngines\RazorDynamicNode\DynamicGrouping.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Collections;

namespace umbraco.MacroEngines
{
	public class DynamicGrouping : IEnumerable&lt;IGrouping&lt;object, DynamicNode&gt;&gt;, IEnumerable&lt;Grouping&lt;object, DynamicNode&gt;&gt;
    {
        public IEnumerable&lt;Grouping&lt;object, DynamicNode&gt;&gt; Inner;

        public DynamicGrouping OrderBy(string expression)
        {
            return this;
        }

        public DynamicGrouping(DynamicNodeList list, string groupBy)
        {
            Inner =
              list
              .Items
              .Select(node =&gt;
                {
                    string predicate = groupBy;
                    var internalList = new DynamicNodeList(new DynamicNode[] { node });
                    var query = (IQueryable&lt;object&gt;)internalList.Select(predicate, new object[] { });
                    var key = query.FirstOrDefault();
                    return new
                    {
                        Key = key,
                        Node = node
                    };
                })
              .Where(item =&gt; item.Key != null)
              .GroupBy(item =&gt; item.Key)
              .Select(item =&gt; new Grouping&lt;object, DynamicNode&gt;()
              {
                  Key = item.Key,
                  Elements = item.Select(inner =&gt; inner.Node)
              });
        }
        public DynamicGrouping(IEnumerable&lt;Grouping&lt;object, DynamicNode&gt;&gt; source)
        {
            this.Inner = source;
        }

		IEnumerator&lt;Grouping&lt;object, DynamicNode&gt;&gt; IEnumerable&lt;Grouping&lt;object, DynamicNode&gt;&gt;.GetEnumerator()
		{
			return Inner.GetEnumerator();
		}

		IEnumerator&lt;IGrouping&lt;object, DynamicNode&gt;&gt; IEnumerable&lt;IGrouping&lt;object, DynamicNode&gt;&gt;.GetEnumerator()
		{
			return Inner.GetEnumerator();
		}

		public IEnumerator GetEnumerator()
        {
            return Inner.GetEnumerator();
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,10,0],[15,13,15,25,0],[16,9,16,10,0],[18,9,18,69,1],[19,9,19,10,1],[20,13,24,17,1],[24,17,24,18,1],[24,18,25,21,1],[25,21,25,48,1],[25,48,26,21,1],[26,21,26,88,1],[26,88,27,21,1],[27,21,27,102,1],[27,102,28,21,1],[28,21,28,54,1],[28,54,29,21,1],[29,21,33,23,1],[33,23,34,17,1],[34,17,34,18,1],[34,18,35,30,1],[35,30,35,46,1],[35,46,36,32,1],[36,32,36,40,1],[36,40,37,31,1],[37,31,40,51,1],[40,51,40,61,1],[40,61,41,16,1],[37,31,41,16,1],[41,16,41,18,1],[20,13,41,18,1],[42,9,42,10,1],[43,9,43,82,0],[44,9,44,10,0],[45,13,45,33,0],[46,9,46,10,0],[49,3,49,4,0],[50,4,50,33,0],[51,3,51,4,0],[54,3,54,4,1],[55,4,55,33,1],[56,3,56,4,1],[59,9,59,10,0],[60,13,60,42,0],[61,9,61,10,0]]);
    </script>
  </body>
</html>