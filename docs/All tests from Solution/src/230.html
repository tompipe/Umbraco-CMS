<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Models\Mapping\ContentTypeModelMappingTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using AutoMapper;
using Moq;
using NUnit.Framework;
using umbraco;
using umbraco.cms.presentation;
using Umbraco.Core;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Persistence;
using Umbraco.Core.Persistence.SqlSyntax;
using Umbraco.Core.Profiling;
using Umbraco.Core.PropertyEditors;
using Umbraco.Core.Services;
using Umbraco.Tests.TestHelpers;
using Umbraco.Tests.TestHelpers.Entities;
using Umbraco.Web.Models.ContentEditing;
using Umbraco.Web.Models.Mapping;
using Umbraco.Web.PropertyEditors;

namespace Umbraco.Tests.Models.Mapping
{
    [TestFixture]
    public class ContentTypeModelMappingTests : BaseUmbracoConfigurationTest
    {
        //Mocks of services that can be setup on a test by test basis to return whatever we want
        private readonly Mock&lt;IContentTypeService&gt; _contentTypeService = new Mock&lt;IContentTypeService&gt;();
        private readonly Mock&lt;IContentService&gt; _contentService = new Mock&lt;IContentService&gt;();
        private readonly Mock&lt;IDataTypeService&gt; _dataTypeService = new Mock&lt;IDataTypeService&gt;();
        private Mock&lt;PropertyEditorResolver&gt; _propertyEditorResolver;
        private readonly Mock&lt;IEntityService&gt; _entityService = new Mock&lt;IEntityService&gt;();
        private readonly Mock&lt;IFileService&gt; _fileService = new Mock&lt;IFileService&gt;();

        [SetUp]
        public void Setup()
        {
            var nullCacheHelper = CacheHelper.CreateDisabledCacheHelper();

            //Create an app context using mocks
            var appContext = new ApplicationContext(
                new DatabaseContext(Mock.Of&lt;IDatabaseFactory&gt;(), Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;ISqlSyntaxProvider&gt;(), &quot;test&quot;),
                
                //Create service context using mocks
                new ServiceContext(

                    contentService: _contentService.Object,
                    contentTypeService:_contentTypeService.Object,
                    dataTypeService:_dataTypeService.Object,
                    entityService:_entityService.Object,
                    fileService: _fileService.Object),                    

                nullCacheHelper,
                new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));
            
            //create a fake property editor resolver to return fake property editors
            Func&lt;IEnumerable&lt;Type&gt;&gt; typeListProducerList = Enumerable.Empty&lt;Type&gt;;
            _propertyEditorResolver = new Mock&lt;PropertyEditorResolver&gt;(
                //ctor args
                Mock.Of&lt;IServiceProvider&gt;(), Mock.Of&lt;ILogger&gt;(), typeListProducerList, nullCacheHelper.RuntimeCache);
            
            Mapper.Initialize(configuration =&gt;
            {
                //initialize our content type mapper
                var mapper = new ContentTypeModelMapper(new Lazy&lt;PropertyEditorResolver&gt;(() =&gt; _propertyEditorResolver.Object));
                mapper.ConfigureMappings(configuration, appContext);
                var entityMapper = new EntityModelMapper();
                entityMapper.ConfigureMappings(configuration, appContext);
            });
        }

        [Test]
        public void MemberTypeSave_To_IMemberType()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(Mock.Of&lt;IDataTypeDefinition&gt;(
                    definition =&gt;
                        definition.Id == 555
                        &amp;&amp; definition.PropertyEditorAlias == &quot;myPropertyType&quot;
                        &amp;&amp; definition.DatabaseType == DataTypeDatabaseType.Nvarchar));

            var display = CreateMemberTypeSave();

            //Act

            var result = Mapper.Map&lt;IMemberType&gt;(display);

            //Assert

            Assert.AreEqual(display.Alias, result.Alias);
            Assert.AreEqual(display.Description, result.Description);
            Assert.AreEqual(display.Icon, result.Icon);
            Assert.AreEqual(display.Id, result.Id);
            Assert.AreEqual(display.Name, result.Name);
            Assert.AreEqual(display.ParentId, result.ParentId);
            Assert.AreEqual(display.Path, result.Path);
            Assert.AreEqual(display.Thumbnail, result.Thumbnail);
            Assert.AreEqual(display.IsContainer, result.IsContainer);
            Assert.AreEqual(display.AllowAsRoot, result.AllowedAsRoot);
            Assert.AreEqual(display.CreateDate, result.CreateDate);
            Assert.AreEqual(display.UpdateDate, result.UpdateDate);

            //TODO: Now we need to assert all of the more complicated parts
            Assert.AreEqual(display.Groups.Count(), result.PropertyGroups.Count);
            for (var i = 0; i &lt; display.Groups.Count(); i++)
            {
                Assert.AreEqual(display.Groups.ElementAt(i).Id, result.PropertyGroups.ElementAt(i).Id);
                Assert.AreEqual(display.Groups.ElementAt(i).Name, result.PropertyGroups.ElementAt(i).Name);
                var propTypes = display.Groups.ElementAt(i).Properties;
                Assert.AreEqual(propTypes.Count(), result.PropertyTypes.Count());
                for (var j = 0; j &lt; propTypes.Count(); j++)
                {
                    Assert.AreEqual(propTypes.ElementAt(j).Id, result.PropertyTypes.ElementAt(j).Id);
                    Assert.AreEqual(propTypes.ElementAt(j).DataTypeId, result.PropertyTypes.ElementAt(j).DataTypeDefinitionId);
                    Assert.AreEqual(propTypes.ElementAt(j).MemberCanViewProperty, result.MemberCanViewProperty(result.PropertyTypes.ElementAt(j).Alias));
                    Assert.AreEqual(propTypes.ElementAt(j).MemberCanEditProperty, result.MemberCanEditProperty(result.PropertyTypes.ElementAt(j).Alias));
                }
            }

            Assert.AreEqual(display.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; display.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(display.AllowedContentTypes.ElementAt(i), result.AllowedContentTypes.ElementAt(i).Id.Value);
            }
        }

        [Test]
        public void MediaTypeSave_To_IMediaType()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(Mock.Of&lt;IDataTypeDefinition&gt;(
                    definition =&gt;
                        definition.Id == 555
                        &amp;&amp; definition.PropertyEditorAlias == &quot;myPropertyType&quot;
                        &amp;&amp; definition.DatabaseType == DataTypeDatabaseType.Nvarchar));            

            var display = CreateMediaTypeSave();

            //Act

            var result = Mapper.Map&lt;IMediaType&gt;(display);

            //Assert

            Assert.AreEqual(display.Alias, result.Alias);
            Assert.AreEqual(display.Description, result.Description);
            Assert.AreEqual(display.Icon, result.Icon);
            Assert.AreEqual(display.Id, result.Id);
            Assert.AreEqual(display.Name, result.Name);
            Assert.AreEqual(display.ParentId, result.ParentId);
            Assert.AreEqual(display.Path, result.Path);
            Assert.AreEqual(display.Thumbnail, result.Thumbnail);
            Assert.AreEqual(display.IsContainer, result.IsContainer);
            Assert.AreEqual(display.AllowAsRoot, result.AllowedAsRoot);
            Assert.AreEqual(display.CreateDate, result.CreateDate);
            Assert.AreEqual(display.UpdateDate, result.UpdateDate);

            //TODO: Now we need to assert all of the more complicated parts
            Assert.AreEqual(display.Groups.Count(), result.PropertyGroups.Count);
            for (var i = 0; i &lt; display.Groups.Count(); i++)
            {
                Assert.AreEqual(display.Groups.ElementAt(i).Id, result.PropertyGroups.ElementAt(i).Id);
                Assert.AreEqual(display.Groups.ElementAt(i).Name, result.PropertyGroups.ElementAt(i).Name);
                var propTypes = display.Groups.ElementAt(i).Properties;
                Assert.AreEqual(propTypes.Count(), result.PropertyTypes.Count());
                for (var j = 0; j &lt; propTypes.Count(); j++)
                {
                    Assert.AreEqual(propTypes.ElementAt(j).Id, result.PropertyTypes.ElementAt(j).Id);
                    Assert.AreEqual(propTypes.ElementAt(j).DataTypeId, result.PropertyTypes.ElementAt(j).DataTypeDefinitionId);
                }
            }            

            Assert.AreEqual(display.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; display.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(display.AllowedContentTypes.ElementAt(i), result.AllowedContentTypes.ElementAt(i).Id.Value);
            }
        }

        [Test]
        public void ContentTypeSave_To_IContentType()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...
            
            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(Mock.Of&lt;IDataTypeDefinition&gt;(
                    definition =&gt; 
                        definition.Id == 555 
                        &amp;&amp; definition.PropertyEditorAlias == &quot;myPropertyType&quot;
                        &amp;&amp; definition.DatabaseType == DataTypeDatabaseType.Nvarchar));


            _fileService.Setup(x =&gt; x.GetTemplate(It.IsAny&lt;string&gt;()))
                .Returns((string alias) =&gt; Mock.Of&lt;ITemplate&gt;(
                    definition =&gt;
                        definition.Id == alias.GetHashCode() &amp;&amp; definition.Alias == alias));
                

            var display = CreateContentTypeSave();

            //Act

            var result = Mapper.Map&lt;IContentType&gt;(display);

            //Assert

            Assert.AreEqual(display.Alias, result.Alias);
            Assert.AreEqual(display.Description, result.Description);
            Assert.AreEqual(display.Icon, result.Icon);
            Assert.AreEqual(display.Id, result.Id);
            Assert.AreEqual(display.Name, result.Name);
            Assert.AreEqual(display.ParentId, result.ParentId);
            Assert.AreEqual(display.Path, result.Path);
            Assert.AreEqual(display.Thumbnail, result.Thumbnail);
            Assert.AreEqual(display.IsContainer, result.IsContainer);
            Assert.AreEqual(display.AllowAsRoot, result.AllowedAsRoot);
            Assert.AreEqual(display.CreateDate, result.CreateDate);
            Assert.AreEqual(display.UpdateDate, result.UpdateDate);
            
            //TODO: Now we need to assert all of the more complicated parts
            Assert.AreEqual(display.Groups.Count(), result.PropertyGroups.Count);
            for (var i = 0; i &lt; display.Groups.Count(); i++)
            {
                Assert.AreEqual(display.Groups.ElementAt(i).Id, result.PropertyGroups.ElementAt(i).Id);
                Assert.AreEqual(display.Groups.ElementAt(i).Name, result.PropertyGroups.ElementAt(i).Name);
                var propTypes = display.Groups.ElementAt(i).Properties;
                Assert.AreEqual(propTypes.Count(), result.PropertyTypes.Count());
                for (var j = 0; j &lt; propTypes.Count(); j++)
                {
                    Assert.AreEqual(propTypes.ElementAt(j).Id, result.PropertyTypes.ElementAt(j).Id);
                    Assert.AreEqual(propTypes.ElementAt(j).DataTypeId, result.PropertyTypes.ElementAt(j).DataTypeDefinitionId);
                }
            }

            var allowedTemplateAliases = display.AllowedTemplates
                .Concat(new[] {display.DefaultTemplate})
                .Distinct();

            Assert.AreEqual(allowedTemplateAliases.Count(), result.AllowedTemplates.Count());
            for (var i = 0; i &lt; display.AllowedTemplates.Count(); i++)
            {
                Assert.AreEqual(display.AllowedTemplates.ElementAt(i), result.AllowedTemplates.ElementAt(i).Alias);
            }

            Assert.AreEqual(display.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; display.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(display.AllowedContentTypes.ElementAt(i), result.AllowedContentTypes.ElementAt(i).Id.Value);
            }
        }

        [Test]
        public void MediaTypeSave_With_Composition_To_IMediaType()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(Mock.Of&lt;IDataTypeDefinition&gt;(
                    definition =&gt;
                        definition.Id == 555
                        &amp;&amp; definition.PropertyEditorAlias == &quot;myPropertyType&quot;
                        &amp;&amp; definition.DatabaseType == DataTypeDatabaseType.Nvarchar));


            var display = CreateCompositionMediaTypeSave();

            //Act

            var result = Mapper.Map&lt;IMediaType&gt;(display);

            //Assert

            //TODO: Now we need to assert all of the more complicated parts
            Assert.AreEqual(display.Groups.Count(x =&gt; x.Inherited == false), result.PropertyGroups.Count);
        }

        [Test]
        public void ContentTypeSave_With_Composition_To_IContentType()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(Mock.Of&lt;IDataTypeDefinition&gt;(
                    definition =&gt;
                        definition.Id == 555
                        &amp;&amp; definition.PropertyEditorAlias == &quot;myPropertyType&quot;
                        &amp;&amp; definition.DatabaseType == DataTypeDatabaseType.Nvarchar));


            var display = CreateCompositionContentTypeSave();

            //Act

            var result = Mapper.Map&lt;IContentType&gt;(display);

            //Assert

            //TODO: Now we need to assert all of the more complicated parts
            Assert.AreEqual(display.Groups.Count(x =&gt; x.Inherited == false), result.PropertyGroups.Count);
        }

        [Test]
        public void IMemberType_To_MemberTypeDisplay()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            // for any call to GetPreValuesCollectionByDataTypeId just return an empty dictionary for now
            // TODO: but we&#39;ll need to change this to return some pre-values to test the mappings
            _dataTypeService.Setup(x =&gt; x.GetPreValuesCollectionByDataTypeId(It.IsAny&lt;int&gt;()))
                .Returns(new PreValueCollection(new Dictionary&lt;string, PreValue&gt;()));

            //return a textbox property editor for any requested editor by alias
            _propertyEditorResolver.Setup(resolver =&gt; resolver.GetByAlias(It.IsAny&lt;string&gt;()))
                .Returns(new TextboxPropertyEditor());
            //for testing, just return a list of whatever property editors we want
            _propertyEditorResolver.Setup(resolver =&gt; resolver.PropertyEditors)
                .Returns(new[] { new TextboxPropertyEditor() });

            var memberType = MockedContentTypes.CreateSimpleMemberType();
            memberType.MemberTypePropertyTypes[memberType.PropertyTypes.Last().Alias] = new MemberTypePropertyProfileAccess(true, true);
            
            MockedContentTypes.EnsureAllIds(memberType, 8888);

            //Act

            var result = Mapper.Map&lt;MemberTypeDisplay&gt;(memberType);

            //Assert

            Assert.AreEqual(memberType.Alias, result.Alias);
            Assert.AreEqual(memberType.Description, result.Description);
            Assert.AreEqual(memberType.Icon, result.Icon);
            Assert.AreEqual(memberType.Id, result.Id);
            Assert.AreEqual(memberType.Name, result.Name);
            Assert.AreEqual(memberType.ParentId, result.ParentId);
            Assert.AreEqual(memberType.Path, result.Path);
            Assert.AreEqual(memberType.Thumbnail, result.Thumbnail);
            Assert.AreEqual(memberType.IsContainer, result.IsContainer);
            Assert.AreEqual(memberType.CreateDate, result.CreateDate);
            Assert.AreEqual(memberType.UpdateDate, result.UpdateDate);

            //TODO: Now we need to assert all of the more complicated parts

            Assert.AreEqual(memberType.PropertyGroups.Count(), result.Groups.Count());
            for (var i = 0; i &lt; memberType.PropertyGroups.Count(); i++)
            {
                Assert.AreEqual(memberType.PropertyGroups.ElementAt(i).Id, result.Groups.ElementAt(i).Id);
                Assert.AreEqual(memberType.PropertyGroups.ElementAt(i).Name, result.Groups.ElementAt(i).Name);
                var propTypes = memberType.PropertyGroups.ElementAt(i).PropertyTypes;

                Assert.AreEqual(propTypes.Count(), result.Groups.ElementAt(i).Properties.Count());
                for (var j = 0; j &lt; propTypes.Count(); j++)
                {
                    Assert.AreEqual(propTypes.ElementAt(j).Id, result.Groups.ElementAt(i).Properties.ElementAt(j).Id);
                    Assert.AreEqual(propTypes.ElementAt(j).DataTypeDefinitionId, result.Groups.ElementAt(i).Properties.ElementAt(j).DataTypeId);
                    
                    Assert.AreEqual(memberType.MemberCanViewProperty(propTypes.ElementAt(j).Alias), result.Groups.ElementAt(i).Properties.ElementAt(j).MemberCanViewProperty);
                    Assert.AreEqual(memberType.MemberCanEditProperty(propTypes.ElementAt(j).Alias), result.Groups.ElementAt(i).Properties.ElementAt(j).MemberCanEditProperty);
                }
            }

            Assert.AreEqual(memberType.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; memberType.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(memberType.AllowedContentTypes.ElementAt(i).Id.Value, result.AllowedContentTypes.ElementAt(i));
            }

        }

        [Test]
        public void IMediaType_To_MediaTypeDisplay()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            // for any call to GetPreValuesCollectionByDataTypeId just return an empty dictionary for now
            // TODO: but we&#39;ll need to change this to return some pre-values to test the mappings
            _dataTypeService.Setup(x =&gt; x.GetPreValuesCollectionByDataTypeId(It.IsAny&lt;int&gt;()))
                .Returns(new PreValueCollection(new Dictionary&lt;string, PreValue&gt;()));

            //return a textbox property editor for any requested editor by alias
            _propertyEditorResolver.Setup(resolver =&gt; resolver.GetByAlias(It.IsAny&lt;string&gt;()))
                .Returns(new TextboxPropertyEditor());
            //for testing, just return a list of whatever property editors we want
            _propertyEditorResolver.Setup(resolver =&gt; resolver.PropertyEditors)
                .Returns(new[] { new TextboxPropertyEditor() });

            var mediaType = MockedContentTypes.CreateImageMediaType();
            MockedContentTypes.EnsureAllIds(mediaType, 8888);

            //Act

            var result = Mapper.Map&lt;MediaTypeDisplay&gt;(mediaType);

            //Assert

            Assert.AreEqual(mediaType.Alias, result.Alias);
            Assert.AreEqual(mediaType.Description, result.Description);
            Assert.AreEqual(mediaType.Icon, result.Icon);
            Assert.AreEqual(mediaType.Id, result.Id);
            Assert.AreEqual(mediaType.Name, result.Name);
            Assert.AreEqual(mediaType.ParentId, result.ParentId);
            Assert.AreEqual(mediaType.Path, result.Path);
            Assert.AreEqual(mediaType.Thumbnail, result.Thumbnail);
            Assert.AreEqual(mediaType.IsContainer, result.IsContainer);
            Assert.AreEqual(mediaType.CreateDate, result.CreateDate);
            Assert.AreEqual(mediaType.UpdateDate, result.UpdateDate);

            //TODO: Now we need to assert all of the more complicated parts

            Assert.AreEqual(mediaType.PropertyGroups.Count(), result.Groups.Count());
            for (var i = 0; i &lt; mediaType.PropertyGroups.Count(); i++)
            {
                Assert.AreEqual(mediaType.PropertyGroups.ElementAt(i).Id, result.Groups.ElementAt(i).Id);
                Assert.AreEqual(mediaType.PropertyGroups.ElementAt(i).Name, result.Groups.ElementAt(i).Name);
                var propTypes = mediaType.PropertyGroups.ElementAt(i).PropertyTypes;

                Assert.AreEqual(propTypes.Count(), result.Groups.ElementAt(i).Properties.Count());
                for (var j = 0; j &lt; propTypes.Count(); j++)
                {
                    Assert.AreEqual(propTypes.ElementAt(j).Id, result.Groups.ElementAt(i).Properties.ElementAt(j).Id);
                    Assert.AreEqual(propTypes.ElementAt(j).DataTypeDefinitionId, result.Groups.ElementAt(i).Properties.ElementAt(j).DataTypeId);
                }
            }
            
            Assert.AreEqual(mediaType.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; mediaType.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(mediaType.AllowedContentTypes.ElementAt(i).Id.Value, result.AllowedContentTypes.ElementAt(i));
            }

        }

        [Test]
        public void IContentType_To_ContentTypeDisplay()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            // for any call to GetPreValuesCollectionByDataTypeId just return an empty dictionary for now
            // TODO: but we&#39;ll need to change this to return some pre-values to test the mappings
            _dataTypeService.Setup(x =&gt; x.GetPreValuesCollectionByDataTypeId(It.IsAny&lt;int&gt;()))
                .Returns(new PreValueCollection(new Dictionary&lt;string, PreValue&gt;()));

            //return a textbox property editor for any requested editor by alias
            _propertyEditorResolver.Setup(resolver =&gt; resolver.GetByAlias(It.IsAny&lt;string&gt;()))
                .Returns(new TextboxPropertyEditor());
            //for testing, just return a list of whatever property editors we want
            _propertyEditorResolver.Setup(resolver =&gt; resolver.PropertyEditors)
                .Returns(new[] { new TextboxPropertyEditor() });
            
            var contentType = MockedContentTypes.CreateTextpageContentType();
            MockedContentTypes.EnsureAllIds(contentType, 8888);

            //Act

            var result = Mapper.Map&lt;DocumentTypeDisplay&gt;(contentType);

            //Assert

            Assert.AreEqual(contentType.Alias, result.Alias);
            Assert.AreEqual(contentType.Description, result.Description);
            Assert.AreEqual(contentType.Icon, result.Icon);
            Assert.AreEqual(contentType.Id, result.Id);
            Assert.AreEqual(contentType.Name, result.Name);
            Assert.AreEqual(contentType.ParentId, result.ParentId);
            Assert.AreEqual(contentType.Path, result.Path);
            Assert.AreEqual(contentType.Thumbnail, result.Thumbnail);
            Assert.AreEqual(contentType.IsContainer, result.IsContainer);
            Assert.AreEqual(contentType.CreateDate, result.CreateDate);
            Assert.AreEqual(contentType.UpdateDate, result.UpdateDate);
            Assert.AreEqual(contentType.DefaultTemplate.Alias, result.DefaultTemplate.Alias);

            //TODO: Now we need to assert all of the more complicated parts

            Assert.AreEqual(contentType.PropertyGroups.Count(), result.Groups.Count());
            for (var i = 0; i &lt; contentType.PropertyGroups.Count(); i++)
            {
                Assert.AreEqual(contentType.PropertyGroups.ElementAt(i).Id, result.Groups.ElementAt(i).Id);
                Assert.AreEqual(contentType.PropertyGroups.ElementAt(i).Name, result.Groups.ElementAt(i).Name);
                var propTypes = contentType.PropertyGroups.ElementAt(i).PropertyTypes;

                Assert.AreEqual(propTypes.Count(), result.Groups.ElementAt(i).Properties.Count());
                for (var j = 0; j &lt; propTypes.Count(); j++)
                {
                    Assert.AreEqual(propTypes.ElementAt(j).Id, result.Groups.ElementAt(i).Properties.ElementAt(j).Id);
                    Assert.AreEqual(propTypes.ElementAt(j).DataTypeDefinitionId, result.Groups.ElementAt(i).Properties.ElementAt(j).DataTypeId);
                }
            }

            Assert.AreEqual(contentType.AllowedTemplates.Count(), result.AllowedTemplates.Count());
            for (var i = 0; i &lt; contentType.AllowedTemplates.Count(); i++)
            {
                Assert.AreEqual(contentType.AllowedTemplates.ElementAt(i).Id, result.AllowedTemplates.ElementAt(i).Id);
            }

            Assert.AreEqual(contentType.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; contentType.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(contentType.AllowedContentTypes.ElementAt(i).Id.Value, result.AllowedContentTypes.ElementAt(i));
            }

        }

        [Test]
        public void MemberPropertyGroupBasic_To_MemberPropertyGroup()
        {
            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(new DataTypeDefinition(&quot;test&quot;));

            var basic = new PropertyGroupBasic&lt;MemberPropertyTypeBasic&gt;
            {
                Id = 222,
                Name = &quot;Group 1&quot;,
                SortOrder = 1,
                Properties = new[]
                {
                    new MemberPropertyTypeBasic()
                    {
                        MemberCanEditProperty = true,
                        MemberCanViewProperty = true,
                        Id = 33,
                        SortOrder = 1,
                        Alias = &quot;prop1&quot;,
                        Description = &quot;property 1&quot;,
                        DataTypeId = 99,
                        GroupId = 222,
                        Label = &quot;Prop 1&quot;,
                        Validation = new PropertyTypeValidation()
                        {
                            Mandatory = true,
                            Pattern = null
                        }
                    },
                    new MemberPropertyTypeBasic()
                    {
                        MemberCanViewProperty = false,
                        MemberCanEditProperty = false,
                        Id = 34,
                        SortOrder = 2,
                        Alias = &quot;prop2&quot;,
                        Description = &quot;property 2&quot;,
                        DataTypeId = 99,
                        GroupId = 222,
                        Label = &quot;Prop 2&quot;,
                        Validation = new PropertyTypeValidation()
                        {
                            Mandatory = false,
                            Pattern = null
                        }
                    },
                }
            };

            var contentType = new MemberTypeSave
            {
                Id = 0,
                ParentId = -1,
                Alias = &quot;alias&quot;,
                Groups = new[] { basic }
            };

            // proper group properties mapping takes place when mapping the content type,
            // not when mapping the group - because of inherited properties and such
            //var result = Mapper.Map&lt;PropertyGroup&gt;(basic);
            var result = Mapper.Map&lt;IMemberType&gt;(contentType).PropertyGroups[0];

            Assert.AreEqual(basic.Name, result.Name);
            Assert.AreEqual(basic.Id, result.Id);
            Assert.AreEqual(basic.SortOrder, result.SortOrder);
            Assert.AreEqual(basic.Properties.Count(), result.PropertyTypes.Count());
        }

        [Test]
        public void PropertyGroupBasic_To_PropertyGroup()
        {
            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(new DataTypeDefinition(&quot;test&quot;));

            var basic = new PropertyGroupBasic&lt;PropertyTypeBasic&gt;
            {
                Id = 222,
                Name = &quot;Group 1&quot;,
                SortOrder = 1,
                Properties = new[]
                {
                    new PropertyTypeBasic()
                    {
                        Id = 33,
                        SortOrder = 1,
                        Alias = &quot;prop1&quot;,
                        Description = &quot;property 1&quot;,
                        DataTypeId = 99,
                        GroupId = 222,
                        Label = &quot;Prop 1&quot;,
                        Validation = new PropertyTypeValidation()
                        {
                            Mandatory = true,
                            Pattern = null
                        }
                    },
                    new PropertyTypeBasic()
                    {
                        Id = 34,
                        SortOrder = 2,
                        Alias = &quot;prop2&quot;,
                        Description = &quot;property 2&quot;,
                        DataTypeId = 99,
                        GroupId = 222,
                        Label = &quot;Prop 2&quot;,
                        Validation = new PropertyTypeValidation()
                        {
                            Mandatory = false,
                            Pattern = null
                        }
                    },
                }
            };

            var contentType = new DocumentTypeSave
            {
                Id = 0,
                ParentId = -1,
                Alias = &quot;alias&quot;,
                AllowedTemplates = Enumerable.Empty&lt;string&gt;(),
                Groups = new[] { basic }
            };

            // proper group properties mapping takes place when mapping the content type,
            // not when mapping the group - because of inherited properties and such
            //var result = Mapper.Map&lt;PropertyGroup&gt;(basic);
            var result = Mapper.Map&lt;IContentType&gt;(contentType).PropertyGroups[0];

            Assert.AreEqual(basic.Name, result.Name);
            Assert.AreEqual(basic.Id, result.Id);
            Assert.AreEqual(basic.SortOrder, result.SortOrder);
            Assert.AreEqual(basic.Properties.Count(), result.PropertyTypes.Count());
        }

        [Test]
        public void MemberPropertyTypeBasic_To_PropertyType()
        {
            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(new DataTypeDefinition(&quot;test&quot;));

            var basic = new MemberPropertyTypeBasic()
            {
                Id = 33,
                SortOrder = 1,
                Alias = &quot;prop1&quot;,
                Description = &quot;property 1&quot;,
                DataTypeId = 99,
                GroupId = 222,
                Label = &quot;Prop 1&quot;,
                Validation = new PropertyTypeValidation()
                {
                    Mandatory = true,
                    Pattern = &quot;xyz&quot;
                }
            };

            var result = Mapper.Map&lt;PropertyType&gt;(basic);

            Assert.AreEqual(basic.Id, result.Id);
            Assert.AreEqual(basic.SortOrder, result.SortOrder);
            Assert.AreEqual(basic.Alias, result.Alias);
            Assert.AreEqual(basic.Description, result.Description);
            Assert.AreEqual(basic.DataTypeId, result.DataTypeDefinitionId);
            Assert.AreEqual(basic.Label, result.Name);
            Assert.AreEqual(basic.Validation.Mandatory, result.Mandatory);
            Assert.AreEqual(basic.Validation.Pattern, result.ValidationRegExp);
        }

        [Test]
        public void PropertyTypeBasic_To_PropertyType()
        {
            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(new DataTypeDefinition(&quot;test&quot;));

            var basic = new PropertyTypeBasic()
            {
                Id = 33,
                SortOrder = 1,
                Alias = &quot;prop1&quot;,
                Description = &quot;property 1&quot;,
                DataTypeId = 99,
                GroupId = 222,
                Label = &quot;Prop 1&quot;,
                Validation = new PropertyTypeValidation()
                {
                    Mandatory = true,
                    Pattern = &quot;xyz&quot;
                }
            };

            var result = Mapper.Map&lt;PropertyType&gt;(basic);

            Assert.AreEqual(basic.Id, result.Id);
            Assert.AreEqual(basic.SortOrder, result.SortOrder);
            Assert.AreEqual(basic.Alias, result.Alias);
            Assert.AreEqual(basic.Description, result.Description);
            Assert.AreEqual(basic.DataTypeId, result.DataTypeDefinitionId);           
            Assert.AreEqual(basic.Label, result.Name);
            Assert.AreEqual(basic.Validation.Mandatory, result.Mandatory);
            Assert.AreEqual(basic.Validation.Pattern, result.ValidationRegExp);
        }

        [Test]
        public void IMediaTypeComposition_To_MediaTypeDisplay()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            // for any call to GetPreValuesCollectionByDataTypeId just return an empty dictionary for now
            // TODO: but we&#39;ll need to change this to return some pre-values to test the mappings
            _dataTypeService.Setup(x =&gt; x.GetPreValuesCollectionByDataTypeId(It.IsAny&lt;int&gt;()))
                .Returns(new PreValueCollection(new Dictionary&lt;string, PreValue&gt;()));

            _entityService.Setup(x =&gt; x.GetObjectType(It.IsAny&lt;int&gt;()))
                .Returns(UmbracoObjectTypes.DocumentType);

            //return a textbox property editor for any requested editor by alias
            _propertyEditorResolver.Setup(resolver =&gt; resolver.GetByAlias(It.IsAny&lt;string&gt;()))
                .Returns(new TextboxPropertyEditor());
            //for testing, just return a list of whatever property editors we want
            _propertyEditorResolver.Setup(resolver =&gt; resolver.PropertyEditors)
                .Returns(new[] { new TextboxPropertyEditor() });

            var ctMain = MockedContentTypes.CreateSimpleMediaType(&quot;parent&quot;, &quot;Parent&quot;);
            //not assigned to tab
            ctMain.AddPropertyType(new PropertyType(Constants.PropertyEditors.TextboxAlias, DataTypeDatabaseType.Ntext)
            {
                Alias = &quot;umbracoUrlName&quot;,
                Name = &quot;Slug&quot;,
                Description = &quot;&quot;,
                Mandatory = false,
                SortOrder = 1,
                DataTypeDefinitionId = -88
            });
            MockedContentTypes.EnsureAllIds(ctMain, 8888);
            var ctChild1 = MockedContentTypes.CreateSimpleMediaType(&quot;child1&quot;, &quot;Child 1&quot;, ctMain, true);
            ctChild1.AddPropertyType(new PropertyType(Constants.PropertyEditors.TextboxAlias, DataTypeDatabaseType.Ntext)
            {
                Alias = &quot;someProperty&quot;,
                Name = &quot;Some Property&quot;,
                Description = &quot;&quot;,
                Mandatory = false,
                SortOrder = 1,
                DataTypeDefinitionId = -88
            }, &quot;Another tab&quot;);
            MockedContentTypes.EnsureAllIds(ctChild1, 7777);
            var contentType = MockedContentTypes.CreateSimpleMediaType(&quot;child2&quot;, &quot;Child 2&quot;, ctChild1, true, &quot;CustomGroup&quot;);
            //not assigned to tab
            contentType.AddPropertyType(new PropertyType(Constants.PropertyEditors.TextboxAlias, DataTypeDatabaseType.Ntext)
            {
                Alias = &quot;umbracoUrlAlias&quot;,
                Name = &quot;AltUrl&quot;,
                Description = &quot;&quot;,
                Mandatory = false,
                SortOrder = 1,
                DataTypeDefinitionId = -88
            });
            MockedContentTypes.EnsureAllIds(contentType, 6666);


            //Act

            var result = Mapper.Map&lt;MediaTypeDisplay&gt;(contentType);

            //Assert

            Assert.AreEqual(contentType.Alias, result.Alias);
            Assert.AreEqual(contentType.Description, result.Description);
            Assert.AreEqual(contentType.Icon, result.Icon);
            Assert.AreEqual(contentType.Id, result.Id);
            Assert.AreEqual(contentType.Name, result.Name);
            Assert.AreEqual(contentType.ParentId, result.ParentId);
            Assert.AreEqual(contentType.Path, result.Path);
            Assert.AreEqual(contentType.Thumbnail, result.Thumbnail);
            Assert.AreEqual(contentType.IsContainer, result.IsContainer);
            Assert.AreEqual(contentType.CreateDate, result.CreateDate);
            Assert.AreEqual(contentType.UpdateDate, result.UpdateDate);

            //TODO: Now we need to assert all of the more complicated parts

            Assert.AreEqual(contentType.CompositionPropertyGroups.Select(x =&gt; x.Name).Distinct().Count(), result.Groups.Count(x =&gt; x.IsGenericProperties == false));
            Assert.AreEqual(1, result.Groups.Count(x =&gt; x.IsGenericProperties));
            Assert.AreEqual(contentType.PropertyGroups.Count(), result.Groups.Count(x =&gt; x.Inherited == false &amp;&amp; x.IsGenericProperties == false));

            var allPropertiesMapped = result.Groups.SelectMany(x =&gt; x.Properties).ToArray();
            var allPropertyIdsMapped = allPropertiesMapped.Select(x =&gt; x.Id).ToArray();
            var allSourcePropertyIds = contentType.CompositionPropertyTypes.Select(x =&gt; x.Id).ToArray();

            Assert.AreEqual(contentType.PropertyTypes.Count(), allPropertiesMapped.Count(x =&gt; x.Inherited == false));
            Assert.AreEqual(allPropertyIdsMapped.Count(), allSourcePropertyIds.Count());
            Assert.IsTrue(allPropertyIdsMapped.ContainsAll(allSourcePropertyIds));

            Assert.AreEqual(2, result.Groups.Count(x =&gt; x.ParentTabContentTypes.Any()));
            Assert.IsTrue(result.Groups.SelectMany(x =&gt; x.ParentTabContentTypes).ContainsAll(new[] { ctMain.Id, ctChild1.Id }));

            
            Assert.AreEqual(contentType.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; contentType.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(contentType.AllowedContentTypes.ElementAt(i).Id.Value, result.AllowedContentTypes.ElementAt(i));
            }

        }

        [Test]
        public void IContentTypeComposition_To_ContentTypeDisplay()
        {
            //Arrange

            // setup the mocks to return the data we want to test against...

            // for any call to GetPreValuesCollectionByDataTypeId just return an empty dictionary for now
            // TODO: but we&#39;ll need to change this to return some pre-values to test the mappings
            _dataTypeService.Setup(x =&gt; x.GetPreValuesCollectionByDataTypeId(It.IsAny&lt;int&gt;()))
                .Returns(new PreValueCollection(new Dictionary&lt;string, PreValue&gt;()));

            _entityService.Setup(x =&gt; x.GetObjectType(It.IsAny&lt;int&gt;()))
                .Returns(UmbracoObjectTypes.DocumentType);

            //return a textbox property editor for any requested editor by alias
            _propertyEditorResolver.Setup(resolver =&gt; resolver.GetByAlias(It.IsAny&lt;string&gt;()))
                .Returns(new TextboxPropertyEditor());
            //for testing, just return a list of whatever property editors we want
            _propertyEditorResolver.Setup(resolver =&gt; resolver.PropertyEditors)
                .Returns(new[] { new TextboxPropertyEditor() });

            var ctMain = MockedContentTypes.CreateSimpleContentType();
            //not assigned to tab
            ctMain.AddPropertyType(new PropertyType(Constants.PropertyEditors.TextboxAlias, DataTypeDatabaseType.Ntext)
            {
                Alias = &quot;umbracoUrlName&quot;, Name = &quot;Slug&quot;, Description = &quot;&quot;, Mandatory = false, SortOrder = 1, DataTypeDefinitionId = -88
            });
            MockedContentTypes.EnsureAllIds(ctMain, 8888);
            var ctChild1 = MockedContentTypes.CreateSimpleContentType(&quot;child1&quot;, &quot;Child 1&quot;, ctMain, true);
            ctChild1.AddPropertyType(new PropertyType(Constants.PropertyEditors.TextboxAlias, DataTypeDatabaseType.Ntext)
            {
                Alias = &quot;someProperty&quot;,
                Name = &quot;Some Property&quot;,
                Description = &quot;&quot;,
                Mandatory = false,
                SortOrder = 1,
                DataTypeDefinitionId = -88
            }, &quot;Another tab&quot;);
            MockedContentTypes.EnsureAllIds(ctChild1, 7777);
            var contentType = MockedContentTypes.CreateSimpleContentType(&quot;child2&quot;, &quot;Child 2&quot;, ctChild1, true, &quot;CustomGroup&quot;);
            //not assigned to tab
            contentType.AddPropertyType(new PropertyType(Constants.PropertyEditors.TextboxAlias, DataTypeDatabaseType.Ntext)
            {
                Alias = &quot;umbracoUrlAlias&quot;, Name = &quot;AltUrl&quot;, Description = &quot;&quot;, Mandatory = false, SortOrder = 1, DataTypeDefinitionId = -88
            });
            MockedContentTypes.EnsureAllIds(contentType, 6666);
            

            //Act

            var result = Mapper.Map&lt;DocumentTypeDisplay&gt;(contentType);

            //Assert

            Assert.AreEqual(contentType.Alias, result.Alias);
            Assert.AreEqual(contentType.Description, result.Description);
            Assert.AreEqual(contentType.Icon, result.Icon);
            Assert.AreEqual(contentType.Id, result.Id);
            Assert.AreEqual(contentType.Name, result.Name);
            Assert.AreEqual(contentType.ParentId, result.ParentId);
            Assert.AreEqual(contentType.Path, result.Path);
            Assert.AreEqual(contentType.Thumbnail, result.Thumbnail);
            Assert.AreEqual(contentType.IsContainer, result.IsContainer);
            Assert.AreEqual(contentType.CreateDate, result.CreateDate);
            Assert.AreEqual(contentType.UpdateDate, result.UpdateDate);
            Assert.AreEqual(contentType.DefaultTemplate.Alias, result.DefaultTemplate.Alias);

            //TODO: Now we need to assert all of the more complicated parts

            Assert.AreEqual(contentType.CompositionPropertyGroups.Select(x =&gt; x.Name).Distinct().Count(), result.Groups.Count(x =&gt; x.IsGenericProperties == false));
            Assert.AreEqual(1, result.Groups.Count(x =&gt; x.IsGenericProperties));
            Assert.AreEqual(contentType.PropertyGroups.Count(), result.Groups.Count(x =&gt; x.Inherited == false &amp;&amp; x.IsGenericProperties == false));

            var allPropertiesMapped = result.Groups.SelectMany(x =&gt; x.Properties).ToArray();
            var allPropertyIdsMapped = allPropertiesMapped.Select(x =&gt; x.Id).ToArray();
            var allSourcePropertyIds = contentType.CompositionPropertyTypes.Select(x =&gt; x.Id).ToArray();

            Assert.AreEqual(contentType.PropertyTypes.Count(), allPropertiesMapped.Count(x =&gt; x.Inherited == false));
            Assert.AreEqual(allPropertyIdsMapped.Count(), allSourcePropertyIds.Count());
            Assert.IsTrue(allPropertyIdsMapped.ContainsAll(allSourcePropertyIds));

            Assert.AreEqual(2, result.Groups.Count(x =&gt; x.ParentTabContentTypes.Any()));
            Assert.IsTrue(result.Groups.SelectMany(x =&gt; x.ParentTabContentTypes).ContainsAll(new[] {ctMain.Id, ctChild1.Id}));

            Assert.AreEqual(contentType.AllowedTemplates.Count(), result.AllowedTemplates.Count());
            for (var i = 0; i &lt; contentType.AllowedTemplates.Count(); i++)
            {
                Assert.AreEqual(contentType.AllowedTemplates.ElementAt(i).Id, result.AllowedTemplates.ElementAt(i).Id);
            }

            Assert.AreEqual(contentType.AllowedContentTypes.Count(), result.AllowedContentTypes.Count());
            for (var i = 0; i &lt; contentType.AllowedContentTypes.Count(); i++)
            {
                Assert.AreEqual(contentType.AllowedContentTypes.ElementAt(i).Id.Value, result.AllowedContentTypes.ElementAt(i));
            }

        }

        [Test]
        public void MemberPropertyTypeBasic_To_MemberPropertyTypeDisplay()
        {
            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(new DataTypeDefinition(&quot;test&quot;));

            var basic = new MemberPropertyTypeBasic()
            {
                Id = 33,
                SortOrder = 1,
                Alias = &quot;prop1&quot;,
                Description = &quot;property 1&quot;,
                DataTypeId = 99,
                GroupId = 222,
                Label = &quot;Prop 1&quot;,
                MemberCanViewProperty = true,
                MemberCanEditProperty = true,
                Validation = new PropertyTypeValidation()
                {
                    Mandatory = true,
                    Pattern = &quot;xyz&quot;
                }
            };

            var result = Mapper.Map&lt;MemberPropertyTypeDisplay&gt;(basic);

            Assert.AreEqual(basic.Id, result.Id);
            Assert.AreEqual(basic.SortOrder, result.SortOrder);
            Assert.AreEqual(basic.Alias, result.Alias);
            Assert.AreEqual(basic.Description, result.Description);
            Assert.AreEqual(basic.GroupId, result.GroupId);
            Assert.AreEqual(basic.Inherited, result.Inherited);
            Assert.AreEqual(basic.Label, result.Label);
            Assert.AreEqual(basic.Validation, result.Validation);
            Assert.AreEqual(basic.MemberCanViewProperty, result.MemberCanViewProperty);
            Assert.AreEqual(basic.MemberCanEditProperty, result.MemberCanEditProperty);
        }

        [Test]
        public void PropertyTypeBasic_To_PropertyTypeDisplay()
        {
            _dataTypeService.Setup(x =&gt; x.GetDataTypeDefinitionById(It.IsAny&lt;int&gt;()))
                .Returns(new DataTypeDefinition(&quot;test&quot;));

            var basic = new PropertyTypeBasic()
            {
                Id = 33,
                SortOrder = 1,
                Alias = &quot;prop1&quot;,
                Description = &quot;property 1&quot;,
                DataTypeId = 99,
                GroupId = 222,
                Label = &quot;Prop 1&quot;,
                Validation = new PropertyTypeValidation()
                {
                    Mandatory = true,
                    Pattern = &quot;xyz&quot;
                }
            };

            var result = Mapper.Map&lt;PropertyTypeDisplay&gt;(basic);

            Assert.AreEqual(basic.Id, result.Id);
            Assert.AreEqual(basic.SortOrder, result.SortOrder);
            Assert.AreEqual(basic.Alias, result.Alias);
            Assert.AreEqual(basic.Description, result.Description);
            Assert.AreEqual(basic.GroupId, result.GroupId);
            Assert.AreEqual(basic.Inherited, result.Inherited);
            Assert.AreEqual(basic.Label, result.Label);
            Assert.AreEqual(basic.Validation, result.Validation);
        }

        private MemberTypeSave CreateMemberTypeSave()
        {
            return new MemberTypeSave
            {
                Alias = &quot;test&quot;,
                AllowAsRoot = true,
                AllowedContentTypes = new[] { 666, 667 },
                Description = &quot;hello world&quot;,
                Icon = &quot;tree-icon&quot;,
                Id = 1234,
                Key = new Guid(&quot;8A60656B-3866-46AB-824A-48AE85083070&quot;),
                Name = &quot;My content type&quot;,
                Path = &quot;-1,1234&quot;,
                ParentId = -1,
                Thumbnail = &quot;tree-thumb&quot;,
                IsContainer = true,
                Groups = new[]
                {
                    new PropertyGroupBasic&lt;MemberPropertyTypeBasic&gt;()
                    {                        
                        Id = 987,
                        Name = &quot;Tab 1&quot;,
                        SortOrder = 0,
                        Inherited = false,
                        Properties = new []
                        {
                            new MemberPropertyTypeBasic
                            {
                                MemberCanEditProperty = true,
                                MemberCanViewProperty = true,
                                Alias = &quot;property1&quot;,
                                Description = &quot;this is property 1&quot;,
                                Inherited = false,
                                Label = &quot;Property 1&quot;,
                                Validation = new PropertyTypeValidation
                                {
                                    Mandatory = false,
                                    Pattern = &quot;&quot;
                                },
                                SortOrder = 0,
                                DataTypeId = 555
                            }
                        }
                    }
                }
            };
        }

        private MediaTypeSave CreateMediaTypeSave()
        {
            return new MediaTypeSave
            {
                Alias = &quot;test&quot;,
                AllowAsRoot = true,                
                AllowedContentTypes = new[] { 666, 667 },
                Description = &quot;hello world&quot;,
                Icon = &quot;tree-icon&quot;,
                Id = 1234,
                Key = new Guid(&quot;8A60656B-3866-46AB-824A-48AE85083070&quot;),
                Name = &quot;My content type&quot;,
                Path = &quot;-1,1234&quot;,
                ParentId = -1,
                Thumbnail = &quot;tree-thumb&quot;,
                IsContainer = true,
                Groups = new[]
                {
                    new PropertyGroupBasic&lt;PropertyTypeBasic&gt;()
                    {
                        Id = 987,
                        Name = &quot;Tab 1&quot;,
                        SortOrder = 0,
                        Inherited = false,
                        Properties = new []
                        {
                            new PropertyTypeBasic
                            {
                                Alias = &quot;property1&quot;,
                                Description = &quot;this is property 1&quot;,
                                Inherited = false,
                                Label = &quot;Property 1&quot;,
                                Validation = new PropertyTypeValidation
                                {
                                    Mandatory = false,
                                    Pattern = &quot;&quot;
                                },
                                SortOrder = 0,
                                DataTypeId = 555
                            }
                        }
                    }
                }
            };
        }

        private DocumentTypeSave CreateContentTypeSave()
        {            
            return new DocumentTypeSave
            {
                Alias = &quot;test&quot;,     
                AllowAsRoot = true,
                AllowedTemplates = new []
                {
                    &quot;template1&quot;,
                    &quot;template2&quot;
                },
                AllowedContentTypes = new [] {666, 667},
                DefaultTemplate = &quot;test&quot;,
                Description = &quot;hello world&quot;,
                Icon = &quot;tree-icon&quot;,
                Id = 1234,
                Key = new Guid(&quot;8A60656B-3866-46AB-824A-48AE85083070&quot;),
                Name = &quot;My content type&quot;,
                Path = &quot;-1,1234&quot;,
                ParentId = -1,
                Thumbnail = &quot;tree-thumb&quot;,
                IsContainer = true,
                Groups = new []
                {
                    new PropertyGroupBasic&lt;PropertyTypeBasic&gt;()
                    {
                        Id = 987,
                        Name = &quot;Tab 1&quot;,
                        SortOrder = 0,
                        Inherited = false,                        
                        Properties = new []
                        {
                            new PropertyTypeBasic
                            {                                
                                Alias = &quot;property1&quot;,
                                Description = &quot;this is property 1&quot;,
                                Inherited = false,
                                Label = &quot;Property 1&quot;,
                                Validation = new PropertyTypeValidation
                                {
                                    Mandatory = false,
                                    Pattern = &quot;&quot;
                                },
                                SortOrder = 0,
                                DataTypeId = 555
                            }
                        }
                    }
                }
            };
        }

        private MediaTypeSave CreateCompositionMediaTypeSave()
        {
            return new MediaTypeSave
            {
                Alias = &quot;test&quot;,
                AllowAsRoot = true,                
                AllowedContentTypes = new[] { 666, 667 },
                Description = &quot;hello world&quot;,
                Icon = &quot;tree-icon&quot;,
                Id = 1234,
                Key = new Guid(&quot;8A60656B-3866-46AB-824A-48AE85083070&quot;),
                Name = &quot;My content type&quot;,
                Path = &quot;-1,1234&quot;,
                ParentId = -1,
                Thumbnail = &quot;tree-thumb&quot;,
                IsContainer = true,
                Groups = new[]
                {
                    new PropertyGroupBasic&lt;PropertyTypeBasic&gt;()
                    {
                        Id = 987,
                        Name = &quot;Tab 1&quot;,
                        SortOrder = 0,
                        Inherited = false,
                        Properties = new[]
                        {
                            new PropertyTypeBasic
                            {
                                Alias = &quot;property1&quot;,
                                Description = &quot;this is property 1&quot;,
                                Inherited = false,
                                Label = &quot;Property 1&quot;,
                                Validation = new PropertyTypeValidation
                                {
                                    Mandatory = false,
                                    Pattern = &quot;&quot;
                                },
                                SortOrder = 0,
                                DataTypeId = 555
                            }
                        }
                    },
                    new PropertyGroupBasic&lt;PropertyTypeBasic&gt;()
                    {
                        Id = 894,
                        Name = &quot;Tab 2&quot;,
                        SortOrder = 0,
                        Inherited = true,
                        Properties = new[]
                        {
                            new PropertyTypeBasic
                            {
                                Alias = &quot;parentProperty&quot;,
                                Description = &quot;this is a property from the parent&quot;,
                                Inherited = true,
                                Label = &quot;Parent property&quot;,
                                Validation = new PropertyTypeValidation
                                {
                                    Mandatory = false,
                                    Pattern = &quot;&quot;
                                },
                                SortOrder = 0,
                                DataTypeId = 555
                            }
                        }

                    }
                }

            };
        }

        private DocumentTypeSave CreateCompositionContentTypeSave()
        {
            return new DocumentTypeSave
            {
                Alias = &quot;test&quot;,
                AllowAsRoot = true,
                AllowedTemplates = new[]
                {
                    &quot;template1&quot;,
                    &quot;template2&quot;
                },
                AllowedContentTypes = new[] { 666, 667 },
                DefaultTemplate = &quot;test&quot;,
                Description = &quot;hello world&quot;,
                Icon = &quot;tree-icon&quot;,
                Id = 1234,
                Key = new Guid(&quot;8A60656B-3866-46AB-824A-48AE85083070&quot;),
                Name = &quot;My content type&quot;,
                Path = &quot;-1,1234&quot;,
                ParentId = -1,
                Thumbnail = &quot;tree-thumb&quot;,
                IsContainer = true,
                Groups = new[]
                {
                    new PropertyGroupBasic&lt;PropertyTypeBasic&gt;()
                    {
                        Id = 987,
                        Name = &quot;Tab 1&quot;,
                        SortOrder = 0,
                        Inherited = false,                        
                        Properties = new[]
                        {
                            new PropertyTypeBasic
                            {                                
                                Alias = &quot;property1&quot;,
                                Description = &quot;this is property 1&quot;,
                                Inherited = false,
                                Label = &quot;Property 1&quot;,
                                Validation = new PropertyTypeValidation
                                {
                                    Mandatory = false,
                                    Pattern = &quot;&quot;
                                },
                                SortOrder = 0,
                                DataTypeId = 555
                            }
                        }
                    },
                    new PropertyGroupBasic&lt;PropertyTypeBasic&gt;()
                    {
                        Id = 894,
                        Name = &quot;Tab 2&quot;,
                        SortOrder = 0,
                        Inherited = true,                        
                        Properties = new[]
                        {
                            new PropertyTypeBasic
                            {                                
                                Alias = &quot;parentProperty&quot;,
                                Description = &quot;this is a property from the parent&quot;,
                                Inherited = true,
                                Label = &quot;Parent property&quot;,
                                Validation = new PropertyTypeValidation
                                {
                                    Mandatory = false,
                                    Pattern = &quot;&quot;
                                },                                
                                SortOrder = 0,
                                DataTypeId = 555
                            }
                        }
                        
                    }
                }

            };
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[29,9,29,106,1],[30,9,30,94,1],[31,9,31,97,1],[33,9,33,91,1],[34,9,34,85,1],[38,9,38,10,1],[39,13,39,75,1],[42,13,55,80,1],[58,13,58,83,1],[59,13,61,118,1],[63,13,64,13,1],[64,13,64,14,1],[64,14,66,17,1],[66,17,66,96,1],[66,96,66,126,1],[66,126,66,129,1],[66,17,66,129,1],[66,129,67,17,1],[67,17,67,69,1],[67,69,68,17,1],[68,17,68,60,1],[68,60,69,17,1],[69,17,69,75,1],[69,75,70,13,1],[70,13,70,14,1],[70,14,70,16,1],[63,13,70,16,1],[71,9,71,10,1],[75,9,75,10,1],[80,13,85,87,1],[87,13,87,50,1],[91,13,91,59,1],[95,13,95,58,1],[96,13,96,70,1],[97,13,97,56,1],[98,13,98,52,1],[99,13,99,56,1],[100,13,100,64,1],[101,13,101,56,1],[102,13,102,66,1],[103,13,103,70,1],[104,13,104,72,1],[105,13,105,68,1],[106,13,106,68,1],[109,13,109,82,1],[110,18,110,27,1],[110,29,110,55,1],[110,57,110,60,1],[111,13,111,14,1],[112,17,112,104,1],[113,17,113,108,1],[114,17,114,72,1],[115,17,115,82,1],[116,22,116,31,1],[116,33,116,54,1],[116,56,116,59,1],[117,17,117,18,1],[118,21,118,102,1],[119,21,119,128,1],[120,21,120,154,1],[121,21,121,154,1],[122,17,122,18,1],[123,13,123,14,1],[125,13,125,102,1],[126,18,126,27,1],[126,29,126,68,1],[126,70,126,73,1],[127,13,127,14,1],[128,17,128,125,1],[129,13,129,14,1],[130,9,130,10,1],[134,9,134,10,1],[139,13,144,87,1],[146,13,146,49,1],[150,13,150,58,1],[154,13,154,58,1],[155,13,155,70,1],[156,13,156,56,1],[157,13,157,52,1],[158,13,158,56,1],[159,13,159,64,1],[160,13,160,56,1],[161,13,161,66,1],[162,13,162,70,1],[163,13,163,72,1],[164,13,164,68,1],[165,13,165,68,1],[168,13,168,82,1],[169,18,169,27,1],[169,29,169,55,1],[169,57,169,60,1],[170,13,170,14,1],[171,17,171,104,1],[172,17,172,108,1],[173,17,173,72,1],[174,17,174,82,1],[175,22,175,31,1],[175,33,175,54,1],[175,56,175,59,1],[176,17,176,18,1],[177,21,177,102,1],[178,21,178,128,1],[179,17,179,18,1],[180,13,180,14,1],[182,13,182,102,1],[183,18,183,27,1],[183,29,183,68,1],[183,70,183,73,1],[184,13,184,14,1],[185,17,185,125,1],[186,13,186,14,1],[187,9,187,10,1],[191,9,191,10,1],[196,13,201,87,1],[204,13,205,44,1],[205,44,207,91,1],[207,91,207,93,1],[204,13,207,93,1],[210,13,210,51,1],[214,13,214,60,1],[218,13,218,58,1],[219,13,219,70,1],[220,13,220,56,1],[221,13,221,52,1],[222,13,222,56,1],[223,13,223,64,1],[224,13,224,56,1],[225,13,225,66,1],[226,13,226,70,1],[227,13,227,72,1],[228,13,228,68,1],[229,13,229,68,1],[232,13,232,82,1],[233,18,233,27,1],[233,29,233,55,1],[233,57,233,60,1],[234,13,234,14,1],[235,17,235,104,1],[236,17,236,108,1],[237,17,237,72,1],[238,17,238,82,1],[239,22,239,31,1],[239,33,239,54,1],[239,56,239,59,1],[240,17,240,18,1],[241,21,241,102,1],[242,21,242,128,1],[243,17,243,18,1],[244,13,244,14,1],[246,13,248,29,1],[250,13,250,94,1],[251,18,251,27,1],[251,29,251,65,1],[251,67,251,70,1],[252,13,252,14,1],[253,17,253,116,1],[254,13,254,14,1],[256,13,256,102,1],[257,18,257,27,1],[257,29,257,68,1],[257,70,257,73,1],[258,13,258,14,1],[259,17,259,125,1],[260,13,260,14,1],[261,9,261,10,1],[265,9,265,10,1],[270,13,275,87,1],[278,13,278,60,1],[282,13,282,58,1],[287,13,287,55,1],[287,55,287,75,1],[287,75,287,107,1],[287,13,287,107,1],[288,9,288,10,1],[292,9,292,10,1],[297,13,302,87,1],[305,13,305,62,1],[309,13,309,60,1],[314,13,314,55,1],[314,55,314,75,1],[314,75,314,107,1],[314,13,314,107,1],[315,9,315,10,1],[319,9,319,10,1],[326,13,327,86,1],[330,13,331,55,1],[333,13,334,65,1],[336,13,336,74,1],[337,13,337,137,1],[339,13,339,63,1],[343,13,343,68,1],[347,13,347,61,1],[348,13,348,73,1],[349,13,349,59,1],[350,13,350,55,1],[351,13,351,59,1],[352,13,352,67,1],[353,13,353,59,1],[354,13,354,69,1],[355,13,355,73,1],[356,13,356,71,1],[357,13,357,71,1],[361,13,361,87,1],[362,18,362,27,1],[362,29,362,66,1],[362,68,362,71,1],[363,13,363,14,1],[364,17,364,107,1],[365,17,365,111,1],[366,17,366,86,1],[368,17,368,99,1],[369,22,369,31,1],[369,33,369,54,1],[369,56,369,59,1],[370,17,370,18,1],[371,21,371,119,1],[372,21,372,145,1],[374,21,374,175,1],[375,21,375,175,1],[376,17,376,18,1],[377,13,377,14,1],[379,13,379,105,1],[380,18,380,27,1],[380,29,380,71,1],[380,73,380,76,0],[381,13,381,14,0],[382,17,382,128,0],[383,13,383,14,0],[385,9,385,10,1],[389,9,389,10,1],[396,13,397,86,1],[400,13,401,55,1],[403,13,404,65,1],[406,13,406,71,1],[407,13,407,62,1],[411,13,411,66,1],[415,13,415,60,1],[416,13,416,72,1],[417,13,417,58,1],[418,13,418,54,1],[419,13,419,58,1],[420,13,420,66,1],[421,13,421,58,1],[422,13,422,68,1],[423,13,423,72,1],[424,13,424,70,1],[425,13,425,70,1],[429,13,429,86,1],[430,18,430,27,1],[430,29,430,65,1],[430,67,430,70,1],[431,13,431,14,1],[432,17,432,106,1],[433,17,433,110,1],[434,17,434,85,1],[436,17,436,99,1],[437,22,437,31,1],[437,33,437,54,1],[437,56,437,59,1],[438,17,438,18,1],[439,21,439,119,1],[440,21,440,145,1],[441,17,441,18,1],[442,13,442,14,1],[444,13,444,104,1],[445,18,445,27,1],[445,29,445,70,1],[445,72,445,75,0],[446,13,446,14,0],[447,17,447,127,0],[448,13,448,14,0],[450,9,450,10,1],[454,9,454,10,1],[461,13,462,86,1],[465,13,466,55,1],[468,13,469,65,1],[471,13,471,78,1],[472,13,472,64,1],[476,13,476,71,1],[480,13,480,62,1],[481,13,481,74,1],[482,13,482,60,1],[483,13,483,56,1],[484,13,484,60,1],[485,13,485,68,1],[486,13,486,60,1],[487,13,487,70,1],[488,13,488,74,1],[489,13,489,72,1],[490,13,490,72,1],[491,13,491,94,1],[495,13,495,88,1],[496,18,496,27,1],[496,29,496,67,1],[496,69,496,72,1],[497,13,497,14,1],[498,17,498,108,1],[499,17,499,112,1],[500,17,500,87,1],[502,17,502,99,1],[503,22,503,31,1],[503,33,503,54,1],[503,56,503,59,1],[504,17,504,18,1],[505,21,505,119,1],[506,21,506,145,1],[507,17,507,18,1],[508,13,508,14,1],[510,13,510,100,1],[511,18,511,27,1],[511,29,511,69,1],[511,71,511,74,1],[512,13,512,14,1],[513,17,513,120,1],[514,13,514,14,1],[516,13,516,106,1],[517,18,517,27,1],[517,29,517,72,1],[517,74,517,77,0],[518,13,518,14,0],[519,17,519,129,0],[520,13,520,14,0],[522,9,522,10,1],[526,9,526,10,1],[527,13,528,58,1],[530,13,572,15,1],[574,13,580,15,1],[585,13,585,81,1],[587,13,587,54,1],[588,13,588,50,1],[589,13,589,64,1],[590,13,590,85,1],[591,9,591,10,1],[595,9,595,10,1],[596,13,597,58,1],[599,13,637,15,1],[639,13,646,15,1],[651,13,651,82,1],[653,13,653,54,1],[654,13,654,50,1],[655,13,655,64,1],[656,13,656,85,1],[657,9,657,10,1],[661,9,661,10,1],[662,13,663,58,1],[665,13,679,15,1],[681,13,681,58,1],[683,13,683,50,1],[684,13,684,64,1],[685,13,685,56,1],[686,13,686,68,1],[687,13,687,76,1],[688,13,688,55,1],[689,13,689,75,1],[690,13,690,80,1],[691,9,691,10,1],[695,9,695,10,1],[696,13,697,58,1],[699,13,713,15,1],[715,13,715,58,1],[717,13,717,50,1],[718,13,718,64,1],[719,13,719,56,1],[720,13,720,68,1],[721,13,721,76,1],[722,13,722,55,1],[723,13,723,75,1],[724,13,724,80,1],[725,9,725,10,1],[729,9,729,10,1],[736,13,737,86,1],[739,13,740,59,1],[743,13,744,55,1],[746,13,747,65,1],[749,13,749,87,1],[751,13,759,16,1],[760,13,760,59,1],[761,13,761,104,1],[762,13,770,31,1],[771,13,771,61,1],[772,13,772,124,1],[774,13,782,16,1],[783,13,783,64,1],[788,13,788,68,1],[792,13,792,62,1],[793,13,793,74,1],[794,13,794,60,1],[795,13,795,56,1],[796,13,796,60,1],[797,13,797,68,1],[798,13,798,60,1],[799,13,799,70,1],[800,13,800,74,1],[801,13,801,72,1],[802,13,802,72,1],[806,13,806,79,1],[806,79,806,85,1],[806,85,806,132,1],[806,132,806,162,1],[806,162,806,165,1],[806,13,806,165,1],[807,13,807,57,1],[807,57,807,78,1],[807,78,807,81,1],[807,13,807,81,1],[808,13,808,90,1],[808,90,808,144,1],[808,144,808,147,1],[808,13,808,147,1],[810,13,810,69,1],[810,69,810,81,1],[810,81,810,93,1],[810,13,810,93,1],[811,13,811,72,1],[811,72,811,76,1],[811,76,811,88,1],[811,13,811,88,1],[812,13,812,89,1],[812,89,812,93,1],[812,93,812,105,1],[812,13,812,105,1],[814,13,814,95,1],[814,95,814,115,1],[814,115,814,118,1],[814,13,814,118,1],[815,13,815,89,1],[816,13,816,83,1],[818,13,818,57,1],[818,57,818,86,1],[818,86,818,89,1],[818,13,818,89,1],[819,13,819,57,1],[819,57,819,80,1],[819,80,819,129,1],[819,13,819,129,1],[822,13,822,106,1],[823,18,823,27,1],[823,29,823,72,1],[823,74,823,77,0],[824,13,824,14,0],[825,17,825,129,0],[826,13,826,14,0],[828,9,828,10,1],[832,9,832,10,1],[839,13,840,86,1],[842,13,843,59,1],[846,13,847,55,1],[849,13,850,65,1],[852,13,852,71,1],[854,13,857,16,1],[858,13,858,59,1],[859,13,859,106,1],[860,13,868,31,1],[869,13,869,61,1],[870,13,870,126,1],[872,13,875,16,1],[876,13,876,64,1],[881,13,881,71,1],[885,13,885,62,1],[886,13,886,74,1],[887,13,887,60,1],[888,13,888,56,1],[889,13,889,60,1],[890,13,890,68,1],[891,13,891,60,1],[892,13,892,70,1],[893,13,893,74,1],[894,13,894,72,1],[895,13,895,72,1],[896,13,896,94,1],[900,13,900,79,1],[900,79,900,85,1],[900,85,900,132,1],[900,132,900,162,1],[900,162,900,165,1],[900,13,900,165,1],[901,13,901,57,1],[901,57,901,78,1],[901,78,901,81,1],[901,13,901,81,1],[902,13,902,90,1],[902,90,902,144,1],[902,144,902,147,1],[902,13,902,147,1],[904,13,904,69,1],[904,69,904,81,1],[904,81,904,93,1],[904,13,904,93,1],[905,13,905,72,1],[905,72,905,76,1],[905,76,905,88,1],[905,13,905,88,1],[906,13,906,89,1],[906,89,906,93,1],[906,93,906,105,1],[906,13,906,105,1],[908,13,908,95,1],[908,95,908,115,1],[908,115,908,118,1],[908,13,908,118,1],[909,13,909,89,1],[910,13,910,83,1],[912,13,912,57,1],[912,57,912,86,1],[912,86,912,89,1],[912,13,912,89,1],[913,13,913,57,1],[913,57,913,80,1],[913,80,913,127,1],[913,13,913,127,1],[915,13,915,100,1],[916,18,916,27,1],[916,29,916,69,1],[916,71,916,74,1],[917,13,917,14,1],[918,17,918,120,1],[919,13,919,14,1],[921,13,921,106,1],[922,18,922,27,1],[922,29,922,72,1],[922,74,922,77,0],[923,13,923,14,0],[924,17,924,129,0],[925,13,925,14,0],[927,9,927,10,1],[931,9,931,10,1],[932,13,933,58,1],[935,13,951,15,1],[953,13,953,71,1],[955,13,955,50,1],[956,13,956,64,1],[957,13,957,56,1],[958,13,958,68,1],[959,13,959,60,1],[960,13,960,64,1],[961,13,961,56,1],[962,13,962,66,1],[963,13,963,88,1],[964,13,964,88,1],[965,9,965,10,1],[969,9,969,10,1],[970,13,971,58,1],[973,13,987,15,1],[989,13,989,65,1],[991,13,991,50,1],[992,13,992,64,1],[993,13,993,56,1],[994,13,994,68,1],[995,13,995,60,1],[996,13,996,64,1],[997,13,997,56,1],[998,13,998,66,1],[999,9,999,10,1],[1002,9,1002,10,1],[1003,13,1046,15,1],[1047,9,1047,10,1],[1050,9,1050,10,1],[1051,13,1092,15,1],[1093,9,1093,10,1],[1096,9,1096,10,1],[1097,13,1144,15,1],[1145,9,1145,10,1],[1148,9,1148,10,1],[1149,13,1216,15,1],[1217,9,1217,10,1],[1220,9,1220,10,1],[1221,13,1294,15,1],[1295,9,1295,10,1]]);
    </script>
  </body>
</html>