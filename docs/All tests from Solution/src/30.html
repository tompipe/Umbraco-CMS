<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\IO\AbstractFileSystemTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using NUnit.Framework;
using Umbraco.Core.IO;

namespace Umbraco.Tests.IO
{
    [TestFixture, RequiresSTA]
    public abstract class AbstractFileSystemTests 
    {
        protected IFileSystem _fileSystem;

        protected AbstractFileSystemTests(IFileSystem fileSystem)
        {
            _fileSystem = fileSystem;
        }

        [Test]
        public void Can_Create_And_Delete_Files()
        {
            _fileSystem.AddFile(&quot;test.txt&quot;, CreateStream());

            Assert.IsTrue(_fileSystem.FileExists(&quot;test.txt&quot;));

            _fileSystem.DeleteFile(&quot;test.txt&quot;);

           Assert.IsFalse(_fileSystem.FileExists(&quot;test.txt&quot;));
        }

        [Test]
        public void Can_Overwrite_File()
        {
            _fileSystem.AddFile(&quot;test/test.txt&quot;, CreateStream());
            _fileSystem.AddFile(&quot;test/test.txt&quot;, CreateStream());

            var files = _fileSystem.GetFiles(&quot;test&quot;);

            Assert.AreEqual(1, files.Count());

            foreach (var file in files)
            {
                _fileSystem.DeleteFile(file);
            }

            _fileSystem.DeleteDirectory(&quot;test&quot;, true);
        }

        [Test]
        [ExpectedException(typeof(InvalidOperationException))]
        public void Cant_Overwrite_File()
        {
            _fileSystem.AddFile(&quot;test.txt&quot;, CreateStream());
            _fileSystem.AddFile(&quot;test.txt&quot;, CreateStream(), false);

            _fileSystem.DeleteFile(&quot;test.txt&quot;);
        }

        [Test]
        public void Can_Get_Files()
        {
            _fileSystem.AddFile(&quot;test/test1.txt&quot;, CreateStream());
            _fileSystem.AddFile(&quot;test/test2.txt&quot;, CreateStream());
            _fileSystem.AddFile(&quot;test/test3.txt&quot;, CreateStream());
            _fileSystem.AddFile(&quot;test/test4.bak&quot;, CreateStream());

            var files = _fileSystem.GetFiles(&quot;test&quot;);

            Assert.AreEqual(4, files.Count());

            files = _fileSystem.GetFiles(&quot;test&quot;, &quot;*.txt&quot;);

            Assert.AreEqual(3, files.Count());

            _fileSystem.DeleteDirectory(&quot;test&quot;, true);
        }

        [Test]
        public void Can_Read_File()
        {
            _fileSystem.AddFile(&quot;test.txt&quot;, CreateStream(&quot;hello world&quot;));

            var stream = _fileSystem.OpenFile(&quot;test.txt&quot;);
            var reader = new StreamReader(stream);
            var contents = reader.ReadToEnd();
            reader.Close();

            Assert.AreEqual(&quot;hello world&quot;, contents);

            _fileSystem.DeleteFile(&quot;test.txt&quot;);
        }

        [Test]
        public void Can_Get_Directories()
        {
            _fileSystem.AddFile(&quot;test/sub1/test.txt&quot;, CreateStream());
            _fileSystem.AddFile(&quot;test/sub2/test.txt&quot;, CreateStream());
            _fileSystem.AddFile(&quot;test/sub3/test.txt&quot;, CreateStream());

            var dirs = _fileSystem.GetDirectories(&quot;test&quot;);

            Assert.AreEqual(3, dirs.Count());
            Assert.IsTrue(_fileSystem.DirectoryExists(&quot;test/sub1&quot;));
            Assert.IsTrue(_fileSystem.DirectoryExists(&quot;test/sub2&quot;));
            Assert.IsTrue(_fileSystem.DirectoryExists(&quot;test/sub3&quot;));

            _fileSystem.DeleteDirectory(&quot;test&quot;, true);
        }

        [Test]
        public void Can_Get_File_Dates()
        {
            _fileSystem.DeleteFile(&quot;test.txt&quot;);

            _fileSystem.AddFile(&quot;test.txt&quot;, CreateStream());

            var created = _fileSystem.GetCreated(&quot;test.txt&quot;);
            var modified = _fileSystem.GetLastModified(&quot;test.txt&quot;);

            Assert.AreEqual(DateTime.Today.Year, created.Year);
            Assert.AreEqual(DateTime.Today.Month, created.Month);
            Assert.AreEqual(DateTime.UtcNow.Date, created.Date);

            Assert.AreEqual(DateTime.Today.Year, modified.Year);
            Assert.AreEqual(DateTime.Today.Month, modified.Month);
            Assert.AreEqual(DateTime.UtcNow.Date, modified.Date);

            _fileSystem.DeleteFile(&quot;test.txt&quot;);
        }

        [Test]
        public void Can_Get_File_Url()
        {
            _fileSystem.AddFile(&quot;test.txt&quot;, CreateStream());

            var url = _fileSystem.GetUrl(&quot;test.txt&quot;);

            Assert.AreEqual(ConstructUrl(&quot;test.txt&quot;), url);

             _fileSystem.DeleteFile(&quot;test.txt&quot;);
        }

        [Test]
        public void Can_Convert_Full_Path_And_Url_To_Relative_Path()
        {
            _fileSystem.AddFile(&quot;test.txt&quot;, CreateStream());

            var url = _fileSystem.GetUrl(&quot;test.txt&quot;);
            var fullPath = _fileSystem.GetFullPath(&quot;test.txt&quot;);

            Assert.AreNotEqual(&quot;test.txt&quot;, url);
            Assert.AreNotEqual(&quot;test.txt&quot;, fullPath);

            Assert.AreEqual(&quot;test.txt&quot;, _fileSystem.GetRelativePath(url));
            Assert.AreEqual(&quot;test.txt&quot;, _fileSystem.GetRelativePath(fullPath));

            _fileSystem.DeleteFile(&quot;test.txt&quot;);
        }

        [Test]
        public void Can_Get_Size()
        {
            var stream = CreateStream();
            var streamLength = stream.Length;
            _fileSystem.AddFile(&quot;test.txt&quot;, stream);

            Assert.AreEqual(streamLength, _fileSystem.GetSize(&quot;test.txt&quot;));

            _fileSystem.DeleteFile(&quot;test.txt&quot;);
        }

        #region Helper Methods

        protected Stream CreateStream(string contents = null)
        {
            if(string.IsNullOrEmpty(contents))
                contents = &quot;test&quot;;

            var bytes = Encoding.UTF8.GetBytes(contents);
            var stream = new MemoryStream(bytes);

            return stream;
        }

        protected abstract string ConstructUrl(string path);

        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,66,1],[17,9,17,10,1],[18,13,18,38,1],[19,9,19,10,1],[23,9,23,10,1],[24,13,24,61,1],[26,13,26,63,1],[28,13,28,48,1],[30,12,30,63,1],[31,9,31,10,1],[35,9,35,10,1],[36,13,36,66,1],[37,13,37,66,1],[39,13,39,54,1],[41,13,41,47,1],[43,13,43,20,1],[43,22,43,30,1],[43,31,43,33,1],[43,34,43,39,1],[44,13,44,14,1],[45,17,45,46,1],[46,13,46,14,1],[48,13,48,55,1],[49,9,49,10,1],[54,9,54,10,1],[55,13,55,61,1],[56,13,56,68,1],[58,13,58,48,0],[59,9,59,10,0],[63,9,63,10,1],[64,13,64,67,1],[65,13,65,67,1],[66,13,66,67,1],[67,13,67,67,1],[69,13,69,54,1],[71,13,71,47,1],[73,13,73,59,1],[75,13,75,47,1],[77,13,77,55,1],[78,9,78,10,1],[82,9,82,10,1],[83,13,83,74,1],[85,13,85,59,1],[86,13,86,51,1],[87,13,87,47,1],[88,13,88,28,1],[90,13,90,54,1],[92,13,92,48,1],[93,9,93,10,1],[97,9,97,10,1],[98,13,98,71,1],[99,13,99,71,1],[100,13,100,71,1],[102,13,102,59,1],[104,13,104,46,1],[105,13,105,69,1],[106,13,106,69,1],[107,13,107,69,1],[109,13,109,55,1],[110,9,110,10,1],[114,9,114,10,1],[115,13,115,48,1],[117,13,117,61,1],[119,13,119,62,1],[120,13,120,68,1],[122,13,122,64,1],[123,13,123,66,1],[124,13,124,65,1],[126,13,126,65,1],[127,13,127,67,1],[128,13,128,66,1],[130,13,130,48,1],[131,9,131,10,1],[135,9,135,10,1],[136,13,136,61,1],[138,13,138,54,1],[140,13,140,60,1],[142,14,142,49,1],[143,9,143,10,1],[147,9,147,10,1],[148,13,148,61,1],[150,13,150,54,1],[151,13,151,64,1],[153,13,153,49,1],[154,13,154,54,1],[156,13,156,75,1],[157,13,157,80,1],[159,13,159,48,1],[160,9,160,10,1],[164,9,164,10,1],[165,13,165,41,1],[166,13,166,46,1],[167,13,167,53,1],[169,13,169,76,1],[171,13,171,48,1],[172,9,172,10,1],[177,9,177,10,1],[178,13,178,47,1],[179,17,179,35,1],[181,13,181,58,1],[182,13,182,50,1],[184,13,184,27,1],[185,9,185,10,1]]);
    </script>
  </body>
</html>