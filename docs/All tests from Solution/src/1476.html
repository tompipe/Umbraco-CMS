<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\ObjectResolution\SingleObjectResolverBase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Threading;

namespace Umbraco.Core.ObjectResolution
{
	/// &lt;summary&gt;
	/// The base class for all single-object resolvers.
	/// &lt;/summary&gt;
	/// &lt;typeparam name=&quot;TResolver&quot;&gt;The type of the concrete resolver class.&lt;/typeparam&gt;
	/// &lt;typeparam name=&quot;TResolved&quot;&gt;The type of the resolved object.&lt;/typeparam&gt;
	/// &lt;remarks&gt;
	/// Resolves &quot;single&quot; objects ie objects for which there is only one application-wide instance, such as the MVC Controller factory.
	/// &lt;/remarks&gt;
	public abstract class SingleObjectResolverBase&lt;TResolver, TResolved&gt; : ResolverBase&lt;TResolver&gt;
		where TResolved : class
        where TResolver : ResolverBase
	{
		private readonly ReaderWriterLockSlim _lock = new ReaderWriterLockSlim();
		private readonly bool _canBeNull;
		private TResolved _value;

		#region Constructors

		/// &lt;summary&gt;
		/// Initialize a new instance of the &lt;see cref=&quot;SingleObjectResolverBase{TResolver, TResolved}&quot;/&gt; class.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;By default &lt;c&gt;CanBeNull&lt;/c&gt; is false, so &lt;c&gt;Value&lt;/c&gt; has to be initialized before being read,
		/// otherwise an exception will be thrown when reading it.&lt;/remarks&gt;
		protected SingleObjectResolverBase()
			: this(false)
		{ }

		/// &lt;summary&gt;
		/// Initialize a new instance of the &lt;see cref=&quot;SingleObjectResolverBase{TResolver, TResolved}&quot;/&gt; class with an instance of the resolved object.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;value&quot;&gt;An instance of the resolved object.&lt;/param&gt;
		/// &lt;remarks&gt;By default &lt;c&gt;CanBeNull&lt;/c&gt; is false, so &lt;c&gt;value&lt;/c&gt; has to be non-null, or &lt;c&gt;Value&lt;/c&gt; has to be
		/// initialized before being accessed, otherwise an exception will be thrown when reading it.&lt;/remarks&gt;
		protected SingleObjectResolverBase(TResolved value)
			: this(false)
		{
			_value = value;
		}

		/// &lt;summary&gt;
		/// Initialize a new instance of the &lt;see cref=&quot;SingleObjectResolverBase{TResolver, TResolved}&quot;/&gt; class with a value indicating whether the resolved object instance can be null.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;canBeNull&quot;&gt;A value indicating whether the resolved object instance can be null.&lt;/param&gt;
		/// &lt;remarks&gt;If &lt;c&gt;CanBeNull&lt;/c&gt; is false, &lt;c&gt;Value&lt;/c&gt; has to be initialized before being read,
		/// otherwise an exception will be thrown when reading it.&lt;/remarks&gt;
		protected SingleObjectResolverBase(bool canBeNull)
		{
			_canBeNull = canBeNull;
		}

		/// &lt;summary&gt;
		/// Initialize a new instance of the &lt;see cref=&quot;SingleObjectResolverBase{TResolver, TResolved}&quot;/&gt; class with an instance of the resolved object,
		/// and a value indicating whether that instance can be null.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;value&quot;&gt;An instance of the resolved object.&lt;/param&gt;
		/// &lt;param name=&quot;canBeNull&quot;&gt;A value indicating whether the resolved object instance can be null.&lt;/param&gt;
		/// &lt;remarks&gt;If &lt;c&gt;CanBeNull&lt;/c&gt; is false, &lt;c&gt;value&lt;/c&gt; has to be non-null, or &lt;c&gt;Value&lt;/c&gt; has to be initialized before being read,
		/// otherwise an exception will be thrown when reading it.&lt;/remarks&gt;
		protected SingleObjectResolverBase(TResolved value, bool canBeNull)
		{
			_value = value;
			_canBeNull = canBeNull;
		}

		#endregion

        /// &lt;summary&gt;
        /// Gets or sets a value indicating whether the resolver can resolve objects before resolution is frozen.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;This is false by default and is used for some special internal resolvers.&lt;/remarks&gt;
        internal bool CanResolveBeforeFrozen { get; set; }

		/// &lt;summary&gt;
		/// Gets a value indicating whether the resolved object instance can be null.
		/// &lt;/summary&gt;
		public bool CanBeNull
		{
			get { return _canBeNull; }
		}

		/// &lt;summary&gt;
		/// Gets a value indicating whether the resolved object instance is null.
		/// &lt;/summary&gt;
		public bool HasValue
		{
			get { return _value != null; }
		}

		/// &lt;summary&gt;
		/// Gets or sets the resolved object instance.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;&lt;/remarks&gt;
		/// &lt;exception cref=&quot;ArgumentNullException&quot;&gt;value is set to null, but cannot be null (&lt;c&gt;CanBeNull&lt;/c&gt; is &lt;c&gt;false&lt;/c&gt;).&lt;/exception&gt;
		/// &lt;exception cref=&quot;InvalidOperationException&quot;&gt;value is read and is null, but cannot be null (&lt;c&gt;CanBeNull&lt;/c&gt; is &lt;c&gt;false&lt;/c&gt;),
		/// or value is set (read) and resolution is (not) frozen.&lt;/exception&gt;
		protected TResolved Value
		{
			get
			{
                using (Resolution.Reader(CanResolveBeforeFrozen))
				using (new ReadLock(_lock))
				{
					if (!_canBeNull &amp;&amp; _value == null)
						throw new InvalidOperationException(string.Format(
							&quot;Resolver {0} requires a value, and none was supplied.&quot;, this.GetType().FullName));

					return _value;
				}
			}

			set
			{
				using (Resolution.Configuration)
				using (var l = new UpgradeableReadLock(_lock))
				{
					if (!_canBeNull &amp;&amp; value == null)
						throw new ArgumentNullException(&quot;value&quot;);

					l.UpgradeToWriteLock();
					_value = value;
				}
			}
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[18,3,18,76,1],[18,3,18,76,1],[30,6,30,17,1],[31,3,31,4,1],[31,5,31,6,1],[40,6,40,17,1],[41,3,41,4,1],[42,4,42,19,1],[43,3,43,4,1],[51,3,51,53,1],[52,3,52,4,1],[53,4,53,27,1],[54,3,54,4,1],[64,3,64,70,1],[65,3,65,4,1],[66,4,66,19,1],[67,4,67,27,1],[68,3,68,4,1],[76,48,76,52,1],[76,53,76,57,1],[83,8,83,9,0],[83,10,83,28,0],[83,29,83,30,0],[91,8,91,9,1],[91,10,91,32,1],[91,33,91,34,1],[104,4,104,5,1],[105,17,105,66,1],[106,5,106,32,1],[107,5,107,6,1],[108,6,108,40,1],[109,7,110,91,1],[112,6,112,20,1],[114,4,114,5,1],[117,4,117,5,1],[118,5,118,37,1],[119,12,119,50,1],[120,5,120,6,1],[121,6,121,39,1],[122,7,122,48,1],[124,6,124,29,1],[125,6,125,21,1],[126,5,126,6,1],[127,4,127,5,1]]);
    </script>
  </body>
</html>