<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\UmbracoEntity.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Reflection;
using System.Runtime.CompilerServices;
using Umbraco.Core.Models.EntityBase;

namespace Umbraco.Core.Models
{
    /// &lt;summary&gt;
    /// Implementation of the &lt;see cref=&quot;IUmbracoEntity&quot;/&gt; for internal use.
    /// &lt;/summary&gt;
    public class UmbracoEntity : Entity, IUmbracoEntity
    {
        private int _creatorId;
        private int _level;
        private string _name;
        private int _parentId;
        private string _path;
        private int _sortOrder;
        private bool _trashed;
        private bool _hasChildren;
        private bool _isPublished;
        private bool _isDraft;
        private bool _hasPendingChanges;
        private string _contentTypeAlias;
        private Guid _nodeObjectTypeId;
        
        private static readonly Lazy&lt;PropertySelectors&gt; Ps = new Lazy&lt;PropertySelectors&gt;();

        private class PropertySelectors
        {
            public readonly PropertyInfo CreatorIdSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, int&gt;(x =&gt; x.CreatorId);
            public readonly PropertyInfo LevelSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, int&gt;(x =&gt; x.Level);
            public readonly PropertyInfo NameSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, string&gt;(x =&gt; x.Name);
            public readonly PropertyInfo ParentIdSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, int&gt;(x =&gt; x.ParentId);
            public readonly PropertyInfo PathSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, string&gt;(x =&gt; x.Path);
            public readonly PropertyInfo SortOrderSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, int&gt;(x =&gt; x.SortOrder);
            public readonly PropertyInfo TrashedSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, bool&gt;(x =&gt; x.Trashed);
            public readonly PropertyInfo HasChildrenSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, bool&gt;(x =&gt; x.HasChildren);
            public readonly PropertyInfo IsPublishedSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, bool&gt;(x =&gt; x.IsPublished);
            public readonly PropertyInfo IsDraftSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, bool&gt;(x =&gt; x.IsDraft);
            public readonly PropertyInfo HasPendingChangesSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, bool&gt;(x =&gt; x.HasPendingChanges);
            public readonly PropertyInfo ContentTypeAliasSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, string&gt;(x =&gt; x.ContentTypeAlias);
            public readonly PropertyInfo ContentTypeIconSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, string&gt;(x =&gt; x.ContentTypeIcon);
            public readonly PropertyInfo ContentTypeThumbnailSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, string&gt;(x =&gt; x.ContentTypeThumbnail);
            public readonly PropertyInfo NodeObjectTypeIdSelector = ExpressionHelper.GetPropertyInfo&lt;UmbracoEntity, Guid&gt;(x =&gt; x.NodeObjectTypeId);
        }

        private string _contentTypeIcon;
        private string _contentTypeThumbnail;

        public UmbracoEntity()
        {
            AdditionalData = new Dictionary&lt;string, object&gt;();
        }

        public UmbracoEntity(bool trashed)
        {
            AdditionalData = new Dictionary&lt;string, object&gt;();
            Trashed = trashed;
        }

        // for MySql
        public UmbracoEntity(UInt64 trashed)
        {
            AdditionalData = new Dictionary&lt;string, object&gt;();
            Trashed = trashed == 1;
        }

        public int CreatorId
        {
            get { return _creatorId; }
            set { SetPropertyValueAndDetectChanges(value, ref _creatorId, Ps.Value.CreatorIdSelector); }
        }

        public int Level
        {
            get { return _level; }
            set { SetPropertyValueAndDetectChanges(value, ref _level, Ps.Value.LevelSelector); }
        }

        public string Name
        {
            get { return _name; }
            set { SetPropertyValueAndDetectChanges(value, ref _name, Ps.Value.NameSelector); }
        }

        public int ParentId
        {
            get { return _parentId; }
            set { SetPropertyValueAndDetectChanges(value, ref _parentId, Ps.Value.ParentIdSelector); }
        }

        public string Path
        {
            get { return _path; }
            set { SetPropertyValueAndDetectChanges(value, ref _path, Ps.Value.PathSelector); }
        }

        public int SortOrder
        {
            get { return _sortOrder; }
            set { SetPropertyValueAndDetectChanges(value, ref _sortOrder, Ps.Value.SortOrderSelector); }
        }

        public bool Trashed
        {
            get { return _trashed; }
            private set { SetPropertyValueAndDetectChanges(value, ref _trashed, Ps.Value.TrashedSelector); }
        }

        public IDictionary&lt;string, object&gt; AdditionalData { get; private set; }


        public bool HasChildren
        {
            get { return _hasChildren; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _hasChildren, Ps.Value.HasChildrenSelector);
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;HasChildren&quot;] = value;
            }
        }

        public bool IsPublished
        {
            get { return _isPublished; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _isPublished, Ps.Value.IsPublishedSelector);
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;IsPublished&quot;] = value;
            }
        }

        public bool IsDraft
        {
            get { return _isDraft; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _isDraft, Ps.Value.IsDraftSelector);
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;IsDraft&quot;] = value;
            }
        }

        public bool HasPendingChanges
        {
            get { return _hasPendingChanges; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _hasPendingChanges, Ps.Value.HasPendingChangesSelector);                
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;HasPendingChanges&quot;] = value;
            }
        }

        public string ContentTypeAlias
        {
            get { return _contentTypeAlias; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _contentTypeAlias, Ps.Value.ContentTypeAliasSelector);                
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;ContentTypeAlias&quot;] = value;
            }
        }

        public string ContentTypeIcon
        {
            get { return _contentTypeIcon; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _contentTypeIcon, Ps.Value.ContentTypeIconSelector);                
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;ContentTypeIcon&quot;] = value;
            }
        }

        public string ContentTypeThumbnail
        {
            get { return _contentTypeThumbnail; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _contentTypeThumbnail, Ps.Value.ContentTypeThumbnailSelector);                
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;ContentTypeThumbnail&quot;] = value;
            }
        }

        public Guid NodeObjectTypeId
        {
            get { return _nodeObjectTypeId; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _nodeObjectTypeId, Ps.Value.NodeObjectTypeIdSelector);
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                AdditionalData[&quot;NodeObjectTypeId&quot;] = value;
            }
        }

        public override object DeepClone()
        {
            var clone = (UmbracoEntity) base.DeepClone();
            //turn off change tracking
            clone.DisableChangeTracking();
            //This ensures that any value in the dictionary that is deep cloneable is cloned too
            foreach (var key in clone.AdditionalData.Keys.ToArray())
            {
                var deepCloneable = clone.AdditionalData[key] as IDeepCloneable;
                if (deepCloneable != null)
                {
                    clone.AdditionalData[key] = deepCloneable.DeepClone();
                }
            }
            //this shouldn&#39;t really be needed since we&#39;re not tracking
            clone.ResetDirtyProperties(false);
            //re-enable tracking
            clone.EnableChangeTracking();
            return clone;
        }

        /// &lt;summary&gt;
        /// A struction that can be contained in the additional data of an UmbracoEntity representing 
        /// a user defined property
        /// &lt;/summary&gt;
        public class EntityProperty : IDeepCloneable
        {
            public string PropertyEditorAlias { get; set; }
            public object Value { get; set; }
            public object DeepClone()
            {
                //Memberwise clone on Entity will work since it doesn&#39;t have any deep elements
                // for any sub class this will work for standard properties as well that aren&#39;t complex object&#39;s themselves.
                var clone = MemberwiseClone();
                return clone;
            }

            protected bool Equals(EntityProperty other)
            {
                return PropertyEditorAlias.Equals(other.PropertyEditorAlias) &amp;&amp; string.Equals(Value, other.Value);
            }

            public override bool Equals(object obj)
            {
                if (ReferenceEquals(null, obj)) return false;
                if (ReferenceEquals(this, obj)) return true;
                if (obj.GetType() != this.GetType()) return false;
                return Equals((EntityProperty) obj);
            }

            public override int GetHashCode()
            {
                unchecked
                {
                    return (PropertyEditorAlias.GetHashCode() * 397) ^ (Value != null ? Value.GetHashCode() : 0);
                }
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[30,9,30,92,1],[34,13,34,133,1],[35,13,35,125,1],[36,13,36,126,1],[37,13,37,131,1],[38,13,38,126,1],[39,13,39,133,1],[40,13,40,130,1],[41,13,41,138,1],[42,13,42,138,1],[43,13,43,130,1],[44,13,44,150,1],[45,13,45,150,1],[46,13,46,148,1],[47,13,47,158,1],[48,13,48,148,1],[54,9,54,31,1],[55,9,55,10,1],[56,13,56,63,1],[57,9,57,10,1],[59,9,59,43,1],[60,9,60,10,1],[61,13,61,63,1],[62,13,62,31,1],[63,9,63,10,1],[66,9,66,45,1],[67,9,67,10,1],[68,13,68,63,1],[69,13,69,36,1],[70,9,70,10,1],[74,17,74,18,1],[74,19,74,37,1],[74,38,74,39,1],[75,17,75,18,1],[75,19,75,103,1],[75,104,75,105,1],[80,17,80,18,1],[80,19,80,33,1],[80,34,80,35,1],[81,17,81,18,1],[81,19,81,95,1],[81,96,81,97,1],[86,17,86,18,1],[86,19,86,32,1],[86,33,86,34,1],[87,17,87,18,1],[87,19,87,93,1],[87,94,87,95,1],[92,17,92,18,1],[92,19,92,36,1],[92,37,92,38,1],[93,17,93,18,1],[93,19,93,101,1],[93,102,93,103,1],[98,17,98,18,1],[98,19,98,32,1],[98,33,98,34,1],[99,17,99,18,1],[99,19,99,93,1],[99,94,99,95,1],[104,17,104,18,1],[104,19,104,37,1],[104,38,104,39,1],[105,17,105,18,1],[105,19,105,103,1],[105,104,105,105,1],[110,17,110,18,1],[110,19,110,35,1],[110,36,110,37,1],[111,25,111,26,1],[111,27,111,107,1],[111,108,111,109,1],[114,61,114,65,1],[114,66,114,78,1],[119,17,119,18,1],[119,19,119,39,1],[119,40,119,41,1],[121,13,121,14,1],[122,17,122,105,1],[124,17,124,55,1],[125,13,125,14,1],[130,17,130,18,1],[130,19,130,39,1],[130,40,130,41,1],[132,13,132,14,1],[133,17,133,105,1],[135,17,135,55,1],[136,13,136,14,1],[141,17,141,18,1],[141,19,141,35,1],[141,36,141,37,1],[143,13,143,14,1],[144,17,144,97,1],[146,17,146,51,1],[147,13,147,14,1],[152,17,152,18,1],[152,19,152,45,1],[152,46,152,47,1],[154,13,154,14,1],[155,17,155,117,1],[157,17,157,61,1],[158,13,158,14,1],[163,17,163,18,1],[163,19,163,44,1],[163,45,163,46,1],[165,13,165,14,1],[166,17,166,115,1],[168,17,168,60,1],[169,13,169,14,1],[174,17,174,18,1],[174,19,174,43,1],[174,44,174,45,1],[176,13,176,14,1],[177,17,177,113,1],[179,17,179,59,1],[180,13,180,14,1],[185,17,185,18,1],[185,19,185,48,1],[185,49,185,50,1],[187,13,187,14,1],[188,17,188,123,1],[190,17,190,64,1],[191,13,191,14,1],[196,17,196,18,1],[196,19,196,44,1],[196,45,196,46,1],[198,13,198,14,1],[199,17,199,115,1],[201,17,201,60,1],[202,13,202,14,1],[206,9,206,10,1],[207,13,207,58,1],[209,13,209,43,1],[211,13,211,20,1],[211,22,211,29,1],[211,30,211,32,1],[211,33,211,68,1],[212,13,212,14,1],[213,17,213,81,1],[214,17,214,43,1],[215,17,215,18,1],[216,21,216,75,1],[217,17,217,18,1],[218,13,218,14,1],[220,13,220,47,1],[222,13,222,42,1],[223,13,223,26,1],[224,9,224,10,1],[232,49,232,53,1],[232,54,232,58,1],[233,35,233,39,0],[233,40,233,44,1],[235,13,235,14,1],[238,17,238,47,1],[239,17,239,30,1],[240,13,240,14,1],[243,13,243,14,0],[244,17,244,115,0],[245,13,245,14,0],[248,13,248,14,0],[249,17,249,48,0],[249,49,249,62,0],[250,17,250,48,0],[250,49,250,61,0],[251,17,251,53,0],[251,54,251,67,0],[252,17,252,53,0],[253,13,253,14,0],[256,13,256,14,0],[258,17,258,18,0],[259,21,259,114,0],[261,13,261,14,0]]);
    </script>
  </body>
</html>