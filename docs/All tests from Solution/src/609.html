<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\developer\Packages\BrowseRepository.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using System.Xml;
using System.Xml.XPath;
using Umbraco.Core.Configuration;
using Umbraco.Core.IO;
using Umbraco.Web;

namespace umbraco.presentation.developer.packages {
    public partial class BrowseRepository : BasePages.UmbracoEnsuredPage {

        public BrowseRepository()
        {
            CurrentApp = BusinessLogic.DefaultApps.developer.ToString();

        }

        protected void Page_Load(object sender, System.EventArgs e) {

            Exception ex = new Exception();
            if (!cms.businesslogic.packager.Settings.HasFileAccess(ref ex)) {
                fb.Style.Add(&quot;margin-top&quot;, &quot;7px&quot;);
                fb.type = global::umbraco.uicontrols.Feedback.feedbacktype.error;
                fb.Text = &quot;&lt;strong&gt;&quot; + ui.Text(&quot;errors&quot;, &quot;filePermissionsError&quot;) + &quot;:&lt;/strong&gt;&lt;br/&gt;&quot; + ex.Message;
            }

            string category = Request.CleanForXss(&quot;category&quot;);
            string repoGuid = Request.CleanForXss(&quot;repoGuid&quot;);

            var repo = cms.businesslogic.packager.repositories.Repository.getByGuid(repoGuid);
            if (repo == null)
            {
                throw new InvalidOperationException(&quot;Could not find repository with id &quot; + repoGuid);
            }

            string url = repo.RepositoryUrl;

            Panel1.Text = &quot;Browse repository: &quot; + repo.Name;
            
            if (!string.IsNullOrEmpty(category))
                category = &quot;&amp;category=&quot; + category;

            iframeGen.Text =
                string.Format(
                    &quot;&lt;iframe id=\&quot;repoFrame\&quot; frameborder=\&quot;1\&quot; style=\&quot;border: none; display: block\&quot; src=\&quot;{0}?repoGuid={1}{2}&amp;callback={3}:{4}{5}/developer/packages/proxy.htm?/{6}/developer/packages/installer.aspx?repoGuid={7}&amp;version=v45&amp;fullVersion={8}.{9}.{10}&amp;useLegacySchema={11}&amp;dotnetVersion={12}&amp;trustLevel={13}\&quot;&gt;&lt;/iframe&gt;&quot;,
                    url, repoGuid, category, Request.ServerVariables[&quot;SERVER_NAME&quot;],
                    Request.ServerVariables[&quot;SERVER_PORT&quot;], IOHelper.ResolveUrl(SystemDirectories.Umbraco),
                    IOHelper.ResolveUrl(SystemDirectories.Umbraco).Trim(&#39;/&#39;), repoGuid,
                    UmbracoVersion.Current.Major,
                    UmbracoVersion.Current.Minor,
                    UmbracoVersion.Current.Build,
                    UmbracoConfig.For.UmbracoSettings().Content.UseLegacyXmlSchema.ToString(), Environment.Version,
                    Umbraco.Core.SystemUtilities.GetCurrentTrustLevel());
        }


    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,34,0],[21,9,21,10,0],[22,13,22,73,0],[24,9,24,10,0],[26,69,26,70,0],[28,13,28,44,0],[29,13,29,76,0],[29,77,29,78,0],[30,17,30,51,0],[31,17,31,82,0],[32,17,32,115,0],[33,13,33,14,0],[35,13,35,63,0],[36,13,36,63,0],[38,13,38,95,0],[39,13,39,30,0],[40,13,40,14,0],[41,17,41,102,0],[44,13,44,45,0],[46,13,46,61,0],[48,13,48,49,0],[49,17,49,52,0],[51,13,61,74,0],[62,9,62,10,0]]);
    </script>
  </body>
</html>