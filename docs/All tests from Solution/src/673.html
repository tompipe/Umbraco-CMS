<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\settings\stylesheet\editstylesheet.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.IO;
using System.Linq;
using System.Web.UI;
using Umbraco.Core.IO;
using Umbraco.Web;
using umbraco.BasePages;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic.web;
using umbraco.cms.helpers;
using umbraco.cms.presentation.Trees;
using umbraco.uicontrols;
using Umbraco.Core;

namespace umbraco.cms.presentation.settings.stylesheet
{
    /// &lt;summary&gt;
    /// Summary description for editstylesheet.
    /// &lt;/summary&gt;
    public partial class editstylesheet : UmbracoEnsuredPage
    {
        protected MenuButton SaveButton;

        private string filename;
        protected string TreeSyncPath { get; private set; }

        public editstylesheet()
        {
            CurrentApp = DefaultApps.settings.ToString();
        }

        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);

            filename = Request.QueryString[&quot;id&quot;].Replace(&#39;\\&#39;, &#39;/&#39;).TrimStart(&#39;/&#39;);

            var editor = Panel1.NewTabPage(ui.Text(&quot;stylesheet&quot;));
            editor.Controls.Add(Pane7);

            var props = Panel1.NewTabPage(ui.Text(&quot;properties&quot;));
            props.Controls.Add(Pane8);

            SaveButton = Panel1.Menu.NewButton();
            SaveButton.Text = ui.Text(&quot;save&quot;);
            SaveButton.ButtonType = MenuButtonType.Primary;
            SaveButton.ID = &quot;save&quot;;
            SaveButton.CssClass = &quot;client-side&quot;;
        }

        protected void Page_Load(object sender, EventArgs e)
        {           
            Panel1.Text = ui.Text(&quot;stylesheet&quot;, &quot;editstylesheet&quot;, UmbracoUser);
            pp_name.Text = ui.Text(&quot;name&quot;, UmbracoUser);
            pp_path.Text = ui.Text(&quot;path&quot;, UmbracoUser);

            var stylesheet = Services.FileService.GetStylesheetByName(filename);
            if (stylesheet == null) // not found
                throw new FileNotFoundException(&quot;Could not find file &#39;&quot; + filename + &quot;&#39;.&quot;);

            lttPath.Text = &quot;&lt;a id=\&quot;&quot; + lttPath.ClientID + &quot;\&quot; target=\&quot;_blank\&quot; href=\&quot;&quot; + stylesheet.VirtualPath + &quot;\&quot;&gt;&quot; + stylesheet.VirtualPath + &quot;&lt;/a&gt;&quot;;
            editorSource.Text = stylesheet.Content;
            TreeSyncPath = DeepLink.GetTreePathFromFilePath(filename).TrimEnd(&quot;.css&quot;);

            // name derives from path, without the .css extension, clean for xss
            NameTxt.Text = stylesheet.Path.TrimEnd(&quot;.css&quot;).CleanForXss(&#39;\\&#39;, &#39;/&#39;);

            if (IsPostBack == false)
            {
                ClientTools
                    .SetActiveTreeType(Constants.Trees.Stylesheets)
                    .SyncTree(TreeSyncPath, false);
            }
        }

        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);
            ScriptManager.GetCurrent(Page).Services.Add(new ServiceReference(&quot;../webservices/codeEditorSave.asmx&quot;));
            ScriptManager.GetCurrent(Page).Services.Add(new ServiceReference(&quot;../webservices/legacyAjaxCalls.asmx&quot;));
        }

        /// &lt;summary&gt;
        /// Panel1 control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.TabView Panel1;

        /// &lt;summary&gt;
        /// Pane7 control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.Pane Pane7;
        protected global::umbraco.uicontrols.Pane Pane8;

        /// &lt;summary&gt;
        /// pp_name control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.PropertyPanel pp_name;

        /// &lt;summary&gt;
        /// NameTxt control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.TextBox NameTxt;

        /// &lt;summary&gt;
        /// pp_path control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.PropertyPanel pp_path;

        /// &lt;summary&gt;
        /// lttPath control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.Literal lttPath;

        /// &lt;summary&gt;
        /// pp_source control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.PropertyPanel pp_source;

        /// &lt;summary&gt;
        /// editorSource control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.CodeArea editorSource;

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[25,41,25,45,0],[25,46,25,58,0],[27,9,27,32,0],[28,9,28,10,0],[29,13,29,58,0],[30,9,30,10,0],[33,9,33,10,0],[34,13,34,28,0],[36,13,36,84,0],[38,13,38,67,0],[39,13,39,40,0],[41,13,41,66,0],[42,13,42,39,0],[44,13,44,50,0],[45,13,45,47,0],[46,13,46,60,0],[47,13,47,36,0],[48,13,48,49,0],[49,9,49,10,0],[52,9,52,10,0],[53,13,53,80,0],[54,13,54,57,0],[55,13,55,57,0],[57,13,57,81,0],[58,13,58,36,0],[59,17,59,92,0],[61,13,61,158,0],[62,13,62,52,0],[63,13,63,87,0],[66,13,66,83,0],[68,13,68,37,0],[69,13,69,14,0],[70,17,72,52,0],[73,13,73,14,0],[74,9,74,10,0],[77,9,77,10,0],[78,13,78,33,0],[79,13,79,117,0],[80,13,80,118,0],[81,9,81,10,0]]);
    </script>
  </body>
</html>