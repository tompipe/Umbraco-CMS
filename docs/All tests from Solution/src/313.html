<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Routing\ContentFinderByNiceUrlTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Configuration;
using NUnit.Framework;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web.PublishedCache.XmlPublishedCache;
using Umbraco.Web.Routing;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic.template;

namespace Umbraco.Tests.Routing
{
	[TestFixture]
	public class ContentFinderByNiceUrlTests : BaseRoutingTest
	{
	

		[TestCase(&quot;/&quot;, 1046)]
		[TestCase(&quot;/default.aspx&quot;, 1046)] //this one is actually rather important since this is the path that comes through when we are running in pre-IIS 7 for the root document &#39;/&#39; !
		[TestCase(&quot;/Sub1&quot;, 1173)]
		[TestCase(&quot;/sub1&quot;, 1173)]
		[TestCase(&quot;/sub1.aspx&quot;, 1173)]
		[TestCase(&quot;/home/sub1&quot;, -1)] // should fail
		
		// these two are special. getNiceUrl(1046) returns &quot;/&quot; but getNiceUrl(1172) cannot also return &quot;/&quot; so
		// we&#39;ve made it return &quot;/test-page&quot; =&gt; we have to support that url back in the lookup...
		[TestCase(&quot;/home&quot;, 1046)]
		[TestCase(&quot;/test-page&quot;, 1172)]
		public void Match_Document_By_Url_Hide_Top_Level(string urlString, int expectedId)
		{
			var routingContext = GetRoutingContext(urlString);
			var url = routingContext.UmbracoContext.CleanedUmbracoUrl; //very important to use the cleaned up umbraco url
			var docreq = new PublishedContentRequest(url, routingContext);
			var lookup = new ContentFinderByNiceUrl();
		    SettingsForTests.HideTopLevelNodeFromPath = true;

			var result = lookup.TryFindContent(docreq);

			if (expectedId &gt; 0)
			{
				Assert.IsTrue(result);
				Assert.AreEqual(expectedId, docreq.PublishedContent.Id);
			}
			else
			{
				Assert.IsFalse(result);
			}
		}

		[TestCase(&quot;/&quot;, 1046)]
		[TestCase(&quot;/default.aspx&quot;, 1046)] //this one is actually rather important since this is the path that comes through when we are running in pre-IIS 7 for the root document &#39;/&#39; !
		[TestCase(&quot;/home&quot;, 1046)]
		[TestCase(&quot;/home/Sub1&quot;, 1173)]
		[TestCase(&quot;/Home/Sub1&quot;, 1173)] //different cases
		[TestCase(&quot;/home/Sub1.aspx&quot;, 1173)]
		public void Match_Document_By_Url(string urlString, int expectedId)
		{
			var routingContext = GetRoutingContext(urlString);
			var url = routingContext.UmbracoContext.CleanedUmbracoUrl;	//very important to use the cleaned up umbraco url		
			var docreq = new PublishedContentRequest(url, routingContext);			
			var lookup = new ContentFinderByNiceUrl();
            SettingsForTests.HideTopLevelNodeFromPath = false;

			var result = lookup.TryFindContent(docreq);

			Assert.IsTrue(result);
			Assert.AreEqual(expectedId, docreq.PublishedContent.Id);
		}

	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[29,3,29,4,1],[30,4,30,54,1],[31,4,31,62,1],[32,4,32,66,1],[33,4,33,46,1],[34,7,34,56,1],[36,4,36,47,1],[38,4,38,23,1],[39,4,39,5,1],[40,5,40,27,1],[41,5,41,61,1],[42,4,42,5,1],[44,4,44,5,1],[45,5,45,28,1],[46,4,46,5,1],[47,3,47,4,1],[56,3,56,4,1],[57,4,57,54,1],[58,4,58,62,1],[59,4,59,66,1],[60,4,60,46,1],[61,13,61,63,1],[63,4,63,47,1],[65,4,65,26,1],[66,4,66,60,1],[67,3,67,4,1]]);
    </script>
  </body>
</html>