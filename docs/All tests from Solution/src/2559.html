<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\SQLCE4Umbraco\SqlCeApplicationBlock.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data.SqlServerCe;
using System.Data;
using System.Diagnostics;
using SQLCE4Umbraco;

namespace SqlCE4Umbraco
{
    public class SqlCeApplicationBlock
    {
        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandParameters&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static object ExecuteScalar(
            string connectionString,
            CommandType commandType,
            string commandText,
            params SqlCeParameter[] commandParameters
            )
        {
            object retVal;

            try
            {
                using (SqlCeConnection conn = SqlCeContextGuardian.Open(connectionString))
                {
                    using (SqlCeCommand cmd = new SqlCeCommand(commandText, conn))
                    {
                        AttachParameters(cmd, commandParameters);
                        Debug.WriteLine(&quot;---------------------------------SCALAR-------------------------------------&quot;);
                        Debug.WriteLine(commandText);
                        Debug.WriteLine(&quot;----------------------------------------------------------------------------&quot;);
                        retVal = cmd.ExecuteScalar();
                    }
                }

                return retVal;
            }
            catch (Exception ee)
            {
                throw new SqlCeProviderException(&quot;Error running Scalar: \nSQL Statement:\n&quot; + commandText + &quot;\n\nException:\n&quot; + ee.ToString());
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandParameters&quot;&gt;&lt;/param&gt;
        public static int ExecuteNonQuery(
            string connectionString,
            CommandType commandType,
            string commandText,
            params SqlCeParameter[] commandParameters
            )
        {
            try
            {
                int rowsAffected;
                using (SqlCeConnection conn = SqlCeContextGuardian.Open(connectionString))
                {
                    // this is for multiple queries in the installer
                    if (commandText.Trim().StartsWith(&quot;!!!&quot;))
                    {
                        commandText = commandText.Trim().Trim(&#39;!&#39;);
                        string[] commands = commandText.Split(&#39;|&#39;);
                        string currentCmd = String.Empty;

                        foreach (string cmd in commands)
                        {
                            try
                            {
                                currentCmd = cmd;
                                if (!String.IsNullOrWhiteSpace(cmd))
                                {
                                    SqlCeCommand c = new SqlCeCommand(cmd, conn);
                                    c.ExecuteNonQuery();
                                }
                            }
                            catch (Exception e)
                            {
                                Debug.WriteLine(&quot;*******************************************************************&quot;);
                                Debug.WriteLine(currentCmd);
                                Debug.WriteLine(e);
                                Debug.WriteLine(&quot;*******************************************************************&quot;);
                            }
                        }
                        return 1;
                    }
                    else
                    {
                        Debug.WriteLine(&quot;----------------------------------------------------------------------------&quot;);
                        Debug.WriteLine(commandText);
                        Debug.WriteLine(&quot;----------------------------------------------------------------------------&quot;);
                        SqlCeCommand cmd = new SqlCeCommand(commandText, conn);
                        AttachParameters(cmd, commandParameters);
                        rowsAffected = cmd.ExecuteNonQuery();
                    }
                }

                return rowsAffected;
            }
            catch (Exception ee)
            {
                throw new SqlCeProviderException(&quot;Error running NonQuery: \nSQL Statement:\n&quot; + commandText + &quot;\n\nException:\n&quot; + ee.ToString());
            }
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connectionString&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;commandParameters&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static SqlCeDataReader ExecuteReader(
            string connectionString,
            CommandType commandType,
            string commandText,
            params SqlCeParameter[] commandParameters
            )
        {
            try
            {
                Debug.WriteLine(&quot;---------------------------------READER-------------------------------------&quot;);
                Debug.WriteLine(commandText);
                Debug.WriteLine(&quot;----------------------------------------------------------------------------&quot;);
                SqlCeDataReader reader;
                SqlCeConnection conn = SqlCeContextGuardian.Open(connectionString);

                try
                {
                    SqlCeCommand cmd = new SqlCeCommand(commandText, conn);
                    AttachParameters(cmd, commandParameters);
                    reader = cmd.ExecuteReader(CommandBehavior.CloseConnection);
                }
                catch
                {
                    conn.Close();
                    throw;
                }

                return reader;
            }
            catch (Exception ee)
            {
                throw new SqlCeProviderException(&quot;Error running Reader: \nSQL Statement:\n&quot; + commandText + &quot;\n\nException:\n&quot; + ee.ToString());
            }
        }

        public static bool VerifyConnection(string connectionString)
        {
            bool isConnected = false;
            using (SqlCeConnection conn = SqlCeContextGuardian.Open(connectionString))
            {
                isConnected = conn.State == ConnectionState.Open;
            }

            return isConnected;
        }

        private static void AttachParameters(SqlCeCommand command, SqlCeParameter[] commandParameters)
        {
            foreach (SqlCeParameter parameter in commandParameters)
            {
                if ((parameter.Direction == ParameterDirection.InputOutput) &amp;&amp; (parameter.Value == null))
                {
                    parameter.Value = DBNull.Value;
                }
                command.Parameters.Add(parameter);
            }
        }



    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[28,9,28,10,1],[32,13,32,14,1],[33,24,33,90,1],[34,17,34,18,1],[35,28,35,82,1],[36,21,36,22,1],[37,25,37,66,1],[38,25,38,121,1],[39,25,39,54,1],[40,25,40,121,1],[41,25,41,54,1],[42,21,42,22,1],[43,17,43,18,1],[45,17,45,31,1],[47,13,47,33,0],[48,13,48,14,0],[49,17,49,145,0],[51,9,51,10,1],[66,9,66,10,0],[68,13,68,14,0],[70,24,70,90,0],[71,17,71,18,0],[73,21,73,62,0],[74,21,74,22,0],[75,25,75,68,0],[76,25,76,68,0],[77,25,77,58,0],[79,25,79,32,0],[79,34,79,44,0],[79,45,79,47,0],[79,48,79,56,0],[80,25,80,26,0],[82,29,82,30,0],[83,33,83,50,0],[84,33,84,69,0],[85,33,85,34,0],[86,37,86,82,0],[87,37,87,57,0],[88,33,88,34,0],[89,29,89,30,0],[90,29,90,48,0],[91,29,91,30,0],[92,33,92,120,0],[93,33,93,61,0],[94,33,94,52,0],[95,33,95,120,0],[96,29,96,30,0],[97,25,97,26,0],[98,25,98,34,0],[101,21,101,22,0],[102,25,102,121,0],[103,25,103,54,0],[104,25,104,121,0],[105,25,105,80,0],[106,25,106,66,0],[107,25,107,62,0],[108,21,108,22,0],[109,17,109,18,0],[111,17,111,37,0],[113,13,113,33,0],[114,13,114,14,0],[115,17,115,147,0],[117,9,117,10,0],[133,9,133,10,1],[135,13,135,14,1],[136,17,136,113,1],[137,17,137,46,1],[138,17,138,113,1],[140,17,140,84,1],[143,17,143,18,1],[144,21,144,76,1],[145,21,145,62,1],[146,21,146,81,1],[147,17,147,18,1],[148,17,148,22,0],[149,17,149,18,0],[150,21,150,34,0],[151,21,151,27,0],[154,17,154,31,1],[156,13,156,33,0],[157,13,157,14,0],[158,17,158,145,0],[160,9,160,10,1],[163,9,163,10,0],[164,13,164,38,0],[165,20,165,86,0],[166,13,166,14,0],[167,17,167,66,0],[168,13,168,14,0],[170,13,170,32,0],[171,9,171,10,0],[174,9,174,10,1],[175,13,175,20,1],[175,22,175,46,1],[175,47,175,49,1],[175,50,175,67,1],[176,13,176,14,1],[177,17,177,106,1],[178,17,178,18,0],[179,21,179,52,0],[180,17,180,18,0],[181,17,181,51,1],[182,13,182,14,1],[183,9,183,10,1]]);
    </script>
  </body>
</html>