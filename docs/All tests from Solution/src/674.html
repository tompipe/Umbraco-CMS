<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\settings\stylesheet\property\EditStyleSheetProperty.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using System.Web;
using System.Web.UI.WebControls;
using Umbraco.Core;

namespace umbraco.cms.presentation.settings.stylesheet
{
    /// &lt;summary&gt;
    /// Summary description for EditStyleSheetProperty.
    /// &lt;/summary&gt;
    public partial class EditStyleSheetProperty : BasePages.UmbracoEnsuredPage
    {
        public EditStyleSheetProperty()
        {
            CurrentApp = BusinessLogic.DefaultApps.settings.ToString();

        }

        private Umbraco.Core.Models.StylesheetProperty _stylesheetproperty;
        private Umbraco.Core.Models.Stylesheet _sheet;

        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:System.Web.UI.Control.Load&quot;&gt;&lt;/see&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;T:System.EventArgs&quot;&gt;&lt;/see&gt; object that contains the event data.&lt;/param&gt;
        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            _sheet = Services.FileService.GetStylesheetByName(Request.QueryString[&quot;id&quot;]);
            if (_sheet == null) throw new InvalidOperationException(&quot;No stylesheet found with name: &quot; + Request.QueryString[&quot;id&quot;]);

            var property = HttpUtility.UrlDecode(Request.QueryString[&quot;prop&quot;]);
            var propName = IsPostBack ? OriginalName.Value : property;

            _stylesheetproperty = _sheet.Properties.FirstOrDefault(x =&gt; x.Name.InvariantEquals(propName));
            if (_stylesheetproperty == null) throw new InvalidOperationException(&quot;No stylesheet property found with name: &quot; + property);

            Panel1.Text = ui.Text(&quot;stylesheet&quot;, &quot;editstylesheetproperty&quot;, UmbracoUser);

            var bt = Panel1.Menu.NewButton();
            bt.Click += SaveClick;
            bt.Text = ui.Text(&quot;save&quot;);
            bt.ToolTip = ui.Text(&quot;save&quot;);
            bt.ButtonType = uicontrols.MenuButtonType.Primary;
            bt.ID = &quot;save&quot;;
        }


        protected override void OnPreRender(EventArgs e)
        {
            NameTxt.Text = _stylesheetproperty.Name;
            Content.Text = _stylesheetproperty.Value;
            AliasTxt.Text = _stylesheetproperty.Alias;
            OriginalName.Value = _stylesheetproperty.Name;

            prStyles.Attributes[&quot;style&quot;] = _stylesheetproperty.Value;

            var nodePath = string.Format(&quot;-1,init,{0},{0}_{1}&quot;, _sheet.Path
                        //needs a double escape to work with JS
                        .Replace(&quot;\\&quot;, &quot;\\\\&quot;).TrimEnd(&quot;.css&quot;), HttpUtility.UrlEncode(_stylesheetproperty.Name));

            ClientTools
                    .SetActiveTreeType(Constants.Trees.Stylesheets)
                    .SyncTree(nodePath, IsPostBack);

            prStyles.Attributes[&quot;style&quot;] = _stylesheetproperty.Value;

            base.OnPreRender(e);
        }

        private void SaveClick(object sender, EventArgs e)
        {
            _stylesheetproperty.Value = Content.Text;
            _stylesheetproperty.Alias = AliasTxt.Text;

            if (_stylesheetproperty.Name != NameTxt.Text)
            {
                //to change the name we actually have to remove the property and re-add it as a different one
                _sheet.AddProperty(new Umbraco.Core.Models.StylesheetProperty(NameTxt.Text, _stylesheetproperty.Alias, _stylesheetproperty.Value));
                _sheet.RemoveProperty(_stylesheetproperty.Name);
                //reset our variable 
                _stylesheetproperty = _sheet.Properties.Single(x =&gt; x.Name == NameTxt.Text);
            }

            Services.FileService.SaveStylesheet(_sheet);

            ClientTools.ShowSpeechBubble(speechBubbleIcon.save, ui.Text(&quot;speechBubbles&quot;, &quot;editStylesheetPropertySaved&quot;, UmbracoUser), &quot;&quot;);
        }


        override protected void OnInit(EventArgs e)
        {
            base.OnInit(e);
            Content.TextMode = TextBoxMode.MultiLine;
            Content.Height = 250;
            Content.Width = 300;
        }


        /// &lt;summary&gt;
        /// Panel1 control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.UmbracoPanel Panel1;

        /// &lt;summary&gt;
        /// Pane7 control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.Pane Pane7;

        protected global::System.Web.UI.WebControls.HiddenField OriginalName;

        /// &lt;summary&gt;
        /// NameTxt control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.TextBox NameTxt;

        /// &lt;summary&gt;
        /// AliasTxt control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.TextBox AliasTxt;

        /// &lt;summary&gt;
        /// Content control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.TextBox Content;

        /// &lt;summary&gt;
        /// prStyles control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.HtmlControls.HtmlGenericControl prStyles;
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,40,0],[15,9,15,10,0],[16,13,16,72,0],[18,9,18,10,0],[28,9,28,10,0],[29,13,29,28,0],[31,13,31,90,0],[32,13,32,32,0],[32,33,32,132,0],[34,13,34,79,0],[35,13,35,71,0],[37,13,37,73,0],[37,73,37,105,0],[37,105,37,107,0],[37,13,37,107,0],[38,13,38,45,0],[38,46,38,137,0],[40,13,40,88,0],[42,13,42,46,0],[43,13,43,35,0],[44,13,44,39,0],[45,13,45,42,0],[46,13,46,63,0],[47,13,47,28,0],[48,9,48,10,0],[52,9,52,10,0],[53,13,53,53,0],[54,13,54,54,0],[55,13,55,55,0],[56,13,56,59,0],[58,13,58,70,0],[60,13,62,114,0],[64,13,66,53,0],[68,13,68,70,0],[70,13,70,33,0],[71,9,71,10,0],[74,9,74,10,0],[75,13,75,54,0],[76,13,76,55,0],[78,13,78,58,0],[79,13,79,14,0],[81,17,81,148,0],[82,17,82,65,0],[84,17,84,69,0],[84,69,84,91,0],[84,91,84,93,0],[84,17,84,93,0],[85,13,85,14,0],[87,13,87,57,0],[89,13,89,139,0],[90,9,90,10,0],[94,9,94,10,0],[95,13,95,28,0],[96,13,96,54,0],[97,13,97,34,0],[98,13,98,33,0],[99,9,99,10,0]]);
    </script>
  </body>
</html>