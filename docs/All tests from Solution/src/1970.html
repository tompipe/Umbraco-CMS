<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\MediaExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using Umbraco.Core.Configuration.UmbracoSettings;
using Umbraco.Core.Logging;
using Umbraco.Core.PropertyEditors.ValueConverters;

namespace Umbraco.Core.Models
{
    internal static class MediaExtensions
    {
        /// &lt;summary&gt;
        /// Hack: we need to put this in a real place, this is currently just used to render the urls for a media item in the back office
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string GetUrl(this IMedia media, string propertyAlias, ILogger logger)
        {
            var propertyType = media.PropertyTypes.FirstOrDefault(x =&gt; x.Alias.InvariantEquals(propertyAlias));
            if (propertyType != null)
            {
                var val = media.Properties[propertyType];
                if (val != null)
                {
                    var jsonString = val.Value as string;
                    if (jsonString != null)
                    {
                        if (propertyType.PropertyEditorAlias == Constants.PropertyEditors.ImageCropperAlias)
                        {
                            if (jsonString.DetectIsJson())
                            {
                                try
                                {
                                    var json = JsonConvert.DeserializeObject&lt;JObject&gt;(jsonString);
                                    if (json[&quot;src&quot;] != null)
                                    {
                                        return json[&quot;src&quot;].Value&lt;string&gt;();
                                    }
                                }
                                catch (Exception ex)
                                {
                                    logger.Error&lt;ImageCropperValueConverter&gt;(&quot;Could not parse the string &quot; + jsonString + &quot; to a json object&quot;, ex);
                                    return string.Empty;
                                }
                            }
                            else
                            {
                                return jsonString;
                            }
                        }
                        else if (propertyType.PropertyEditorAlias == Constants.PropertyEditors.UploadFieldAlias)
                        {
                            return jsonString;
                        }
                        //hrm, without knowing what it is, just adding a string here might not be very nice
                    }
                }
            }
            return string.Empty;
        }

        /// &lt;summary&gt;
        /// Hack: we need to put this in a real place, this is currently just used to render the urls for a media item in the back office
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string[] GetUrls(this IMedia media, IContentSection contentSection, ILogger logger)
        {
            var links = new List&lt;string&gt;();
            var autoFillProperties = contentSection.ImageAutoFillProperties.ToArray();
            if (autoFillProperties.Any())
            {
                links.AddRange(
                    autoFillProperties
                        .Select(field =&gt; media.GetUrl(field.Alias, logger))
                        .Where(link =&gt; link.IsNullOrWhiteSpace() == false));
            }
            return links.ToArray();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,10,0],[20,13,20,72,0],[20,72,20,110,0],[20,110,20,112,0],[20,13,20,112,0],[21,13,21,38,0],[22,13,22,14,0],[23,17,23,58,0],[24,17,24,33,0],[25,17,25,18,0],[26,21,26,58,0],[27,21,27,44,0],[28,21,28,22,0],[29,25,29,109,0],[30,25,30,26,0],[31,29,31,59,0],[32,29,32,30,0],[34,33,34,34,0],[35,37,35,99,0],[36,37,36,61,0],[37,37,37,38,0],[38,41,38,76,0],[40,33,40,34,0],[41,33,41,53,0],[42,33,42,34,0],[43,37,43,148,0],[44,37,44,57,0],[46,29,46,30,0],[48,29,48,30,0],[49,33,49,51,0],[51,25,51,26,0],[52,30,52,113,0],[53,25,53,26,0],[54,29,54,47,0],[57,21,57,22,0],[58,17,58,18,0],[59,13,59,14,0],[60,13,60,33,0],[61,9,61,10,0],[68,9,68,10,0],[69,13,69,44,0],[70,13,70,87,0],[71,13,71,42,0],[72,13,72,14,0],[73,17,75,42,0],[75,42,75,75,0],[75,75,76,40,0],[76,40,76,74,0],[76,74,76,77,0],[73,17,76,77,0],[77,13,77,14,0],[78,13,78,36,0],[79,9,79,10,0]]);
    </script>
  </body>
</html>