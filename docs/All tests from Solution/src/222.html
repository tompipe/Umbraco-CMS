<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Models\MediaXmlTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Linq;
using System.Xml.Linq;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.ObjectResolution;
using Umbraco.Core.Models;
using Umbraco.Core.Strings;
using Umbraco.Tests.TestHelpers;
using Umbraco.Tests.TestHelpers.Entities;
using umbraco.editorControls.tinyMCE3;
using umbraco.interfaces;

namespace Umbraco.Tests.Models
{
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerFixture)]
    [TestFixture]
    public class MediaXmlTest : BaseDatabaseFactoryTest
    {
        [SetUp]
        public override void Initialize()
        {            
            base.Initialize();
        }

        protected override void FreezeResolution()
        {
            UrlSegmentProviderResolver.Current = new UrlSegmentProviderResolver(
                new ActivatorServiceProvider(),
                Logger,
                typeof(DefaultUrlSegmentProvider));
            base.FreezeResolution();
        }

        [TearDown]
        public override void TearDown()
        {
            base.TearDown();
        }

        [Test]
        public void Can_Generate_Xml_Representation_Of_Media()
        {
            // Arrange
            var mediaType = MockedContentTypes.CreateImageMediaType(&quot;image2&quot;);
            ServiceContext.ContentTypeService.Save(mediaType);

            var media = MockedMedia.CreateMediaImage(mediaType, -1);
            ServiceContext.MediaService.Save(media, 0);

            var nodeName = media.ContentType.Alias.ToSafeAliasWithForcingCheck();
            var urlName = media.GetUrlSegment();

            // Act
            XElement element = media.ToXml();

            // Assert
            Assert.That(element, Is.Not.Null);
            Assert.That(element.Name.LocalName, Is.EqualTo(nodeName));
            Assert.AreEqual(media.Id.ToString(), (string)element.Attribute(&quot;id&quot;));
            Assert.AreEqual(media.ParentId.ToString(), (string)element.Attribute(&quot;parentID&quot;));
            Assert.AreEqual(media.Level.ToString(), (string)element.Attribute(&quot;level&quot;));
            Assert.AreEqual(media.SortOrder.ToString(), (string)element.Attribute(&quot;sortOrder&quot;));
            Assert.AreEqual(media.CreateDate.ToString(&quot;s&quot;), (string)element.Attribute(&quot;createDate&quot;));
            Assert.AreEqual(media.UpdateDate.ToString(&quot;s&quot;), (string)element.Attribute(&quot;updateDate&quot;));
            Assert.AreEqual(media.Name, (string)element.Attribute(&quot;nodeName&quot;));
            Assert.AreEqual(urlName, (string)element.Attribute(&quot;urlName&quot;));
            Assert.AreEqual(media.Path, (string)element.Attribute(&quot;path&quot;));
            Assert.AreEqual(&quot;&quot;, (string)element.Attribute(&quot;isDoc&quot;));
            Assert.AreEqual(media.ContentType.Id.ToString(), (string)element.Attribute(&quot;nodeType&quot;));
            Assert.AreEqual(media.GetCreatorProfile().Name, (string)element.Attribute(&quot;writerName&quot;));
            Assert.AreEqual(media.CreatorId.ToString(), (string)element.Attribute(&quot;writerID&quot;));
            Assert.AreEqual(media.Version.ToString(), (string)element.Attribute(&quot;version&quot;));
            Assert.AreEqual(&quot;0&quot;, (string)element.Attribute(&quot;template&quot;));

            Assert.AreEqual(media.Properties[Constants.Conventions.Media.File].Value.ToString(), element.Elements(Constants.Conventions.Media.File).Single().Value);
            Assert.AreEqual(media.Properties[Constants.Conventions.Media.Width].Value.ToString(), element.Elements(Constants.Conventions.Media.Width).Single().Value);
            Assert.AreEqual(media.Properties[Constants.Conventions.Media.Height].Value.ToString(), element.Elements(Constants.Conventions.Media.Height).Single().Value);
            Assert.AreEqual(media.Properties[Constants.Conventions.Media.Bytes].Value.ToString(), element.Elements(Constants.Conventions.Media.Bytes).Single().Value);
            Assert.AreEqual(media.Properties[Constants.Conventions.Media.Extension].Value.ToString(), element.Elements(Constants.Conventions.Media.Extension).Single().Value);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,10,1],[22,13,22,31,1],[23,9,23,10,1],[26,9,26,10,1],[27,13,30,52,1],[31,13,31,37,1],[32,9,32,10,1],[36,9,36,10,1],[37,13,37,29,1],[38,9,38,10,1],[42,9,42,10,1],[44,13,44,79,1],[45,13,45,63,1],[47,13,47,69,1],[48,13,48,56,1],[50,13,50,82,1],[51,13,51,49,1],[54,13,54,46,1],[57,13,57,47,1],[58,13,58,71,1],[59,13,59,83,1],[60,13,60,95,1],[61,13,61,89,1],[62,13,62,97,1],[63,13,63,102,1],[64,13,64,102,1],[65,13,65,80,1],[66,13,66,76,1],[67,13,67,76,1],[68,13,68,69,1],[69,13,69,101,1],[70,13,70,102,1],[71,13,71,96,1],[72,13,72,93,1],[73,13,73,73,1],[75,13,75,165,1],[76,13,76,167,1],[77,13,77,169,1],[78,13,78,167,1],[79,13,79,175,1],[80,9,80,10,1]]);
    </script>
  </body>
</html>