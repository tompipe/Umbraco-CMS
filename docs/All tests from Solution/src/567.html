<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\plugins\tinymce3\insertLink.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using Umbraco.Core;
using umbraco.BusinessLogic;
using umbraco.businesslogic.Exceptions;

namespace umbraco.presentation.plugins.tinymce3
{
    public partial class insertLink : BasePages.UmbracoEnsuredPage
    {
        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);

            //this could be used for media or content so we need to at least validate that the user has access to one or the other
            if (!ValidateUserApp(DefaultApps.content.ToString()) &amp;&amp; !ValidateUserApp(DefaultApps.media.ToString()))
                throw new UserAuthorizationException(&quot;The current user doesn&#39;t have access to the section/app&quot;);
        }

        protected void Page_Load(object sender, System.EventArgs e)
        {
            ClientLoader.DataBind();

            uicontrols.TabPage tp = tv_options.NewTabPage(ui.Text(&quot;content&quot;));
            tp.HasMenu = false;
            tp.Controls.Add(pane_content);


            if (CurrentUser.GetApplications().Find(t =&gt; t.alias == Constants.Applications.Media) != null)
            {
                uicontrols.TabPage tp2 = tv_options.NewTabPage(ui.Text(&quot;media&quot;));
                tp2.HasMenu = false;
                tp2.Controls.Add(pane_media);
            } else
            {
                pane_media.Visible = false;
            }


        }

        protected override void Render(HtmlTextWriter writer)
        {
            // clear form action
            Page.Form.Attributes.Add(&quot;onsubmit&quot;, &quot;insertAction();return false;&quot;);
            //            Page.Form.Action = &quot;#&quot;;
            // this context item is needed to prevent the urlrewriterformwriter class to change the action
            //          HttpContext.Current.Items[&quot;UrlRewriterFormWriterDisableAction&quot;] = &quot;true&quot;;
            //        HttpContext.Current.Items[&quot;ActionAlreadyWritten&quot;] = &quot;true&quot;;

            base.Render(writer);
        }

        public User GetUser()
        {
            return base.getUser();
        }


    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,0],[16,13,16,28,0],[19,13,19,116,0],[20,17,20,113,0],[21,9,21,10,0],[24,9,24,10,0],[25,13,25,37,0],[27,13,27,79,0],[28,13,28,32,0],[29,13,29,43,0],[32,13,32,57,0],[32,57,32,96,0],[32,96,32,106,0],[32,13,32,106,0],[33,13,33,14,0],[34,17,34,82,0],[35,17,35,37,0],[36,17,36,46,0],[37,13,37,14,0],[38,13,38,14,0],[39,17,39,44,0],[40,13,40,14,0],[43,9,43,10,0],[46,9,46,10,0],[48,13,48,82,0],[54,13,54,33,0],[55,9,55,10,0],[58,9,58,10,0],[59,13,59,35,0],[60,9,60,10,0]]);
    </script>
  </body>
</html>