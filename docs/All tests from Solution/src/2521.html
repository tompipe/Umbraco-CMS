<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.businesslogic\Application.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Configuration;
using System.IO;
using System.Linq;
using System.Web;
using System.Xml.Linq;
using AutoMapper;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Events;
using Umbraco.Core.IO;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Services;
using umbraco.DataLayer;
using System.Runtime.CompilerServices;
using umbraco.businesslogic;

namespace umbraco.BusinessLogic
{
    /// &lt;summary&gt;
    /// Class for handling all registered applications in Umbraco.
    /// &lt;/summary&gt;
    [Obsolete(&quot;Use ApplicationContext.Current.Services.SectionService and/or Umbraco.Core.Sections.SectionCollection instead&quot;)]
    public class Application
    {
        private static ISqlHelper _sqlHelper;
        
        

        /// &lt;summary&gt;
        /// Gets the SQL helper.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The SQL helper.&lt;/value&gt;
        [Obsolete(&quot;Do not use SqlHelper anymore, if database querying needs to be done use the DatabaseContext instead&quot;)]
        public static ISqlHelper SqlHelper
        {
            get
            {
                if (_sqlHelper == null)
                {
                    var connectionString = string.Empty;

                    try
                    {
                        const string umbracoDsn = Umbraco.Core.Configuration.GlobalSettings.UmbracoConnectionName;
                    
                        var databaseSettings = ConfigurationManager.ConnectionStrings[umbracoDsn];
                        if (databaseSettings != null)
                            connectionString = databaseSettings.ConnectionString;

                        // During upgrades we might still have the old appSettings connectionstring, and not the new one, so get that one instead
                        if (string.IsNullOrWhiteSpace(connectionString) &amp;&amp;
                            ConfigurationManager.AppSettings.ContainsKey(umbracoDsn))
                            connectionString = ConfigurationManager.AppSettings[umbracoDsn];

                        _sqlHelper = DataLayerHelper.CreateSqlHelper(connectionString, false);
                    }
                    catch(Exception ex)
                    {
                        LogHelper.Error&lt;Application&gt;(string.Format(&quot;Can&#39;t instantiate SQLHelper with connectionstring \&quot;{0}\&quot;&quot;, connectionString), ex);
                    }
                }

                return _sqlHelper;
            }
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;Application&quot;/&gt; class.
        /// &lt;/summary&gt;
        public Application()
        { }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;Application&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;The application name.&lt;/param&gt;
        /// &lt;param name=&quot;alias&quot;&gt;The application alias.&lt;/param&gt;
        /// &lt;param name=&quot;icon&quot;&gt;The application icon.&lt;/param&gt;
        public Application(string name, string alias, string icon)
            : this(name, alias, icon, 0)
        { }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;Application&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;The name.&lt;/param&gt;
        /// &lt;param name=&quot;alias&quot;&gt;The alias.&lt;/param&gt;
        /// &lt;param name=&quot;icon&quot;&gt;The icon.&lt;/param&gt;
        /// &lt;param name=&quot;sortOrder&quot;&gt;The sort order.&lt;/param&gt;
        public Application(string name, string alias, string icon, int sortOrder)
        {
            this.name = name;
            this.alias = alias;
            this.icon = icon;
            this.sortOrder = sortOrder;
        }

        /// &lt;summary&gt;
        /// Gets or sets the application name.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The name.&lt;/value&gt;
        public string name { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the application alias.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The alias.&lt;/value&gt;
        public string alias { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the application icon.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The application icon.&lt;/value&gt;
        public string icon { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the sort order.
        /// &lt;/summary&gt;
        /// &lt;value&gt;
        /// The sort order.
        /// &lt;/value&gt;
        public int sortOrder { get; set; }

        /// &lt;summary&gt;
        /// Creates a new applcation if no application with the specified alias is found.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;The application name.&lt;/param&gt;
        /// &lt;param name=&quot;alias&quot;&gt;The application alias.&lt;/param&gt;
        /// &lt;param name=&quot;icon&quot;&gt;The application icon, which has to be located in umbraco/images/tray folder.&lt;/param&gt;
        public static void MakeNew(string name, string alias, string icon)
        {
            ApplicationContext.Current.Services.SectionService.MakeNew(name, alias, icon);
        }

        /// &lt;summary&gt;
        /// Makes the new.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;The name.&lt;/param&gt;
        /// &lt;param name=&quot;alias&quot;&gt;The alias.&lt;/param&gt;
        /// &lt;param name=&quot;icon&quot;&gt;The icon.&lt;/param&gt;
        /// &lt;param name=&quot;sortOrder&quot;&gt;The sort order.&lt;/param&gt;
        public static void MakeNew(string name, string alias, string icon, int sortOrder)
        {
            ApplicationContext.Current.Services.SectionService.MakeNew(name, alias, icon, sortOrder);
        }

        /// &lt;summary&gt;
        /// Gets the application by its alias.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;appAlias&quot;&gt;The application alias.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static Application getByAlias(string appAlias)
        {
            return Mapper.Map&lt;Section, Application&gt;(
                ApplicationContext.Current.Services.SectionService.GetByAlias(appAlias));
        }

        /// &lt;summary&gt;
        /// Deletes this instance.
        /// &lt;/summary&gt;
        public void Delete()
        {
            ApplicationContext.Current.Services.SectionService.DeleteSection(Mapper.Map&lt;Application, Section&gt;(this));
        }

        /// &lt;summary&gt;
        /// Gets all applications registered in umbraco from the umbracoApp table..
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Returns a Application Array&lt;/returns&gt;
        public static List&lt;Application&gt; getAll()
        {
            return ApplicationContext.Current.Services.SectionService.GetSections().Select(Mapper.Map&lt;Section, Application&gt;).ToList();
        }

        /// &lt;summary&gt;
        /// Stores all references to classes that are of type IApplication
        /// &lt;/summary&gt;
        [Obsolete(&quot;RegisterIApplications has been depricated. Please use ApplicationStartupHandler.RegisterHandlers() instead.&quot;)]
        public static void RegisterIApplications()
        {
            ApplicationStartupHandler.RegisterHandlers();
        }
   
        
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[40,13,40,14,1],[41,17,41,40,1],[42,17,42,18,1],[43,21,43,57,1],[46,21,46,22,1],[49,25,49,99,1],[50,25,50,54,1],[51,29,51,82,1],[54,25,55,86,1],[56,29,56,93,0],[58,25,58,95,1],[59,21,59,22,1],[60,21,60,40,0],[61,21,61,22,0],[62,25,62,152,0],[63,21,63,22,0],[64,17,64,18,1],[66,17,66,35,1],[67,13,67,14,1],[73,9,73,29,0],[74,9,74,10,0],[74,11,74,12,0],[83,15,83,41,0],[84,9,84,10,0],[84,11,84,12,0],[93,9,93,82,1],[94,9,94,10,1],[95,13,95,30,1],[96,13,96,32,1],[97,13,97,30,1],[98,13,98,40,1],[99,9,99,10,1],[105,30,105,34,1],[105,35,105,39,1],[111,31,111,35,1],[111,36,111,40,1],[117,30,117,34,1],[117,35,117,39,1],[125,32,125,36,1],[125,37,125,41,1],[134,9,134,10,0],[135,13,135,91,0],[136,9,136,10,0],[146,9,146,10,0],[147,13,147,102,0],[148,9,148,10,0],[156,9,156,10,0],[157,13,158,90,0],[159,9,159,10,0],[165,9,165,10,0],[166,13,166,118,0],[167,9,167,10,0],[174,9,174,10,1],[175,13,175,135,1],[176,9,176,10,1],[183,9,183,10,0],[184,13,184,58,0],[185,9,185,10,0]]);
    </script>
  </body>
</html>