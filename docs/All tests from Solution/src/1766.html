<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Migrations\Syntax\Insert\Expressions\InsertDataExpression.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Text;
using Umbraco.Core.Persistence.DatabaseModelDefinitions;
using Umbraco.Core.Persistence.SqlSyntax;

namespace Umbraco.Core.Persistence.Migrations.Syntax.Insert.Expressions
{
    public class InsertDataExpression : MigrationExpressionBase
    {
        private readonly List&lt;InsertionDataDefinition&gt; _rows = new List&lt;InsertionDataDefinition&gt;();
        
        public InsertDataExpression(DatabaseProviders current, DatabaseProviders[] databaseProviders, ISqlSyntaxProvider sqlSyntax) 
            : base(current, databaseProviders, sqlSyntax)
        {
        }

        public string SchemaName { get; set; }
        public string TableName { get; set; }
        public bool EnabledIdentityInsert { get; set; }

        public List&lt;InsertionDataDefinition&gt; Rows
        {
            get { return _rows; }
        }
        
        public override string ToString()
        {
            if (IsExpressionSupported() == false)
                return string.Empty;
            
            var sb = new StringBuilder();

            if (EnabledIdentityInsert &amp;&amp; SqlSyntax.SupportsIdentityInsert())
            {
                sb.AppendLine(string.Format(&quot;SET IDENTITY_INSERT {0} ON;&quot;, SqlSyntax.GetQuotedTableName(TableName)));
                if (CurrentDatabaseProvider == DatabaseProviders.SqlServer || CurrentDatabaseProvider == DatabaseProviders.SqlServerCE)
                {
                    sb.AppendLine(&quot;GO&quot;);
                }
            }

            try
            {
                foreach (var item in Rows)
                {
                    var cols = &quot;&quot;;
                    var vals = &quot;&quot;;
                    foreach (var keyVal in item)
                    {
                        cols += SqlSyntax.GetQuotedColumnName(keyVal.Key) + &quot;,&quot;;
                        vals += GetQuotedValue(keyVal.Value) + &quot;,&quot;;
                    }
                    cols = cols.TrimEnd(&#39;,&#39;);
                    vals = vals.TrimEnd(&#39;,&#39;);


                    var sql = string.Format(SqlSyntax.InsertData,
                                  SqlSyntax.GetQuotedTableName(TableName),
                                  cols, vals);

                    sb.AppendLine(string.Format(&quot;{0};&quot;, sql));
                    if (CurrentDatabaseProvider == DatabaseProviders.SqlServer || CurrentDatabaseProvider == DatabaseProviders.SqlServerCE)
                    {
                        sb.AppendLine(&quot;GO&quot;);
                    }
                }
            }
            finally
            {
                if (EnabledIdentityInsert &amp;&amp; SqlSyntax.SupportsIdentityInsert())
                {
                    sb.AppendLine(string.Format(&quot;SET IDENTITY_INSERT {0} OFF;&quot;, SqlSyntax.GetQuotedTableName(TableName)));
                    if (CurrentDatabaseProvider == DatabaseProviders.SqlServer || CurrentDatabaseProvider == DatabaseProviders.SqlServerCE)
                    {
                        sb.AppendLine(&quot;GO&quot;);
                    }
                }
            }

            return sb.ToString();
        }

        
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,9,11,100,0],[14,15,14,58,0],[15,9,15,10,0],[16,9,16,10,0],[18,36,18,40,0],[18,41,18,45,0],[19,35,19,39,0],[19,40,19,44,0],[20,45,20,49,0],[20,50,20,54,0],[24,17,24,18,0],[24,19,24,32,0],[24,33,24,34,0],[28,9,28,10,0],[29,13,29,50,0],[30,17,30,37,0],[32,13,32,42,0],[34,13,34,77,0],[35,13,35,14,0],[36,17,36,118,0],[37,17,37,136,0],[38,17,38,18,0],[39,21,39,41,0],[40,17,40,18,0],[41,13,41,14,0],[44,13,44,14,0],[45,17,45,24,0],[45,26,45,34,0],[45,35,45,37,0],[45,38,45,42,0],[46,17,46,18,0],[47,21,47,35,0],[48,21,48,35,0],[49,21,49,28,0],[49,30,49,40,0],[49,41,49,43,0],[49,44,49,48,0],[50,21,50,22,0],[51,25,51,81,0],[52,25,52,68,0],[53,21,53,22,0],[54,21,54,46,0],[55,21,55,46,0],[58,21,60,47,0],[62,21,62,63,0],[63,21,63,140,0],[64,21,64,22,0],[65,25,65,45,0],[66,21,66,22,0],[67,17,67,18,0],[68,13,68,14,0],[70,13,70,14,0],[71,17,71,81,0],[72,17,72,18,0],[73,21,73,123,0],[74,21,74,140,0],[75,21,75,22,0],[76,25,76,45,0],[77,21,77,22,0],[78,17,78,18,0],[79,13,79,14,0],[81,13,81,34,0],[82,9,82,10,0]]);
    </script>
  </body>
</html>