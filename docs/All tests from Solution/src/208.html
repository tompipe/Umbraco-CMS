<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Models\MemberTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Diagnostics;
using System.Linq;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Core.Models.EntityBase;
using Umbraco.Core.Serialization;
using Umbraco.Tests.TestHelpers.Entities;

namespace Umbraco.Tests.Models
{
    [TestFixture]
    public class MemberTests
    {
        [Test]
        public void Can_Deep_Clone()
        {
            // Arrange
            var memberType = MockedContentTypes.CreateSimpleMemberType(&quot;memberType&quot;, &quot;Member Type&quot;);
            memberType.Id = 99;
            var member = MockedMember.CreateSimpleMember(memberType, &quot;Name&quot;, &quot;email@email.com&quot;, &quot;pass&quot;, &quot;user&quot;, Guid.NewGuid());
            var i = 200;
            foreach (var property in member.Properties)
            {
                property.Id = ++i;
            }
            member.Id = 10;
            member.CreateDate = DateTime.Now;
            member.CreatorId = 22;
            member.Comments = &quot;comments&quot;;
            member.Key = Guid.NewGuid();
            member.FailedPasswordAttempts = 22;
            member.Level = 3;
            member.Path = &quot;-1,4,10&quot;;
            member.Groups = new[] {&quot;group1&quot;, &quot;group2&quot;};
            member.IsApproved = true;
            member.IsLockedOut = true;
            member.LastLockoutDate = DateTime.Now;
            member.LastLoginDate = DateTime.Now;
            member.LastPasswordChangeDate = DateTime.Now;
            member.PasswordQuestion = &quot;question&quot;;
            member.ProviderUserKey = Guid.NewGuid();
            member.RawPasswordAnswerValue = &quot;raw answer&quot;;
            member.RawPasswordValue = &quot;raw pass&quot;;
            member.SortOrder = 5;
            member.Trashed = false;
            member.UpdateDate = DateTime.Now;
            member.Version = Guid.NewGuid();            
            ((IUmbracoEntity)member).AdditionalData.Add(&quot;test1&quot;, 123);
            ((IUmbracoEntity)member).AdditionalData.Add(&quot;test2&quot;, &quot;hello&quot;);

            // Act
            var clone = (Member)member.DeepClone();

            // Assert
            Assert.AreNotSame(clone, member);
            Assert.AreEqual(clone, member);
            Assert.AreEqual(clone.Id, member.Id);
            Assert.AreEqual(clone.Version, member.Version);
            Assert.AreEqual(((IUmbracoEntity)clone).AdditionalData, ((IUmbracoEntity)member).AdditionalData);
            Assert.AreNotSame(clone.ContentType, member.ContentType);
            Assert.AreEqual(clone.ContentType, member.ContentType);
            Assert.AreEqual(clone.ContentType.PropertyGroups.Count, member.ContentType.PropertyGroups.Count);
            for (var index = 0; index &lt; member.ContentType.PropertyGroups.Count; index++)
            {
                Assert.AreNotSame(clone.ContentType.PropertyGroups[index], member.ContentType.PropertyGroups[index]);
                Assert.AreEqual(clone.ContentType.PropertyGroups[index], member.ContentType.PropertyGroups[index]);
            }
            Assert.AreEqual(clone.ContentType.PropertyTypes.Count(), member.ContentType.PropertyTypes.Count());
            for (var index = 0; index &lt; member.ContentType.PropertyTypes.Count(); index++)
            {
                Assert.AreNotSame(clone.ContentType.PropertyTypes.ElementAt(index), member.ContentType.PropertyTypes.ElementAt(index));
                Assert.AreEqual(clone.ContentType.PropertyTypes.ElementAt(index), member.ContentType.PropertyTypes.ElementAt(index));
            }
            Assert.AreEqual(clone.ContentTypeId, member.ContentTypeId);
            Assert.AreEqual(clone.CreateDate, member.CreateDate);
            Assert.AreEqual(clone.CreatorId, member.CreatorId);
            Assert.AreEqual(clone.Comments, member.Comments);
            Assert.AreEqual(clone.Key, member.Key);
            Assert.AreEqual(clone.FailedPasswordAttempts, member.FailedPasswordAttempts);
            Assert.AreEqual(clone.Level, member.Level);
            Assert.AreEqual(clone.Path, member.Path);
            Assert.AreEqual(clone.Groups, member.Groups);
            Assert.AreEqual(clone.Groups.Count(), member.Groups.Count());
            Assert.AreEqual(clone.IsApproved, member.IsApproved);
            Assert.AreEqual(clone.IsLockedOut, member.IsLockedOut);
            Assert.AreEqual(clone.SortOrder, member.SortOrder);
            Assert.AreEqual(clone.LastLockoutDate, member.LastLockoutDate);
            Assert.AreNotSame(clone.LastLoginDate, member.LastLoginDate);
            Assert.AreEqual(clone.LastPasswordChangeDate, member.LastPasswordChangeDate);
            Assert.AreEqual(clone.Trashed, member.Trashed);
            Assert.AreEqual(clone.UpdateDate, member.UpdateDate);
            Assert.AreEqual(clone.Version, member.Version);
            Assert.AreEqual(clone.PasswordQuestion, member.PasswordQuestion);
            Assert.AreEqual(clone.ProviderUserKey, member.ProviderUserKey);
            Assert.AreEqual(clone.RawPasswordAnswerValue, member.RawPasswordAnswerValue);
            Assert.AreEqual(clone.RawPasswordValue, member.RawPasswordValue);
            Assert.AreNotSame(clone.Properties, member.Properties);
            Assert.AreEqual(clone.Properties.Count(), member.Properties.Count());
            for (var index = 0; index &lt; member.Properties.Count; index++)
            {
                Assert.AreNotSame(clone.Properties[index], member.Properties[index]);
                Assert.AreEqual(clone.Properties[index], member.Properties[index]);
            }

            //This double verifies by reflection
            var allProps = clone.GetType().GetProperties();
            foreach (var propertyInfo in allProps)
            {
                Assert.AreEqual(propertyInfo.GetValue(clone, null), propertyInfo.GetValue(member, null));
            }
        }

        [Test]
        public void Can_Serialize_Without_Error()
        {
            var ss = new SerializationService(new JsonNetSerializer());

            var memberType = MockedContentTypes.CreateSimpleMemberType(&quot;memberType&quot;, &quot;Member Type&quot;);
            memberType.Id = 99;
            var member = MockedMember.CreateSimpleMember(memberType, &quot;Name&quot;, &quot;email@email.com&quot;, &quot;pass&quot;, &quot;user&quot;, Guid.NewGuid());
            var i = 200;
            foreach (var property in member.Properties)
            {
                property.Id = ++i;
            }
            member.Id = 10;
            member.CreateDate = DateTime.Now;
            member.CreatorId = 22;
            member.Comments = &quot;comments&quot;;
            member.Key = Guid.NewGuid();
            member.FailedPasswordAttempts = 22;
            member.Level = 3;
            member.Path = &quot;-1,4,10&quot;;
            member.Groups = new[] { &quot;group1&quot;, &quot;group2&quot; };
            member.IsApproved = true;
            member.IsLockedOut = true;
            member.LastLockoutDate = DateTime.Now;
            member.LastLoginDate = DateTime.Now;
            member.LastPasswordChangeDate = DateTime.Now;
            member.PasswordQuestion = &quot;question&quot;;
            member.ProviderUserKey = Guid.NewGuid();
            member.RawPasswordAnswerValue = &quot;raw answer&quot;;
            member.RawPasswordValue = &quot;raw pass&quot;;
            member.SortOrder = 5;
            member.Trashed = false;
            member.UpdateDate = DateTime.Now;
            member.Version = Guid.NewGuid();
            ((IUmbracoEntity)member).AdditionalData.Add(&quot;test1&quot;, 123);
            ((IUmbracoEntity)member).AdditionalData.Add(&quot;test2&quot;, &quot;hello&quot;);

            var result = ss.ToStream(member);
            var json = result.ResultStream.ToJsonString();
            Debug.Print(json);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[19,13,19,101,1],[20,13,20,32,1],[21,13,21,129,1],[22,13,22,25,1],[23,13,23,20,1],[23,22,23,34,1],[23,35,23,37,1],[23,38,23,55,1],[24,13,24,14,1],[25,17,25,35,1],[26,13,26,14,1],[27,13,27,28,1],[28,13,28,46,1],[29,13,29,35,1],[30,13,30,42,1],[31,13,31,41,1],[32,13,32,48,1],[33,13,33,30,1],[34,13,34,37,1],[35,13,35,56,1],[36,13,36,38,1],[37,13,37,39,1],[38,13,38,51,1],[39,13,39,49,1],[40,13,40,58,1],[41,13,41,50,1],[42,13,42,53,1],[43,13,43,58,1],[44,13,44,50,1],[45,13,45,34,1],[46,13,46,36,1],[47,13,47,46,1],[48,13,48,45,1],[49,13,49,71,1],[50,13,50,75,1],[53,13,53,52,1],[56,13,56,46,1],[57,13,57,44,1],[58,13,58,50,1],[59,13,59,60,1],[60,13,60,110,1],[61,13,61,70,1],[62,13,62,68,1],[63,13,63,110,1],[64,18,64,31,1],[64,33,64,80,1],[64,82,64,89,1],[65,13,65,14,1],[66,17,66,118,1],[67,17,67,116,1],[68,13,68,14,1],[69,13,69,112,1],[70,18,70,31,1],[70,33,70,81,1],[70,83,70,90,1],[71,13,71,14,1],[72,17,72,136,1],[73,17,73,134,1],[74,13,74,14,1],[75,13,75,72,1],[76,13,76,66,1],[77,13,77,64,1],[78,13,78,62,1],[79,13,79,52,1],[80,13,80,90,1],[81,13,81,56,1],[82,13,82,54,1],[83,13,83,58,1],[84,13,84,74,1],[85,13,85,66,1],[86,13,86,68,1],[87,13,87,64,1],[88,13,88,76,1],[89,13,89,74,1],[90,13,90,90,1],[91,13,91,60,1],[92,13,92,66,1],[93,13,93,60,1],[94,13,94,78,1],[95,13,95,76,1],[96,13,96,90,1],[97,13,97,78,1],[98,13,98,68,1],[99,13,99,82,1],[100,18,100,31,1],[100,33,100,64,1],[100,66,100,73,1],[101,13,101,14,1],[102,17,102,86,1],[103,17,103,84,1],[104,13,104,14,1],[107,13,107,60,1],[108,13,108,20,1],[108,22,108,38,1],[108,39,108,41,1],[108,42,108,50,1],[109,13,109,14,1],[110,17,110,106,1],[111,13,111,14,1],[112,9,112,10,1],[116,9,116,10,1],[117,13,117,72,1],[119,13,119,101,1],[120,13,120,32,1],[121,13,121,129,1],[122,13,122,25,1],[123,13,123,20,1],[123,22,123,34,1],[123,35,123,37,1],[123,38,123,55,1],[124,13,124,14,1],[125,17,125,35,1],[126,13,126,14,1],[127,13,127,28,1],[128,13,128,46,1],[129,13,129,35,1],[130,13,130,42,1],[131,13,131,41,1],[132,13,132,48,1],[133,13,133,30,1],[134,13,134,37,1],[135,13,135,58,1],[136,13,136,38,1],[137,13,137,39,1],[138,13,138,51,1],[139,13,139,49,1],[140,13,140,58,1],[141,13,141,50,1],[142,13,142,53,1],[143,13,143,58,1],[144,13,144,50,1],[145,13,145,34,1],[146,13,146,36,1],[147,13,147,46,1],[148,13,148,45,1],[149,13,149,71,1],[150,13,150,75,1],[152,13,152,46,1],[153,13,153,59,1],[154,13,154,31,1],[155,9,155,10,1]]);
    </script>
  </body>
</html>