<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\BaseRest\MemberRest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Xml;
using System.Xml.XPath;

using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.member;
using umbraco.cms.businesslogic.property;

namespace Umbraco.Web.BaseRest
{
    [Obsolete(&quot;Umbraco /base is obsoleted, use WebApi (UmbracoApiController) instead for all REST based logic&quot;)]
	public static class MemberRest
	{
		public static int GetCurrentMemberId()
		{
			return Member.CurrentMemberId();
		}

		public static Member GetCurrentMember()
		{
			return Member.GetCurrentMember();
		}

		public static int Login(string login, string password)
		{
			Member m = Member.GetMemberFromLoginNameAndPassword(login, password);
			var id = GetCurrentMemberId();
			if (id == 0)
			{
				if (m == null)
				{
					return 0;
				}
				else
				{
					Member.AddMemberToCache(m);
					return m.Id;
				}
			}
			else
			{
				return id;
			}
		}

		public static int Logout()
		{
			var currentId = GetCurrentMemberId();
			if (currentId &gt; 0)
			{
				Member.RemoveMemberFromCache(currentId);
				Member.ClearMemberFromClient(currentId);
				return currentId;
			}
			else
			{
				return 0;
			}
		}

		public static XPathNodeIterator GetCurrentMemberAsXml()
		{
			var m = GetCurrentMember();
			if (m != null)
			{
				XmlDocument doc = new XmlDocument();
				doc.LoadXml(m.ToXml(doc, false).OuterXml);
				XPathNavigator nav = doc.CreateNavigator();
				return nav.Select(&quot;/node&quot;);
			}
			else
			{
				return null;
			}
		}

		public static string SetProperty(string alias, object value)
		{
			string ret = &quot;False&quot;;

			try
			{
				var m = GetCurrentMember();

				if (m != null)
				{
					var prop = m.getProperty(alias);

					if (m.ContentType != null &amp;&amp; MemberType.GetByAlias(m.ContentType.Alias).MemberCanEdit(prop.PropertyType))
					{

						if (prop.PropertyType.ValidationRegExp.Trim() != &quot;&quot;)
						{
							Regex regex = new Regex(m.getProperty(alias).PropertyType.ValidationRegExp);

							if (regex.IsMatch(value.ToString()))
							{
								prop.Value = value;
								ret = &quot;True&quot;;
							    m.Save();
							}
						}
						else
						{
							prop.Value = value;
							ret = &quot;True&quot;;
                            m.Save();
						}

					}
				}
			}
			catch (Exception e)
			{
				ret = e.Message;
			}

			return ret;
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,3,19,4,0],[20,4,20,36,0],[21,3,21,4,0],[24,3,24,4,0],[25,4,25,37,0],[26,3,26,4,0],[29,3,29,4,0],[30,4,30,73,0],[31,4,31,34,0],[32,4,32,16,0],[33,4,33,5,0],[34,5,34,19,0],[35,5,35,6,0],[36,6,36,15,0],[39,5,39,6,0],[40,6,40,33,0],[41,6,41,18,0],[45,4,45,5,0],[46,5,46,15,0],[48,3,48,4,0],[51,3,51,4,0],[52,4,52,41,0],[53,4,53,22,0],[54,4,54,5,0],[55,5,55,45,0],[56,5,56,45,0],[57,5,57,22,0],[60,4,60,5,0],[61,5,61,14,0],[63,3,63,4,0],[66,3,66,4,0],[67,4,67,31,0],[68,4,68,18,0],[69,4,69,5,0],[70,5,70,41,0],[71,5,71,47,0],[72,5,72,48,0],[73,5,73,32,0],[76,4,76,5,0],[77,5,77,17,0],[79,3,79,4,0],[82,3,82,4,0],[83,4,83,25,0],[86,4,86,5,0],[87,5,87,32,0],[89,5,89,19,0],[90,5,90,6,0],[91,6,91,38,0],[93,6,93,111,0],[94,6,94,7,0],[96,7,96,59,0],[97,7,97,8,0],[98,8,98,84,0],[100,8,100,44,0],[101,8,101,9,0],[102,9,102,28,0],[103,9,103,22,0],[104,12,104,21,0],[105,8,105,9,0],[106,7,106,8,0],[108,7,108,8,0],[109,8,109,27,0],[110,8,110,21,0],[111,29,111,38,0],[112,7,112,8,0],[114,6,114,7,0],[115,5,115,6,0],[116,4,116,5,0],[117,4,117,23,0],[118,4,118,5,0],[119,5,119,21,0],[120,4,120,5,0],[122,4,122,15,0],[123,3,123,4,0]]);
    </script>
  </body>
</html>