<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Collections\DeepCloneableList.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Umbraco.Core.Models;
using Umbraco.Core.Models.EntityBase;

namespace Umbraco.Core.Collections
{
    /// &lt;summary&gt;
    /// A List that can be deep cloned with deep cloned elements and can reset the collection&#39;s items dirty flags
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
    internal class DeepCloneableList&lt;T&gt; : List&lt;T&gt;, IDeepCloneable, IRememberBeingDirty
    {
        private readonly ListCloneBehavior _listCloneBehavior;
        
        public DeepCloneableList(ListCloneBehavior listCloneBehavior)
        {
            _listCloneBehavior = listCloneBehavior;
        }
        
        public DeepCloneableList(IEnumerable&lt;T&gt; collection, ListCloneBehavior listCloneBehavior) : base(collection)
        {
            _listCloneBehavior = listCloneBehavior;
        }

        /// &lt;summary&gt;
        /// Default behavior is CloneOnce
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;collection&quot;&gt;&lt;/param&gt;
        public DeepCloneableList(IEnumerable&lt;T&gt; collection)
            : this(collection, ListCloneBehavior.CloneOnce)
        {
        }

        /// &lt;summary&gt;
        /// Creates a new list and adds each element as a deep cloned element if it is of type IDeepCloneable
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public object DeepClone()
        {
            switch (_listCloneBehavior)
            {
                case ListCloneBehavior.CloneOnce:
                    //we are cloning once, so create a new list in none mode
                    // and deep clone all items into it
                    var newList = new DeepCloneableList&lt;T&gt;(ListCloneBehavior.None);
                    foreach (var item in this)
                    {
                        var dc = item as IDeepCloneable;
                        if (dc != null)
                        {
                            newList.Add((T)dc.DeepClone());
                        }
                        else
                        {
                            newList.Add(item);
                        }
                    }
                    return newList;
                case ListCloneBehavior.None:
                    //we are in none mode, so just return a new list with the same items
                    return new DeepCloneableList&lt;T&gt;(this, ListCloneBehavior.None);
                case ListCloneBehavior.Always:
                    //always clone to new list
                    var newList2 = new DeepCloneableList&lt;T&gt;(ListCloneBehavior.Always);
                    foreach (var item in this)
                    {
                        var dc = item as IDeepCloneable;
                        if (dc != null)
                        {
                            newList2.Add((T)dc.DeepClone());
                        }
                        else
                        {
                            newList2.Add(item);
                        }
                    }
                    return newList2;
                default:
                    throw new ArgumentOutOfRangeException();
            }
        }

        public bool IsDirty()
        {
            return this.OfType&lt;IRememberBeingDirty&gt;().Any(x =&gt; x.IsDirty());
        }

        public bool WasDirty()
        {
            return this.OfType&lt;IRememberBeingDirty&gt;().Any(x =&gt; x.WasDirty());
        }

        /// &lt;summary&gt;
        /// Always returns false, the list has no properties we need to report
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;propName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool IsPropertyDirty(string propName)
        {
            return false;
        }

        /// &lt;summary&gt;
        /// Always returns false, the list has no properties we need to report
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;propertyName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool WasPropertyDirty(string propertyName)
        {
            return false;
        }

        public void ResetDirtyProperties()
        {
            foreach (var dc in this.OfType&lt;IRememberBeingDirty&gt;())
            {
                dc.ResetDirtyProperties();
            }
        }

        public void ForgetPreviouslyDirtyProperties()
        {
            foreach (var dc in this.OfType&lt;IRememberBeingDirty&gt;())
            {
                dc.ForgetPreviouslyDirtyProperties();
            }
        }

        public void ResetDirtyProperties(bool rememberPreviouslyChangedProperties)
        {
            foreach (var dc in this.OfType&lt;IRememberBeingDirty&gt;())
            {
                dc.ResetDirtyProperties(rememberPreviouslyChangedProperties);
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,70,1],[20,9,20,10,1],[21,13,21,52,1],[22,9,22,10,1],[24,100,24,116,1],[25,9,25,10,1],[26,13,26,52,1],[27,9,27,10,1],[34,15,34,60,1],[35,9,35,10,1],[36,9,36,10,1],[43,9,43,10,1],[44,13,44,40,1],[49,21,49,84,1],[50,21,50,28,1],[50,30,50,38,1],[50,39,50,41,1],[50,42,50,46,1],[51,21,51,22,1],[52,25,52,57,1],[53,25,53,40,1],[54,25,54,26,1],[55,29,55,60,1],[56,25,56,26,1],[58,25,58,26,0],[59,29,59,47,0],[60,25,60,26,0],[61,21,61,22,1],[62,21,62,36,1],[65,21,65,83,1],[68,21,68,87,1],[69,21,69,28,1],[69,30,69,38,1],[69,39,69,41,1],[69,42,69,46,1],[70,21,70,22,1],[71,25,71,57,1],[72,25,72,40,1],[73,25,73,26,1],[74,29,74,61,1],[75,25,75,26,1],[77,25,77,26,0],[78,29,78,48,0],[79,25,79,26,0],[80,21,80,22,1],[81,21,81,37,1],[83,21,83,61,0],[85,9,85,10,1],[88,9,88,10,0],[89,13,89,64,0],[89,64,89,75,0],[89,75,89,77,0],[89,13,89,77,0],[90,9,90,10,0],[93,9,93,10,0],[94,13,94,64,0],[94,64,94,76,0],[94,76,94,78,0],[94,13,94,78,0],[95,9,95,10,0],[103,9,103,10,0],[104,13,104,26,0],[105,9,105,10,0],[113,9,113,10,0],[114,13,114,26,0],[115,9,115,10,0],[118,9,118,10,0],[119,13,119,20,0],[119,22,119,28,0],[119,29,119,31,0],[119,32,119,66,0],[120,13,120,14,0],[121,17,121,43,0],[122,13,122,14,0],[123,9,123,10,0],[126,9,126,10,0],[127,13,127,20,0],[127,22,127,28,0],[127,29,127,31,0],[127,32,127,66,0],[128,13,128,14,0],[129,17,129,54,0],[130,13,130,14,0],[131,9,131,10,0],[134,9,134,10,1],[135,13,135,20,1],[135,22,135,28,0],[135,29,135,31,1],[135,32,135,66,1],[136,13,136,14,0],[137,17,137,78,0],[138,13,138,14,0],[139,9,139,10,1]]);
    </script>
  </body>
</html>