<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\UmbracoExamine\DataServices\UmbracoMediaService.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Linq;
using System.Security;
using System.Xml.Linq;
using System.Xml.XPath;
using Examine.LuceneEngine;
using Umbraco.Core;
using Umbraco.Core.Services;
using Umbraco.Core.Models;

namespace UmbracoExamine.DataServices
{

    /// &lt;summary&gt;
    /// Data service used to query for media
    /// &lt;/summary&gt;
    [Obsolete(&quot;This should no longer be used, latest content will be indexed by using the IMediaService directly&quot;)]
	public class UmbracoMediaService : IMediaService
	{
		private readonly ServiceContext _services;

        
		public UmbracoMediaService()
			: this(ApplicationContext.Current.Services)
		{

		}

        
		public UmbracoMediaService(ServiceContext services)
		{
			_services = services;
		}

		/// &lt;summary&gt;
		/// This is quite an intensive operation...
		/// get all root media, then get the XML structure for all children,
		/// then run xpath against the navigator that&#39;s created
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;xpath&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
        [Obsolete(&quot;This should no longer be used, latest content will be indexed by using the IMediaService directly&quot;)]
		public XDocument GetLatestMediaByXpath(string xpath)
		{
			var xmlMedia = XDocument.Parse(&quot;&lt;media&gt;&lt;/media&gt;&quot;);
			foreach (var m in _services.MediaService.GetRootMedia())
			{
                xmlMedia.Root.Add(m.ToDeepXml(_services.PackagingService));
			}
			var result = ((IEnumerable)xmlMedia.XPathEvaluate(xpath)).Cast&lt;XElement&gt;();
			return result.ToXDocument();
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[25,6,25,47,0],[26,3,26,4,0],[28,3,28,4,0],[31,3,31,54,0],[32,3,32,4,0],[33,4,33,25,0],[34,3,34,4,0],[45,3,45,4,0],[46,4,46,54,0],[47,4,47,11,0],[47,13,47,18,0],[47,19,47,21,0],[47,22,47,59,0],[48,4,48,5,0],[49,17,49,76,0],[50,4,50,5,0],[51,4,51,79,0],[52,4,52,32,0],[53,3,53,4,0]]);
    </script>
  </body>
</html>