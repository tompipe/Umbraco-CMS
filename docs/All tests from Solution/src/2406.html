<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\web\StylesheetProperty.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using Umbraco.Core;
using Umbraco.Core.Cache;
using umbraco.cms.businesslogic.cache;
using Umbraco.Core.Models.Rdbms;
using umbraco.DataLayer;

namespace umbraco.cms.businesslogic.web
{
    [Obsolete(&quot;Do not use this, use the Umbraco.Core.Services.IFileService instead to manipulate stylesheets&quot;)]
    public class StylesheetProperty : CMSNode
    {
     
        internal Umbraco.Core.Models.Stylesheet StylesheetItem;
        internal Umbraco.Core.Models.StylesheetProperty StylesheetProp;

        internal StylesheetProperty(Umbraco.Core.Models.Stylesheet sheet, Umbraco.Core.Models.StylesheetProperty prop)
            : base(int.MaxValue, true)
        {
            StylesheetItem = sheet;
            StylesheetProp = prop;
        }

        public StylesheetProperty(int id) : base(id)
        {
        }

        public StylesheetProperty(Guid id) : base(id)
        {
        }

        /// &lt;summary&gt;
        /// Sets up the internal data of the CMSNode, used by the various constructors
        /// &lt;/summary&gt;
        protected override void setupNode()
        {
            web.StyleSheet.ThrowNotSupported&lt;StylesheetProperty&gt;();
        }

        public StyleSheet StyleSheet() 
        {
            return new StyleSheet(StylesheetItem);
        }

        public void RefreshFromFile()
        {
            var name = StylesheetItem.Name;
            StylesheetItem = ApplicationContext.Current.Services.FileService.GetStylesheetByName(name);
            if (StylesheetItem == null) throw new ArgumentException(string.Format(&quot;No stylesheet exists with name &#39;{0}&#39;&quot;, name));

            StylesheetProp = StylesheetItem.Properties.FirstOrDefault(x =&gt; x.Alias == StylesheetProp.Alias);
        }

        /// &lt;summary&gt;
        /// Human readable name/label
        /// &lt;/summary&gt;
        public override string Text
        {
            get { return StylesheetProp.Name; }
            set
            {
                //Changing the name requires removing the current property and then adding another new one

                if (StylesheetProp.Name != value)
                {
                    StylesheetItem.RemoveProperty(StylesheetProp.Name);
                    var newProp = new Umbraco.Core.Models.StylesheetProperty(value, StylesheetProp.Alias, StylesheetProp.Value);
                    StylesheetItem.AddProperty(newProp);
                    StylesheetProp = newProp;
                }
            }
        }

        public string Alias 
        {
            get { return StylesheetProp.Alias; }
            set { StylesheetProp.Alias = value; }
        }

        public string value 
        {
            get { return StylesheetProp.Value; }
            set { StylesheetProp.Value = value; }
        }

        public static StylesheetProperty MakeNew(string Text, StyleSheet sheet, BusinessLogic.User user)
        {
            //we need to create it with a temp place holder!
            var prop = new Umbraco.Core.Models.StylesheetProperty(Text, &quot;#&quot; + Text.ToSafeAlias(), &quot;&quot;);
            sheet.StylesheetEntity.AddProperty(prop);
            ApplicationContext.Current.Services.FileService.SaveStylesheet(sheet.StylesheetEntity);

            var ssp = new StylesheetProperty(sheet.StylesheetEntity, prop);
            var e = new NewEventArgs();
            ssp.OnNew(e);
            return ssp;
        }

        public override void delete() 
        {
            var e = new DeleteEventArgs();
            FireBeforeDelete(e);

            if (!e.Cancel) 
            {
                
                StylesheetItem.RemoveProperty(Text);
                ApplicationContext.Current.Services.FileService.SaveStylesheet(StylesheetItem);

                FireAfterDelete(e);
            }
        }

        public override void Save()
        {
            var e = new SaveEventArgs();
            FireBeforeSave(e);

            if (!e.Cancel)
            {
                ApplicationContext.Current.Services.FileService.SaveStylesheet(StylesheetItem);

                FireAfterSave(e);
            }
        }

        public override string ToString()
        {
            return String.Format(&quot;{0} {{\n{1}\n}}\n&quot;, this.Alias, this.value);
        }


        public static StylesheetProperty GetStyleSheetProperty(int id)
        {
            web.StyleSheet.ThrowNotSupported&lt;StylesheetProperty&gt;();
            return null;
        }

        // EVENTS
        /// &lt;summary&gt;
        /// The save event handler
        /// &lt;/summary&gt;
        public delegate void SaveEventHandler(StylesheetProperty sender, SaveEventArgs e);
        /// &lt;summary&gt;
        /// The new event handler
        /// &lt;/summary&gt;
        public delegate void NewEventHandler(StylesheetProperty sender, NewEventArgs e);
        /// &lt;summary&gt;
        /// The delete event handler
        /// &lt;/summary&gt;
        public delegate void DeleteEventHandler(StylesheetProperty sender, DeleteEventArgs e);


        /// &lt;summary&gt;
        /// Occurs when [before save].
        /// &lt;/summary&gt;
        new public static event SaveEventHandler BeforeSave;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:BeforeSave&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        new protected virtual void FireBeforeSave(SaveEventArgs e) {
            if (BeforeSave != null)
                BeforeSave(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [after save].
        /// &lt;/summary&gt;
        new public static event SaveEventHandler AfterSave;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:AfterSave&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        new protected virtual void FireAfterSave(SaveEventArgs e) {
            if (AfterSave != null)
                AfterSave(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [new].
        /// &lt;/summary&gt;
        public static event NewEventHandler New;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:New&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        protected virtual void OnNew(NewEventArgs e) {
            if (New != null)
                New(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [before delete].
        /// &lt;/summary&gt;
        new public static event DeleteEventHandler BeforeDelete;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:BeforeDelete&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        new protected virtual void FireBeforeDelete(DeleteEventArgs e) {
            if (BeforeDelete != null)
                BeforeDelete(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [after delete].
        /// &lt;/summary&gt;
        new public static event DeleteEventHandler AfterDelete;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:AfterDelete&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        new protected virtual void FireAfterDelete(DeleteEventArgs e) {
            if (AfterDelete != null)
                AfterDelete(this, e);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,15,19,39,0],[20,9,20,10,0],[21,13,21,36,0],[22,13,22,35,0],[23,9,23,10,0],[25,45,25,53,0],[26,9,26,10,0],[27,9,27,10,0],[29,46,29,54,0],[30,9,30,10,0],[31,9,31,10,0],[37,9,37,10,0],[38,13,38,68,0],[39,9,39,10,0],[42,9,42,10,0],[43,13,43,51,0],[44,9,44,10,0],[47,9,47,10,0],[48,13,48,44,0],[49,13,49,104,0],[50,13,50,40,0],[50,41,50,130,0],[52,13,52,76,0],[52,76,52,107,0],[52,107,52,109,0],[52,13,52,109,0],[53,9,53,10,0],[60,17,60,18,0],[60,19,60,46,0],[60,47,60,48,0],[62,13,62,14,0],[65,17,65,50,0],[66,17,66,18,0],[67,21,67,72,0],[68,21,68,129,0],[69,21,69,57,0],[70,21,70,46,0],[71,17,71,18,0],[72,13,72,14,0],[77,17,77,18,0],[77,19,77,47,0],[77,48,77,49,0],[78,17,78,18,0],[78,19,78,48,0],[78,49,78,50,0],[83,17,83,18,0],[83,19,83,47,0],[83,48,83,49,0],[84,17,84,18,0],[84,19,84,48,0],[84,49,84,50,0],[88,9,88,10,0],[90,13,90,103,0],[91,13,91,54,0],[92,13,92,100,0],[94,13,94,76,0],[95,13,95,40,0],[96,13,96,26,0],[97,13,97,24,0],[98,9,98,10,0],[101,9,101,10,0],[102,13,102,43,0],[103,13,103,33,0],[105,13,105,27,0],[106,13,106,14,0],[108,17,108,53,0],[109,17,109,96,0],[111,17,111,36,0],[112,13,112,14,0],[113,9,113,10,0],[116,9,116,10,0],[117,13,117,41,0],[118,13,118,31,0],[120,13,120,27,0],[121,13,121,14,0],[122,17,122,96,0],[124,17,124,34,0],[125,13,125,14,0],[126,9,126,10,0],[129,9,129,10,0],[130,13,130,79,0],[131,9,131,10,0],[135,9,135,10,0],[136,13,136,68,0],[137,13,137,25,0],[138,9,138,10,0],[163,68,163,69,0],[164,13,164,36,0],[165,17,165,37,0],[166,9,166,10,0],[176,67,176,68,0],[177,13,177,35,0],[178,17,178,36,0],[179,9,179,10,0],[189,54,189,55,0],[190,13,190,29,0],[191,17,191,30,0],[192,9,192,10,0],[202,72,202,73,0],[203,13,203,38,0],[204,17,204,39,0],[205,9,205,10,0],[215,71,215,72,0],[216,13,216,37,0],[217,17,217,38,0],[218,9,218,10,0]]);
    </script>
  </body>
</html>