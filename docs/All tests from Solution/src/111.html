<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\CodeFirst\StronglyTypedMapperTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Diagnostics;
using System.Linq;
using System.Text.RegularExpressions;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Core.Models.PublishedContent;
using Umbraco.Core.PropertyEditors;
using Umbraco.Tests.CodeFirst.TestModels;
using Umbraco.Tests.PublishedContent;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web;

namespace Umbraco.Tests.CodeFirst
{
    [DatabaseTestBehavior(DatabaseBehavior.NoDatabasePerFixture)]
    [TestFixture]
    public class StronglyTypedMapperTest : PublishedContentTestBase
    {
        [Test]
        public void Type_Test()
        {
            var doc = GetNode(1);
            var currentContent = ContentTypeMapper.Map&lt;Home&gt;(doc);

            Assert.That(currentContent.SiteName, Is.EqualTo(&quot;Test site&quot;));
            Assert.That(currentContent.SiteDescription, Is.EqualTo(&quot;this is a test site&quot;));
        }

        [Test]
        public void Children_Of_Type_Test()
        {
            var doc = GetNode(1);
            var currentContent = ContentTypeMapper.Map&lt;Home&gt;(doc);
            var result = currentContent.ChildrenOfType&lt;NewsLandingPage&gt;().ToArray();
            Assert.AreEqual(&quot;page2/alias, 2ndpagealias&quot;, result[0].PageTitle);
        }

        [Test]
        public void Descendants_Of_Type_Test()
        {
            var doc = GetNode(1);
            var currentContent = ContentTypeMapper.Map&lt;Home&gt;(doc);
            var result = currentContent.Descendants&lt;NewsArticle&gt;().ToArray();

            Assert.AreEqual(&quot;John doe&quot;, result[0].ArticleAuthor);
            Assert.AreEqual(&quot;John Smith&quot;, result[1].ArticleAuthor);
        }

        [Test]
        public void Can_Split_Pascal_Casing()
        {
            string name = &quot;SiteName&quot;;
            string result = Regex.Replace(name, &quot;([a-z](?=[A-Z])|[A-Z](?=[A-Z][a-z]))&quot;, &quot;$1 &quot;);
            Assert.That(result, Is.EqualTo(&quot;Site Name&quot;));

            string name2 = &quot;MySiteDefinitionCase&quot;;
            string result2 = Regex.Replace(name2, &quot;([a-z](?=[A-Z])|[A-Z](?=[A-Z][a-z]))&quot;, &quot;$1 &quot;);
            Assert.That(result2, Is.EqualTo(&quot;My Site Definition Case&quot;));
        }

        #region Test setup
        public override void Initialize()
        {   
            // required so we can access property.Value
            //PropertyValueConvertersResolver.Current = new PropertyValueConvertersResolver();

            base.Initialize();            

            // need to specify a custom callback for unit tests
            // AutoPublishedContentTypes generates properties automatically
            // when they are requested, but we must declare those that we
            // explicitely want to be here...

            var propertyTypes = new[]
                {
                    // AutoPublishedContentType will auto-generate other properties
                    new PublishedPropertyType(&quot;siteDescription&quot;, 0, &quot;?&quot;), 
                    new PublishedPropertyType(&quot;siteName&quot;, 0, &quot;?&quot;), 
                    new PublishedPropertyType(&quot;articleContent&quot;, 0, &quot;?&quot;), 
                    new PublishedPropertyType(&quot;articleAuthor&quot;, 0, &quot;?&quot;), 
                    new PublishedPropertyType(&quot;articleDate&quot;, 0, &quot;?&quot;), 
                    new PublishedPropertyType(&quot;pageTitle&quot;, 0, &quot;?&quot;), 
                };
            var type = new AutoPublishedContentType(0, &quot;anything&quot;, propertyTypes);
            PublishedContentType.GetPublishedContentTypeCallback = (alias) =&gt; type;
            Debug.Print(&quot;INIT STRONG {0}&quot;,
                PublishedContentType.Get(PublishedItemType.Content, &quot;anything&quot;)
                    .PropertyTypes.Count());
        }

        public override void TearDown()
        {
            TestHelper.CleanUmbracoSettingsConfig();

            base.TearDown();
        }

        protected override string GetXmlContent(int templateId)
        {
            return @&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;utf-8&quot;&quot;?&gt;
&lt;!DOCTYPE root[ 
&lt;!ELEMENT Home ANY&gt;
&lt;!ATTLIST Home id ID #REQUIRED&gt;
&lt;!ELEMENT NewsArticle ANY&gt;
&lt;!ATTLIST NewsArticle id ID #REQUIRED&gt;
&lt;!ELEMENT NewsLandingPage ANY&gt;
&lt;!ATTLIST NewsLandingPage id ID #REQUIRED&gt;
&lt;!ELEMENT ContentPage ANY&gt;
&lt;!ATTLIST ContentPage id ID #REQUIRED&gt;
]&gt;
&lt;root id=&quot;&quot;-1&quot;&quot;&gt;
	&lt;Home id=&quot;&quot;1&quot;&quot; parentID=&quot;&quot;-1&quot;&quot; level=&quot;&quot;1&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;10&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-06-12T14:13:17&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:50:43&quot;&quot; nodeName=&quot;&quot;Home&quot;&quot; urlName=&quot;&quot;home&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
		&lt;siteName&gt;&lt;![CDATA[Test site]]&gt;&lt;/siteName&gt;
		&lt;siteDescription&gt;&lt;![CDATA[this is a test site]]&gt;&lt;/siteDescription&gt;
		&lt;bodyContent&gt;&lt;![CDATA[This is some body content on the home page]]&gt;&lt;/bodyContent&gt;
		&lt;NewsLandingPage id=&quot;&quot;2&quot;&quot; parentID=&quot;&quot;1&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;11&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-20T18:06:45&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:07:31&quot;&quot; nodeName=&quot;&quot;news&quot;&quot; urlName=&quot;&quot;news&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1,2&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;bodyContent&gt;&lt;![CDATA[This is some body content on the news landing page]]&gt;&lt;/bodyContent&gt;
			&lt;pageTitle&gt;&lt;![CDATA[page2/alias, 2ndpagealias]]&gt;&lt;/pageTitle&gt;			
			&lt;NewsArticle id=&quot;&quot;3&quot;&quot; parentID=&quot;&quot;2&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;12&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-20T18:07:54&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:27&quot;&quot; nodeName=&quot;&quot;Something happened&quot;&quot; urlName=&quot;&quot;something-happened&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1,2,3&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;articleContent&gt;&lt;![CDATA[Some cool stuff happened today]]&gt;&lt;/articleContent&gt;
				&lt;articleDate&gt;&lt;![CDATA[2012-01-02 12:33:44]]&gt;&lt;/articleDate&gt;
				&lt;articleAuthor&gt;&lt;![CDATA[John doe]]&gt;&lt;/articleAuthor&gt;
			&lt;/NewsArticle&gt;
			&lt;NewsArticle id=&quot;&quot;4&quot;&quot; parentID=&quot;&quot;2&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;12&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;3&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Then another thing&quot;&quot; urlName=&quot;&quot;then-another-thing&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1,2,4&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;articleContent&gt;&lt;![CDATA[Today, other cool things occurred]]&gt;&lt;/articleContent&gt;
				&lt;articleDate&gt;&lt;![CDATA[2012-01-03 15:33:44]]&gt;&lt;/articleDate&gt;
				&lt;articleAuthor&gt;&lt;![CDATA[John Smith]]&gt;&lt;/articleAuthor&gt;
			&lt;/NewsArticle&gt;			
		&lt;/NewsLandingPage&gt;		
		&lt;ContentPage id=&quot;&quot;5&quot;&quot; parentID=&quot;&quot;1&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;13&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;4&quot;&quot; createDate=&quot;&quot;2012-07-16T15:26:59&quot;&quot; updateDate=&quot;&quot;2012-07-18T14:23:35&quot;&quot; nodeName=&quot;&quot;First Content Page&quot;&quot; urlName=&quot;&quot;content-page-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1,5&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;bodyContent&gt;&lt;![CDATA[This is some body content on the first content page]]&gt;&lt;/bodyContent&gt;
		&lt;/ContentPage&gt;
		&lt;ContentPage id=&quot;&quot;6&quot;&quot; parentID=&quot;&quot;1&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;13&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;4&quot;&quot; createDate=&quot;&quot;2012-07-16T15:26:59&quot;&quot; updateDate=&quot;&quot;2012-07-16T14:23:35&quot;&quot; nodeName=&quot;&quot;Second Content Page&quot;&quot; urlName=&quot;&quot;content-page-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1,6&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;bodyContent&gt;&lt;![CDATA[This is some body content on the second content page]]&gt;&lt;/bodyContent&gt;
		&lt;/ContentPage&gt;
	&lt;/Home&gt;
&lt;/root&gt;&quot;;
        }

        internal IPublishedContent GetNode(int id)
        {
            var ctx = UmbracoContext.Current;
            var doc = ctx.ContentCache.GetById(id);
            Assert.IsNotNull(doc);
            return doc;
        }
        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,1],[24,13,24,34,1],[25,13,25,67,1],[27,13,27,75,1],[28,13,28,92,1],[29,9,29,10,1],[33,9,33,10,1],[34,13,34,34,1],[35,13,35,67,1],[36,13,36,85,1],[37,13,37,79,1],[38,9,38,10,1],[42,9,42,10,1],[43,13,43,34,1],[44,13,44,67,1],[45,13,45,78,1],[47,13,47,66,1],[48,13,48,68,1],[49,9,49,10,1],[53,9,53,10,1],[54,13,54,38,1],[55,13,55,96,1],[56,13,56,58,1],[58,13,58,51,1],[59,13,59,98,1],[60,13,60,73,1],[61,9,61,10,1],[65,9,65,10,1],[69,13,69,31,1],[76,13,85,19,1],[86,13,86,83,1],[87,13,87,79,1],[87,79,87,83,1],[87,83,87,84,1],[87,13,87,84,1],[88,13,90,45,1],[91,9,91,10,1],[94,9,94,10,1],[95,13,95,53,1],[97,13,97,29,1],[98,9,98,10,1],[101,9,101,10,1],[102,13,139,10,1],[140,9,140,10,1],[143,9,143,10,1],[144,13,144,46,1],[145,13,145,52,1],[146,13,146,35,1],[147,13,147,24,1],[148,9,148,10,1]]);
    </script>
  </body>
</html>