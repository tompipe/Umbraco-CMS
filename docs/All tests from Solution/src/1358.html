<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Cache\DistributedCacheExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using Umbraco.Core;
using Umbraco.Core.Configuration;
using Umbraco.Core.Events;
using Umbraco.Core.Models;
using umbraco;
using umbraco.cms.businesslogic.web;
using Umbraco.Core.Persistence.Repositories;

namespace Umbraco.Web.Cache
{
    /// &lt;summary&gt;
    /// Extension methods for &lt;see cref=&quot;DistributedCache&quot;/&gt;
    /// &lt;/summary&gt;
    internal static class DistributedCacheExtensions
    {
        #region Public access

        public static void RefreshPublicAccess(this DistributedCache dc)
        {
            dc.RefreshAll(DistributedCache.PublicAccessCacheRefresherGuid);
        }

        #endregion

        #region Application tree cache

        public static void RefreshAllApplicationTreeCache(this DistributedCache dc)
        {
            dc.RefreshAll(DistributedCache.ApplicationTreeCacheRefresherGuid);
        }

        #endregion

        #region Application cache

        public static void RefreshAllApplicationCache(this DistributedCache dc)
        {
            dc.RefreshAll(DistributedCache.ApplicationCacheRefresherGuid);
        }

        #endregion

        #region User type cache

        public static void RemoveUserTypeCache(this DistributedCache dc, int userTypeId)
        {
            dc.Remove(DistributedCache.UserTypeCacheRefresherGuid, userTypeId);
        }

        public static void RefreshUserTypeCache(this DistributedCache dc, int userTypeId)
        {
            dc.Refresh(DistributedCache.UserTypeCacheRefresherGuid, userTypeId);
        }

        public static void RefreshAllUserTypeCache(this DistributedCache dc)
        {
            dc.RefreshAll(DistributedCache.UserTypeCacheRefresherGuid);
        }

        #endregion

        #region User cache

        public static void RemoveUserCache(this DistributedCache dc, int userId)
        {
            dc.Remove(DistributedCache.UserCacheRefresherGuid, userId);
        }

        public static void RefreshUserCache(this DistributedCache dc, int userId)
        {
            dc.Refresh(DistributedCache.UserCacheRefresherGuid, userId);
        }

        public static void RefreshAllUserCache(this DistributedCache dc)
        {
            dc.RefreshAll(DistributedCache.UserCacheRefresherGuid);
        } 

        #endregion

        #region User permissions cache

        public static void RemoveUserPermissionsCache(this DistributedCache dc, int userId)
        {
            dc.Remove(DistributedCache.UserPermissionsCacheRefresherGuid, userId);
        }

        public static void RefreshUserPermissionsCache(this DistributedCache dc, int userId)
        {
            dc.Refresh(DistributedCache.UserPermissionsCacheRefresherGuid, userId);
        }

        public static void RefreshAllUserPermissionsCache(this DistributedCache dc)
        {
            dc.RefreshAll(DistributedCache.UserPermissionsCacheRefresherGuid);
        }

        #endregion

        #region Template cache

        public static void RefreshTemplateCache(this DistributedCache dc, int templateId)
        {
            dc.Refresh(DistributedCache.TemplateRefresherGuid, templateId);
        }

        public static void RemoveTemplateCache(this DistributedCache dc, int templateId)
        {
            dc.Remove(DistributedCache.TemplateRefresherGuid, templateId);
        } 

        #endregion

        #region Dictionary cache

        public static void RefreshDictionaryCache(this DistributedCache dc, int dictionaryItemId)
        {
            dc.Refresh(DistributedCache.DictionaryCacheRefresherGuid, dictionaryItemId);
        }

        public static void RemoveDictionaryCache(this DistributedCache dc, int dictionaryItemId)
        {
            dc.Remove(DistributedCache.DictionaryCacheRefresherGuid, dictionaryItemId);
        }

        #endregion
        
        #region Data type cache     

        public static void RefreshDataTypeCache(this DistributedCache dc, IDataTypeDefinition dataType)
        {
            if (dataType == null) return;
            dc.RefreshByJson(DistributedCache.DataTypeCacheRefresherGuid, DataTypeCacheRefresher.SerializeToJsonPayload(dataType));
        }

        public static void RemoveDataTypeCache(this DistributedCache dc, IDataTypeDefinition dataType)
        {
            if (dataType == null) return;
            dc.RefreshByJson(DistributedCache.DataTypeCacheRefresherGuid, DataTypeCacheRefresher.SerializeToJsonPayload(dataType));
        }

        #endregion

        #region Page cache

        public static void RefreshAllPageCache(this DistributedCache dc)
        {
            dc.RefreshAll(DistributedCache.PageCacheRefresherGuid);
        }

        public static void RefreshPageCache(this DistributedCache dc, int documentId)
        {
            dc.Refresh(DistributedCache.PageCacheRefresherGuid, documentId);
        }

        public static void RefreshPageCache(this DistributedCache dc, params IContent[] content)
        {
            dc.Refresh(DistributedCache.PageCacheRefresherGuid, x =&gt; x.Id, content);
        }

        public static void RemovePageCache(this DistributedCache dc, params IContent[] content)
        {
            dc.Remove(DistributedCache.PageCacheRefresherGuid, x =&gt; x.Id, content);
        }

        public static void RemovePageCache(this DistributedCache dc, int documentId)
        {
            dc.Remove(DistributedCache.PageCacheRefresherGuid, documentId);
        }

        public static void RefreshUnpublishedPageCache(this DistributedCache dc, params IContent[] content)
        {
            dc.Refresh(DistributedCache.UnpublishedPageCacheRefresherGuid, x =&gt; x.Id, content);
        }

        public static void RemoveUnpublishedPageCache(this DistributedCache dc, params IContent[] content)
        {
            dc.Remove(DistributedCache.UnpublishedPageCacheRefresherGuid, x =&gt; x.Id, content);
        }

        public static void RemoveUnpublishedCachePermanently(this DistributedCache dc, params int[] contentIds)
        {
            dc.RefreshByJson(DistributedCache.UnpublishedPageCacheRefresherGuid, UnpublishedPageCacheRefresher.SerializeToJsonPayloadForPermanentDeletion(contentIds));
        }

        #endregion

        #region Member cache

        public static void RefreshMemberCache(this DistributedCache dc, params IMember[] members)
        {
            dc.Refresh(DistributedCache.MemberCacheRefresherGuid, x =&gt; x.Id, members);
        }

        public static void RemoveMemberCache(this DistributedCache dc, params IMember[] members)
        {
            dc.Remove(DistributedCache.MemberCacheRefresherGuid, x =&gt; x.Id, members);
        } 

        [Obsolete(&quot;Use the RefreshMemberCache with strongly typed IMember objects instead&quot;)]
        public static void RefreshMemberCache(this DistributedCache dc, int memberId)
        {
            dc.Refresh(DistributedCache.MemberCacheRefresherGuid, memberId);
        }

        [Obsolete(&quot;Use the RemoveMemberCache with strongly typed IMember objects instead&quot;)]
        public static void RemoveMemberCache(this DistributedCache dc, int memberId)
        {
            dc.Remove(DistributedCache.MemberCacheRefresherGuid, memberId);
        } 

        #endregion

        #region Member group cache

        public static void RefreshMemberGroupCache(this DistributedCache dc, int memberGroupId)
        {
            dc.Refresh(DistributedCache.MemberGroupCacheRefresherGuid, memberGroupId);
        }

        public static void RemoveMemberGroupCache(this DistributedCache dc, int memberGroupId)
        {
            dc.Remove(DistributedCache.MemberGroupCacheRefresherGuid, memberGroupId);
        }

        #endregion

        #region Media Cache
        
        public static void RefreshMediaCache(this DistributedCache dc, params IMedia[] media)
        {
            dc.RefreshByJson(DistributedCache.MediaCacheRefresherGuid, MediaCacheRefresher.SerializeToJsonPayload(MediaCacheRefresher.OperationType.Saved, media));
        }

        public static void RefreshMediaCacheAfterMoving(this DistributedCache dc, params MoveEventInfo&lt;IMedia&gt;[] media)
        {
            dc.RefreshByJson(DistributedCache.MediaCacheRefresherGuid, MediaCacheRefresher.SerializeToJsonPayloadForMoving(MediaCacheRefresher.OperationType.Saved, media));
        }

        // clearing by Id will never work for load balanced scenarios for media since we require a Path
        // to clear all of the cache but the media item will be removed before the other servers can
        // look it up. Only here for legacy purposes.
        [Obsolete(&quot;Ensure to clear with other RemoveMediaCache overload&quot;)]
        public static void RemoveMediaCache(this DistributedCache dc, int mediaId)
        {
            dc.Remove(new Guid(DistributedCache.MediaCacheRefresherId), mediaId);
        }

        public static void RemoveMediaCacheAfterRecycling(this DistributedCache dc, params MoveEventInfo&lt;IMedia&gt;[] media)
        {
            dc.RefreshByJson(DistributedCache.MediaCacheRefresherGuid, MediaCacheRefresher.SerializeToJsonPayloadForMoving(MediaCacheRefresher.OperationType.Trashed, media));
        }

        public static void RemoveMediaCachePermanently(this DistributedCache dc, params int[] mediaIds)
        {
            dc.RefreshByJson(DistributedCache.MediaCacheRefresherGuid, MediaCacheRefresher.SerializeToJsonPayloadForPermanentDeletion(mediaIds));
        }

        #endregion

        #region Macro Cache

        public static void ClearAllMacroCacheOnCurrentServer(this DistributedCache dc)
        {
            var macroRefresher = CacheRefreshersResolver.Current.GetById(DistributedCache.MacroCacheRefresherGuid);
            macroRefresher.RefreshAll();
        }

        public static void RefreshMacroCache(this DistributedCache dc, IMacro macro)
        {
            if (macro == null) return;
            dc.RefreshByJson(DistributedCache.MacroCacheRefresherGuid, MacroCacheRefresher.SerializeToJsonPayload(macro));
        }

        public static void RemoveMacroCache(this DistributedCache dc, IMacro macro)
        {
            if (macro == null) return;
            dc.RefreshByJson(DistributedCache.MacroCacheRefresherGuid, MacroCacheRefresher.SerializeToJsonPayload(macro));
        }

        public static void RefreshMacroCache(this DistributedCache dc, global::umbraco.cms.businesslogic.macro.Macro macro)
        {
            if (macro == null) return;
            dc.RefreshByJson(DistributedCache.MacroCacheRefresherGuid, MacroCacheRefresher.SerializeToJsonPayload(macro));
        }
        
        public static void RemoveMacroCache(this DistributedCache dc, global::umbraco.cms.businesslogic.macro.Macro macro)
        {
            if (macro == null) return;
            dc.RefreshByJson(DistributedCache.MacroCacheRefresherGuid, MacroCacheRefresher.SerializeToJsonPayload(macro));
        }

        public static void RemoveMacroCache(this DistributedCache dc, macro macro)
        {
            if (macro == null || macro.Model == null) return;
            dc.RefreshByJson(DistributedCache.MacroCacheRefresherGuid, MacroCacheRefresher.SerializeToJsonPayload(macro));
        } 

        #endregion

        #region Document type cache

        public static void RefreshContentTypeCache(this DistributedCache dc, IContentType contentType)
        {
            if (contentType == null) return;
            dc.RefreshByJson(DistributedCache.ContentTypeCacheRefresherGuid, ContentTypeCacheRefresher.SerializeToJsonPayload(false, contentType));
        }

        public static void RemoveContentTypeCache(this DistributedCache dc, IContentType contentType)
        {
            if (contentType == null) return;
            dc.RefreshByJson(DistributedCache.ContentTypeCacheRefresherGuid, ContentTypeCacheRefresher.SerializeToJsonPayload(true, contentType));
        }

        #endregion

        #region Media type cache

        public static void RefreshMediaTypeCache(this DistributedCache dc, IMediaType mediaType)
        {
            if (mediaType == null) return;
            dc.RefreshByJson(DistributedCache.ContentTypeCacheRefresherGuid, ContentTypeCacheRefresher.SerializeToJsonPayload(false, mediaType));
        }

        public static void RemoveMediaTypeCache(this DistributedCache dc, IMediaType mediaType)
        {
            if (mediaType == null) return;
            dc.RefreshByJson(DistributedCache.ContentTypeCacheRefresherGuid, ContentTypeCacheRefresher.SerializeToJsonPayload(true, mediaType));
        }

        #endregion

        #region Media type cache

        public static void RefreshMemberTypeCache(this DistributedCache dc, IMemberType memberType)
        {
            if (memberType == null) return;
            dc.RefreshByJson(DistributedCache.ContentTypeCacheRefresherGuid, ContentTypeCacheRefresher.SerializeToJsonPayload(false, memberType));
        }

        public static void RemoveMemberTypeCache(this DistributedCache dc, IMemberType memberType)
        {
            if (memberType == null) return;
            dc.RefreshByJson(DistributedCache.ContentTypeCacheRefresherGuid, ContentTypeCacheRefresher.SerializeToJsonPayload(true, memberType));
        }

        #endregion

        #region Stylesheet Cache

        public static void RefreshStylesheetPropertyCache(this DistributedCache dc, global::umbraco.cms.businesslogic.web.StylesheetProperty styleSheetProperty)
        {
            if (styleSheetProperty == null) return;
            dc.Refresh(DistributedCache.StylesheetPropertyCacheRefresherGuid, styleSheetProperty.Id);
        }

        public static void RemoveStylesheetPropertyCache(this DistributedCache dc, global::umbraco.cms.businesslogic.web.StylesheetProperty styleSheetProperty)
        {
            if (styleSheetProperty == null) return;
            dc.Remove(DistributedCache.StylesheetPropertyCacheRefresherGuid, styleSheetProperty.Id);
        }

        public static void RefreshStylesheetCache(this DistributedCache dc, StyleSheet styleSheet)
        {
            if (styleSheet == null) return;
            dc.Refresh(DistributedCache.StylesheetCacheRefresherGuid, styleSheet.Id);
        }

        public static void RemoveStylesheetCache(this DistributedCache dc, StyleSheet styleSheet)
        {
            if (styleSheet == null) return;
            dc.Remove(DistributedCache.StylesheetCacheRefresherGuid, styleSheet.Id);
        }

        public static void RefreshStylesheetCache(this DistributedCache dc, Umbraco.Core.Models.Stylesheet styleSheet)
        {
            if (styleSheet == null) return;
            dc.Refresh(DistributedCache.StylesheetCacheRefresherGuid, styleSheet.Id);
        }

        public static void RemoveStylesheetCache(this DistributedCache dc, Umbraco.Core.Models.Stylesheet styleSheet)
        {
            if (styleSheet == null) return;
            dc.Remove(DistributedCache.StylesheetCacheRefresherGuid, styleSheet.Id);
        }

        #endregion

        #region Domain Cache

        public static void RefreshDomainCache(this DistributedCache dc, IDomain domain)
        {
            if (domain == null) return;
            dc.Refresh(DistributedCache.DomainCacheRefresherGuid, domain.Id);
        }

        public static void RemoveDomainCache(this DistributedCache dc, IDomain domain)
        {
            if (domain == null) return;
            dc.Remove(DistributedCache.DomainCacheRefresherGuid, domain.Id);
        }

        public static void ClearDomainCacheOnCurrentServer(this DistributedCache dc)
        {
            var domainRefresher = CacheRefreshersResolver.Current.GetById(DistributedCache.DomainCacheRefresherGuid);
            domainRefresher.RefreshAll();
        }

        #endregion

        #region Language Cache

        public static void RefreshLanguageCache(this DistributedCache dc, ILanguage language)
        {
            if (language == null) return;
            dc.Refresh(DistributedCache.LanguageCacheRefresherGuid, language.Id);
        }

        public static void RemoveLanguageCache(this DistributedCache dc, ILanguage language)
        {
            if (language == null) return;
            dc.Remove(DistributedCache.LanguageCacheRefresherGuid, language.Id);
        }

        public static void RefreshLanguageCache(this DistributedCache dc, global::umbraco.cms.businesslogic.language.Language language)
        {
            if (language == null) return;
            dc.Refresh(DistributedCache.LanguageCacheRefresherGuid, language.id);
        }

        public static void RemoveLanguageCache(this DistributedCache dc, global::umbraco.cms.businesslogic.language.Language language)
        {
            if (language == null) return;
            dc.Remove(DistributedCache.LanguageCacheRefresherGuid, language.id);
        }

        #endregion

        #region Xslt Cache

        public static void ClearXsltCacheOnCurrentServer(this DistributedCache dc)
        {
            if (UmbracoConfig.For.UmbracoSettings().Content.UmbracoLibraryCacheDuration &lt;= 0) return;
            ApplicationContext.Current.ApplicationCache.RuntimeCache.ClearCacheObjectTypes(&quot;MS.Internal.Xml.XPath.XPathSelectionIterator&quot;);
        }

        #endregion

        #region Relation type cache

        public static void RefreshRelationTypeCache(this DistributedCache dc, int id)
        {
            dc.Refresh(DistributedCache.RelationTypeCacheRefresherGuid, id);
        }

        public static void RemoveRelationTypeCache(this DistributedCache dc, int id)
        {
            dc.Remove(DistributedCache.RelationTypeCacheRefresherGuid, id);
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,10,0],[21,13,21,76,0],[22,9,22,10,0],[29,9,29,10,0],[30,13,30,79,0],[31,9,31,10,0],[38,9,38,10,0],[39,13,39,75,0],[40,9,40,10,0],[47,9,47,10,0],[48,13,48,80,0],[49,9,49,10,0],[52,9,52,10,0],[53,13,53,81,0],[54,9,54,10,0],[57,9,57,10,0],[58,13,58,72,0],[59,9,59,10,0],[66,9,66,10,0],[67,13,67,72,0],[68,9,68,10,0],[71,9,71,10,0],[72,13,72,73,0],[73,9,73,10,0],[76,9,76,10,0],[77,13,77,68,0],[78,9,78,10,0],[85,9,85,10,0],[86,13,86,83,0],[87,9,87,10,0],[90,9,90,10,0],[91,13,91,84,0],[92,9,92,10,0],[95,9,95,10,0],[96,13,96,79,0],[97,9,97,10,0],[104,9,104,10,0],[105,13,105,76,0],[106,9,106,10,0],[109,9,109,10,0],[110,13,110,75,0],[111,9,111,10,0],[118,9,118,10,0],[119,13,119,89,0],[120,9,120,10,0],[123,9,123,10,0],[124,13,124,88,0],[125,9,125,10,0],[132,9,132,10,0],[133,13,133,34,0],[133,35,133,42,0],[134,13,134,132,0],[135,9,135,10,0],[138,9,138,10,0],[139,13,139,34,0],[139,35,139,42,0],[140,13,140,132,0],[141,9,141,10,0],[148,9,148,10,0],[149,13,149,68,0],[150,9,150,10,0],[153,9,153,10,0],[154,13,154,77,0],[155,9,155,10,0],[158,9,158,10,0],[159,13,159,70,0],[159,70,159,74,0],[159,74,159,85,0],[159,13,159,85,0],[160,9,160,10,0],[163,9,163,10,0],[164,13,164,69,0],[164,69,164,73,0],[164,73,164,84,0],[164,13,164,84,0],[165,9,165,10,0],[168,9,168,10,0],[169,13,169,76,0],[170,9,170,10,0],[173,9,173,10,0],[174,13,174,81,0],[174,81,174,85,0],[174,85,174,96,0],[174,13,174,96,0],[175,9,175,10,0],[178,9,178,10,0],[179,13,179,80,0],[179,80,179,84,0],[179,84,179,95,0],[179,13,179,95,0],[180,9,180,10,0],[183,9,183,10,0],[184,13,184,168,0],[185,9,185,10,0],[192,9,192,10,0],[193,13,193,72,0],[193,72,193,76,0],[193,76,193,87,0],[193,13,193,87,0],[194,9,194,10,0],[197,9,197,10,0],[198,13,198,71,0],[198,71,198,75,0],[198,75,198,86,0],[198,13,198,86,0],[199,9,199,10,0],[203,9,203,10,0],[204,13,204,77,0],[205,9,205,10,0],[209,9,209,10,0],[210,13,210,76,0],[211,9,211,10,0],[218,9,218,10,0],[219,13,219,87,0],[220,9,220,10,0],[223,9,223,10,0],[224,13,224,86,0],[225,9,225,10,0],[232,9,232,10,0],[233,13,233,164,0],[234,9,234,10,0],[237,9,237,10,0],[238,13,238,173,0],[239,9,239,10,0],[246,9,246,10,0],[247,13,247,82,0],[248,9,248,10,0],[251,9,251,10,0],[252,13,252,175,0],[253,9,253,10,0],[256,9,256,10,0],[257,13,257,146,0],[258,9,258,10,0],[265,9,265,10,0],[266,13,266,116,0],[267,13,267,41,0],[268,9,268,10,0],[271,9,271,10,0],[272,13,272,31,0],[272,32,272,39,0],[273,13,273,123,0],[274,9,274,10,0],[277,9,277,10,0],[278,13,278,31,0],[278,32,278,39,0],[279,13,279,123,0],[280,9,280,10,0],[283,9,283,10,0],[284,13,284,31,0],[284,32,284,39,0],[285,13,285,123,0],[286,9,286,10,0],[289,9,289,10,0],[290,13,290,31,0],[290,32,290,39,0],[291,13,291,123,0],[292,9,292,10,0],[295,9,295,10,0],[296,13,296,54,0],[296,55,296,62,0],[297,13,297,123,0],[298,9,298,10,0],[305,9,305,10,0],[306,13,306,37,0],[306,38,306,45,0],[307,13,307,148,0],[308,9,308,10,0],[311,9,311,10,0],[312,13,312,37,0],[312,38,312,45,0],[313,13,313,147,0],[314,9,314,10,0],[321,9,321,10,0],[322,13,322,35,0],[322,36,322,43,0],[323,13,323,146,0],[324,9,324,10,0],[327,9,327,10,0],[328,13,328,35,0],[328,36,328,43,0],[329,13,329,145,0],[330,9,330,10,0],[337,9,337,10,0],[338,13,338,36,0],[338,37,338,44,0],[339,13,339,147,0],[340,9,340,10,0],[343,9,343,10,0],[344,13,344,36,0],[344,37,344,44,0],[345,13,345,146,0],[346,9,346,10,0],[353,9,353,10,0],[354,13,354,44,0],[354,45,354,52,0],[355,13,355,102,0],[356,9,356,10,0],[359,9,359,10,0],[360,13,360,44,0],[360,45,360,52,0],[361,13,361,101,0],[362,9,362,10,0],[365,9,365,10,0],[366,13,366,36,0],[366,37,366,44,0],[367,13,367,86,0],[368,9,368,10,0],[371,9,371,10,0],[372,13,372,36,0],[372,37,372,44,0],[373,13,373,85,0],[374,9,374,10,0],[377,9,377,10,0],[378,13,378,36,0],[378,37,378,44,0],[379,13,379,86,0],[380,9,380,10,0],[383,9,383,10,0],[384,13,384,36,0],[384,37,384,44,0],[385,13,385,85,0],[386,9,386,10,0],[393,9,393,10,0],[394,13,394,32,0],[394,33,394,40,0],[395,13,395,78,0],[396,9,396,10,0],[399,9,399,10,0],[400,13,400,32,0],[400,33,400,40,0],[401,13,401,77,0],[402,9,402,10,0],[405,9,405,10,0],[406,13,406,118,0],[407,13,407,42,0],[408,9,408,10,0],[415,9,415,10,0],[416,13,416,34,0],[416,35,416,42,0],[417,13,417,82,0],[418,9,418,10,0],[421,9,421,10,0],[422,13,422,34,0],[422,35,422,42,0],[423,13,423,81,0],[424,9,424,10,0],[427,9,427,10,0],[428,13,428,34,0],[428,35,428,42,0],[429,13,429,82,0],[430,9,430,10,0],[433,9,433,10,0],[434,13,434,34,0],[434,35,434,42,0],[435,13,435,81,0],[436,9,436,10,0],[443,9,443,10,0],[444,13,444,94,0],[444,95,444,102,0],[445,13,445,140,0],[446,9,446,10,0],[453,9,453,10,0],[454,13,454,77,0],[455,9,455,10,0],[458,9,458,10,0],[459,13,459,76,0],[460,9,460,10,0]]);
    </script>
  </body>
</html>