<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\tinymce\tinyMCEConfiguration.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Text;
using System.Collections;
using System.Xml;
using Umbraco.Core.IO;

namespace umbraco.editorControls.tinymce
{
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public class tinyMCEConfiguration
    {
        private static bool _init = false;

        private static Hashtable _commands = new Hashtable(StringComparer.InvariantCultureIgnoreCase);

        private static string _validElements;

        private static Hashtable _configOptions = new Hashtable(StringComparer.InvariantCultureIgnoreCase);

        public static Hashtable ConfigOptions
        {
            get
            {
                if (!_init)
                    init();
                return _configOptions;
            }
            set
            {
                _configOptions = value;
            }
        }

        public static string ValidElements
        {
            get
            {
                if (!_init)
                    init();
                return _validElements;
            }
            set { _validElements = value; }
        }

        public static string PluginPath = IOHelper.ResolveUrl( SystemDirectories.Umbraco ) + &quot;/plugins/tinymce3&quot;;
        public static string JavascriptPath = IOHelper.ResolveUrl( SystemDirectories.UmbracoClient ) + &quot;/tinymce3&quot;;

        private static string _invalidElements;

        public static string InvalidElements
        {
            get
            {
                if (!_init)
                    init();
                return _invalidElements;
            }
            set { _invalidElements = value; }
        }

        private static Hashtable _plugins = new Hashtable(StringComparer.InvariantCultureIgnoreCase);

        public static Hashtable Plugins
        {
            get
            {
                if (!_init)
                    init();
                return _plugins;
            }
            set { _plugins = value; }
        }



        public static Hashtable Commands
        {
            get
            {
                if (!_init)
                    init();
                return _commands;
            }
        }

        public static SortedList SortedCommands
        {
            get
            {
                if (!_init)
                    init();

                SortedList sc = new SortedList();
                IDictionaryEnumerator ide = _commands.GetEnumerator();
                while (ide.MoveNext())
                    sc.Add(((tinyMCECommand)ide.Value).Priority, (tinyMCECommand)ide.Value);
                return sc;
            }
        }

        private static void init()
        {
            // Load config
            XmlDocument xd = new XmlDocument();
            xd.Load(IOHelper.MapPath( SystemFiles.TinyMceConfig ));

            foreach (XmlNode n in xd.DocumentElement.SelectNodes(&quot;//command&quot;))
            {
                if (!_commands.ContainsKey(n.SelectSingleNode(&quot;./umbracoAlias&quot;).FirstChild.Value))
                {
                    bool isStyle = false;
                    if (n.Attributes.GetNamedItem(&quot;isStyle&quot;) != null)
                        isStyle = bool.Parse(n.Attributes.GetNamedItem(&quot;isStyle&quot;).Value);

                    _commands.Add(
                        n.SelectSingleNode(&quot;./umbracoAlias&quot;).FirstChild.Value.ToLower(),
                        new tinyMCECommand(
                            isStyle,
                            n.SelectSingleNode(&quot;./icon&quot;).FirstChild.Value,
                            n.SelectSingleNode(&quot;./tinyMceCommand&quot;).FirstChild.Value,
                            n.SelectSingleNode(&quot;./umbracoAlias&quot;).FirstChild.Value.ToLower(),
                            n.SelectSingleNode(&quot;./tinyMceCommand&quot;).Attributes.GetNamedItem(&quot;userInterface&quot;).Value,
                            n.SelectSingleNode(&quot;./tinyMceCommand&quot;).Attributes.GetNamedItem(&quot;frontendCommand&quot;).Value,
                            n.SelectSingleNode(&quot;./tinyMceCommand&quot;).Attributes.GetNamedItem(&quot;value&quot;).Value,
                            int.Parse(n.SelectSingleNode(&quot;./priority&quot;).FirstChild.Value)
                            ));
                }
            }

            foreach (XmlNode n in xd.DocumentElement.SelectNodes(&quot;//plugin&quot;))
            {
                if (!_plugins.ContainsKey(n.FirstChild.Value))
                {
                    bool useOnFrontend = false;
                    if (n.Attributes.GetNamedItem(&quot;loadOnFrontend&quot;) != null)
                        useOnFrontend = bool.Parse(n.Attributes.GetNamedItem(&quot;loadOnFrontend&quot;).Value);

                    _plugins.Add(
                        n.FirstChild.Value.ToLower(),
                        new tinyMCEPlugin(
                            n.FirstChild.Value,
                            useOnFrontend));
                }
            }

            foreach (XmlNode n in xd.DocumentElement.SelectNodes(&quot;//config&quot;))
            {
                if (!_configOptions.ContainsKey(n.Attributes[&quot;key&quot;].FirstChild.Value))
                {
                    var value = &quot;&quot;;
                    if (n.FirstChild != null)
                        value = n.FirstChild.Value;

                    _configOptions.Add(
                        n.Attributes[&quot;key&quot;].FirstChild.Value.ToLower(),
                        value);
                }
            }

            if (xd.DocumentElement.SelectSingleNode(&quot;./invalidElements&quot;) != null)
                _invalidElements = xd.DocumentElement.SelectSingleNode(&quot;./invalidElements&quot;).FirstChild.Value;
            if (xd.DocumentElement.SelectSingleNode(&quot;./validElements&quot;) != null)
            {
                string _val = xd.DocumentElement.SelectSingleNode(&quot;./validElements&quot;).FirstChild.Value.Replace(&quot;\r&quot;, &quot;&quot;);
                foreach (string s in _val.Split(&quot;\n&quot;.ToCharArray()))
                    _validElements += &quot;&#39;&quot; + s + &quot;&#39; + \n&quot;;
                _validElements = _validElements.Substring(0, _validElements.Length - 4);

            }

            _init = true;
        }
    }

    public class tinyMCEPlugin
    {
        public tinyMCEPlugin(string Name, bool UseOnFrontEnd)
        {
            _name = Name;
            _useOnFrontend = UseOnFrontEnd;
        }

        private string _name;

        public string Name
        {
            get { return _name; }
            set { _name = value; }
        }


        private bool _useOnFrontend;

        public bool UseOnFrontend
        {
            get { return _useOnFrontend; }
            set { _useOnFrontend = value; }
        }

    }

    public class tinyMCECommand
    {

        public tinyMCECommand(bool isStylePicker, string Icon, string Command, string Alias, string UserInterface, string FrontEndCommand, string Value, int Priority)
        {
            _isStylePicker = isStylePicker;
            _icon = Icon;
            _command = Command;
            _alias = Alias;
            _userInterface = UserInterface;
            _frontEndCommand = FrontEndCommand;
            _value = Value;
            _priority = Priority;
        }

        private bool _isStylePicker;

        public bool IsStylePicker
        {
            get { return _isStylePicker; }
            set { _isStylePicker = value; }
        }


        private string _icon;

        public string Icon
        {
            get { return IOHelper.ResolveUrl( SystemDirectories.Umbraco ) + &quot;/&quot; + _icon; }
            set { _icon = value; }
        }

        private string _command;

        public string Command
        {
            get { return _command; }
            set { _command = value; }
        }

        private string _alias;

        public string Alias
        {
            get { return _alias; }
            set { _alias = value; }
        }

        private string _userInterface;

        public string UserInterface
        {
            get { return _userInterface; }
            set { _userInterface = value; }
        }

        private string _frontEndCommand;

        public string FrontEndCommand
        {
            get { return _frontEndCommand; }
            set { _frontEndCommand = value; }
        }

        private string _value;

        public string Value
        {
            get { return _value; }
            set { _value = value; }
        }

        private int _priority;

        public int Priority
        {
            get { return _priority; }
            set { _priority = value; }
        }








    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,43,0],[15,9,15,103,0],[19,9,19,108,0],[24,13,24,14,0],[25,17,25,28,0],[26,21,26,28,0],[27,17,27,39,0],[28,13,28,14,0],[30,13,30,14,0],[31,17,31,40,0],[32,13,32,14,0],[38,13,38,14,0],[39,17,39,28,0],[40,21,40,28,0],[41,17,41,39,0],[42,13,42,14,0],[43,17,43,18,0],[43,19,43,42,0],[43,43,43,44,0],[46,9,46,114,0],[47,9,47,116,0],[54,13,54,14,0],[55,17,55,28,0],[56,21,56,28,0],[57,17,57,41,0],[58,13,58,14,0],[59,17,59,18,0],[59,19,59,44,0],[59,45,59,46,0],[62,9,62,102,0],[67,13,67,14,0],[68,17,68,28,0],[69,21,69,28,0],[70,17,70,33,0],[71,13,71,14,0],[72,17,72,18,0],[72,19,72,36,0],[72,37,72,38,0],[80,13,80,14,0],[81,17,81,28,0],[82,21,82,28,0],[83,17,83,34,0],[84,13,84,14,0],[90,13,90,14,0],[91,17,91,28,0],[92,21,92,28,0],[94,17,94,50,0],[95,17,95,71,0],[96,17,96,39,0],[97,21,97,93,0],[98,17,98,27,0],[99,13,99,14,0],[103,9,103,10,0],[105,13,105,48,0],[106,13,106,68,0],[108,13,108,20,0],[108,22,108,31,0],[108,32,108,34,0],[108,35,108,78,0],[109,13,109,14,0],[110,17,110,99,0],[111,17,111,18,0],[112,21,112,42,0],[113,21,113,70,0],[114,25,114,90,0],[116,21,127,32,0],[128,17,128,18,0],[129,13,129,14,0],[131,13,131,20,0],[131,22,131,31,0],[131,32,131,34,0],[131,35,131,77,0],[132,13,132,14,0],[133,17,133,63,0],[134,17,134,18,0],[135,21,135,48,0],[136,21,136,77,0],[137,25,137,103,0],[139,21,143,45,0],[144,17,144,18,0],[145,13,145,14,0],[147,13,147,20,0],[147,22,147,31,0],[147,32,147,34,0],[147,35,147,77,0],[148,13,148,14,0],[149,17,149,87,0],[150,17,150,18,0],[151,21,151,36,0],[152,21,152,46,0],[153,25,153,52,0],[155,21,157,32,0],[158,17,158,18,0],[159,13,159,14,0],[161,13,161,82,0],[162,17,162,110,0],[163,13,163,80,0],[164,13,164,14,0],[165,17,165,121,0],[166,17,166,24,0],[166,26,166,34,0],[166,35,166,37,0],[166,38,166,68,0],[167,21,167,58,0],[168,17,168,89,0],[170,13,170,14,0],[172,13,172,26,0],[173,9,173,10,0],[178,9,178,62,0],[179,9,179,10,0],[180,13,180,26,0],[181,13,181,44,0],[182,9,182,10,0],[188,17,188,18,0],[188,19,188,32,0],[188,33,188,34,0],[189,17,189,18,0],[189,19,189,33,0],[189,34,189,35,0],[197,17,197,18,0],[197,19,197,41,0],[197,42,197,43,0],[198,17,198,18,0],[198,19,198,42,0],[198,43,198,44,0],[206,9,206,167,0],[207,9,207,10,0],[208,13,208,44,0],[209,13,209,26,0],[210,13,210,32,0],[211,13,211,28,0],[212,13,212,44,0],[213,13,213,48,0],[214,13,214,28,0],[215,13,215,34,0],[216,9,216,10,0],[222,17,222,18,0],[222,19,222,41,0],[222,42,222,43,0],[223,17,223,18,0],[223,19,223,42,0],[223,43,223,44,0],[231,17,231,18,0],[231,19,231,89,0],[231,90,231,91,0],[232,17,232,18,0],[232,19,232,33,0],[232,34,232,35,0],[239,17,239,18,0],[239,19,239,35,0],[239,36,239,37,0],[240,17,240,18,0],[240,19,240,36,0],[240,37,240,38,0],[247,17,247,18,0],[247,19,247,33,0],[247,34,247,35,0],[248,17,248,18,0],[248,19,248,34,0],[248,35,248,36,0],[255,17,255,18,0],[255,19,255,41,0],[255,42,255,43,0],[256,17,256,18,0],[256,19,256,42,0],[256,43,256,44,0],[263,17,263,18,0],[263,19,263,43,0],[263,44,263,45,0],[264,17,264,18,0],[264,19,264,44,0],[264,45,264,46,0],[271,17,271,18,0],[271,19,271,33,0],[271,34,271,35,0],[272,17,272,18,0],[272,19,272,34,0],[272,35,272,36,0],[279,17,279,18,0],[279,19,279,36,0],[279,37,279,38,0],[280,17,280,18,0],[280,19,280,37,0],[280,38,280,39,0]]);
    </script>
  </body>
</html>