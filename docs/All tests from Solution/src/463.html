<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Trees\loadMedia.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using umbraco.BasePages;
using umbraco.businesslogic;
using umbraco.interfaces;
using umbraco.BusinessLogic.Actions;
using umbraco.cms.presentation.Trees;
using Umbraco.Core;


namespace umbraco
{
    [Obsolete(&quot;This is no longer used and will be removed from the codebase in the future&quot;)]
    public class loadMedia : BaseMediaTree
    {

        private int _StartNodeID;
        /// &lt;summary&gt;
		/// Create the linkable data types list and add the DataTypeUploadField guid to it.
		/// By default, any media type that is to be &quot;linkable&quot; in the WYSIWYG editor must contain
		/// a DataTypeUploadField data type which will ouput the value for the link, however, if 
		/// a developer wants the WYSIWYG editor to link to a custom media type, they will either have
		/// to create their own media tree and inherit from this one and override the GetLinkValue 
		/// or add another GUID to the LinkableMediaDataType list on application startup that matches
		/// the GUID of a custom data type. The order of GUIDs will determine the output value.
		/// &lt;/summary&gt;
		static loadMedia()
		{
			LinkableMediaDataTypes = new List&lt;Guid&gt;();
			LinkableMediaDataTypes.Add(new Guid(Constants.PropertyEditors.UploadField));
		}

		public loadMedia(string application)
			: base(application)
		{
            _StartNodeID = CurrentUser.StartMediaId;
		}		

        protected override void CreateRootNode(ref XmlTreeNode rootNode)
        {            

            if (this.IsDialog)
                rootNode.Action = &quot;javascript:openMedia(-1);&quot;;
            else
                rootNode.Action = &quot;javascript:&quot; + ClientTools.Scripts.OpenDashboard(&quot;Media&quot;);
        }

        protected override void CreateRootNodeActions(ref List&lt;IAction&gt; actions)
		{
			actions.Clear();
			actions.Add(ActionNew.Instance);
			actions.Add(ContextMenuSeperator.Instance);
			actions.Add(ActionSort.Instance);
			actions.Add(ContextMenuSeperator.Instance);
			actions.Add(ActionRefresh.Instance);
		}

        protected override void CreateAllowedActions(ref List&lt;IAction&gt; actions)
        {
            actions.Clear();
            actions.Add(ActionNew.Instance);
            actions.Add(ActionMove.Instance);
            actions.Add(ActionDelete.Instance);
            actions.Add(ActionSort.Instance);
            actions.Add(ContextMenuSeperator.Instance);
            actions.Add(ActionRefresh.Instance);
        }

		/// &lt;summary&gt;
		/// If the user is an admin, always return entire tree structure, otherwise
		/// return the user&#39;s start node id.
		/// &lt;/summary&gt;
		public override int StartNodeID
		{
            get
            {
                return _StartNodeID;
            }
		}

		/// &lt;summary&gt;
		/// Adds the recycling bin node. This method should only actually add the recycle bin node when the tree is initially created and if the user
		/// actually has access to the root node.
		/// &lt;/summary&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		protected XmlTreeNode CreateRecycleBin()
		{
			if (m_id == -1 &amp;&amp; !this.IsDialog)
			{
				//create a new content recycle bin tree, initialized with it&#39;s startnodeid
				MediaRecycleBin bin = new MediaRecycleBin(this.m_app);
				bin.ShowContextMenu = this.ShowContextMenu;
				bin.id = bin.StartNodeID;
				return bin.RootNode;
			}
			return null;
		}

		public override void Render(ref XmlTree tree)
		{
			base.Render(ref tree);
			XmlTreeNode recycleBin = CreateRecycleBin();
			if (recycleBin != null)
				tree.Add(recycleBin);
		}

	

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[28,3,28,4,0],[29,4,29,46,0],[30,4,30,80,0],[31,3,31,4,0],[34,6,34,23,0],[35,3,35,4,0],[36,13,36,53,0],[37,3,37,4,0],[40,9,40,10,0],[42,13,42,31,0],[43,17,43,63,0],[45,17,45,94,0],[46,9,46,10,0],[49,3,49,4,0],[50,4,50,20,0],[51,4,51,36,0],[52,4,52,47,0],[53,4,53,37,0],[54,4,54,47,0],[55,4,55,40,0],[56,3,56,4,0],[59,9,59,10,0],[60,13,60,29,0],[61,13,61,45,0],[62,13,62,46,0],[63,13,63,48,0],[64,13,64,46,0],[65,13,65,56,0],[66,13,66,49,0],[67,9,67,10,0],[76,13,76,14,0],[77,17,77,37,0],[78,13,78,14,0],[87,3,87,4,0],[88,4,88,37,0],[89,4,89,5,0],[91,5,91,59,0],[92,5,92,48,0],[93,5,93,30,0],[94,5,94,25,0],[96,4,96,16,0],[97,3,97,4,0],[100,3,100,4,0],[101,4,101,26,0],[102,4,102,48,0],[103,4,103,27,0],[104,5,104,26,0],[105,3,105,4,0]]);
    </script>
  </body>
</html>