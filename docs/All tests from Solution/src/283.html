<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\TestHelpers\BaseRoutingTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Configuration;
using System.Linq;
using System.Web.Routing;
using NUnit.Framework;
using Umbraco.Core.Configuration;
using Umbraco.Core.Configuration.UmbracoSettings;
using Umbraco.Core.Models;
using Umbraco.Tests.TestHelpers.Stubs;
using Umbraco.Web;
using Umbraco.Web.PublishedCache.XmlPublishedCache;
using Umbraco.Web.Routing;

namespace Umbraco.Tests.TestHelpers
{
	[TestFixture, RequiresSTA]
	public abstract class BaseRoutingTest : BaseWebTest
	{
	    ///  &lt;summary&gt;
	    ///  Return a new RoutingContext
	    ///  &lt;/summary&gt;
	    ///  &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
	    ///  &lt;param name=&quot;templateId&quot;&gt;
	    ///  The template Id to insert into the Xml cache file for each node, this is helpful for unit testing with templates but you		 
	    ///  should normally create the template in the database with this id
	    /// &lt;/param&gt;
	    ///  &lt;param name=&quot;routeData&quot;&gt;&lt;/param&gt;
	    /// &lt;param name=&quot;setUmbracoContextCurrent&quot;&gt;set to true to also set the singleton UmbracoContext.Current to the context created with this method&lt;/param&gt;
	    /// &lt;param name=&quot;umbracoSettings&quot;&gt;&lt;/param&gt;
	    /// &lt;returns&gt;&lt;/returns&gt;
	    protected RoutingContext GetRoutingContext(string url, int templateId, RouteData routeData = null, bool setUmbracoContextCurrent = false, IUmbracoSettingsSection umbracoSettings = null)
	    {
	        if (umbracoSettings == null) umbracoSettings = SettingsForTests.GetDefault();

			var umbracoContext = GetUmbracoContext(url, templateId, routeData);
            var urlProvider = new UrlProvider(umbracoContext, umbracoSettings.WebRouting, new IUrlProvider[]
            {
                new DefaultUrlProvider(umbracoSettings.RequestHandler)
            });
			var routingContext = new RoutingContext(
				umbracoContext,
				Enumerable.Empty&lt;IContentFinder&gt;(),
				new FakeLastChanceFinder(),
                urlProvider);

			//assign the routing context back to the umbraco context
			umbracoContext.RoutingContext = routingContext;

	        if (setUmbracoContextCurrent)
	            UmbracoContext.Current = umbracoContext;

			return routingContext;
		}

		/// &lt;summary&gt;
		/// Return a new RoutingContext
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;template&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;routeData&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		protected RoutingContext GetRoutingContext(string url, Template template, RouteData routeData = null)
		{
			return GetRoutingContext(url, template.Id, routeData);
		}

		/// &lt;summary&gt;
		/// Return a new RoutingContext that doesn&#39;t require testing based on template
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;routeData&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		protected RoutingContext GetRoutingContext(string url, RouteData routeData = null)
		{
			return GetRoutingContext(url, 1234, routeData);
		}

		
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[31,6,31,7,1],[32,10,32,38,1],[32,39,32,87,1],[34,4,34,71,1],[35,13,38,16,1],[39,4,43,30,1],[46,4,46,51,1],[48,10,48,39,1],[49,14,49,54,1],[51,4,51,26,1],[52,3,52,4,1],[62,3,62,4,1],[63,4,63,58,1],[64,3,64,4,1],[73,3,73,4,1],[74,4,74,51,1],[75,3,75,4,1]]);
    </script>
  </body>
</html>