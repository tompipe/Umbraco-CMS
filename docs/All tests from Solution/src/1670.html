<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\SqlSyntax\MicrosoftSqlSyntaxProviderBase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;
using System.Linq;
using Umbraco.Core.Persistence.Querying;

namespace Umbraco.Core.Persistence.SqlSyntax
{
    /// &lt;summary&gt;
    /// Abstract class for defining MS sql implementations
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;TSyntax&quot;&gt;&lt;/typeparam&gt;
    public abstract class MicrosoftSqlSyntaxProviderBase&lt;TSyntax&gt; : SqlSyntaxProviderBase&lt;TSyntax&gt;
        where TSyntax : ISqlSyntaxProvider
    {
        protected MicrosoftSqlSyntaxProviderBase()
        {            
            AutoIncrementDefinition = &quot;IDENTITY(1,1)&quot;;
            GuidColumnDefinition = &quot;UniqueIdentifier&quot;;
            RealColumnDefinition = &quot;FLOAT&quot;;
            BoolColumnDefinition = &quot;BIT&quot;;
            DecimalColumnDefinition = &quot;DECIMAL(38,6)&quot;;
            TimeColumnDefinition = &quot;TIME&quot;; //SQLSERVER 2008+
            BlobColumnDefinition = &quot;VARBINARY(MAX)&quot;;

            InitColumnTypeMap();
        }

        public override string RenameTable { get { return &quot;sp_rename &#39;{0}&#39;, &#39;{1}&#39;&quot;; } }

        public override string AddColumn { get { return &quot;ALTER TABLE {0} ADD {1}&quot;; } }

        public override string GetQuotedTableName(string tableName)
        {
            if (tableName.Contains(&quot;.&quot;) == false)
                return string.Format(&quot;[{0}]&quot;, tableName);

            var tableNameParts = tableName.Split(new[] { &#39;.&#39; }, 2);
            return string.Format(&quot;[{0}].[{1}]&quot;, tableNameParts[0], tableNameParts[1]);
        }

        public override string GetQuotedColumnName(string columnName)
        {
            return string.Format(&quot;[{0}]&quot;, columnName);
        }

        public override string GetQuotedName(string name)
        {
            return string.Format(&quot;[{0}]&quot;, name);
        }

        public override string GetStringColumnEqualComparison(string column, int paramIndex, TextColumnType columnType)
        {
            switch (columnType)
            {
                case TextColumnType.NVarchar:
                    return base.GetStringColumnEqualComparison(column, paramIndex, columnType);
                case TextColumnType.NText:
                    //MSSQL doesn&#39;t allow for = comparison with NText columns but allows this syntax
                    return string.Format(&quot;{0} LIKE @{1}&quot;, column, paramIndex);
                default:
                    throw new ArgumentOutOfRangeException(&quot;columnType&quot;);
            }
        }

        public override string GetStringColumnWildcardComparison(string column, int paramIndex, TextColumnType columnType)
        {
            switch (columnType)
            {
                case TextColumnType.NVarchar:
                    return base.GetStringColumnWildcardComparison(column, paramIndex, columnType);
                case TextColumnType.NText:
                    //MSSQL doesn&#39;t allow for upper methods with NText columns
                    return string.Format(&quot;{0} LIKE @{1}&quot;, column, paramIndex);
                default:
                    throw new ArgumentOutOfRangeException(&quot;columnType&quot;);
            }
        }

        [Obsolete(&quot;Use the overload with the parameter index instead&quot;)]
        public override string GetStringColumnStartsWithComparison(string column, string value, TextColumnType columnType)
        {
            switch (columnType)
            {
                case TextColumnType.NVarchar:
                    return base.GetStringColumnStartsWithComparison(column, value, columnType);
                case TextColumnType.NText:
                    //MSSQL doesn&#39;t allow for upper methods with NText columns
                    return string.Format(&quot;{0} LIKE &#39;{1}%&#39;&quot;, column, value);
                default:
                    throw new ArgumentOutOfRangeException(&quot;columnType&quot;);
            }
        }

        [Obsolete(&quot;Use the overload with the parameter index instead&quot;)]
        public override string GetStringColumnEndsWithComparison(string column, string value, TextColumnType columnType)
        {
            switch (columnType)
            {
                case TextColumnType.NVarchar:
                    return base.GetStringColumnEndsWithComparison(column, value, columnType);
                case TextColumnType.NText:
                    //MSSQL doesn&#39;t allow for upper methods with NText columns
                    return string.Format(&quot;{0} LIKE &#39;%{1}&#39;&quot;, column, value);
                default:
                    throw new ArgumentOutOfRangeException(&quot;columnType&quot;);
            }
        }

        [Obsolete(&quot;Use the overload with the parameter index instead&quot;)]
        public override string GetStringColumnContainsComparison(string column, string value, TextColumnType columnType)
        {
            switch (columnType)
            {
                case TextColumnType.NVarchar:
                    return base.GetStringColumnContainsComparison(column, value, columnType);
                case TextColumnType.NText:
                    //MSSQL doesn&#39;t allow for upper methods with NText columns
                    return string.Format(&quot;{0} LIKE &#39;%{1}%&#39;&quot;, column, value);
                default:
                    throw new ArgumentOutOfRangeException(&quot;columnType&quot;);
            }
        }

        [Obsolete(&quot;Use the overload with the parameter index instead&quot;)]
        public override string GetStringColumnWildcardComparison(string column, string value, TextColumnType columnType)
        {
            switch (columnType)
            {
                case TextColumnType.NVarchar:
                    return base.GetStringColumnContainsComparison(column, value, columnType);
                case TextColumnType.NText:
                    //MSSQL doesn&#39;t allow for upper methods with NText columns
                    return string.Format(&quot;{0} LIKE &#39;{1}&#39;&quot;, column, value);
                default:
                    throw new ArgumentOutOfRangeException(&quot;columnType&quot;);
            }
        }

        /// &lt;summary&gt;
        /// This uses a the DbTypeMap created and custom mapping to resolve the SqlDbType
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;clrType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public virtual SqlDbType GetSqlDbType(Type clrType)
        {
            var dbType = DbTypeMap.ColumnDbTypeMap.First(x =&gt; x.Key == clrType).Value;
            return GetSqlDbType(dbType);
        }

        /// &lt;summary&gt;
        /// Returns the mapped SqlDbType for the DbType specified
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dbType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public virtual SqlDbType GetSqlDbType(DbType dbType)
        {
            var sqlDbType = SqlDbType.NVarChar;

            //SEE: https://msdn.microsoft.com/en-us/library/cc716729(v=vs.110).aspx
            // and https://msdn.microsoft.com/en-us/library/yy6y35y8%28v=vs.110%29.aspx?f=255&amp;MSPPError=-2147217396
            switch (dbType)
            {
                case DbType.AnsiString:
                    sqlDbType = SqlDbType.VarChar;
                    break;
                case DbType.Binary:
                    sqlDbType = SqlDbType.VarBinary;
                    break;
                case DbType.Byte:
                    sqlDbType = SqlDbType.TinyInt;
                    break;
                case DbType.Boolean:
                    sqlDbType = SqlDbType.Bit;
                    break;
                case DbType.Currency:
                    sqlDbType = SqlDbType.Money;
                    break;
                case DbType.Date:
                    sqlDbType = SqlDbType.Date;
                    break;
                case DbType.DateTime:
                    sqlDbType = SqlDbType.DateTime;
                    break;
                case DbType.Decimal:
                    sqlDbType = SqlDbType.Decimal;
                    break;
                case DbType.Double:
                    sqlDbType = SqlDbType.Float;
                    break;
                case DbType.Guid:
                    sqlDbType = SqlDbType.UniqueIdentifier;
                    break;
                case DbType.Int16:
                    sqlDbType = SqlDbType.SmallInt;
                    break;
                case DbType.Int32:
                    sqlDbType = SqlDbType.Int;
                    break;
                case DbType.Int64:
                    sqlDbType = SqlDbType.BigInt;
                    break;
                case DbType.Object:
                    sqlDbType = SqlDbType.Variant;
                    break;
                case DbType.SByte:
                    throw new NotSupportedException(&quot;Inferring a SqlDbType from SByte is not supported.&quot;);
                case DbType.Single:
                    sqlDbType = SqlDbType.Real;
                    break;
                case DbType.String:
                    sqlDbType = SqlDbType.NVarChar;
                    break;
                case DbType.Time:
                    sqlDbType = SqlDbType.Time;
                    break;
                case DbType.UInt16:
                    throw new NotSupportedException(&quot;Inferring a SqlDbType from UInt16 is not supported.&quot;);
                case DbType.UInt32:
                    throw new NotSupportedException(&quot;Inferring a SqlDbType from UInt32 is not supported.&quot;);
                case DbType.UInt64:
                    throw new NotSupportedException(&quot;Inferring a SqlDbType from UInt64 is not supported.&quot;);
                case DbType.VarNumeric:
                    throw new NotSupportedException(&quot;Inferring a VarNumeric from UInt64 is not supported.&quot;);
                case DbType.AnsiStringFixedLength:
                    sqlDbType = SqlDbType.Char;
                    break;
                case DbType.StringFixedLength:
                    sqlDbType = SqlDbType.NChar;
                    break;
                case DbType.Xml:
                    sqlDbType = SqlDbType.Xml;
                    break;
                case DbType.DateTime2:
                    sqlDbType = SqlDbType.DateTime2;
                    break;
                case DbType.DateTimeOffset:
                    sqlDbType = SqlDbType.DateTimeOffset;
                    break;
                default:
                    throw new ArgumentOutOfRangeException();
            }
            return sqlDbType;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,51,1],[16,9,16,10,1],[17,13,17,55,1],[18,13,18,55,1],[19,13,19,44,1],[20,13,20,42,1],[21,13,21,55,1],[22,13,22,43,1],[23,13,23,53,1],[25,13,25,33,1],[26,9,26,10,1],[28,50,28,51,1],[28,52,28,84,1],[28,85,28,86,1],[30,48,30,49,1],[30,50,30,83,1],[30,84,30,85,1],[33,9,33,10,1],[34,13,34,50,1],[35,17,35,58,1],[37,13,37,68,0],[38,13,38,87,0],[39,9,39,10,1],[42,9,42,10,1],[43,13,43,55,1],[44,9,44,10,1],[47,9,47,10,1],[48,13,48,49,1],[49,9,49,10,1],[52,9,52,10,1],[53,13,53,32,1],[56,21,56,96,1],[59,21,59,79,1],[61,21,61,73,0],[63,9,63,10,1],[66,9,66,10,1],[67,13,67,32,1],[70,21,70,99,1],[73,21,73,79,1],[75,21,75,73,0],[77,9,77,10,1],[81,9,81,10,0],[82,13,82,32,0],[85,21,85,96,0],[88,21,88,76,0],[90,21,90,73,0],[92,9,92,10,0],[96,9,96,10,0],[97,13,97,32,0],[100,21,100,94,0],[103,21,103,76,0],[105,21,105,73,0],[107,9,107,10,0],[111,9,111,10,0],[112,13,112,32,0],[115,21,115,94,0],[118,21,118,77,0],[120,21,120,73,0],[122,9,122,10,0],[126,9,126,10,0],[127,13,127,32,0],[130,21,130,94,0],[133,21,133,75,0],[135,21,135,73,0],[137,9,137,10,0],[145,9,145,10,0],[146,13,146,63,0],[146,63,146,79,0],[146,79,146,87,0],[146,13,146,87,0],[147,13,147,41,0],[148,9,148,10,0],[156,9,156,10,0],[157,13,157,48,0],[161,13,161,28,0],[164,21,164,51,0],[165,21,165,27,0],[167,21,167,53,0],[168,21,168,27,0],[170,21,170,51,0],[171,21,171,27,0],[173,21,173,47,0],[174,21,174,27,0],[176,21,176,49,0],[177,21,177,27,0],[179,21,179,48,0],[180,21,180,27,0],[182,21,182,52,0],[183,21,183,27,0],[185,21,185,51,0],[186,21,186,27,0],[188,21,188,49,0],[189,21,189,27,0],[191,21,191,60,0],[192,21,192,27,0],[194,21,194,52,0],[195,21,195,27,0],[197,21,197,47,0],[198,21,198,27,0],[200,21,200,50,0],[201,21,201,27,0],[203,21,203,51,0],[204,21,204,27,0],[206,21,206,107,0],[208,21,208,48,0],[209,21,209,27,0],[211,21,211,52,0],[212,21,212,27,0],[214,21,214,48,0],[215,21,215,27,0],[217,21,217,108,0],[219,21,219,108,0],[221,21,221,108,0],[223,21,223,109,0],[225,21,225,48,0],[226,21,226,27,0],[228,21,228,49,0],[229,21,229,27,0],[231,21,231,47,0],[232,21,232,27,0],[234,21,234,53,0],[235,21,235,27,0],[237,21,237,58,0],[238,21,238,27,0],[240,21,240,61,0],[242,13,242,30,0],[243,9,243,10,0]]);
    </script>
  </body>
</html>