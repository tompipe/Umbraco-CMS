<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Strings\StylesheetHelperTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Linq;
using System.Text;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Strings.Css;

namespace Umbraco.Tests.Strings
{
    [TestFixture]
    public class StylesheetHelperTests
    {
        [Test]
        public void Replace_Rule()
        {
            var css = @&quot;body {font-family:Arial;}/** Umb_Name: Test1 */ p { font-size: 1em; } /** umb_name:  Test2 */ li {padding:0px;} table {margin:0;}&quot;;
            var results = StylesheetHelper.ParseRules(css);

            var result = StylesheetHelper.ReplaceRule(css, results.First().Name, new StylesheetRule()
            {
                Name = &quot;My new rule&quot;,
                Selector = &quot;p&quot;,
                Styles = &quot;font-size:1em; color:blue;&quot;
            });

            Assert.AreEqual(@&quot;body {font-family:Arial;}/**umb_name:My new rule*/
p{font-size:1em; color:blue;} /** umb_name:  Test2 */ li {padding:0px;} table {margin:0;}&quot;.StripWhitespace(), result.StripWhitespace());
        }

        [Test]
        public void Append_Rule()
        {
            var css = @&quot;body {font-family:Arial;}/** Umb_Name: Test1 */ p { font-size: 1em; } /** umb_name:  Test2 */ li {padding:0px;} table {margin:0;}&quot;;

            var result = StylesheetHelper.AppendRule(css, new StylesheetRule()
            {
                Name = &quot;My new rule&quot;,
                Selector = &quot;p&quot;,
                Styles = &quot;font-size:1em; color:blue;&quot;
            });

            Assert.AreEqual(@&quot;body {font-family:Arial;}/** Umb_Name: Test1 */ p { font-size: 1em; } /** umb_name:  Test2 */ li {padding:0px;} table {margin:0;}

/**umb_name:My new rule*/
p{font-size:1em; color:blue;}&quot;.StripWhitespace(), result.StripWhitespace());
        }

        [Test]
        public void Duplicate_Names()
        {
            var css = @&quot;/** Umb_Name: Test */ p { font-size: 1em; } /** umb_name:  Test */ li {padding:0px;}&quot;;
            var results = StylesheetHelper.ParseRules(css);
            Assert.AreEqual(1, results.Count());
        }

        // Standard rule stle
        [TestCase(&quot;Test&quot;, &quot;p&quot;, &quot;font-size: 1em;&quot;, @&quot;/**
    Umb_Name: Test
*/
p {
    font-size: 1em;
}&quot;)]
        // All on one line, different casing
        [TestCase(&quot;Test&quot;, &quot;p&quot;, &quot;font-size: 1em;&quot;, @&quot;/** Umb_Name: Test */ p { font-size: 1em; }&quot;)]
        // styles on several lines
        [TestCase(&quot;Test&quot;, &quot;p&quot;, @&quot;font-size: 1em;
color:red; font-weight:bold;

text-align:left;&quot;, @&quot;/** umb_name: Test */ p { font-size: 1em; 
color:red; font-weight:bold;

text-align:left; 

}&quot;)]
        // All on one line with no spaces
        [TestCase(&quot;Test&quot;, &quot;p&quot;, &quot;font-size: 1em;&quot;, @&quot;/**UMB_NAME:Test*/p{font-size: 1em;}&quot;)]
        // Has a name with spaces
        [TestCase(&quot;Hello world&quot;, &quot;p&quot;, &quot;font-size: 1em;&quot;, @&quot;/**UMB_NAME:Hello world */p{font-size: 1em;}&quot;)]        
        // Every part on a new line
        [TestCase(&quot;Test&quot;, &quot;p&quot;, &quot;font-size: 1em;&quot;, @&quot;/** 
umb_name:
Test
*/
p
{
font-size: 1em;
}&quot;)]
        public void ParseRules_Parses(string name, string selector, string styles, string css)
        {
            
            // Act
            var results = StylesheetHelper.ParseRules(css);

            // Assert
            Assert.AreEqual(1, results.Count());

            //Assert.IsTrue(results.First().RuleId.Value.Value.ToString() == file.Id.Value.Value + &quot;/&quot; + name);
            Assert.AreEqual(name, results.First().Name);
            Assert.AreEqual(selector, results.First().Selector);
            Assert.AreEqual(styles.StripWhitespace(), results.First().Styles.StripWhitespace());
        }

        // No Name: keyword
        [TestCase(@&quot;/** Test2 */
p
{
    font-size: 1em;
}&quot;)]
        // Has a Name: keyword, but applies to 2 rules, so shouldn&#39;t parse
        [TestCase(@&quot;/** umb_name: Test2 */
p, h2
{
    font-size: 1em;
}&quot;)]
        // Has it&#39;s name wrapping over two lines
        [TestCase(&quot;/** umb_name: Test\r\n2 */ p { font-size: 1em; }&quot;)]
        [TestCase(&quot;/** umb_name: Test\n2 */ p { font-size: 1em; }&quot;)]
        //Only a single asterisk
        [TestCase(&quot;/* umb_name: Test */ p { font-size: 1em; }&quot;)]
        // Has a name with spaces over multiple lines
        [TestCase(@&quot;/**UMB_NAME:Hello 

world */p{font-size: 1em;}&quot;)]
        public void ParseRules_DoesntParse(string css)
        {
         
            // Act
            var results = StylesheetHelper.ParseRules(css);

            // Assert
            Assert.IsTrue(results.Count() == 0);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,10,1],[15,13,15,156,1],[16,13,16,60,1],[18,13,23,16,1],[25,13,26,137,1],[27,9,27,10,1],[31,9,31,10,1],[32,13,32,156,1],[34,13,39,16,1],[41,13,44,77,1],[45,9,45,10,1],[49,9,49,10,1],[50,13,50,111,1],[51,13,51,60,1],[52,13,52,49,1],[53,9,53,10,1],[88,9,88,10,1],[91,13,91,60,1],[94,13,94,49,1],[97,13,97,57,1],[98,13,98,65,1],[99,13,99,97,1],[100,9,100,10,1],[124,9,124,10,1],[127,13,127,60,1],[130,13,130,49,1],[131,9,131,10,1]]);
    </script>
  </body>
</html>