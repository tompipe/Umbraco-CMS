<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\HttpCookieExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Web;
using Microsoft.Owin;
using Umbraco.Core;

namespace Umbraco.Web
{
    /// &lt;summary&gt;
    /// Extension methods used to check/set cookie values
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// This should 100% supercede the StateManager.Cookies
    /// &lt;/remarks&gt; 
    internal static class HttpCookieExtensions
    {
        /// &lt;summary&gt;
        /// Removes the cookie from the request and the response if it exists
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;http&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;cookieName&quot;&gt;&lt;/param&gt;
        public static void ExpireCookie(this HttpContextBase http, string cookieName)
        {
            //remove from the request
            http.Request.Cookies.Remove(cookieName);

            //expire from the response
            var angularCookie = http.Response.Cookies[cookieName];
            if (angularCookie != null)
            {
                //this will expire immediately and be removed from the browser
                angularCookie.Expires = DateTime.Now.AddYears(-1);
            }
            else
            {
                //ensure there&#39;s def an expired cookie
                http.Response.Cookies.Add(new HttpCookie(cookieName) { Expires = DateTime.Now.AddYears(-1) });
            }
        }

        public static string GetPreviewCookieValue(this HttpRequestMessage request)
        {
            var cookie = request.Headers.GetCookies(Constants.Web.PreviewCookieName).FirstOrDefault();
            if (cookie != null)
            {
                if (cookie[Constants.Web.PreviewCookieName] != null)
                {
                    return cookie[Constants.Web.PreviewCookieName].Value;
                }
            }
            return null;
        }

        /// &lt;summary&gt;
        /// Does a preview cookie exist ?
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static bool HasPreviewCookie(this HttpRequestBase request)
        {
            return request.Cookies[Constants.Web.PreviewCookieName] != null;
        }

        /// &lt;summary&gt;
        /// Does a preview cookie exist ?
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static bool HasPreviewCookie(this IOwinRequest request)
        {
            return request.Cookies[Constants.Web.PreviewCookieName] != null;
        }

        /// &lt;summary&gt;
        /// Does a cookie exist with the specified key ?
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static bool HasCookie(this HttpRequestBase request, string key)
        {
            return request.Cookies[key] != null;
        }

        /// &lt;summary&gt;
        /// Is there a cookie with the key supplied and does it have a value that is not empty
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static bool HasCookieValue(this HttpRequestBase request, string key)
        {
            return request.Cookies[key] != null
                   &amp;&amp; request.Cookies[key].Value != null
                   &amp;&amp; request.Cookies[key].Value.IsNullOrWhiteSpace() == false;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[25,9,25,10,0],[27,13,27,53,0],[30,13,30,67,0],[31,13,31,39,0],[32,13,32,14,0],[34,17,34,67,0],[35,13,35,14,0],[37,13,37,14,0],[39,17,39,111,0],[40,13,40,14,0],[41,9,41,10,0],[44,9,44,10,0],[45,13,45,103,0],[46,13,46,32,0],[47,13,47,14,0],[48,17,48,69,0],[49,17,49,18,0],[50,21,50,74,0],[52,13,52,14,0],[53,13,53,25,0],[54,9,54,10,0],[62,9,62,10,1],[63,13,63,77,1],[64,9,64,10,1],[72,9,72,10,0],[73,13,73,77,0],[74,9,74,10,0],[83,9,83,10,0],[84,13,84,49,0],[85,9,85,10,0],[94,9,94,10,0],[95,13,97,80,0],[98,9,98,10,0]]);
    </script>
  </body>
</html>