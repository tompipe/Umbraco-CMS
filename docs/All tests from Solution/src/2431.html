<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\Packager\PackageActions\moveRootDocument.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Xml;

namespace umbraco.cms.businesslogic.packager.standardPackageActions
{
	/// &lt;summary&gt;
	/// This class implements the IPackageAction Interface, used to execute code when packages are installed.
	/// All IPackageActions only takes a PackageName and a XmlNode as input, and executes based on the data in the xmlnode.
	/// &lt;/summary&gt;
	public class moveRootDocument : umbraco.interfaces.IPackageAction
	{
		#region IPackageAction Members

		/// &lt;summary&gt;
		/// Executes the specified package action.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;packageName&quot;&gt;Name of the package.&lt;/param&gt;
		/// &lt;param name=&quot;xmlData&quot;&gt;The XML data.&lt;/param&gt;
		/// &lt;example&gt;&lt;code&gt;
		/// &lt;Action runat=&quot;install&quot; alias=&quot;moveRootDocument&quot; documentName=&quot;News&quot; parentDocumentType=&quot;Home&quot;  /&gt;
		/// &lt;/code&gt;&lt;/example&gt;
		/// &lt;returns&gt;True if executed succesfully&lt;/returns&gt;
		public bool Execute(string packageName, XmlNode xmlData)
		{

			string documentName = xmlData.Attributes[&quot;documentName&quot;].Value;
			string parentDocumentType = xmlData.Attributes[&quot;parentDocumentType&quot;].Value;
			string parentDocumentName = &quot;&quot;;

			if (xmlData.Attributes[&quot;parentDocumentName&quot;] != null)
				parentDocumentName = xmlData.Attributes[&quot;parentDocumentName&quot;].Value;

			int parentDocid = 0;

			ContentType ct = ContentType.GetByAlias(parentDocumentType);
			Content[] docs = web.Document.getContentOfContentType(ct);

			if (docs.Length &gt; 0)
			{
				if (String.IsNullOrEmpty(parentDocumentName))
					parentDocid = docs[0].Id;
				else
				{
					foreach (Content doc in docs)
					{
						if (doc.Text == parentDocumentName)
							parentDocid = doc.Id;
					}
				}
			}

			if (parentDocid &gt; 0)
			{
				web.Document[] rootDocs = web.Document.GetRootDocuments();

				foreach (web.Document rootDoc in rootDocs)
				{
					if (rootDoc.Text == documentName)
					{
						rootDoc.Move(parentDocid);
						rootDoc.PublishWithSubs(new umbraco.BusinessLogic.User(0));
					}
				}
			}


			return true;
		}

		//this has no undo.
		/// &lt;summary&gt;
		/// This action has no undo.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;packageName&quot;&gt;Name of the package.&lt;/param&gt;
		/// &lt;param name=&quot;xmlData&quot;&gt;The XML data.&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public bool Undo(string packageName, XmlNode xmlData)
		{
			return true;
		}

		/// &lt;summary&gt;
		/// Action alias
		/// &lt;/summary&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public string Alias()
		{
			return &quot;moveRootDocument&quot;;
		}

		#endregion

		public XmlNode SampleXml()
		{
			throw new NotImplementedException();
		}

	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[24,3,24,4,0],[26,4,26,67,0],[27,4,27,79,0],[28,4,28,35,0],[30,4,30,57,0],[31,5,31,73,0],[33,4,33,24,0],[35,4,35,64,0],[36,4,36,62,0],[38,4,38,24,0],[39,4,39,5,0],[40,5,40,50,0],[41,6,41,31,0],[43,5,43,6,0],[44,6,44,13,0],[44,15,44,26,0],[44,27,44,29,0],[44,30,44,34,0],[45,6,45,7,0],[46,7,46,42,0],[47,8,47,29,0],[48,6,48,7,0],[49,5,49,6,0],[50,4,50,5,0],[52,4,52,24,0],[53,4,53,5,0],[54,5,54,63,0],[56,5,56,12,0],[56,14,56,34,0],[56,35,56,37,0],[56,38,56,46,0],[57,5,57,6,0],[58,6,58,39,0],[59,6,59,7,0],[60,7,60,33,0],[61,7,61,66,0],[62,6,62,7,0],[63,5,63,6,0],[64,4,64,5,0],[67,4,67,16,0],[68,3,68,4,0],[78,3,78,4,0],[79,4,79,16,0],[80,3,80,4,0],[87,3,87,4,0],[88,4,88,30,0],[89,3,89,4,0],[94,3,94,4,0],[95,4,95,40,0]]);
    </script>
  </body>
</html>