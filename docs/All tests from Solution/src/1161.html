<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Models\ImageCropDataSet.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Dynamic;
using System.Linq;
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.Serialization;
using System.Text;
using System.Web;
using Newtonsoft.Json;
using Umbraco.Core;
using Umbraco.Core.Dynamics;
using Umbraco.Core.Serialization;
using Umbraco.Web.PropertyEditors.ValueConverters;

namespace Umbraco.Web.Models
{
    [JsonConverter(typeof(NoTypeConverterJsonConverter&lt;ImageCropDataSet&gt;))]
    [TypeConverter(typeof(ImageCropDataSetConverter))]
    [DataContract(Name=&quot;imageCropDataSet&quot;)]
    public class ImageCropDataSet : CaseInsensitiveDynamicObject&lt;ImageCropDataSet&gt;, IHtmlString, IEquatable&lt;ImageCropDataSet&gt;
    {   

        [DataMember(Name=&quot;src&quot;)]
        public string Src { get; set;}

        [DataMember(Name = &quot;focalPoint&quot;)]
        public ImageCropFocalPoint FocalPoint { get; set; }

        [DataMember(Name = &quot;crops&quot;)]
        public IEnumerable&lt;ImageCropData&gt; Crops { get; set; }

        public string GetCropUrl(string alias, bool useCropDimensions = true, bool useFocalPoint = false, string cacheBusterValue = null)
        {

            var crop = Crops.GetCrop(alias);

            if (crop == null &amp;&amp; string.IsNullOrEmpty(alias) == false)
            {
                return null;
            }

            var sb = new StringBuilder();

            var cropBaseUrl = this.GetCropBaseUrl(alias, useFocalPoint);
            if (cropBaseUrl != null)
            {
                sb.Append(cropBaseUrl);
            }

            if (crop != null &amp;&amp; useCropDimensions)
            {
                sb.Append(&quot;&amp;width=&quot;).Append(crop.Width);
                sb.Append(&quot;&amp;height=&quot;).Append(crop.Height);
            }

            if (cacheBusterValue != null)
            {
                sb.Append(&quot;&amp;rnd=&quot;).Append(cacheBusterValue);
            }

            return sb.ToString();

        }

        public bool HasFocalPoint()
        {
            return FocalPoint != null &amp;&amp; FocalPoint.Left != 0.5m &amp;&amp; FocalPoint.Top != 0.5m;
        }

        public bool HasCrop(string alias)
        {
            return Crops.Any(x =&gt; x.Alias == alias);
        }

        public bool HasImage()
        {
            return string.IsNullOrEmpty(Src);
        }

        public string ToHtmlString()
        {
            return this.Src;
        }

        /// &lt;summary&gt;
        /// Returns a string that represents the current object.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// If there are crops defined, it will return the JSON value, otherwise it will just return the Src value
        /// &lt;/returns&gt;
        public override string ToString()
        {
            return Crops.Any() ? JsonConvert.SerializeObject(this) : Src;
        }
               

        /// &lt;summary&gt;
        /// Indicates whether the current object is equal to another object of the same type.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// true if the current object is equal to the &lt;paramref name=&quot;other&quot;/&gt; parameter; otherwise, false.
        /// &lt;/returns&gt;
        /// &lt;param name=&quot;other&quot;&gt;An object to compare with this object.&lt;/param&gt;
        public bool Equals(ImageCropDataSet other)
        {
            if (ReferenceEquals(null, other)) return false;
            if (ReferenceEquals(this, other)) return true;
            return string.Equals(Src, other.Src) &amp;&amp; Equals(FocalPoint, other.FocalPoint) 
                &amp;&amp; Crops.SequenceEqual(other.Crops);
        }

        /// &lt;summary&gt;
        /// Determines whether the specified object is equal to the current object.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// true if the specified object  is equal to the current object; otherwise, false.
        /// &lt;/returns&gt;
        /// &lt;param name=&quot;obj&quot;&gt;The object to compare with the current object. &lt;/param&gt;
        public override bool Equals(object obj)
        {
            if (ReferenceEquals(null, obj)) return false;
            if (ReferenceEquals(this, obj)) return true;
            if (obj.GetType() != this.GetType()) return false;
            return Equals((ImageCropDataSet) obj);
        }

        /// &lt;summary&gt;
        /// Serves as the default hash function. 
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// A hash code for the current object.
        /// &lt;/returns&gt;
        public override int GetHashCode()
        {
            unchecked
            {
                var hashCode = (Src != null ? Src.GetHashCode() : 0);
                hashCode = (hashCode*397) ^ (FocalPoint != null ? FocalPoint.GetHashCode() : 0);
                hashCode = (hashCode*397) ^ (Crops != null ? Crops.GetHashCode() : 0);
                return hashCode;
            }
        }

        public static bool operator ==(ImageCropDataSet left, ImageCropDataSet right)
        {
            return Equals(left, right);
        }

        public static bool operator !=(ImageCropDataSet left, ImageCropDataSet right)
        {
            return !Equals(left, right);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,29,26,33,1],[26,34,26,38,1],[29,49,29,53,1],[29,54,29,58,1],[32,51,32,55,1],[32,56,32,60,1],[35,9,35,10,1],[37,13,37,45,1],[39,13,39,70,1],[40,13,40,14,0],[41,17,41,29,0],[44,13,44,42,1],[46,13,46,73,1],[47,13,47,37,1],[48,13,48,14,1],[49,17,49,40,1],[50,13,50,14,1],[52,13,52,51,1],[53,13,53,14,1],[54,17,54,57,1],[55,17,55,59,1],[56,13,56,14,1],[58,13,58,42,1],[59,13,59,14,0],[60,17,60,61,0],[61,13,61,14,0],[63,13,63,34,1],[65,9,65,10,1],[68,9,68,10,1],[69,13,69,92,1],[70,9,70,10,1],[73,9,73,10,1],[74,13,74,35,1],[74,35,74,51,1],[74,51,74,53,1],[74,13,74,53,1],[75,9,75,10,1],[78,9,78,10,0],[79,13,79,46,0],[80,9,80,10,0],[83,9,83,10,0],[84,13,84,29,0],[85,9,85,10,0],[94,9,94,10,1],[95,13,95,74,1],[96,9,96,10,1],[107,9,107,10,1],[108,13,108,46,1],[108,47,108,60,0],[109,13,109,46,1],[109,47,109,59,0],[110,13,111,53,1],[112,9,112,10,1],[122,9,122,10,1],[123,13,123,44,1],[123,45,123,58,0],[124,13,124,44,1],[124,45,124,57,0],[125,13,125,49,1],[125,50,125,63,1],[126,13,126,51,0],[127,9,127,10,1],[136,9,136,10,1],[138,13,138,14,1],[139,17,139,70,1],[140,17,140,97,1],[141,17,141,87,1],[142,17,142,33,1],[144,9,144,10,1],[147,9,147,10,1],[148,13,148,40,1],[149,9,149,10,1],[152,9,152,10,1],[153,13,153,41,1],[154,9,154,10,1]]);
    </script>
  </body>
</html>