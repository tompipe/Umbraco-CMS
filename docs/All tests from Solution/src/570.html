<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\plugins\tinymce3\JSONWriter.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
/*
 * $Id: JSONWriter.cs 439 2007-11-26 13:26:10Z spocke $
 *
 * Copyright ï¿½ 2007, Moxiecode Systems AB, All rights reserved. 
 */

using System;
using System.Text;
using System.IO;
using System.Collections;

namespace umbraco.presentation.plugins.tinymce3
{
    /// &lt;summary&gt;
	/// 
	/// &lt;/summary&gt;
	public enum JSONLocation {
		/// &lt;summary&gt; &lt;/summary&gt;
		InArray,

		/// &lt;summary&gt; &lt;/summary&gt;
		InObject,

		/// &lt;summary&gt; &lt;/summary&gt;
		Normal
	}

	/// &lt;summary&gt;
	/// Description of JSONWriter.
	/// &lt;/summary&gt;
	public class JSONWriter {
		private TextWriter writer;
		private JSONLocation location;
		private Stack lastLocations;
		private int index, lastIndex;
		private bool isProp = false;

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;writer&quot;&gt;&lt;/param&gt;
		public JSONWriter(TextWriter writer) {
			this.writer = writer;
			this.location = JSONLocation.Normal;
			this.lastLocations = new Stack();
			this.index = 0;
			this.lastIndex = 0;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteStartObject() {
			this.WriteDelim();
			this.writer.Write(&#39;{&#39;);
			this.lastLocations.Push(this.location);
			this.lastIndex = this.index;
			this.location = JSONLocation.InObject;
			this.index = 0;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteEndObject() {
			this.writer.Write(&#39;}&#39;);
			this.location = (JSONLocation) lastLocations.Pop();
			this.index = this.lastIndex;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteStartArray() {
			this.WriteDelim();
			this.writer.Write(&#39;[&#39;);
			this.lastLocations.Push(this.location);
			this.lastIndex = this.index;
			this.location = JSONLocation.InArray;
			this.index = 0;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteEndArray() {
			this.writer.Write(&#39;]&#39;);
			this.location = (JSONLocation) lastLocations.Pop();
			this.index = this.lastIndex;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
		public void WritePropertyName(string name) {
			this.WriteDelim();
			this.isProp = true;
			this.WriteObject(EncodeString(name));
			this.writer.Write(&#39;:&#39;);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;
		public void WriteProperty(string name, object obj) {
			this.WritePropertyName(name);
			this.WriteObject(obj);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;obj&quot;&gt;&lt;/param&gt;
		public void WriteValue(object obj) {
			this.WriteDelim();
			this.WriteObject(obj);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void WriteNull() {
			this.WriteDelim();
			this.writer.Write(&quot;null&quot;);
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		public void Close() {
			this.writer.Close();
		}

		#region private methods

		private void WriteObject(object obj) {
			if (obj == null) {
				this.writer.Write(&quot;null&quot;);
				return;
			}

			if (obj is bool) {
				this.writer.Write(((bool) obj) == true ? &quot;true&quot; : &quot;false&quot;);
				return;
			}

			if (obj is int) {
				this.writer.Write(((int) obj));
				return;
			}

			if (obj is long) {
				this.writer.Write(((long) obj));
				return;
			}

			if (obj is float || obj is double) {
				string str = Convert.ToString(obj);
				this.writer.Write(str.Replace(&#39;,&#39;, &#39;.&#39;));
				return;
			}

			if (obj is string) {
				this.writer.Write(&#39;&quot;&#39;);
				this.writer.Write(EncodeString((string) obj));
				this.writer.Write(&#39;&quot;&#39;);
				return;
			}
		}

		private void WriteDelim() {
			if (this.index &gt; 0 &amp;&amp; !this.isProp)
				this.writer.Write(&#39;,&#39;);

			this.isProp = false;
			this.index++;
		}

		/// &lt;summary&gt;
		/// 
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;str&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static string EncodeString(string str) {
			if (str == null)
				return null;

			StringBuilder strBuilder = new StringBuilder(str.Length);
			char[] chars = str.ToCharArray();

			for (int i=0; i&lt;chars.Length; i++) {
				// Unicode it if needed
				if (chars[i] &gt; 128 || Char.IsControl(chars[i])) {
					strBuilder.Append(&quot;\\u&quot;);
					strBuilder.Append(((int) chars[i]).ToString(&quot;X4&quot;));
					continue;
				}

				switch (chars[i]) {
					case &#39;\&#39;&#39;:
						strBuilder.Append(&quot;\\\&#39;&quot;);
						break;

					case &#39;\&quot;&#39;:
						strBuilder.Append(&quot;\\\&quot;&quot;);
						break;

					case &#39;\\&#39;:
						strBuilder.Append(&quot;\\\\&quot;);
						break;

					default:
						strBuilder.Append(chars[i]);
						break;
				}
			}

			return strBuilder.ToString();
		}

		#endregion
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[36,3,36,31,0],[42,3,42,39,0],[42,40,42,41,0],[43,4,43,25,0],[44,4,44,40,0],[45,4,45,37,0],[46,4,46,19,0],[47,4,47,23,0],[48,3,48,4,0],[53,34,53,35,0],[54,4,54,22,0],[55,4,55,27,0],[56,4,56,43,0],[57,4,57,32,0],[58,4,58,42,0],[59,4,59,19,0],[60,3,60,4,0],[65,32,65,33,0],[66,4,66,27,0],[67,4,67,55,0],[68,4,68,32,0],[69,3,69,4,0],[74,33,74,34,0],[75,4,75,22,0],[76,4,76,27,0],[77,4,77,43,0],[78,4,78,32,0],[79,4,79,41,0],[80,4,80,19,0],[81,3,81,4,0],[86,31,86,32,0],[87,4,87,27,0],[88,4,88,55,0],[89,4,89,32,0],[90,3,90,4,0],[96,46,96,47,0],[97,4,97,22,0],[98,4,98,23,0],[99,4,99,41,0],[100,4,100,27,0],[101,3,101,4,0],[108,54,108,55,0],[109,4,109,33,0],[110,4,110,26,0],[111,3,111,4,0],[117,38,117,39,0],[118,4,118,22,0],[119,4,119,26,0],[120,3,120,4,0],[125,27,125,28,0],[126,4,126,22,0],[127,4,127,30,0],[128,3,128,4,0],[133,23,133,24,0],[134,4,134,24,0],[135,3,135,4,0],[139,40,139,41,0],[140,4,140,20,0],[140,21,140,22,0],[141,5,141,31,0],[142,5,142,12,0],[145,4,145,20,0],[145,21,145,22,0],[146,5,146,64,0],[147,5,147,12,0],[150,4,150,19,0],[150,20,150,21,0],[151,5,151,36,0],[152,5,152,12,0],[155,4,155,20,0],[155,21,155,22,0],[156,5,156,37,0],[157,5,157,12,0],[160,4,160,38,0],[160,39,160,40,0],[161,5,161,40,0],[162,5,162,46,0],[163,5,163,12,0],[166,4,166,22,0],[166,23,166,24,0],[167,5,167,28,0],[168,5,168,51,0],[169,5,169,28,0],[170,5,170,12,0],[172,3,172,4,0],[174,29,174,30,0],[175,4,175,39,0],[176,5,176,28,0],[178,4,178,24,0],[179,4,179,17,0],[180,3,180,4,0],[187,49,187,50,0],[188,4,188,20,0],[189,5,189,17,0],[191,4,191,61,0],[192,4,192,37,0],[194,9,194,16,0],[194,18,194,32,0],[194,34,194,37,0],[194,39,194,40,0],[196,5,196,52,0],[196,53,196,54,0],[197,6,197,31,0],[198,6,198,57,0],[199,6,199,15,0],[202,5,202,22,0],[204,7,204,33,0],[205,7,205,13,0],[208,7,208,33,0],[209,7,209,13,0],[212,7,212,33,0],[213,7,213,13,0],[216,7,216,35,0],[217,7,217,13,0],[219,4,219,5,0],[221,4,221,33,0],[222,3,222,4,0]]);
    </script>
  </body>
</html>