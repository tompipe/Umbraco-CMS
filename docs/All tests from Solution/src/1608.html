<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\PropertyEditors\PropertyEditor.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using Newtonsoft.Json;
using Umbraco.Core.IO;
using Umbraco.Core.Models;

namespace Umbraco.Core.PropertyEditors
{
    /// &lt;summary&gt;
    /// Basic definition of a property editor
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// The Json serialization attributes are required for manifest property editors to work
    /// &lt;/remarks&gt;
    [DebuggerDisplay(&quot;{DebuggerDisplay(),nq}&quot;)]
    public class PropertyEditor : IParameterEditor
    {
        private readonly PropertyEditorAttribute _attribute;

        /// &lt;summary&gt;
        /// The constructor will setup the property editor based on the attribute if one is found
        /// &lt;/summary&gt;
        public PropertyEditor()             
        {
            //defaults
            Icon = Constants.Icons.PropertyEditor;
            Group = &quot;common&quot;;

            //assign properties based on the attribute if it is found
            _attribute = GetType().GetCustomAttribute&lt;PropertyEditorAttribute&gt;(false);
            if (_attribute != null)
            {
                //set the id/name from the attribute
                Alias = _attribute.Alias;
                Name = _attribute.Name;
                IsParameterEditor = _attribute.IsParameterEditor;
                Icon = _attribute.Icon;
                Group = _attribute.Group;
            }
        }

        /// &lt;summary&gt;
        /// These are assigned by default normally based on property editor attributes or manifest definitions,
        /// developers have the chance to override CreateValueEditor if they don&#39;t want to use the pre-defined instance
        /// &lt;/summary&gt;
        internal PropertyValueEditor ManifestDefinedPropertyValueEditor = null;

        /// &lt;summary&gt;
        /// These are assigned by default normally based on property editor attributes or manifest definitions,
        /// developers have the chance to override CreatePreValueEditor if they don&#39;t want to use the pre-defined instance
        /// &lt;/summary&gt;
        internal PreValueEditor ManifestDefinedPreValueEditor = null;

        /// &lt;summary&gt;
        /// Boolean flag determining if this can be used as a parameter editor
        /// &lt;/summary&gt;
        [JsonProperty(&quot;isParameterEditor&quot;)]
        public bool IsParameterEditor { get; internal set; }

        /// &lt;summary&gt;
        /// The id  of the property editor
        /// &lt;/summary&gt;
        [JsonProperty(&quot;alias&quot;, Required = Required.Always)]
        public string Alias { get; internal set; }

        /// &lt;summary&gt;
        /// The name of the property editor
        /// &lt;/summary&gt;
        [JsonProperty(&quot;name&quot;, Required = Required.Always)]
        public string Name { get; internal set; }

        /// &lt;summary&gt;
        /// The icon of the property editor - if not set it uses a default icon
        /// &lt;/summary&gt;
        [JsonProperty(&quot;icon&quot;)]
        public string Icon { get; internal set; }

        /// &lt;summary&gt;
        /// The group of the property editor - if not set the editor will list as a generic editor
        /// &lt;/summary&gt;
        [JsonProperty(&quot;group&quot;)]
        public string Group { get; internal set; }


        [JsonProperty(&quot;editor&quot;, Required = Required.Always)]        
        public PropertyValueEditor ValueEditor
        {
            get { return CreateValueEditor(); }
        }

        [JsonIgnore]
        IValueEditor IParameterEditor.ValueEditor
        {
            get { return ValueEditor; }
        }

        [JsonProperty(&quot;prevalues&quot;)]
        public PreValueEditor PreValueEditor
        {
            get { return CreatePreValueEditor(); }
        }

        [JsonProperty(&quot;defaultConfig&quot;)]
        public virtual IDictionary&lt;string, object&gt; DefaultPreValues { get; set; }

        [JsonIgnore]
        IDictionary&lt;string, object&gt; IParameterEditor.Configuration
        {
            get { return DefaultPreValues; }
        }

        /// &lt;summary&gt;
        /// Creates a value editor instance
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        protected virtual PropertyValueEditor CreateValueEditor()
        {
            if (ManifestDefinedPropertyValueEditor != null)
            {
                //detect if the view is a virtual path (in most cases, yes) then convert it
                if (ManifestDefinedPropertyValueEditor.View.StartsWith(&quot;~/&quot;))
                {
                    ManifestDefinedPropertyValueEditor.View = IOHelper.ResolveUrl(ManifestDefinedPropertyValueEditor.View);
                }
                return ManifestDefinedPropertyValueEditor;
            }

            //create a new editor
            var editor = new PropertyValueEditor();

            if (_attribute.EditorView.IsNullOrWhiteSpace())
            {
                throw new NotImplementedException(&quot;This method must be implemented if a view is not explicitly set&quot;);
            }

            editor.View = _attribute.EditorView.StartsWith(&quot;~/&quot;) ? IOHelper.ResolveUrl(_attribute.EditorView) : _attribute.EditorView;
            editor.ValueType = _attribute.ValueType;
            editor.HideLabel = _attribute.HideLabel;
            return editor;

        }

        /// &lt;summary&gt;
        /// Creates a pre value editor instance
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        protected virtual PreValueEditor CreatePreValueEditor()
        {      
            //This will not be null if it is a manifest defined editor
            if (ManifestDefinedPreValueEditor != null)
            {
                foreach (var f in ManifestDefinedPreValueEditor.Fields)
                {
                    //detect if the view is a virtual path (in most cases, yes) then convert it
                    if (f.View.StartsWith(&quot;~/&quot;))
                    {
                        f.View = IOHelper.ResolveUrl(f.View);
                    }    
                }
                return ManifestDefinedPreValueEditor;
            }

            //There&#39;s no manifest, just return an empty one
            return new PreValueEditor();
        }

        protected bool Equals(PropertyEditor other)
        {
            return string.Equals(Alias, other.Alias);
        }

        public override bool Equals(object obj)
        {
            if (ReferenceEquals(null, obj)) return false;
            if (ReferenceEquals(this, obj)) return true;
            if (obj.GetType() != this.GetType()) return false;
            return Equals((PropertyEditor) obj);
        }

        public override int GetHashCode()
        {
            return Alias.GetHashCode();
        }

        /// &lt;summary&gt;
        /// Provides a summary of the PropertyEditor for use with the &lt;see cref=&quot;DebuggerDisplayAttribute&quot;/&gt;.
        /// &lt;/summary&gt;
        protected virtual string DebuggerDisplay()
        {
            return string.Format(&quot;Name: {0}, Alias: {1}, IsParameterEditor: {2}&quot;, Name, Alias, IsParameterEditor);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[25,9,25,32,1],[26,9,26,10,1],[28,13,28,51,1],[29,13,29,30,1],[32,13,32,87,1],[33,13,33,36,1],[34,13,34,14,1],[36,17,36,42,1],[37,17,37,40,1],[38,17,38,66,1],[39,17,39,40,1],[40,17,40,42,1],[41,13,41,14,1],[42,9,42,10,1],[48,9,48,80,1],[54,9,54,70,1],[60,41,60,45,1],[60,46,60,59,1],[66,31,66,35,1],[66,36,66,49,1],[72,30,72,34,1],[72,35,72,48,1],[78,30,78,34,1],[78,35,78,48,1],[84,31,84,35,1],[84,36,84,49,1],[90,17,90,18,1],[90,19,90,46,1],[90,47,90,48,1],[96,17,96,18,0],[96,19,96,38,0],[96,39,96,40,0],[102,17,102,18,1],[102,19,102,49,1],[102,50,102,51,1],[106,71,106,75,1],[106,76,106,80,1],[111,17,111,18,1],[111,19,111,43,1],[111,44,111,45,1],[119,9,119,10,1],[120,13,120,60,1],[121,13,121,14,1],[123,17,123,78,1],[124,17,124,18,1],[125,21,125,124,1],[126,17,126,18,1],[127,17,127,59,1],[131,13,131,52,1],[133,13,133,60,1],[134,13,134,14,0],[135,17,135,118,0],[138,13,138,135,1],[139,13,139,53,1],[140,13,140,53,1],[141,13,141,27,1],[143,9,143,10,1],[150,9,150,10,1],[152,13,152,55,1],[153,13,153,14,1],[154,17,154,24,1],[154,26,154,31,1],[154,32,154,34,1],[154,35,154,71,1],[155,17,155,18,1],[157,21,157,49,1],[158,21,158,22,1],[159,25,159,62,1],[160,21,160,22,1],[161,17,161,18,1],[162,17,162,54,1],[166,13,166,41,1],[167,9,167,10,1],[170,9,170,10,0],[171,13,171,54,0],[172,9,172,10,0],[175,9,175,10,0],[176,13,176,44,0],[176,45,176,58,0],[177,13,177,44,0],[177,45,177,57,0],[178,13,178,49,0],[178,50,178,63,0],[179,13,179,49,0],[180,9,180,10,0],[183,9,183,10,1],[184,13,184,40,1],[185,9,185,10,1],[191,9,191,10,0],[192,13,192,115,0],[193,9,193,10,0]]);
    </script>
  </body>
</html>