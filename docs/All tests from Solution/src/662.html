<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\developer\Python\editPython.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using System.IO;
using System.Xml;
using System.Xml.Xsl;
using System.Text.RegularExpressions;
using Umbraco.Core.IO;
using umbraco.cms.businesslogic.macro;
using umbraco.cms.presentation.Trees;
using umbraco.cms.helpers;
using umbraco.uicontrols;

namespace umbraco.cms.presentation.developer
{
    public partial class editPython : BasePages.UmbracoEnsuredPage
    {
        public editPython()
        {
            CurrentApp = BusinessLogic.DefaultApps.developer.ToString();

        }

        protected MenuButton SaveButton;

        private readonly List&lt;string&gt; _allowedExtensions = new List&lt;string&gt;();
        protected PlaceHolder buttons;
        protected CodeArea CodeArea1;

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            UmbracoPanel1.hasMenu = true;

            if (!IsPostBack)
            {
                string file = Request.QueryString[&quot;file&quot;];
                string path = DeepLink.GetTreePathFromFilePath(file);
                ClientTools
                    .SetActiveTreeType(TreeDefinitionCollection.Instance.FindTree&lt;loadDLRScripts&gt;().Tree.Alias)
                    .SyncTree(path, false);
            }
        }

        private List&lt;string&gt; validScriptingExtensions()
        {
            if (_allowedExtensions.Count == 0)
            {
                foreach (MacroEngineLanguage lang in MacroEngineFactory.GetSupportedUILanguages())
                {
                    if (!_allowedExtensions.Contains(lang.Extension))
                        _allowedExtensions.Add(lang.Extension);
                }
            }

            return _allowedExtensions;
        }

        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);

            SaveButton = UmbracoPanel1.Menu.NewButton();
           
            SaveButton.ToolTip = &quot;Save scripting File&quot;;
            SaveButton.Text = ui.Text(&quot;save&quot;);
            SaveButton.OnClientClick = &quot;return false;&quot;;
            SaveButton.ID = &quot;save&quot;;
            SaveButton.ButtonType = MenuButtonType.Primary;


            var code = UmbracoPanel1.NewTabPage(&quot;code&quot;);
            code.Controls.Add(Pane1);

            var props = UmbracoPanel1.NewTabPage(&quot;properties&quot;);
            props.Controls.Add(Pane2);


            // Add source and filename
            String file = IOHelper.MapPath(SystemDirectories.MacroScripts + &quot;/&quot; + Request.QueryString[&quot;file&quot;]);

            // validate file
            IOHelper.ValidateEditPath(file, SystemDirectories.MacroScripts);
            // validate extension
            IOHelper.ValidateFileExtension(file, validScriptingExtensions());

            pythonFileName.Text = file.Replace(IOHelper.MapPath(SystemDirectories.MacroScripts), &quot;&quot;).Substring(1).Replace(@&quot;\&quot;, &quot;/&quot;);

            StreamReader SR;
            string S;
            SR = File.OpenText(file);
            S = SR.ReadToEnd();
            SR.Close();
            pythonSource.Text = S;
        }

        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);

            ScriptManager.GetCurrent(Page).Services.Add(new ServiceReference(IOHelper.ResolveUrl(SystemDirectories.WebServices) + &quot;/codeEditorSave.asmx&quot;));
            ScriptManager.GetCurrent(Page).Services.Add(new ServiceReference(IOHelper.ResolveUrl(SystemDirectories.WebServices) + &quot;/legacyAjaxCalls.asmx&quot;));
        }

        /// &lt;summary&gt;
        /// UmbracoPanel1 control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.TabView UmbracoPanel1;

        /// &lt;summary&gt;
        /// Pane1 control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.Pane Pane1;
        protected global::umbraco.uicontrols.Pane Pane2;

        /// &lt;summary&gt;
        /// pp_filename control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.PropertyPanel pp_filename;

        /// &lt;summary&gt;
        /// pythonFileName control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.TextBox pythonFileName;

        /// &lt;summary&gt;
        /// pp_testing control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.PropertyPanel pp_testing;

        /// &lt;summary&gt;
        /// SkipTesting control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.CheckBox SkipTesting;

        /// &lt;summary&gt;
        /// pp_errorMsg control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.PropertyPanel pp_errorMsg;

        /// &lt;summary&gt;
        /// pythonSource control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::umbraco.uicontrols.CodeArea pythonSource;
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,28,0],[27,9,27,10,0],[28,13,28,73,0],[30,9,30,10,0],[34,9,34,79,0],[39,9,39,10,0],[40,13,40,28,0],[42,13,42,42,0],[44,13,44,29,0],[45,13,45,14,0],[46,17,46,59,0],[47,17,47,70,0],[48,17,50,44,0],[51,13,51,14,0],[52,9,52,10,0],[55,9,55,10,0],[56,13,56,47,0],[57,13,57,14,0],[58,17,58,24,0],[58,26,58,50,0],[58,51,58,53,0],[58,54,58,98,0],[59,17,59,18,0],[60,21,60,70,0],[61,25,61,64,0],[62,17,62,18,0],[63,13,63,14,0],[65,13,65,39,0],[66,9,66,10,0],[69,9,69,10,0],[70,13,70,28,0],[72,13,72,57,0],[74,13,74,56,0],[75,13,75,47,0],[76,13,76,56,0],[77,13,77,36,0],[78,13,78,60,0],[81,13,81,57,0],[82,13,82,38,0],[84,13,84,64,0],[85,13,85,39,0],[89,13,89,112,0],[92,13,92,77,0],[94,13,94,78,0],[96,13,96,134,0],[100,13,100,38,0],[101,13,101,32,0],[102,13,102,24,0],[103,13,103,35,0],[104,9,104,10,0],[107,9,107,10,0],[108,13,108,33,0],[110,13,110,156,0],[111,13,111,157,0],[112,9,112,10,0]]);
    </script>
  </body>
</html>