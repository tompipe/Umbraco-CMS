<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Trees\FileSystemTreeController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Umbraco.Core.IO;
using Umbraco.Web.Models.Trees;

namespace Umbraco.Web.Trees
{
    public abstract class FileSystemTreeController : TreeController
    {
        protected abstract string FilePath { get; }
        protected abstract string FileSearchPattern { get; }

        /// &lt;summary&gt;
        /// Inheritors can override this method to modify the file node that is created.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;xNode&quot;&gt;&lt;/param&gt;
        protected virtual void OnRenderFileNode(ref TreeNode treeNode) { }

        /// &lt;summary&gt;
        /// Inheritors can override this method to modify the folder node that is created.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;xNode&quot;&gt;&lt;/param&gt;
        protected virtual void OnRenderFolderNode(ref TreeNode treeNode) { }

        protected override Models.Trees.TreeNodeCollection GetTreeNodes(string id, System.Net.Http.Formatting.FormDataCollection queryStrings)
        {
            string orgPath = &quot;&quot;;
            string path = &quot;&quot;;
            if (!string.IsNullOrEmpty(id) &amp;&amp; id != &quot;-1&quot;)
            {
                orgPath = id;
                path = IOHelper.MapPath(FilePath + &quot;/&quot; + orgPath);
                orgPath += &quot;/&quot;;
            }
            else
            {
                path = IOHelper.MapPath(FilePath);
            }

            DirectoryInfo dirInfo = new DirectoryInfo(path);
            DirectoryInfo[] dirInfos = dirInfo.GetDirectories();

            var nodes = new TreeNodeCollection();
            foreach (DirectoryInfo dir in dirInfos)
            {
                if ((dir.Attributes &amp; FileAttributes.Hidden) == 0)
                {
                    var HasChildren = dir.GetFiles().Length &gt; 0 || dir.GetDirectories().Length &gt; 0;
                    var node = CreateTreeNode(orgPath + dir.Name, orgPath, queryStrings, dir.Name, &quot;icon-folder&quot;, HasChildren);

                    OnRenderFolderNode(ref node);
                    if(node != null)
                        nodes.Add(node);
                }
            }

            //this is a hack to enable file system tree to support multiple file extension look-up
            //so the pattern both support *.* *.xml and xml,js,vb for lookups
            string[] allowedExtensions = new string[0];
            bool filterByMultipleExtensions = FileSearchPattern.Contains(&quot;,&quot;);
            FileInfo[] fileInfo;

            if (filterByMultipleExtensions)
            {
                fileInfo = dirInfo.GetFiles();
                allowedExtensions = FileSearchPattern.ToLower().Split(&#39;,&#39;);
            }
            else
                fileInfo = dirInfo.GetFiles(FileSearchPattern);

            foreach (FileInfo file in fileInfo)
            {
                if ((file.Attributes &amp; FileAttributes.Hidden) == 0)
                {
                    if (filterByMultipleExtensions &amp;&amp; Array.IndexOf&lt;string&gt;(allowedExtensions, file.Extension.ToLower().Trim(&#39;.&#39;)) &lt; 0)
                        continue;

                    var node = CreateTreeNode(orgPath + file.Name, orgPath, queryStrings, file.Name, &quot;icon-file&quot;, false);

                    OnRenderFileNode(ref node);

                    if(node != null)
                        nodes.Add(node);
                }
            }

            return nodes;
        }    
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,72,21,73,0],[21,74,21,75,0],[27,74,27,75,0],[27,76,27,77,0],[30,9,30,10,0],[31,13,31,33,0],[32,13,32,30,0],[33,13,33,57,0],[34,13,34,14,0],[35,17,35,30,0],[36,17,36,67,0],[37,17,37,32,0],[38,13,38,14,0],[40,13,40,14,0],[41,17,41,51,0],[42,13,42,14,0],[44,13,44,61,0],[45,13,45,65,0],[47,13,47,50,0],[48,13,48,20,0],[48,22,48,39,0],[48,40,48,42,0],[48,43,48,51,0],[49,13,49,14,0],[50,17,50,67,0],[51,17,51,18,0],[52,21,52,100,0],[53,21,53,128,0],[55,21,55,50,0],[56,21,56,37,0],[57,25,57,41,0],[58,17,58,18,0],[59,13,59,14,0],[63,13,63,56,0],[64,13,64,79,0],[67,13,67,44,0],[68,13,68,14,0],[69,17,69,47,0],[70,17,70,76,0],[71,13,71,14,0],[73,17,73,64,0],[75,13,75,20,0],[75,22,75,35,0],[75,36,75,38,0],[75,39,75,47,0],[76,13,76,14,0],[77,17,77,68,0],[78,17,78,18,0],[79,21,79,136,0],[80,25,80,34,0],[82,21,82,122,0],[84,21,84,48,0],[86,21,86,37,0],[87,25,87,41,0],[88,17,88,18,0],[89,13,89,14,0],[91,13,91,26,0],[92,9,92,10,0]]);
    </script>
  </body>
</html>