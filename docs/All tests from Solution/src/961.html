<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Routing\ContentFinderByNiceUrl.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core;

namespace Umbraco.Web.Routing
{
	/// &lt;summary&gt;
	/// Provides an implementation of &lt;see cref=&quot;IContentFinder&quot;/&gt; that handles page nice urls.
	/// &lt;/summary&gt;
	/// &lt;remarks&gt;
	/// &lt;para&gt;Handles &lt;c&gt;/foo/bar&lt;/c&gt; where &lt;c&gt;/foo/bar&lt;/c&gt; is the nice url of a document.&lt;/para&gt;
	/// &lt;/remarks&gt;
    public class ContentFinderByNiceUrl : IContentFinder
    {
	    /// &lt;summary&gt;
		/// Tries to find and assign an Umbraco document to a &lt;c&gt;PublishedContentRequest&lt;/c&gt;.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;docRequest&quot;&gt;The &lt;c&gt;PublishedContentRequest&lt;/c&gt;.&lt;/param&gt;		
		/// &lt;returns&gt;A value indicating whether an Umbraco document was found and assigned.&lt;/returns&gt;
		public virtual bool TryFindContent(PublishedContentRequest docRequest)
        {
			string route;
			if (docRequest.HasDomain)
				route = docRequest.Domain.RootNodeId.ToString() + DomainHelper.PathRelativeToDomain(docRequest.DomainUri, docRequest.Uri.GetAbsolutePathDecoded());
			else
				route = docRequest.Uri.GetAbsolutePathDecoded();

			var node = FindContent(docRequest, route);
            return node != null;
        }

		/// &lt;summary&gt;
		/// Tries to find an Umbraco document for a &lt;c&gt;PublishedContentRequest&lt;/c&gt; and a route.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;docreq&quot;&gt;The document request.&lt;/param&gt;
		/// &lt;param name=&quot;route&quot;&gt;The route.&lt;/param&gt;
		/// &lt;returns&gt;The document node, or null.&lt;/returns&gt;
        protected IPublishedContent FindContent(PublishedContentRequest docreq, string route)
        {
			LogHelper.Debug&lt;ContentFinderByNiceUrl&gt;(&quot;Test route \&quot;{0}\&quot;&quot;, () =&gt; route);

		    var node = docreq.RoutingContext.UmbracoContext.ContentCache.GetByRoute(route);
            if (node != null)
            {
                docreq.PublishedContent = node;
                LogHelper.Debug&lt;ContentFinderByNiceUrl&gt;(&quot;Got content, id={0}&quot;, () =&gt; node.Id);
            }
            else
            {
                LogHelper.Debug&lt;ContentFinderByNiceUrl&gt;(&quot;No match.&quot;);
            }

		    return node;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,10,1],[23,4,23,29,1],[24,5,24,152,1],[26,5,26,53,1],[28,4,28,46,1],[29,13,29,33,1],[30,9,30,10,1],[39,9,39,10,1],[40,4,40,72,1],[40,72,40,77,0],[40,77,40,79,1],[40,4,40,79,1],[42,7,42,86,1],[43,13,43,30,1],[44,13,44,14,1],[45,17,45,48,1],[46,17,46,86,1],[46,86,46,93,0],[46,93,46,95,1],[46,17,46,95,1],[47,13,47,14,1],[49,13,49,14,1],[50,17,50,70,1],[51,13,51,14,1],[53,7,53,19,1],[54,9,54,10,1]]);
    </script>
  </body>
</html>