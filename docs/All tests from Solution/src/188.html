<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Resolvers\ActionsResolverTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Linq;
using Moq;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Logging;
using Umbraco.Core.ObjectResolution;
using Umbraco.Core.Profiling;
using Umbraco.Tests.TestHelpers;
using umbraco.BasePages;
using umbraco.interfaces;

namespace Umbraco.Tests.Resolvers
{
    [TestFixture]
    public class ActionsResolverTests : ResolverBaseTest
    {
        
		[TearDown]
		public void TearDown()
		{
            ActionsResolver.Reset();
		}

        // NOTE
        // ManyResolverTests ensure that we&#39;ll get our actions back and ActionsResolver works,
        // so all we&#39;re testing here is that plugin manager _does_ find our actions
        // which should be ensured by PlugingManagerTests anyway, so this is useless?
        // maybe not as it seems to handle the &quot;instance&quot; thing... so we test that we respect the singleton?
        [Test]
		public void FindAllActions()
		{
            ActionsResolver.Current = new ActionsResolver(
                new ActivatorServiceProvider(), ProfilingLogger.Logger,
                () =&gt; PluginManager.ResolveActions());

            Resolution.Freeze();

            var actions = ActionsResolver.Current.Actions;
			Assert.AreEqual(2, actions.Count());

            // order is unspecified, but both must be there
            bool hasAction1 = actions.ElementAt(0) is SingletonAction || actions.ElementAt(1) is SingletonAction;
            bool hasAction2 = actions.ElementAt(0) is NonSingletonAction || actions.ElementAt(1) is NonSingletonAction;
            Assert.IsTrue(hasAction1);
            Assert.IsTrue(hasAction2);

            SingletonAction action = (SingletonAction)(actions.ElementAt(0) is SingletonAction ? actions.ElementAt(0) : actions.ElementAt(1));

            // ensure we respect the singleton
            Assert.AreSame(SingletonAction.Instance, action);
        }		

		#region Classes for tests

		public class SingletonAction : IAction
		{
			//create singleton
			private static readonly SingletonAction instance = new SingletonAction();
			
			public static SingletonAction Instance
			{
				get { return instance; }
			}

			#region IAction Members

			public char Letter
			{
				get
				{
					return &#39;I&#39;;
				}
			}

			public string JsFunctionName
			{
				get
				{
					return string.Format(&quot;{0}.actionAssignDomain()&quot;, ClientTools.Scripts.GetAppActions);
				}
			}

			public string JsSource
			{
				get
				{
					return null;
				}
			}

			public string Alias
			{
				get
				{
					return &quot;assignDomain&quot;;
				}
			}

			public string Icon
			{
				get
				{
					return &quot;.sprDomain&quot;;
				}
			}

			public bool ShowInNotifier
			{
				get
				{
					return false;
				}
			}
			public bool CanBePermissionAssigned
			{
				get
				{
					return true;
				}
			}
			#endregion
		}

		public class NonSingletonAction : IAction
		{
			#region IAction Members

			public char Letter
			{
				get
				{
					return &#39;Q&#39;;
				}
			}

			public string JsFunctionName
			{
				get
				{
					return string.Format(&quot;{0}.actionAssignDomain()&quot;, ClientTools.Scripts.GetAppActions);
				}
			}

			public string JsSource
			{
				get
				{
					return null;
				}
			}

			public string Alias
			{
				get
				{
					return &quot;asfasdf&quot;;
				}
			}

			public string Icon
			{
				get
				{
					return &quot;.sprDomain&quot;;
				}
			}

			public bool ShowInNotifier
			{
				get
				{
					return false;
				}
			}
			public bool CanBePermissionAssigned
			{
				get
				{
					return true;
				}
			}
			#endregion
		}
		
		#endregion
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,3,21,4,1],[22,13,22,37,1],[23,3,23,4,1],[32,3,32,4,1],[33,13,35,23,1],[35,23,35,53,1],[35,53,35,55,1],[33,13,35,55,1],[37,13,37,33,1],[39,13,39,59,1],[40,4,40,40,1],[43,13,43,114,1],[44,13,44,120,1],[45,13,45,39,1],[46,13,46,39,1],[48,13,48,143,1],[51,13,51,62,1],[52,9,52,10,1],[59,4,59,77,1],[63,9,63,10,1],[63,11,63,27,1],[63,28,63,29,1],[71,5,71,6,0],[72,6,72,17,0],[73,5,73,6,0],[79,5,79,6,0],[80,6,80,90,0],[81,5,81,6,0],[87,5,87,6,0],[88,6,88,18,0],[89,5,89,6,0],[95,5,95,6,0],[96,6,96,28,0],[97,5,97,6,0],[103,5,103,6,0],[104,6,104,26,0],[105,5,105,6,0],[111,5,111,6,0],[112,6,112,19,0],[113,5,113,6,0],[118,5,118,6,0],[119,6,119,18,0],[120,5,120,6,0],[132,5,132,6,0],[133,6,133,17,0],[134,5,134,6,0],[140,5,140,6,0],[141,6,141,90,0],[142,5,142,6,0],[148,5,148,6,0],[149,6,149,18,0],[150,5,150,6,0],[156,5,156,6,0],[157,6,157,23,0],[158,5,158,6,0],[164,5,164,6,0],[165,6,165,26,0],[166,5,166,6,0],[172,5,172,6,0],[173,6,173,19,0],[174,5,174,6,0],[179,5,179,6,0],[180,6,180,18,0],[181,5,181,6,0]]);
    </script>
  </body>
</html>