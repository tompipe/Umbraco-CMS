<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Cache\DistributedCache.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.ComponentModel;
using System.Linq;
using Umbraco.Core;
using Umbraco.Core.Sync;
using umbraco.interfaces;

namespace Umbraco.Web.Cache
{
    /// &lt;summary&gt;
    /// Represents the entry point into Umbraco&#39;s distributed cache infrastructure.
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// &lt;para&gt;
    /// The distributed cache infrastructure ensures that distributed caches are
    /// invalidated properly in load balancing environments.
    /// &lt;/para&gt;
    /// &lt;para&gt;
    /// Distribute caches include static (in-memory) cache, runtime cache, front-end content cache, Examine/Lucene indexes
    /// &lt;/para&gt;
    /// &lt;/remarks&gt;
    public sealed class DistributedCache
    {
        #region Public constants/Ids

        public const string ApplicationTreeCacheRefresherId = &quot;0AC6C028-9860-4EA4-958D-14D39F45886E&quot;;
        public const string ApplicationCacheRefresherId = &quot;B15F34A1-BC1D-4F8B-8369-3222728AB4C8&quot;;
        public const string TemplateRefresherId = &quot;DD12B6A0-14B9-46e8-8800-C154F74047C8&quot;;
        public const string PageCacheRefresherId = &quot;27AB3022-3DFA-47b6-9119-5945BC88FD66&quot;;
        public const string UnpublishedPageCacheRefresherId = &quot;55698352-DFC5-4DBE-96BD-A4A0F6F77145&quot;;
        public const string MemberCacheRefresherId = &quot;E285DF34-ACDC-4226-AE32-C0CB5CF388DA&quot;;
        public const string MemberGroupCacheRefresherId = &quot;187F236B-BD21-4C85-8A7C-29FBA3D6C00C&quot;;
        public const string MediaCacheRefresherId = &quot;B29286DD-2D40-4DDB-B325-681226589FEC&quot;;
        public const string MacroCacheRefresherId = &quot;7B1E683C-5F34-43dd-803D-9699EA1E98CA&quot;;
        public const string UserCacheRefresherId = &quot;E057AF6D-2EE6-41F4-8045-3694010F0AA6&quot;;
        public const string UserPermissionsCacheRefresherId = &quot;840AB9C5-5C0B-48DB-A77E-29FE4B80CD3A&quot;;
        public const string UserTypeCacheRefresherId = &quot;7E707E21-0195-4522-9A3C-658CC1761BD4&quot;;
        public const string ContentTypeCacheRefresherId = &quot;6902E22C-9C10-483C-91F3-66B7CAE9E2F5&quot;;
        public const string LanguageCacheRefresherId = &quot;3E0F95D8-0BE5-44B8-8394-2B8750B62654&quot;;
        public const string DomainCacheRefresherId = &quot;11290A79-4B57-4C99-AD72-7748A3CF38AF&quot;;
        public const string RelationTypeCacheRefresherId = &quot;D8375ABA-4FB3-4F86-B505-92FBA1B6F7C9&quot;;

        [Obsolete(&quot;This is no longer used and will be removed in future versions&quot;)]
        [EditorBrowsable(EditorBrowsableState.Never)]
        public const string StylesheetCacheRefresherId = &quot;E0633648-0DEB-44AE-9A48-75C3A55CB670&quot;;
        public const string StylesheetPropertyCacheRefresherId = &quot;2BC7A3A4-6EB1-4FBC-BAA3-C9E7B6D36D38&quot;;
        public const string DataTypeCacheRefresherId = &quot;35B16C25-A17E-45D7-BC8F-EDAB1DCC28D2&quot;;
        public const string DictionaryCacheRefresherId = &quot;D1D7E227-F817-4816-BFE9-6C39B6152884&quot;;
        public const string PublicAccessCacheRefresherId = &quot;1DB08769-B104-4F8B-850E-169CAC1DF2EC&quot;;

        public static readonly Guid ApplicationTreeCacheRefresherGuid = new Guid(ApplicationTreeCacheRefresherId);
        public static readonly Guid ApplicationCacheRefresherGuid = new Guid(ApplicationCacheRefresherId);
        public static readonly Guid TemplateRefresherGuid = new Guid(TemplateRefresherId);
        public static readonly Guid PageCacheRefresherGuid = new Guid(PageCacheRefresherId);
        public static readonly Guid UnpublishedPageCacheRefresherGuid = new Guid(UnpublishedPageCacheRefresherId);
        public static readonly Guid MemberCacheRefresherGuid = new Guid(MemberCacheRefresherId);
        public static readonly Guid MemberGroupCacheRefresherGuid = new Guid(MemberGroupCacheRefresherId);
        public static readonly Guid MediaCacheRefresherGuid = new Guid(MediaCacheRefresherId);
        public static readonly Guid MacroCacheRefresherGuid = new Guid(MacroCacheRefresherId);
        public static readonly Guid UserCacheRefresherGuid = new Guid(UserCacheRefresherId);
        public static readonly Guid UserPermissionsCacheRefresherGuid = new Guid(UserPermissionsCacheRefresherId);
        public static readonly Guid UserTypeCacheRefresherGuid = new Guid(UserTypeCacheRefresherId);
        public static readonly Guid ContentTypeCacheRefresherGuid = new Guid(ContentTypeCacheRefresherId);
        public static readonly Guid LanguageCacheRefresherGuid = new Guid(LanguageCacheRefresherId);
        public static readonly Guid DomainCacheRefresherGuid = new Guid(DomainCacheRefresherId);
        public static readonly Guid StylesheetCacheRefresherGuid = new Guid(StylesheetCacheRefresherId);
        public static readonly Guid StylesheetPropertyCacheRefresherGuid = new Guid(StylesheetPropertyCacheRefresherId);
        public static readonly Guid DataTypeCacheRefresherGuid = new Guid(DataTypeCacheRefresherId);
        public static readonly Guid DictionaryCacheRefresherGuid = new Guid(DictionaryCacheRefresherId);
        public static readonly Guid PublicAccessCacheRefresherGuid = new Guid(PublicAccessCacheRefresherId);
        public static readonly Guid RelationTypeCacheRefresherGuid = new Guid(RelationTypeCacheRefresherId);

        #endregion

        #region Constructor &amp; Singleton

        // note - should inject into the application instead of using a singleton
        private static readonly DistributedCache InstanceObject = new DistributedCache();

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;DistributedCache&quot;/&gt; class.
        /// &lt;/summary&gt;
        private DistributedCache()
        { }
        
        /// &lt;summary&gt;
        /// Gets the static unique instance of the &lt;see cref=&quot;DistributedCache&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;The static unique instance of the &lt;see cref=&quot;DistributedCache&quot;/&gt; class.&lt;/returns&gt;
        /// &lt;remarks&gt;Exists so that extension methods can be added to the distributed cache.&lt;/remarks&gt;
        public static DistributedCache Instance
        {
            get
            {
                return InstanceObject;    
            }
        }

        #endregion

        #region Core notification methods

        /// &lt;summary&gt;
        /// Notifies the distributed cache of specifieds item invalidation, for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;The type of the invalidated items.&lt;/typeparam&gt;
        /// &lt;param name=&quot;factoryGuid&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        /// &lt;param name=&quot;getNumericId&quot;&gt;A function returning the unique identifier of items.&lt;/param&gt;
        /// &lt;param name=&quot;instances&quot;&gt;The invalidated items.&lt;/param&gt;
        /// &lt;remarks&gt;
        /// This method is much better for performance because it does not need to re-lookup object instances.
        /// &lt;/remarks&gt;
        public void Refresh&lt;T&gt;(Guid factoryGuid, Func&lt;T, int&gt; getNumericId, params T[] instances)
        {
            if (factoryGuid == Guid.Empty || instances.Length == 0 || getNumericId == null) return;

            ServerMessengerResolver.Current.Messenger.PerformRefresh(
                ServerRegistrarResolver.Current.Registrar.Registrations,
                GetRefresherById(factoryGuid),
                getNumericId,
                instances);
        }

        /// &lt;summary&gt;
        /// Notifies the distributed cache of a specified item invalidation, for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryGuid&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;The unique identifier of the invalidated item.&lt;/param&gt;
        public void Refresh(Guid factoryGuid, int id)
        {
            if (factoryGuid == Guid.Empty || id == default(int)) return;

            ServerMessengerResolver.Current.Messenger.PerformRefresh(
                ServerRegistrarResolver.Current.Registrar.Registrations, 
                GetRefresherById(factoryGuid), 
                id);
        }

        /// &lt;summary&gt;
        /// Notifies the distributed cache of a specified item invalidation, for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryGuid&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;The unique identifier of the invalidated item.&lt;/param&gt;
        public void Refresh(Guid factoryGuid, Guid id)
        {
            if (factoryGuid == Guid.Empty || id == Guid.Empty) return;

            ServerMessengerResolver.Current.Messenger.PerformRefresh(
                ServerRegistrarResolver.Current.Registrar.Registrations,
                GetRefresherById(factoryGuid),
                id);
        }

        public void RefreshByPayload(Guid factoryGuid, object payload)
        {
            if (factoryGuid == Guid.Empty || payload == null) return;

            ServerMessengerResolver.Current.Messenger.PerformRefresh(
                ServerRegistrarResolver.Current.Registrar.Registrations,
                GetRefresherById(factoryGuid),
                payload);
        }

        /// &lt;summary&gt;
        /// Notifies the distributed cache, for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryGuid&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        /// &lt;param name=&quot;jsonPayload&quot;&gt;The notification content.&lt;/param&gt;
        public void RefreshByJson(Guid factoryGuid, string jsonPayload)
        {
            if (factoryGuid == Guid.Empty || jsonPayload.IsNullOrWhiteSpace()) return;

            ServerMessengerResolver.Current.Messenger.PerformRefresh(
                ServerRegistrarResolver.Current.Registrar.Registrations,
                GetRefresherById(factoryGuid),
                jsonPayload);
        }

        ///// &lt;summary&gt;
        ///// Notifies the distributed cache, for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        ///// &lt;/summary&gt;
        ///// &lt;param name=&quot;refresherId&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        ///// &lt;param name=&quot;payload&quot;&gt;The notification content.&lt;/param&gt;
        //internal void Notify(Guid refresherId, object payload)
        //{
        //    if (refresherId == Guid.Empty || payload == null) return;

        //    ServerMessengerResolver.Current.Messenger.Notify(
        //        ServerRegistrarResolver.Current.Registrar.Registrations,
        //        GetRefresherById(refresherId),
        //        json);
        //}

        /// &lt;summary&gt;
        /// Notifies the distributed cache of a global invalidation for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryGuid&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        public void RefreshAll(Guid factoryGuid)
        {
            if (factoryGuid == Guid.Empty) return;

            ServerMessengerResolver.Current.Messenger.PerformRefreshAll(
                ServerRegistrarResolver.Current.Registrar.Registrations,
                GetRefresherById(factoryGuid));
        }

        [EditorBrowsable(EditorBrowsableState.Never)]
        [Obsolete(&quot;This method is no longer in use and does not work as advertised, the allServers parameter doesnt have any affect for database server messengers, do not use!&quot;)]
        public void RefreshAll(Guid factoryGuid, bool allServers)
        {
            if (factoryGuid == Guid.Empty) return;
            if (allServers)
            {
                RefreshAll(factoryGuid);
            }
            else
            {
                ServerMessengerResolver.Current.Messenger.PerformRefreshAll(
                    Enumerable.Empty&lt;IServerAddress&gt;(),
                    GetRefresherById(factoryGuid));
            }
        }

        /// &lt;summary&gt;
        /// Notifies the distributed cache of a specified item removal, for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryGuid&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;The unique identifier of the removed item.&lt;/param&gt;
        public void Remove(Guid factoryGuid, int id)
        {
            if (factoryGuid == Guid.Empty || id == default(int)) return;

            ServerMessengerResolver.Current.Messenger.PerformRemove(
                ServerRegistrarResolver.Current.Registrar.Registrations,
                GetRefresherById(factoryGuid),
                id);
        }

        /// &lt;summary&gt;
        /// Notifies the distributed cache of specifieds item removal, for a specified &lt;see cref=&quot;ICacheRefresher&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;The type of the removed items.&lt;/typeparam&gt;
        /// &lt;param name=&quot;factoryGuid&quot;&gt;The unique identifier of the ICacheRefresher.&lt;/param&gt;
        /// &lt;param name=&quot;getNumericId&quot;&gt;A function returning the unique identifier of items.&lt;/param&gt;
        /// &lt;param name=&quot;instances&quot;&gt;The removed items.&lt;/param&gt;
        /// &lt;remarks&gt;
        /// This method is much better for performance because it does not need to re-lookup object instances.
        /// &lt;/remarks&gt;
        public void Remove&lt;T&gt;(Guid factoryGuid, Func&lt;T, int&gt; getNumericId, params T[] instances)
        {
            ServerMessengerResolver.Current.Messenger.PerformRemove(
                ServerRegistrarResolver.Current.Registrar.Registrations,
                GetRefresherById(factoryGuid),
                getNumericId,
                instances);
        }

        #endregion

        // helper method to get an ICacheRefresher by its unique identifier
        private static ICacheRefresher GetRefresherById(Guid uniqueIdentifier)
        {
            return CacheRefreshersResolver.Current.GetById(uniqueIdentifier);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[51,9,51,115,1],[52,9,52,107,1],[53,9,53,91,1],[54,9,54,93,1],[55,9,55,115,1],[56,9,56,97,1],[57,9,57,107,1],[58,9,58,95,1],[59,9,59,95,1],[60,9,60,93,1],[61,9,61,115,1],[62,9,62,101,1],[63,9,63,107,1],[64,9,64,101,1],[65,9,65,97,1],[66,9,66,105,1],[67,9,67,121,1],[68,9,68,101,1],[69,9,69,105,1],[70,9,70,109,1],[71,9,71,109,1],[78,9,78,90,1],[83,9,83,35,1],[84,9,84,10,1],[84,11,84,12,1],[94,13,94,14,1],[95,17,95,39,1],[96,13,96,14,1],[114,9,114,10,1],[115,13,115,92,1],[115,93,115,100,0],[117,13,121,28,1],[122,9,122,10,1],[130,9,130,10,1],[131,13,131,65,1],[131,66,131,73,0],[133,13,136,21,1],[137,9,137,10,1],[145,9,145,10,1],[146,13,146,63,1],[146,64,146,71,0],[148,13,151,21,1],[152,9,152,10,1],[155,9,155,10,0],[156,13,156,62,0],[156,63,156,70,0],[158,13,161,26,0],[162,9,162,10,0],[170,9,170,10,0],[171,13,171,79,0],[171,80,171,87,0],[173,13,176,30,0],[177,9,177,10,0],[199,9,199,10,1],[200,13,200,43,1],[200,44,200,51,0],[202,13,204,48,1],[205,9,205,10,1],[210,9,210,10,0],[211,13,211,43,0],[211,44,211,51,0],[212,13,212,28,0],[213,13,213,14,0],[214,17,214,41,0],[215,13,215,14,0],[217,13,217,14,0],[218,17,220,52,0],[221,13,221,14,0],[222,9,222,10,0],[230,9,230,10,1],[231,13,231,65,1],[231,66,231,73,0],[233,13,236,21,1],[237,9,237,10,1],[250,9,250,10,0],[251,13,255,28,0],[256,9,256,10,0],[262,9,262,10,1],[263,13,263,78,1],[264,9,264,10,1]]);
    </script>
  </body>
</html>