<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.controls\TreeUrlGenerator.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace umbraco.uicontrols
{
    /// &lt;summary&gt;
    /// This class will generate the URLs for iframe tree pages. 
    /// Generally used to get the a tree picker url.    
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// This was created in 4.1 so that this helper class can be exposed to other assemblies since
    /// it only existed in the presentation assembly in previous versions
    /// &lt;/remarks&gt;
    public class TreeUrlGenerator
    {

		public const string TREE_URL = &quot;tree.aspx&quot;;
		public const string INIT_URL = &quot;treeinit.aspx&quot;;
		public const string PICKER_URL = &quot;treepicker.aspx&quot;;

		private int? m_startNodeID;
		private string m_treeType;
		private bool? m_showContextMenu;
		private bool? m_isDialog;
		private string m_app;
		private string m_nodeKey;
		private string m_functionToCall;

		#region Public Properties

		public string FunctionToCall
		{
			get { return m_functionToCall; }
			set { m_functionToCall = value; }
		}

		public string NodeKey
		{
			get { return m_nodeKey; }
			set { m_nodeKey = value; }
		}

		public int StartNodeID
		{
			get { return m_startNodeID ?? -1; }
			set { m_startNodeID = value; }
		}

		public string TreeType
		{
			get { return m_treeType; }
			set { m_treeType = value; }
		}

		public bool ShowContextMenu
		{
			get { return m_showContextMenu ?? true; }
			set { m_showContextMenu = value; }
		}

		public bool IsDialog
		{
			get { return m_isDialog ?? false; }
			set { m_isDialog = value; }
		}		

		public string App
		{
			get { return m_app; }
			set { m_app = value; }
		}
		#endregion

		/// &lt;summary&gt;
		/// Returns the url for servicing the xml tree request based on the parameters specified on this class.
		/// &lt;/summary&gt;
		/// &lt;returns&gt;Tree service url as a string&lt;/returns&gt;
		public string GetServiceUrl()
		{
            return Umbraco.Core.IO.IOHelper.ResolveUrl(Umbraco.Core.IO.SystemDirectories.Umbraco) + &quot;/&quot; + GetUrl(TREE_URL);
		}

		/// &lt;summary&gt;
		/// Static method to return the tree service url with the specified parameters
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;startNodeID&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;treeType&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;showContextMenu&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;isDialog&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;app&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;nodeKey&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;functionToCall&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static string GetServiceUrl(int? startNodeID, string treeType, bool? showContextMenu,
			bool? isDialog, string app, string nodeKey, string functionToCall)
		{
            TreeUrlGenerator treeSvc = new TreeUrlGenerator()
            {
                StartNodeID = startNodeID ?? -1,
                TreeType = treeType,
                ShowContextMenu = showContextMenu ?? true,
                IsDialog = isDialog ?? false,
                App = app,
                NodeKey = nodeKey,
                FunctionToCall = functionToCall
            };
			return treeSvc.GetServiceUrl();
		}

		/// &lt;summary&gt;
		/// Returns the url for initializing the tree based on the parameters specified on this class
		/// &lt;/summary&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public string GetInitUrl()
		{
            return Umbraco.Core.IO.IOHelper.ResolveUrl(Umbraco.Core.IO.SystemDirectories.Umbraco) + &quot;/&quot; + GetUrl(INIT_URL);
		}

		/// &lt;summary&gt;
		/// static method to return the tree init url with the specified parameters
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;startNodeID&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;treeType&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;showContextMenu&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;isDialog&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;app&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;nodeKey&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;functionToCall&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static string GetInitUrl(int? startNodeID, string treeType, bool? showContextMenu,
		   bool? isDialog, string app, string nodeKey, string functionToCall)
		{
            TreeUrlGenerator treeSvc = new TreeUrlGenerator()
            {
                StartNodeID = startNodeID ?? -1,
                TreeType = treeType,
                ShowContextMenu = showContextMenu ?? true,
                IsDialog = isDialog ?? false,
                App = app,
                NodeKey = nodeKey,
                FunctionToCall = functionToCall
            };
			return treeSvc.GetInitUrl();
		}

        /// &lt;summary&gt;
        /// Returns the url for the tree picker (used on modal windows) based on the parameters specified on this class
        /// &lt;/summary&gt;
        public static string GetPickerUrl(string app, string treeType)
        {
            TreeUrlGenerator treeSvc = new TreeUrlGenerator();
            treeSvc.App = app;
            treeSvc.TreeType = treeType;
            return treeSvc.GetPickerUrl();
        }

        /// &lt;summary&gt;
        /// Returns the url for the tree picker (used on modal windows) based on the parameters specified on this class
        /// &lt;/summary&gt;
        public string GetPickerUrl()
        {
            return Umbraco.Core.IO.IOHelper.ResolveUrl(Umbraco.Core.IO.SystemDirectories.Umbraco) + &quot;/dialogs/&quot; + GetUrl(PICKER_URL);
        }

        [Obsolete(&quot;No longer used as useSubModal no longer has any relavence&quot;)]
		public static string GetPickerUrl(bool useSubModal, string app, string treeType)
		{
            return GetPickerUrl(app, treeType);
		}
        [Obsolete(&quot;No longer used as useSubModal no longer has any relavence&quot;)]
		public string GetPickerUrl(bool useSubModal)
		{
            return GetPickerUrl();
		}

		/// &lt;summary&gt;
		/// Generates the URL parameters for the tree service.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;pageUrl&quot;&gt;the base url (i.e. tree.aspx)&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		protected virtual string GetUrl(string pageUrl)
		{
			StringBuilder sb = new StringBuilder();

			sb.Append(pageUrl);
			//insert random
			sb.Append(string.Format(&quot;?rnd={0}&quot;, Guid.NewGuid().ToString(&quot;N&quot;)));

			sb.Append(string.Format(&quot;&amp;id={0}&quot;, this.StartNodeID.ToString()));
			if (!string.IsNullOrEmpty(this.TreeType)) sb.Append(string.Format(&quot;&amp;treeType={0}&quot;, this.TreeType));
			if (!string.IsNullOrEmpty(this.NodeKey)) sb.Append(string.Format(&quot;&amp;nodeKey={0}&quot;, this.NodeKey));
			sb.Append(string.Format(&quot;&amp;contextMenu={0}&quot;, this.ShowContextMenu.ToString().ToLower()));
			sb.Append(string.Format(&quot;&amp;isDialog={0}&quot;, this.IsDialog.ToString().ToLower()));
			if (!string.IsNullOrEmpty(this.App)) sb.Append(string.Format(&quot;&amp;app={0}&quot;, this.App));

			return sb.ToString();
		}

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[35,8,35,9,0],[35,10,35,34,0],[35,35,35,36,0],[36,8,36,9,0],[36,10,36,35,0],[36,36,36,37,0],[41,8,41,9,0],[41,10,41,27,0],[41,28,41,29,0],[42,8,42,9,0],[42,10,42,28,0],[42,29,42,30,0],[47,8,47,9,0],[47,10,47,37,0],[47,38,47,39,0],[48,8,48,9,0],[48,10,48,32,0],[48,33,48,34,0],[53,8,53,9,0],[53,10,53,28,0],[53,29,53,30,0],[54,8,54,9,0],[54,10,54,29,0],[54,30,54,31,0],[59,8,59,9,0],[59,10,59,43,0],[59,44,59,45,0],[60,8,60,9,0],[60,10,60,36,0],[60,37,60,38,0],[65,8,65,9,0],[65,10,65,37,0],[65,38,65,39,0],[66,8,66,9,0],[66,10,66,29,0],[66,30,66,31,0],[71,8,71,9,0],[71,10,71,23,0],[71,24,71,25,0],[72,8,72,9,0],[72,10,72,24,0],[72,25,72,26,0],[81,3,81,4,0],[82,13,82,124,0],[83,3,83,4,0],[98,3,98,4,0],[99,13,108,15,0],[109,4,109,35,0],[110,3,110,4,0],[117,3,117,4,0],[118,13,118,124,0],[119,3,119,4,0],[134,3,134,4,0],[135,13,144,15,0],[145,4,145,32,0],[146,3,146,4,0],[152,9,152,10,0],[153,13,153,63,0],[154,13,154,31,0],[155,13,155,41,0],[156,13,156,43,0],[157,9,157,10,0],[163,9,163,10,0],[164,13,164,134,0],[165,9,165,10,0],[169,3,169,4,0],[170,13,170,48,0],[171,3,171,4,0],[174,3,174,4,0],[175,13,175,35,0],[176,3,176,4,0],[184,3,184,4,0],[185,4,185,43,0],[187,4,187,23,0],[189,4,189,71,0],[191,4,191,69,0],[192,4,192,45,0],[192,46,192,103,0],[193,4,193,44,0],[193,45,193,100,0],[194,4,194,92,0],[195,4,195,82,0],[196,4,196,40,0],[196,41,196,88,0],[198,4,198,25,0],[199,3,199,4,0]]);
    </script>
  </body>
</html>