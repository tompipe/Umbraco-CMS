<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Controllers\UmbRegisterController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using System.Web.Mvc;
using System.Web.Security;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic.member;
using Umbraco.Core;
using Umbraco.Core.Security;
using Umbraco.Web.Models;
using Umbraco.Web.Mvc;

namespace Umbraco.Web.Controllers
{
    public class UmbRegisterController : SurfaceController
    {
        [HttpPost]
        public ActionResult HandleRegisterMember([Bind(Prefix = &quot;registerModel&quot;)]RegisterModel model)
        {
            if (ModelState.IsValid == false)
            {
                return CurrentUmbracoPage();
            }

            MembershipCreateStatus status;
            var member = Members.RegisterMember(model, out status, model.LoginOnSuccess);
            
            switch (status)
            {
                case MembershipCreateStatus.Success:

                    TempData[&quot;FormSuccess&quot;] = true;

                    //if there is a specified path to redirect to then use it
                    if (model.RedirectUrl.IsNullOrWhiteSpace() == false)
                    {
                        return Redirect(model.RedirectUrl);
                    }
                    //redirect to current page by default
                    
                    return RedirectToCurrentUmbracoPage();
                case MembershipCreateStatus.InvalidUserName:
                    ModelState.AddModelError((model.UsernameIsEmail || model.Username == null)
                        ? &quot;registerModel.Email&quot;
                        : &quot;registerModel.Username&quot;,
                        &quot;Username is not valid&quot;);
                    break;
                case MembershipCreateStatus.InvalidPassword:
                    ModelState.AddModelError(&quot;registerModel.Password&quot;, &quot;The password is not strong enough&quot;);
                    break;
                case MembershipCreateStatus.InvalidQuestion:
                case MembershipCreateStatus.InvalidAnswer:
                    //TODO: Support q/a http://issues.umbraco.org/issue/U4-3213
                    throw new NotImplementedException(status.ToString());
                case MembershipCreateStatus.InvalidEmail:
                    ModelState.AddModelError(&quot;registerModel.Email&quot;, &quot;Email is invalid&quot;);
                    break;
                case MembershipCreateStatus.DuplicateUserName:
                    ModelState.AddModelError((model.UsernameIsEmail || model.Username == null)
                        ? &quot;registerModel.Email&quot;
                        : &quot;registerModel.Username&quot;,
                        &quot;A member with this username already exists.&quot;);
                    break;
                case MembershipCreateStatus.DuplicateEmail:
                    ModelState.AddModelError(&quot;registerModel.Email&quot;, &quot;A member with this e-mail address already exists&quot;);
                    break;
                case MembershipCreateStatus.UserRejected:
                case MembershipCreateStatus.InvalidProviderUserKey:
                case MembershipCreateStatus.DuplicateProviderUserKey:
                case MembershipCreateStatus.ProviderError:
                    //don&#39;t add a field level error, just model level
                    ModelState.AddModelError(&quot;registerModel&quot;, &quot;An error occurred creating the member: &quot; + status);
                    break;
                default:
                    throw new ArgumentOutOfRangeException();
            }

            return CurrentUmbracoPage();
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,10,0],[19,13,19,45,0],[20,13,20,14,0],[21,17,21,45,0],[25,13,25,90,0],[27,13,27,28,0],[31,21,31,52,0],[34,21,34,73,0],[35,21,35,22,0],[36,25,36,60,0],[40,21,40,59,0],[42,21,45,50,0],[46,21,46,27,0],[48,21,48,109,0],[49,21,49,27,0],[53,21,53,74,0],[55,21,55,89,0],[56,21,56,27,0],[58,21,61,72,0],[62,21,62,27,0],[64,21,64,121,0],[65,21,65,27,0],[71,21,71,115,0],[72,21,72,27,0],[74,21,74,61,0],[77,13,77,41,0],[78,9,78,10,0]]);
    </script>
  </body>
</html>