<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Publishing\ScheduledPublisher.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Services;

namespace Umbraco.Core.Publishing
{
    /// &lt;summary&gt;
    /// Used to perform scheduled publishing/unpublishing
    /// &lt;/summary&gt;
    internal class ScheduledPublisher
    {
        private readonly IContentService _contentService;

        public ScheduledPublisher(IContentService contentService)
        {
            _contentService = contentService;
        }

        /// &lt;summary&gt;
        /// Processes scheduled operations
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// Returns the number of items successfully completed
        /// &lt;/returns&gt;
        public int CheckPendingAndProcess()
        {
            var counter = 0;
            foreach (var d in _contentService.GetContentForRelease())
            {
                try
                {
                    d.ReleaseDate = null;
                    var result = _contentService.SaveAndPublishWithStatus(d, (int)d.GetWriterProfile().Id);
                    if (result.Success == false)
                    {
                        if (result.Exception != null)
                        {
                            LogHelper.Error&lt;ScheduledPublisher&gt;(&quot;Could not published the document (&quot; + d.Id + &quot;) based on it&#39;s scheduled release, status result: &quot; + result.Result.StatusType, result.Exception);
                        }
                        else
                        {
                            LogHelper.Warn&lt;ScheduledPublisher&gt;(&quot;Could not published the document (&quot; + d.Id + &quot;) based on it&#39;s scheduled release. Status result: &quot; + result.Result.StatusType);
                        }
                    }
                    else
                    {
                        counter++;
                    }
                }
                catch (Exception ee)
                {
                    LogHelper.Error&lt;ScheduledPublisher&gt;(string.Format(&quot;Error publishing node {0}&quot;, d.Id), ee);
                    throw;
                }
            }
            foreach (var d in _contentService.GetContentForExpiration())
            {
                try
                {
                    d.ExpireDate = null;
                    var result = _contentService.UnPublish(d, (int)d.GetWriterProfile().Id);
                    if (result)
                    {
                        counter++;
                    }
                }
                catch (Exception ee)
                {
                    LogHelper.Error&lt;ScheduledPublisher&gt;(string.Format(&quot;Error unpublishing node {0}&quot;, d.Id), ee);
                    throw;
                }
            }

            return counter;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,66,0],[16,9,16,10,0],[17,13,17,46,0],[18,9,18,10,0],[27,9,27,10,0],[28,13,28,29,0],[29,13,29,20,0],[29,22,29,27,0],[29,28,29,30,0],[29,31,29,69,0],[30,13,30,14,0],[32,17,32,18,0],[33,21,33,42,0],[34,21,34,108,0],[35,21,35,49,0],[36,21,36,22,0],[37,25,37,54,0],[38,25,38,26,0],[39,29,39,210,0],[40,25,40,26,0],[42,25,42,26,0],[43,29,43,191,0],[44,25,44,26,0],[45,21,45,22,0],[47,21,47,22,0],[48,25,48,35,0],[49,21,49,22,0],[50,17,50,18,0],[51,17,51,37,0],[52,17,52,18,0],[53,21,53,111,0],[54,21,54,27,0],[56,13,56,14,0],[57,13,57,20,0],[57,22,57,27,0],[57,28,57,30,0],[57,31,57,72,0],[58,13,58,14,0],[60,17,60,18,0],[61,21,61,41,0],[62,21,62,93,0],[63,21,63,32,0],[64,21,64,22,0],[65,25,65,35,0],[66,21,66,22,0],[67,17,67,18,0],[68,17,68,37,0],[69,17,69,18,0],[70,21,70,113,0],[71,21,71,27,0],[73,13,73,14,0],[75,13,75,28,0],[76,9,76,10,0]]);
    </script>
  </body>
</html>