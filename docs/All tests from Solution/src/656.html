<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Trees\TreeDefinition.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using umbraco.BusinessLogic;
using umbraco.interfaces;

namespace umbraco.cms.presentation.Trees
{

    /// &lt;summary&gt;
    /// Defines the entire structure of an application tree including it&#39;s Type, a reference to it&#39;s ApplicationTree object, and a reference 
    /// to it&#39;s Application object. Tree Definitions are based on defining a database in the umbracoAppTree database. Any tree defined in this table 
    /// that is of an ITree type, it will be found and can be instantiated by this class. Any ITree that is not defined in the database will
    /// need to be instantiated with it&#39;s own tree constructor.
    /// &lt;/summary&gt;
    public class TreeDefinition
    {
        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;TreeDefinition&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;type&quot;&gt;The type.&lt;/param&gt;
        /// &lt;param name=&quot;tree&quot;&gt;The tree.&lt;/param&gt;
        /// &lt;param name=&quot;app&quot;&gt;The app.&lt;/param&gt;
        public TreeDefinition(Type type, ApplicationTree tree, Application app)
        {
            m_treeType = type;
            m_tree = tree;
            m_app = app;
        }

        private Type m_treeType;
        private ApplicationTree m_tree;
        private Application m_app;

        /// &lt;summary&gt;
        /// Returns a new instance of a BaseTree based on this Tree Definition
        /// &lt;/summary&gt;
        public BaseTree CreateInstance()
        {       
            //create the tree instance
            ITree typeInstance = CreateTreeInstance(m_treeType, m_app.alias);

            if (typeInstance != null)
            {
                //convert to BaseTree
                return (BaseTree.IsBaseTree(typeInstance) ? typeInstance as BaseTree : BaseTree.FromITree(typeInstance, m_tree.Alias, m_app.alias, m_tree.IconClosed, m_tree.IconOpened, m_tree.Action));                    
            }
            return null;
        }

        /// &lt;summary&gt;
        /// Gets or sets the type of the tree.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The type of the tree.&lt;/value&gt;
        public Type TreeType
        {
            get { return m_treeType; }
            set { m_treeType = value; }
        }

        /// &lt;summary&gt;
        /// Gets or sets the tree.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The tree.&lt;/value&gt;
        public ApplicationTree Tree
        {
            get { return m_tree; }
            set { m_tree = value; }
        }

        /// &lt;summary&gt;
        /// Gets or sets the application.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The app.&lt;/value&gt;
        public Application App
        {
            get { return m_app; }
            set { m_app = value; }
        }

        /// &lt;summary&gt;
        /// Creates an ITree instance.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tree&quot;&gt;The tree.&lt;/param&gt;
        /// &lt;param name=&quot;appAlias&quot;&gt;The app alias.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static ITree CreateTreeInstance(Type tree, string appAlias)
        {
            ITree typeInstance;
            //call the correct constructor
            if (typeof(BaseTree).IsAssignableFrom(tree))
                typeInstance = Activator.CreateInstance(tree, new object[] { appAlias }) as ITree; //the BaseTree constructor
            else
                typeInstance = CreateTreeInstance(tree);
            return typeInstance;
        }

        private static ITree CreateTreeInstance(Type tree)
        {
            ITree typeInstance = Activator.CreateInstance(tree) as ITree; //an empty constructor (ITree)
            return typeInstance;
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[30,9,30,80,0],[31,9,31,10,0],[32,13,32,31,0],[33,13,33,27,0],[34,13,34,25,0],[35,9,35,10,0],[45,9,45,10,0],[47,13,47,78,0],[49,13,49,38,0],[50,13,50,14,0],[52,17,52,202,0],[54,13,54,25,0],[55,9,55,10,0],[63,17,63,18,0],[63,19,63,37,0],[63,38,63,39,0],[64,17,64,18,0],[64,19,64,38,0],[64,39,64,40,0],[73,17,73,18,0],[73,19,73,33,0],[73,34,73,35,0],[74,17,74,18,0],[74,19,74,34,0],[74,35,74,36,0],[83,17,83,18,0],[83,19,83,32,0],[83,33,83,34,0],[84,17,84,18,0],[84,19,84,33,0],[84,34,84,35,0],[94,9,94,10,0],[97,13,97,57,0],[98,17,98,99,0],[100,17,100,57,0],[101,13,101,33,0],[102,9,102,10,0],[105,9,105,10,0],[106,13,106,74,0],[107,13,107,33,0],[108,9,108,10,0]]);
    </script>
  </body>
</html>