<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.datalayer\Extensions\SqlHelperExtender.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
/************************************************************************************
 * 
 *  Umbraco Data Layer
 *  MIT Licensed work
 *  ï¿½2008 Ruben Verborgh
 * 
 ***********************************************************************************/

using System;
using System.Collections.Generic;
using System.Data;
using System.Xml;
using umbraco.DataLayer.Utility;

namespace umbraco.DataLayer.Extensions
{
    /// &lt;summary&gt;
    /// Class that adds extensions to an existing SQL helper.
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;Decorator design pattern.&lt;/remarks&gt;
    public class SqlHelperExtender : ISqlHelper
    {
        #region Private Fields
        
        /// &lt;summary&gt;SQL helper this SqlHelperExtender extends.&lt;/summary&gt;
        private readonly ISqlHelper m_SqlHelper;

        /// &lt;summary&gt;Extensions that are currently in use.&lt;/summary&gt;
        private readonly List&lt;ISqlHelperExtension&gt; m_Extensions = new List&lt;ISqlHelperExtension&gt;();

        #endregion

        #region Public Properties
        
        /// &lt;summary&gt;
        /// Gets the connection string.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The connection string.&lt;/value&gt;
        public string ConnectionString
        {
            get { return m_SqlHelper.ConnectionString; }
        }

        /// &lt;summary&gt;
        /// Gets the Umbraco utility associated with this SQL helper.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The utilities.&lt;/value&gt;
        public IUtilitySet Utility
        {
            get { return m_SqlHelper.Utility; }
        } 

        #endregion

        #region Public Contructors

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;SqlHelperExtender&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sqlHelper&quot;&gt;The SQL helper.&lt;/param&gt;
        public SqlHelperExtender(ISqlHelper sqlHelper)
        {
            if (sqlHelper == null)
                throw new ArgumentNullException(&quot;sqlHelper&quot;);
            m_SqlHelper = sqlHelper;
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;SqlHelperExtender&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sqlHelper&quot;&gt;The SQL helper.&lt;/param&gt;
        /// &lt;param name=&quot;extensions&quot;&gt;The extensions.&lt;/param&gt;
        public SqlHelperExtender(ISqlHelper sqlHelper, params ISqlHelperExtension[] extensions)
            : this(sqlHelper)
        {
            foreach (ISqlHelperExtension extension in extensions)
                AddExtension(extension);
        }

        #endregion

        #region Public Methods

        /// &lt;summary&gt;
        /// Adds the extension to the extension chain.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;extension&quot;&gt;The extension.&lt;/param&gt;
        public void AddExtension(ISqlHelperExtension extension)
        {
            if (extension == null)
                throw new ArgumentNullException(&quot;extension&quot;);
            m_Extensions.Add(extension);
        }

        /// &lt;summary&gt;
        /// Removes an extension from the extension chain.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;extension&quot;&gt;The extension.&lt;/param&gt;
        public void RemoveExtension(ISqlHelperExtension extension)
        {
            if (extension == null)
                throw new ArgumentNullException(&quot;extension&quot;);
            m_Extensions.Remove(extension);
        }

        #endregion

        #region ISqlHelper Members
        
        /// &lt;summary&gt;
        /// Creates a new parameter for use with this specific implementation of ISqlHelper.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;parameterName&quot;&gt;Name of the parameter.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;Value of the parameter.&lt;/param&gt;
        /// &lt;returns&gt;A new parameter of the correct type.&lt;/returns&gt;
        /// &lt;remarks&gt;Abstract factory pattern&lt;/remarks&gt;
        public IParameter CreateParameter(string parameterName, object value)
        {
            return m_SqlHelper.CreateParameter(parameterName, value);
        }

		/// &lt;summary&gt;
		/// Creates a concatenation fragment for use in an SQL query.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;values&quot;&gt;The values that need to be concatenated&lt;/param&gt;
		/// &lt;returns&gt;The SQL query fragment.&lt;/returns&gt;
		/// &lt;remarks&gt;SQL Server uses a+b, MySql uses concat(a,b), Oracle uses a||b...&lt;/remarks&gt;
		public virtual string Concat(params string[] values)
		{
			return m_SqlHelper.Concat(values);
		}
		
		/// &lt;summary&gt;
        /// Escapes a string for use in an SQL query.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;text&quot;&gt;The text to be escaped.&lt;/param&gt;
        /// &lt;returns&gt;The escaped value.&lt;/returns&gt;
        /// &lt;remarks&gt;You should use SQL parameters instead.&lt;/remarks&gt;
        public string EscapeString(string text)
        {
            // Although EscapeString is obsolete, we still need to implement it
            #pragma warning disable 618
            return m_SqlHelper.EscapeString(text);
            #pragma warning restore 618
        }

        /// &lt;summary&gt;
        /// Executes a command and returns the number of rows affected.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;param name=&quot;parameters&quot;&gt;The parameters.&lt;/param&gt;
        /// &lt;returns&gt;
        /// The number of rows affected by the command.
        /// &lt;/returns&gt;
        public int ExecuteNonQuery(string commandText, params IParameter[] parameters)
        {
            foreach (ISqlHelperExtension extension in m_Extensions)
                extension.OnExecuteNonQuery(m_SqlHelper, ref commandText, ref parameters);
            return m_SqlHelper.ExecuteNonQuery(commandText, parameters);
        }

        /// &lt;summary&gt;
        /// Executes a command and returns a records reader containing the results.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;param name=&quot;parameters&quot;&gt;The parameters.&lt;/param&gt;
        /// &lt;returns&gt;
        /// A data reader containing the results of the command.
        /// &lt;/returns&gt;
        public IRecordsReader ExecuteReader(string commandText, params IParameter[] parameters)
        {
            foreach (ISqlHelperExtension extension in m_Extensions)
                extension.OnExecuteReader(m_SqlHelper, ref commandText, ref parameters);
            return m_SqlHelper.ExecuteReader(commandText, parameters);
        }

        /// &lt;summary&gt;
        /// Executes a command that returns a single value.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;The type of the value.&lt;/typeparam&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;param name=&quot;parameters&quot;&gt;The parameters.&lt;/param&gt;
        /// &lt;returns&gt;The return value of the command.&lt;/returns&gt;
        /// &lt;exception cref=&quot;umbraco.DataLayer.SqlHelperException&quot;&gt;If a data source error occurs.&lt;/exception&gt;
        public T ExecuteScalar&lt;T&gt;(string commandText, params IParameter[] parameters)
        {
            foreach (ISqlHelperExtension extension in m_Extensions)
                extension.OnExecuteScalar(m_SqlHelper, ref commandText, ref parameters);
            return m_SqlHelper.ExecuteScalar&lt;T&gt;(commandText, parameters);
        }

        /// &lt;summary&gt;
        /// Executes a command that returns an XML value.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;param name=&quot;parameters&quot;&gt;The parameters.&lt;/param&gt;
        /// &lt;returns&gt;
        /// An XML reader containing the return value.
        /// &lt;/returns&gt;
        public XmlReader ExecuteXmlReader(string commandText, params IParameter[] parameters)
        {
            foreach (ISqlHelperExtension extension in m_Extensions)
                extension.OnExecuteXmlReader(m_SqlHelper, ref commandText, ref parameters);
            return m_SqlHelper.ExecuteXmlReader(commandText, parameters);
        }

        /// &lt;summary&gt;
        /// Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.
        /// &lt;/summary&gt;
        public void Dispose()
        {
            m_SqlHelper.Dispose();
        }

        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[29,9,29,99,0],[41,17,41,18,0],[41,19,41,55,0],[41,56,41,57,0],[50,17,50,18,0],[50,19,50,46,0],[50,47,50,48,0],[61,9,61,55,0],[62,9,62,10,0],[63,13,63,35,0],[64,17,64,62,0],[65,13,65,37,0],[66,9,66,10,0],[74,15,74,30,0],[75,9,75,10,0],[76,13,76,20,0],[76,22,76,51,0],[76,52,76,54,0],[76,55,76,65,0],[77,17,77,41,0],[78,9,78,10,0],[89,9,89,10,0],[90,13,90,35,0],[91,17,91,62,0],[92,13,92,41,0],[93,9,93,10,0],[100,9,100,10,0],[101,13,101,35,0],[102,17,102,62,0],[103,13,103,44,0],[104,9,104,10,0],[118,9,118,10,0],[119,13,119,70,0],[120,9,120,10,0],[129,3,129,4,0],[130,4,130,38,0],[131,3,131,4,0],[140,9,140,10,0],[143,13,143,51,0],[145,9,145,10,0],[156,9,156,10,0],[157,13,157,20,0],[157,22,157,51,0],[157,52,157,54,0],[157,55,157,67,0],[158,17,158,91,0],[159,13,159,73,0],[160,9,160,10,0],[171,9,171,10,0],[172,13,172,20,0],[172,22,172,51,0],[172,52,172,54,0],[172,55,172,67,0],[173,17,173,89,0],[174,13,174,71,0],[175,9,175,10,0],[186,9,186,10,0],[187,13,187,20,0],[187,22,187,51,0],[187,52,187,54,0],[187,55,187,67,0],[188,17,188,89,0],[189,13,189,74,0],[190,9,190,10,0],[201,9,201,10,0],[202,13,202,20,0],[202,22,202,51,0],[202,52,202,54,0],[202,55,202,67,0],[203,17,203,92,0],[204,13,204,74,0],[205,9,205,10,0],[211,9,211,10,0],[212,13,212,35,0],[213,9,213,10,0]]);
    </script>
  </body>
</html>