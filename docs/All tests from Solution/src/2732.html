<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\imagecropper\ImageInfo.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Drawing;
using System.IO;
using System.Net;
using System.Web;
using Umbraco.Core.IO;
//using Umbraco.Core.IO;


namespace umbraco.editorControls.imagecropper
{
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public class ImageInfo
    {
        public Image image { get; set; }
        public string Name { get; set; }
        public int Width { get; set; }
        public int Height { get; set; }
        public float Aspect { get; set; }
        public DateTime DateStamp { get; set; }
        public string Path { get; set; }
        public string RelativePath { get; set; }

        private readonly MediaFileSystem _fs;

        public ImageInfo(string relativePath)
        {
            _fs = FileSystemProviderManager.Current.GetFileSystemProvider&lt;MediaFileSystem&gt;();

            try
            {
                RelativePath = relativePath;

                //This get&#39;s the IFileSystem&#39;s path based on the URL (i.e. /media/blah/blah.jpg )
                Path = _fs.GetRelativePath(relativePath);

                using (var stream = _fs.OpenFile(Path))                
                using (image = Image.FromStream(stream))
                {
                    var fileName = _fs.GetFileName(Path);
                    Name = fileName.Substring(0, fileName.LastIndexOf(&#39;.&#39;));

                    DateStamp = _fs.GetLastModified(Path).Date;
                    Width = image.Width;
                    Height = image.Height;
                    Aspect = (float)Width / Height;        
                }
                
            }
            catch (Exception)
            {
                Width = 0;
                Height = 0;
                Aspect = 0;
            }

        }

        public bool Exists
        {
            get { return Width &gt; 0 &amp;&amp; Height &gt; 0; }
        }

        //public string Directory
        //{
        //    get { return Path.Substring(0, Path.LastIndexOf(&#39;\\&#39;)); }
        //}

        public void GenerateThumbnails(SaveData saveData, Config config)
        {
            if (config.GenerateImages)
            {
                for (int i = 0; i &lt; config.presets.Count; i++)
                {
                    Crop crop = (Crop)saveData.data[i];
                    Preset preset = (Preset)config.presets[i];

                    // Crop rectangle bigger than actual image
                    if (crop.X2 - crop.X &gt; Width || crop.Y2 - crop.Y &gt; Height)
                    {
                        crop = preset.Fit(this);
                    }
                    
                    ImageTransform.Execute(
                        Path,
                        String.Format(&quot;{0}_{1}&quot;, Name, preset.Name),
                        crop.X,
                        crop.Y,
                        crop.X2 - crop.X,
                        crop.Y2 - crop.Y,
                        preset.TargetWidth,
                        preset.TargetHeight,
                        config.Quality
                        );
                    //BasePage bp = new BasePage();
                    //bp.speechBubble(BasePage.speechBubbleIcon.error, &quot;Error&quot;,
                    //                &quot;One or more crops are out of bounds. Please correct and try again.&quot;);
                }
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,30,15,34,0],[15,35,15,39,0],[16,30,16,34,0],[16,35,16,39,0],[17,28,17,32,0],[17,33,17,37,0],[18,29,18,33,0],[18,34,18,38,0],[19,31,19,35,0],[19,36,19,40,0],[20,37,20,41,0],[20,42,20,46,0],[21,30,21,34,0],[21,35,21,39,0],[22,38,22,42,0],[22,43,22,47,0],[26,9,26,46,0],[27,9,27,10,0],[28,13,28,94,0],[31,13,31,14,0],[32,17,32,45,0],[35,17,35,58,0],[37,24,37,55,0],[38,17,38,57,0],[39,17,39,18,0],[40,21,40,58,0],[41,21,41,77,0],[43,21,43,64,0],[44,21,44,41,0],[45,21,45,43,0],[46,21,46,52,0],[47,17,47,18,0],[49,13,49,14,0],[50,13,50,30,0],[51,13,51,14,0],[52,17,52,27,0],[53,17,53,28,0],[54,17,54,28,0],[55,13,55,14,0],[57,9,57,10,0],[61,17,61,18,0],[61,19,61,50,0],[61,51,61,52,0],[70,9,70,10,0],[71,13,71,39,0],[72,13,72,14,0],[73,22,73,31,0],[73,33,73,57,0],[73,59,73,62,0],[74,17,74,18,0],[75,21,75,56,0],[76,21,76,63,0],[79,21,79,79,0],[80,21,80,22,0],[81,25,81,49,0],[82,21,82,22,0],[84,21,94,27,0],[98,17,98,18,0],[99,13,99,14,0],[100,9,100,10,0]]);
    </script>
  </body>
</html>