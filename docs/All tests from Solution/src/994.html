<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\PropertyEditors\DropDownMultipleWithKeysPropertyEditor.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Core.PropertyEditors;

namespace Umbraco.Web.PropertyEditors
{
    /// &lt;summary&gt;
    /// A property editor to allow multiple selection of pre-defined items
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// Due to maintaining backwards compatibility this data type stores the value as a string which is a comma separated value of the 
    /// ids of the individual items so we have logic in here to deal with that.
    /// &lt;/remarks&gt;
    [PropertyEditor(Constants.PropertyEditors.DropdownlistMultiplePublishKeysAlias, &quot;Dropdown list multiple, publish keys&quot;, &quot;dropdown&quot;, Group = &quot;lists&quot;, Icon = &quot;icon-bulleted-list&quot;)]
    public class DropDownMultipleWithKeysPropertyEditor : DropDownPropertyEditor
    {
        protected override PropertyValueEditor CreateValueEditor()
        {
            return new PublishValuesMultipleValueEditor(true, base.CreateValueEditor());
        }

        protected override PreValueEditor CreatePreValueEditor()
        {
            return new DropDownMultiplePreValueEditor();
        }

        /// &lt;summary&gt;
        /// A pre-value editor for the &#39;drop down list multiple&#39; property editor that ensures that &#39;multiple&#39; is saved for the config in the db but is not 
        /// rendered as a pre-value field.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// This is mostly to maintain backwards compatibility with old property editors. Devs can now simply use the Drop down property editor and check the multiple pre-value checkbox
        /// &lt;/remarks&gt;
        internal class DropDownMultiplePreValueEditor : ValueListPreValueEditor
        {
            public DropDownMultiplePreValueEditor()
            {
                //add the multiple field, we&#39;ll make it hidden so it is not seen in the pre-value editor
                Fields.Add(new PreValueField
                    {
                        Key = &quot;multiple&quot;,
                        Name = &quot;multiple&quot;,
                        View = &quot;hidden&quot;,
                        HideLabel = true
                    });                
            }

            /// &lt;summary&gt;
            /// Always
            /// &lt;/summary&gt;
            /// &lt;param name=&quot;defaultPreVals&quot;&gt;&lt;/param&gt;
            /// &lt;param name=&quot;persistedPreVals&quot;&gt;&lt;/param&gt;
            /// &lt;returns&gt;&lt;/returns&gt;
            public override IDictionary&lt;string, object&gt; ConvertDbToEditor(IDictionary&lt;string, object&gt; defaultPreVals, PreValueCollection persistedPreVals)
            {
                var returnVal = base.ConvertDbToEditor(defaultPreVals, persistedPreVals);
                //always add the multiple param to true
                returnVal[&quot;multiple&quot;] = &quot;1&quot;;
                return returnVal;
            }
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,10,1],[20,13,20,89,1],[21,9,21,10,1],[24,9,24,10,0],[25,13,25,57,0],[26,9,26,10,0],[37,13,37,52,0],[38,13,38,14,0],[40,17,46,24,0],[47,13,47,14,0],[56,13,56,14,0],[57,17,57,90,0],[59,17,59,45,0],[60,17,60,34,0],[61,13,61,14,0]]);
    </script>
  </body>
</html>