<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Migrations\Syntax\Rename\Expressions\RenameColumnExpression.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Umbraco.Core.Persistence.SqlSyntax;

namespace Umbraco.Core.Persistence.Migrations.Syntax.Rename.Expressions
{
    public class RenameColumnExpression : MigrationExpressionBase
    {        
        public RenameColumnExpression(DatabaseProviders current, DatabaseProviders[] databaseProviders, ISqlSyntaxProvider sqlSyntax)
            : base(current, databaseProviders, sqlSyntax)
        {
        }

        public virtual string SchemaName { get; set; }
        public virtual string TableName { get; set; }
        public virtual string OldName { get; set; }
        public virtual string NewName { get; set; }

        public override string Process(Database database)
        {
            if (CurrentDatabaseProvider == DatabaseProviders.MySql)
            {
                string columnDefinitionSql = string.Format(@&quot;
SELECT CONCAT(
          CAST(COLUMN_TYPE AS CHAR),
          IF(ISNULL(CHARACTER_SET_NAME),
             &#39;&#39;,
             CONCAT(&#39; CHARACTER SET &#39;, CHARACTER_SET_NAME)),
          IF(ISNULL(COLLATION_NAME),
             &#39;&#39;,
             CONCAT(&#39; COLLATE &#39;, COLLATION_NAME)),
          &#39; &#39;,
          IF(IS_NULLABLE = &#39;NO&#39;, &#39;NOT NULL &#39;, &#39;&#39;),
          IF(IS_NULLABLE = &#39;NO&#39; AND COLUMN_DEFAULT IS NULL,
             &#39;&#39;,
             CONCAT(&#39;DEFAULT &#39;, QUOTE(COLUMN_DEFAULT), &#39; &#39;)),
          UPPER(extra))
  FROM INFORMATION_SCHEMA.COLUMNS
 WHERE TABLE_NAME = &#39;{0}&#39; AND COLUMN_NAME = &#39;{1}&#39;&quot;, TableName, OldName);

                var columnDefinition = database.ExecuteScalar&lt;string&gt;(columnDefinitionSql);
                return this.ToString() + &quot; &quot; + columnDefinition;
            }

            return this.ToString();
        }

        public override string ToString()
        {
            if (IsExpressionSupported() == false)
                return string.Empty;

            return SqlSyntax.FormatColumnRename(TableName, OldName, NewName);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[8,15,8,58,1],[9,9,9,10,1],[10,9,10,10,1],[12,44,12,48,0],[12,49,12,53,0],[13,43,13,47,1],[13,48,13,52,1],[14,41,14,45,1],[14,46,14,50,1],[15,41,15,45,1],[15,46,15,50,1],[18,9,18,10,1],[19,13,19,68,1],[20,13,20,14,0],[21,17,37,73,0],[39,17,39,92,0],[40,17,40,65,0],[43,13,43,36,1],[44,9,44,10,1],[47,9,47,10,1],[48,13,48,50,1],[49,17,49,37,0],[51,13,51,78,1],[52,9,52,10,1]]);
    </script>
  </body>
</html>