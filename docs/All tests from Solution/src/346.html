<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Persistence\Querying\ContentTypeRepositorySqlClausesTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Diagnostics;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Models.Rdbms;
using Umbraco.Core.Persistence;
using Umbraco.Tests.TestHelpers;

namespace Umbraco.Tests.Persistence.Querying
{
    [TestFixture]
    public class ContentTypeRepositorySqlClausesTest : BaseUsingSqlCeSyntax
    {
        [Test]
        public void Can_Verify_Base_Clause()
        {
            var NodeObjectType = new Guid(Constants.ObjectTypes.DocumentType);

            var expected = new Sql();
            expected.Select(&quot;*&quot;)
                .From(&quot;[cmsDocumentType]&quot;)
                .RightJoin(&quot;[cmsContentType]&quot;)
                .On(&quot;[cmsContentType].[nodeId] = [cmsDocumentType].[contentTypeNodeId]&quot;)
                .InnerJoin(&quot;[umbracoNode]&quot;)
                .On(&quot;[cmsContentType].[nodeId] = [umbracoNode].[id]&quot;)
                .Where(&quot;([umbracoNode].[nodeObjectType] = @0)&quot;, new Guid(&quot;a2cb7800-f571-4787-9638-bc48539a0efb&quot;))
                .Where(&quot;([cmsDocumentType].[IsDefault] = @0)&quot;, true);

            var sql = new Sql();
            sql.Select(&quot;*&quot;)
                .From&lt;ContentTypeTemplateDto&gt;()
                .RightJoin&lt;ContentTypeDto&gt;()
                .On&lt;ContentTypeDto, ContentTypeTemplateDto&gt;(left =&gt; left.NodeId, right =&gt; right.ContentTypeNodeId)
                .InnerJoin&lt;NodeDto&gt;()
                .On&lt;ContentTypeDto, NodeDto&gt;(left =&gt; left.NodeId, right =&gt; right.NodeId)
                .Where&lt;NodeDto&gt;(x =&gt; x.NodeObjectType == NodeObjectType)
                .Where&lt;ContentTypeTemplateDto&gt;(x =&gt; x.IsDefault == true);

            Assert.That(sql.SQL, Is.EqualTo(expected.SQL));

            Assert.AreEqual(expected.Arguments.Length, sql.Arguments.Length);
            for (int i = 0; i &lt; expected.Arguments.Length; i++)
            {
                Assert.AreEqual(expected.Arguments[i], sql.Arguments[i]);
            }

            Debug.Print(sql.SQL);
        }

        [Test]
        public void Can_Verify_Base_Where_Clause()
        {
            var NodeObjectType = new Guid(Constants.ObjectTypes.DocumentType);

            var expected = new Sql();
            expected.Select(&quot;*&quot;)
                .From(&quot;[cmsDocumentType]&quot;)
                .RightJoin(&quot;[cmsContentType]&quot;)
                .On(&quot;[cmsContentType].[nodeId] = [cmsDocumentType].[contentTypeNodeId]&quot;)
                .InnerJoin(&quot;[umbracoNode]&quot;)
                .On(&quot;[cmsContentType].[nodeId] = [umbracoNode].[id]&quot;)
                .Where(&quot;([umbracoNode].[nodeObjectType] = @0)&quot;, new Guid(&quot;a2cb7800-f571-4787-9638-bc48539a0efb&quot;))
                .Where(&quot;[cmsDocumentType].[IsDefault] = @0&quot;, true)
                .Where(&quot;([umbracoNode].[id] = @0)&quot;, 1050);

            var sql = new Sql();
            sql.Select(&quot;*&quot;)
                .From&lt;ContentTypeTemplateDto&gt;()
                .RightJoin&lt;ContentTypeDto&gt;()
                .On&lt;ContentTypeDto, ContentTypeTemplateDto&gt;(left =&gt; left.NodeId, right =&gt; right.ContentTypeNodeId)
                .InnerJoin&lt;NodeDto&gt;()
                .On&lt;ContentTypeDto, NodeDto&gt;(left =&gt; left.NodeId, right =&gt; right.NodeId)
                .Where&lt;NodeDto&gt;(x =&gt; x.NodeObjectType == NodeObjectType)
                .Where&lt;ContentTypeTemplateDto&gt;(x =&gt; x.IsDefault)
                .Where&lt;NodeDto&gt;(x =&gt; x.NodeId == 1050);

            Assert.That(sql.SQL, Is.EqualTo(expected.SQL));

            Assert.AreEqual(expected.Arguments.Length, sql.Arguments.Length);
            for (int i = 0; i &lt; expected.Arguments.Length; i++)
            {
                Assert.AreEqual(expected.Arguments[i], sql.Arguments[i]);
            }

            Debug.Print(sql.SQL);
        }

        [Test]
        public void Can_Verify_PerformQuery_Clause()
        {
            var expected = new Sql();
            expected.Select(&quot;*&quot;)
                .From(&quot;[cmsPropertyTypeGroup]&quot;)
                .RightJoin(&quot;[cmsPropertyType]&quot;).On(&quot;[cmsPropertyTypeGroup].[id] = [cmsPropertyType].[propertyTypeGroupId]&quot;)
                .InnerJoin(&quot;[cmsDataType]&quot;).On(&quot;[cmsPropertyType].[dataTypeId] = [cmsDataType].[nodeId]&quot;);

            var sql = new Sql();
            sql.Select(&quot;*&quot;)
               .From&lt;PropertyTypeGroupDto&gt;()
               .RightJoin&lt;PropertyTypeDto&gt;()
               .On&lt;PropertyTypeGroupDto, PropertyTypeDto&gt;(left =&gt; left.Id, right =&gt; right.PropertyTypeGroupId)
               .InnerJoin&lt;DataTypeDto&gt;()
               .On&lt;PropertyTypeDto, DataTypeDto&gt;(left =&gt; left.DataTypeId, right =&gt; right.DataTypeId);

            Assert.That(sql.SQL, Is.EqualTo(expected.SQL));

            Debug.Print(sql.SQL);
        }

        [Test]
        public void Can_Verify_AllowedContentTypeIds_Clause()
        {
            var expected = new Sql();
            expected.Select(&quot;*&quot;)
                .From(&quot;[cmsContentTypeAllowedContentType]&quot;)
                .Where(&quot;([cmsContentTypeAllowedContentType].[Id] = @0)&quot;, 1050);

            var sql = new Sql();
            sql.Select(&quot;*&quot;)
               .From&lt;ContentTypeAllowedContentTypeDto&gt;()
               .Where&lt;ContentTypeAllowedContentTypeDto&gt;(x =&gt; x.Id == 1050);

            Assert.That(sql.SQL, Is.EqualTo(expected.SQL));

            Assert.AreEqual(expected.Arguments.Length, sql.Arguments.Length);
            for (int i = 0; i &lt; expected.Arguments.Length; i++)
            {
                Assert.AreEqual(expected.Arguments[i], sql.Arguments[i]);
            }

            Debug.Print(sql.SQL);
        }

        [Test]
        public void Can_Verify_PropertyGroupCollection_Clause()
        {
            var expected = new Sql();
            expected.Select(&quot;*&quot;)
                .From(&quot;[cmsPropertyTypeGroup]&quot;)
                .RightJoin(&quot;[cmsPropertyType]&quot;).On(&quot;[cmsPropertyTypeGroup].[id] = [cmsPropertyType].[propertyTypeGroupId]&quot;)
                .InnerJoin(&quot;[cmsDataType]&quot;).On(&quot;[cmsPropertyType].[dataTypeId] = [cmsDataType].[nodeId]&quot;)
                .Where(&quot;([cmsPropertyType].[contentTypeId] = @0)&quot;, 1050);

            var sql = new Sql();
            sql.Select(&quot;*&quot;)
               .From&lt;PropertyTypeGroupDto&gt;()
               .RightJoin&lt;PropertyTypeDto&gt;()
               .On&lt;PropertyTypeGroupDto, PropertyTypeDto&gt;(left =&gt; left.Id, right =&gt; right.PropertyTypeGroupId)
               .InnerJoin&lt;DataTypeDto&gt;()
               .On&lt;PropertyTypeDto, DataTypeDto&gt;(left =&gt; left.DataTypeId, right =&gt; right.DataTypeId)
               .Where&lt;PropertyTypeDto&gt;(x =&gt; x.ContentTypeId == 1050);

            Assert.That(sql.SQL, Is.EqualTo(expected.SQL));

            Assert.AreEqual(expected.Arguments.Length, sql.Arguments.Length);
            for (int i = 0; i &lt; expected.Arguments.Length; i++)
            {
                Assert.AreEqual(expected.Arguments[i], sql.Arguments[i]);
            }

            Debug.Print(sql.SQL);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,10,1],[17,13,17,79,1],[19,13,19,38,1],[20,13,27,70,1],[29,13,29,33,1],[30,13,37,74,1],[39,13,39,60,1],[41,13,41,78,1],[42,18,42,27,1],[42,29,42,58,1],[42,60,42,63,1],[43,13,43,14,1],[44,17,44,74,1],[45,13,45,14,1],[47,13,47,34,1],[48,9,48,10,1],[52,9,52,10,1],[53,13,53,79,1],[55,13,55,38,1],[56,13,64,59,1],[66,13,66,33,1],[67,13,75,56,1],[77,13,77,60,1],[79,13,79,78,1],[80,18,80,27,1],[80,29,80,58,1],[80,60,80,63,1],[81,13,81,14,1],[82,17,82,74,1],[83,13,83,14,1],[85,13,85,34,1],[86,9,86,10,1],[90,9,90,10,1],[91,13,91,38,1],[92,13,95,107,1],[97,13,97,33,1],[98,13,103,102,1],[105,13,105,60,1],[107,13,107,34,1],[108,9,108,10,1],[112,9,112,10,1],[113,13,113,38,1],[114,13,116,80,1],[118,13,118,33,1],[119,13,121,76,1],[123,13,123,60,1],[125,13,125,78,1],[126,18,126,27,1],[126,29,126,58,1],[126,60,126,63,1],[127,13,127,14,1],[128,17,128,74,1],[129,13,129,14,1],[131,13,131,34,1],[132,9,132,10,1],[136,9,136,10,1],[137,13,137,38,1],[138,13,142,74,1],[144,13,144,33,1],[145,13,151,70,1],[153,13,153,60,1],[155,13,155,78,1],[156,18,156,27,1],[156,29,156,58,1],[156,60,156,63,1],[157,13,157,14,1],[158,17,158,74,1],[159,13,159,14,1],[161,13,161,34,1],[162,9,162,10,1]]);
    </script>
  </body>
</html>