<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\DictionaryItem.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Runtime.Serialization;
using Umbraco.Core.Models.EntityBase;

namespace Umbraco.Core.Models
{
    /// &lt;summary&gt;
    /// Represents a Dictionary Item
    /// &lt;/summary&gt;
    [Serializable]
    [DataContract(IsReference = true)]
    public class DictionaryItem : Entity, IDictionaryItem
    {
        public Func&lt;int, ILanguage&gt; GetLanguage { get; set; }
        private Guid? _parentId;
        private string _itemKey;
        private IEnumerable&lt;IDictionaryTranslation&gt; _translations;

        public DictionaryItem(string itemKey)
            : this(null, itemKey)
        {}

        public DictionaryItem(Guid? parentId, string itemKey)
        {
            _parentId = parentId;
            _itemKey = itemKey;
            _translations = new List&lt;IDictionaryTranslation&gt;();
        }

        private static readonly Lazy&lt;PropertySelectors&gt; Ps = new Lazy&lt;PropertySelectors&gt;();

        private class PropertySelectors
        {
            public readonly PropertyInfo ParentIdSelector = ExpressionHelper.GetPropertyInfo&lt;DictionaryItem, Guid?&gt;(x =&gt; x.ParentId);
            public readonly PropertyInfo ItemKeySelector = ExpressionHelper.GetPropertyInfo&lt;DictionaryItem, string&gt;(x =&gt; x.ItemKey);
            public readonly PropertyInfo TranslationsSelector = ExpressionHelper.GetPropertyInfo&lt;DictionaryItem, IEnumerable&lt;IDictionaryTranslation&gt;&gt;(x =&gt; x.Translations);
        }

        /// &lt;summary&gt;
        /// Gets or Sets the Parent Id of the Dictionary Item
        /// &lt;/summary&gt;
        [DataMember]
        public Guid? ParentId
        {
            get { return _parentId; }
            set { SetPropertyValueAndDetectChanges(value, ref _parentId, Ps.Value.ParentIdSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the Key for the Dictionary Item
        /// &lt;/summary&gt;
        [DataMember]
        public string ItemKey
        {
            get { return _itemKey; }
            set { SetPropertyValueAndDetectChanges(value, ref _itemKey, Ps.Value.ItemKeySelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets a list of translations for the Dictionary Item
        /// &lt;/summary&gt;
        [DataMember]
        public IEnumerable&lt;IDictionaryTranslation&gt; Translations
        {
            get { return _translations; }
            set
            {
                var asArray = value.ToArray();
                //ensure the language callback is set on each translation
                if (GetLanguage != null)
                {
                    foreach (var translation in asArray.OfType&lt;DictionaryTranslation&gt;())
                    {
                        translation.GetLanguage = GetLanguage;
                    }
                }

                SetPropertyValueAndDetectChanges(asArray, ref _translations, Ps.Value.TranslationsSelector,
                    //Custom comparer for enumerable
                    new DelegateEqualityComparer&lt;IEnumerable&lt;IDictionaryTranslation&gt;&gt;(
                        (enumerable, translations) =&gt; enumerable.UnsortedSequenceEqual(translations),
                        enumerable =&gt; enumerable.GetHashCode()));                
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,51,17,55,1],[17,56,17,60,1],[23,15,23,34,1],[24,9,24,10,1],[24,10,24,11,1],[26,9,26,62,1],[27,9,27,10,1],[28,13,28,34,1],[29,13,29,32,1],[30,13,30,64,1],[31,9,31,10,1],[33,9,33,92,1],[37,13,37,134,1],[38,13,38,133,1],[39,13,39,172,1],[48,17,48,18,1],[48,19,48,36,1],[48,37,48,38,1],[49,17,49,18,1],[49,19,49,101,1],[49,102,49,103,1],[58,17,58,18,1],[58,19,58,35,1],[58,36,58,37,1],[59,17,59,18,1],[59,19,59,99,1],[59,100,59,101,1],[68,17,68,18,1],[68,19,68,40,1],[68,41,68,42,1],[70,13,70,14,1],[71,17,71,47,1],[73,17,73,41,1],[74,17,74,18,1],[75,21,75,28,1],[75,30,75,45,1],[75,46,75,48,1],[75,49,75,88,1],[76,21,76,22,1],[77,25,77,63,1],[78,21,78,22,1],[79,17,79,18,1],[81,17,84,55,1],[84,55,84,101,1],[84,101,85,39,1],[85,39,85,63,0],[85,63,85,66,1],[81,17,85,66,1],[86,13,86,14,1]]);
    </script>
  </body>
</html>