<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\UriExtensionsTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.IO;

namespace Umbraco.Tests
{
    [TestFixture]
    public class UriExtensionsTests
    {
        [TearDown]
        public void TearDown()
        {
            SystemDirectories.Root = &quot;&quot;;
        }

        [TestCase(&quot;http://www.domain.com/umbraco&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/Umbraco/&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/umbraco/default.aspx&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/umbraco/test/test&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/umbraco/test/test/test&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/Umbraco/test/test.aspx&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/umbraco/test/test.js&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/umbrac&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/test&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/test/umbraco&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/test/umbraco.aspx&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/Umbraco/restServices/blah&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/Umbraco/Backoffice/blah&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/Umbraco/anything&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/Umbraco/anything/&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/Umbraco/surface/blah&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/umbraco/api/blah&quot;, &quot;&quot;, false)]
        [TestCase(&quot;http://www.domain.com/myvdir/umbraco/api/blah&quot;, &quot;myvdir&quot;, false)]
        [TestCase(&quot;http://www.domain.com/MyVdir/umbraco/api/blah&quot;, &quot;/myvdir&quot;, false)]
        [TestCase(&quot;http://www.domain.com/MyVdir/Umbraco/&quot;, &quot;myvdir&quot;, true)]
        [TestCase(&quot;http://www.domain.com/MyVdir/Umbraco/restServices/blah&quot;, &quot;/myvdir&quot;, true)]
        [TestCase(&quot;http://www.domain.com/umbraco/webservices/legacyAjaxCalls.asmx/js&quot;, &quot;&quot;, true)]
        [TestCase(&quot;http://www.domain.com/umbraco/test/legacyAjaxCalls.ashx?some=query&amp;blah=js&quot;, &quot;&quot;, true)]  
        public void Is_Back_Office_Request(string input, string virtualPath, bool expected)
        {
            SystemDirectories.Root = virtualPath;

            var source = new Uri(input);
            Assert.AreEqual(expected, source.IsBackOfficeRequest(virtualPath));
        }

        [TestCase(&quot;http://www.domain.com/install&quot;, true)]
        [TestCase(&quot;http://www.domain.com/Install/&quot;, true)]
        [TestCase(&quot;http://www.domain.com/install/default.aspx&quot;, true)]
        [TestCase(&quot;http://www.domain.com/install/test/test&quot;, true)]
        [TestCase(&quot;http://www.domain.com/Install/test/test.aspx&quot;, true)]
        [TestCase(&quot;http://www.domain.com/install/test/test.js&quot;, true)]
        [TestCase(&quot;http://www.domain.com/instal&quot;, false)]
        [TestCase(&quot;http://www.domain.com/umbraco&quot;, false)]
        [TestCase(&quot;http://www.domain.com/umbraco/umbraco&quot;, false)]
        [TestCase(&quot;http://www.domain.com/test/umbraco.aspx&quot;, false)]
        public void Is_Installer_Request(string input, bool expected)
        {
            var source = new Uri(input);
            Assert.AreEqual(expected, source.IsInstallerRequest());
        }

        [TestCase(&quot;http://www.domain.com/foo/bar&quot;, &quot;/&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar#hop&quot;, &quot;/&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar?q=2#hop&quot;, &quot;/&quot;, &quot;http://www.domain.com/?q=2&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar&quot;, &quot;/path/to/page&quot;, &quot;http://www.domain.com/path/to/page&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar&quot;, &quot;/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/&quot;)]
        [TestCase(&quot;http://www.domain.com/&quot;, &quot;/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/&quot;)]
        [TestCase(&quot;http://www.domain.com&quot;, &quot;/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/&quot;)]
        [TestCase(&quot;http://www.domain.com/foo?q=3&quot;, &quot;/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/?q=3&quot;)]
        [TestCase(&quot;http://www.domain.com/foo#bang&quot;, &quot;/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/&quot;)]
        [TestCase(&quot;http://www.domain.com/foo?q=3#bang&quot;, &quot;/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/?q=3&quot;)]
        public void RewritePath(string input, string path, string expected)
        {
            var source = new Uri(input);
            var output = source.Rewrite(path);
            Assert.AreEqual(expected, output.ToString());
        }

        [TestCase(&quot;http://www.domain.com/&quot;, &quot;path/to/page/&quot;, typeof(ArgumentException))]
        [TestCase(&quot;http://www.domain.com&quot;, &quot;path/to/page/&quot;, typeof(ArgumentException))]
        public void RewritePath_Exceptions(string input, string path, Type exception)
        {
            var source = new Uri(input);
            Assert.Throws(exception, () =&gt;
                {
                    var output = source.Rewrite(path);
                });
        }

        [TestCase(&quot;http://www.domain.com/foo/bar&quot;, &quot;/path/to/page&quot;, &quot;&quot;, &quot;http://www.domain.com/path/to/page&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar?k=3&quot;, &quot;/path/to/page&quot;, &quot;&quot;, &quot;http://www.domain.com/path/to/page&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar?k=3#hop&quot;, &quot;/path/to/page&quot;, &quot;&quot;, &quot;http://www.domain.com/path/to/page&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar&quot;, &quot;/path/to/page&quot;, &quot;?x=12&quot;, &quot;http://www.domain.com/path/to/page?x=12&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar#hop&quot;, &quot;/path/to/page&quot;, &quot;?x=12&quot;, &quot;http://www.domain.com/path/to/page?x=12&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar?k=3&quot;, &quot;/path/to/page&quot;, &quot;?x=12&quot;, &quot;http://www.domain.com/path/to/page?x=12&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar?k=3#hop&quot;, &quot;/path/to/page&quot;, &quot;?x=12&quot;, &quot;http://www.domain.com/path/to/page?x=12&quot;)]
        public void RewritePathAndQuery(string input, string path, string query, string expected)
        {
            var source = new Uri(input);
            var output = source.Rewrite(path, query);
            Assert.AreEqual(expected, output.ToString());
        }

        [TestCase(&quot;http://www.domain.com/&quot;, &quot;path/to/page/&quot;, &quot;&quot;, typeof(ArgumentException))]
        [TestCase(&quot;http://www.domain.com/&quot;, &quot;/path/to/page/&quot;, &quot;x=27&quot;, typeof(ArgumentException))]
        public void RewritePathAndQuery_Exceptions(string input, string path, string query, Type exception)
        {
            var source = new Uri(input);
            Assert.Throws(exception, () =&gt;
                {
                    var output = source.Rewrite(path, query);
                });
        }

        [TestCase(&quot;http://www.domain.com&quot;, &quot;/&quot;)]
        [TestCase(&quot;http://www.domain.com/&quot;, &quot;/&quot;)]
        [TestCase(&quot;http://www.domain.com/foo&quot;, &quot;/foo&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/&quot;, &quot;/foo/&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar&quot;, &quot;/foo/bar&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar%20nix&quot;, &quot;/foo/bar%20nix&quot;)]
        [TestCase(&quot;http://www.domain.com/foo/bar?q=7#hop&quot;, &quot;/foo/bar&quot;)]
        [TestCase(&quot;/&quot;, &quot;/&quot;)]
        [TestCase(&quot;/foo&quot;, &quot;/foo&quot;)]
        [TestCase(&quot;/foo/&quot;, &quot;/foo/&quot;)]
        [TestCase(&quot;/foo/bar&quot;, &quot;/foo/bar&quot;)]
        [TestCase(&quot;/foo/bar?q=7#hop&quot;, &quot;/foo/bar&quot;)]
        [TestCase(&quot;/foo%20bar/pof&quot;, &quot;/foo%20bar/pof&quot;)]
        public void GetSafeAbsolutePath(string input, string expected)
        {
            var source = new Uri(input, UriKind.RelativeOrAbsolute);
            var output = source.GetSafeAbsolutePath();
            Assert.AreEqual(expected, output);
        }

        [TestCase(&quot;http://www.domain.com/foo/bar%20nix&quot;, &quot;/foo/bar nix&quot;)]
        public void GetAbsolutePathDecoded(string input, string expected)
        {
            var source = new Uri(input, UriKind.RelativeOrAbsolute);
            var output = source.GetAbsolutePathDecoded();
            Assert.AreEqual(expected, output);
        }

        [TestCase(&quot;http://www.domain.com/foo/bar%20nix&quot;, &quot;/foo/bar nix&quot;)]
        [TestCase(&quot;/foo%20bar/pof&quot;, &quot;/foo bar/pof&quot;)]
        public void GetSafeAbsolutePathDecoded(string input, string expected)
        {
            var source = new Uri(input, UriKind.RelativeOrAbsolute);
            var output = source.GetSafeAbsolutePathDecoded();
            Assert.AreEqual(expected, output);
        }

        [TestCase(&quot;http://www.domain.com/path/to/page&quot;, &quot;http://www.domain.com/path/to/page/&quot;)]
        [TestCase(&quot;http://www.domain.com/path/to/&quot;, &quot;http://www.domain.com/path/to/&quot;)]
        [TestCase(&quot;http://www.domain.com/&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com/path/to?q=3#yop&quot;, &quot;http://www.domain.com/path/to/?q=3&quot;)]
        public void EndPathWithSlash(string input, string expected)
        {
            var source = new Uri(input);
            var output = source.EndPathWithSlash();
            Assert.AreEqual(expected, output.ToString());
        }

        [TestCase(&quot;http://www.domain.com/path/to/page&quot;, &quot;http://www.domain.com/path/to/page&quot;)]
        [TestCase(&quot;http://www.domain.com/path/to/&quot;, &quot;http://www.domain.com/path/to&quot;)]
        [TestCase(&quot;http://www.domain.com/&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com/path/to/?q=3#yop&quot;, &quot;http://www.domain.com/path/to?q=3&quot;)]
        public void TrimPathEndSlash(string input, string expected)
        {
            var source = new Uri(input);
            var output = source.TrimPathEndSlash();
            Assert.AreEqual(expected, output.ToString());
        }

        [TestCase(&quot;/foo/bar&quot;, &quot;http://www.domain.com&quot;, &quot;http://www.domain.com/foo/bar&quot;)]
        [TestCase(&quot;/foo/bar&quot;, &quot;http://www.domain.com/dang/dang&quot;, &quot;http://www.domain.com/foo/bar&quot;)]
        [TestCase(&quot;/&quot;, &quot;http://www.domain.com/dang/dang&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;/foo/bar&quot;, &quot;http://www.domain.com/dang/dang?q=3#dang&quot;, &quot;http://www.domain.com/foo/bar&quot;)]
        [TestCase(&quot;/foo/bar?k=6#yop&quot;, &quot;http://www.domain.com/dang/dang?q=3#dang&quot;, &quot;http://www.domain.com/foo/bar?k=6&quot;)]
        public void MakeAbsolute(string input, string reference, string expected)
        {
            var source = new Uri(input, UriKind.Relative);
            var absolute = new Uri(reference);
            var output = source.MakeAbsolute(absolute);
            Assert.AreEqual(expected, output.ToString());
        }

        [TestCase(&quot;http://www.domain.com/path/to/page&quot;, &quot;http://www.domain.com/path/to/page&quot;)]
        [TestCase(&quot;http://www.domain.com/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/&quot;)]
        [TestCase(&quot;http://www.domain.com&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com/&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com/path/to?q=3#yop&quot;, &quot;http://www.domain.com/path/to?q=3#yop&quot;)]
        [TestCase(&quot;http://www.domain.com/path/to/?q=3#yop&quot;, &quot;http://www.domain.com/path/to/?q=3#yop&quot;)]
        [TestCase(&quot;http://www.domain.com:666/path/to/page&quot;, &quot;http://www.domain.com/path/to/page&quot;)]
        [TestCase(&quot;http://www.domain.com:666/path/to/page/&quot;, &quot;http://www.domain.com/path/to/page/&quot;)]
        [TestCase(&quot;http://www.domain.com:666&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com:666/&quot;, &quot;http://www.domain.com/&quot;)]
        [TestCase(&quot;http://www.domain.com:666/path/to?q=3#yop&quot;, &quot;http://www.domain.com/path/to?q=3#yop&quot;)]
        [TestCase(&quot;http://www.domain.com:666/path/to/?q=3#yop&quot;, &quot;http://www.domain.com/path/to/?q=3#yop&quot;)]
        public void WithoutPort(string input, string expected)
        {
            var source = new Uri(input);
            var output = source.WithoutPort();
            Assert.AreEqual(expected, output.ToString());
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,10,1],[17,13,17,41,1],[18,9,18,10,1],[44,9,44,10,1],[45,13,45,50,1],[47,13,47,41,1],[48,13,48,80,1],[49,9,49,10,1],[62,9,62,10,1],[63,13,63,41,1],[64,13,64,68,1],[65,9,65,10,1],[78,9,78,10,1],[79,13,79,41,1],[80,13,80,47,1],[81,13,81,58,1],[82,9,82,10,1],[87,9,87,10,1],[88,13,88,41,1],[89,13,90,17,1],[90,17,90,18,1],[90,18,91,21,1],[91,21,91,55,1],[91,55,92,17,1],[92,17,92,18,0],[92,18,92,20,1],[89,13,92,20,1],[93,9,93,10,1],[103,9,103,10,1],[104,13,104,41,1],[105,13,105,54,1],[106,13,106,58,1],[107,9,107,10,1],[112,9,112,10,1],[113,13,113,41,1],[114,13,115,17,1],[115,17,115,18,1],[115,18,116,21,1],[116,21,116,62,1],[116,62,117,17,1],[117,17,117,18,0],[117,18,117,20,1],[114,13,117,20,1],[118,9,118,10,1],[134,9,134,10,1],[135,13,135,69,1],[136,13,136,55,1],[137,13,137,47,1],[138,9,138,10,1],[142,9,142,10,1],[143,13,143,69,1],[144,13,144,58,1],[145,13,145,47,1],[146,9,146,10,1],[151,9,151,10,1],[152,13,152,69,1],[153,13,153,62,1],[154,13,154,47,1],[155,9,155,10,1],[163,9,163,10,1],[164,13,164,41,1],[165,13,165,52,1],[166,13,166,58,1],[167,9,167,10,1],[175,9,175,10,1],[176,13,176,41,1],[177,13,177,52,1],[178,13,178,58,1],[179,9,179,10,1],[187,9,187,10,1],[188,13,188,59,1],[189,13,189,47,1],[190,13,190,56,1],[191,13,191,58,1],[192,9,192,10,1],[207,9,207,10,1],[208,13,208,41,1],[209,13,209,47,1],[210,13,210,58,1],[211,9,211,10,1]]);
    </script>
  </body>
</html>