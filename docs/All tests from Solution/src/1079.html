<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Mvc\SurfaceControllerFactory.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.Mvc;
using System.Web.Routing;

namespace Umbraco.Web.Mvc
{
	/// &lt;summary&gt;
	/// Creates SurfaceControllers
	/// &lt;/summary&gt;
	[Obsolete(&quot;This is not used in the codebase and will be removed from the core in future versions&quot;)]
	public class SurfaceControllerFactory : RenderControllerFactory
	{
		/// &lt;summary&gt;
		/// Check if the correct data tokens are in the route values so that we know its a surface controller route
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public override bool CanHandle(RequestContext request)
		{
			var area = request.RouteData.DataTokens[&quot;area&quot;];
			
			//if its a non-area route don&#39;t handle, all surface controllers will be in the &#39;umbraco&#39; area
			if (area == null || string.IsNullOrWhiteSpace(area.ToString()))
				return false;

			//ensure there is an umbraco token set
			var umbracoToken = request.RouteData.DataTokens[Core.Constants.Web.UmbracoDataToken];
			if (umbracoToken == null || string.IsNullOrWhiteSpace(umbracoToken.ToString()))
				return false;

			return true;
		}

		/// &lt;summary&gt;
		/// Create the controller
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;requestContext&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;controllerName&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public override IController CreateController(RequestContext requestContext, string controllerName)
		{
			//first try to instantiate with the DependencyResolver, if that fails, try with the UmbracoContext as a param, if that fails try with no params.
			var controllerType = GetControllerType(requestContext, controllerName);
			if (controllerType == null)
				throw new InvalidOperationException(&quot;Could not find a controller type for the controller name &quot; + controllerName);

			object controllerObject;
			try
			{
				controllerObject = DependencyResolver.Current.GetService(controllerType);
			}
			catch (Exception)
			{
				try
				{
					controllerObject = Activator.CreateInstance(controllerType, UmbracoContext.Current);
				}
				catch (Exception)
				{
					//if this throws an exception, we&#39;ll let it
					controllerObject = Activator.CreateInstance(controllerType);
				}
			}
			//if an exception is thrown here, we want it to be thrown as its an invalid cast.
			return (IController)controllerObject;			
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,3,19,4,0],[20,4,20,52,0],[23,4,23,67,0],[24,5,24,18,0],[27,4,27,89,0],[28,4,28,83,0],[29,5,29,18,0],[31,4,31,16,0],[32,3,32,4,0],[41,3,41,4,0],[43,4,43,75,0],[44,4,44,31,0],[45,5,45,119,0],[49,4,49,5,0],[50,5,50,78,0],[51,4,51,5,0],[52,4,52,21,0],[53,4,53,5,0],[55,5,55,6,0],[56,6,56,90,0],[57,5,57,6,0],[58,5,58,22,0],[59,5,59,6,0],[61,6,61,66,0],[62,5,62,6,0],[63,4,63,5,0],[65,4,65,41,0],[66,3,66,4,0]]);
    </script>
  </body>
</html>