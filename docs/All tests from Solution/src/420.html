<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\uQuery\uQuery-Media.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using umbraco.cms.businesslogic.media;

namespace umbraco
{
	public static partial class uQuery
	{
		/// &lt;summary&gt;
		/// Get a collection of media items from an XPath expression (note XML source is currently a flat structure)
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;xPath&quot;&gt;XPath expression&lt;/param&gt;
		/// &lt;returns&gt;collection or empty collection&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetMediaByXPath(string xPath)
		{
			var media = new List&lt;Media&gt;();
			var xmlDocument = uQuery.GetPublishedXml(UmbracoObjectType.Media);
			var xPathNavigator = xmlDocument.CreateNavigator();
			var xPathNodeIterator = xPathNavigator.Select(xPath);

			while (xPathNodeIterator.MoveNext())
			{
				var mediaItem = uQuery.GetMedia(xPathNodeIterator.Current.Evaluate(&quot;string(@id)&quot;).ToString());
				if (mediaItem != null)
				{
					media.Add(mediaItem);
				}
			}

			return media;
		}

		/// &lt;summary&gt;
		/// Get collection of media objects from the supplied CSV of IDs
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;csv&quot;&gt;string csv of IDs&lt;/param&gt;
		/// &lt;returns&gt;collection or emtpy collection&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetMediaByCsv(string csv)
		{
			var media = new List&lt;Media&gt;();
			var ids = uQuery.GetCsvIds(csv);

			if (ids != null)
			{
				foreach (string id in ids)
				{
					var mediaItem = uQuery.GetMedia(id);
					if (mediaItem != null)
					{
						media.Add(mediaItem);
					}
				}
			}

			return media;
		}

		/// &lt;summary&gt;
		/// Gets the media by XML.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;xml&quot;&gt;The XML.&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetMediaByXml(string xml)
		{
			var media = new List&lt;Media&gt;();
			var ids = uQuery.GetXmlIds(xml);

			if (ids != null)
			{
				foreach (int id in ids)
				{
					var mediaItem = uQuery.GetMedia(id);
					if (mediaItem != null)
					{
						media.Add(mediaItem);
					}
				}
			}

			return media;
		}

		/// &lt;summary&gt;
		/// Get Media by name
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;name&quot;&gt;name of node to look for&lt;/param&gt;
		/// &lt;returns&gt;list of nodes, or empty list&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetMediaByName(string name)
		{
			return uQuery.GetMediaByXPath(string.Concat(&quot;descendant::*[@nodeName=&#39;&quot;, name, &quot;&#39;]&quot;));
		}

		/// &lt;summary&gt;
		/// Get Media by media type alias
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;mediaTypeAlias&quot;&gt;The media type alias&lt;/param&gt;
		/// &lt;returns&gt;list of media, or empty list&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetMediaByType(string mediaTypeAlias)
		{
			// Both XML schema versions have this attribute
			return uQuery.GetMediaByXPath(string.Concat(&quot;descendant::*[@nodeTypeAlias=&#39;&quot;, mediaTypeAlias, &quot;&#39;]&quot;));
		}

		// public static Media GetCurrentMedia() { }

		/// &lt;summary&gt;
		/// Get media item from an ID
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;mediaId&quot;&gt;string ID of media item to get&lt;/param&gt;
		/// &lt;returns&gt;media or null&lt;/returns&gt;
		public static Media GetMedia(string mediaId)
		{
			int id;
			Media mediaItem = null;

			if (int.TryParse(mediaId, out id))
			{
				mediaItem = uQuery.GetMedia(id);
			}

			return mediaItem;
		}

		/// &lt;summary&gt;
		/// Get media item from an ID
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;id&quot;&gt;ID of media item to get&lt;/param&gt;
		/// &lt;returns&gt;Media or null&lt;/returns&gt;
		public static Media GetMedia(int id)
		{
			// suppress error if media with supplied id doesn&#39;t exist
			try
			{
				return new Media(id);
			}
			catch
			{
				return null;
			}
		}

		/// &lt;summary&gt;
		/// Extension method on Media collection to return key value pairs of: media.Id / media.Text
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;generic list of Media objects&lt;/param&gt;
		/// &lt;returns&gt;a collection of mediaIDs and their text fields&lt;/returns&gt;
		public static Dictionary&lt;int, string&gt; ToNameIds(this IEnumerable&lt;Media&gt; media)
		{
			var dictionary = new Dictionary&lt;int, string&gt;();

			foreach (var mediaItem in media)
			{
				if (mediaItem != null &amp;&amp; mediaItem.Id != -1)
				{
					dictionary.Add(mediaItem.Id, mediaItem.Text);
				}
			}

			return dictionary;
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,3,14,4,0],[15,4,15,34,0],[16,4,16,70,0],[17,4,17,55,0],[18,4,18,57,0],[20,4,20,40,0],[21,4,21,5,0],[22,5,22,99,0],[23,5,23,27,0],[24,5,24,6,0],[25,6,25,27,0],[26,5,26,6,0],[27,4,27,5,0],[29,4,29,17,0],[30,3,30,4,0],[38,3,38,4,0],[39,4,39,34,0],[40,4,40,36,0],[42,4,42,20,0],[43,4,43,5,0],[44,5,44,12,0],[44,14,44,23,0],[44,24,44,26,0],[44,27,44,30,0],[45,5,45,6,0],[46,6,46,42,0],[47,6,47,28,0],[48,6,48,7,0],[49,7,49,28,0],[50,6,50,7,0],[51,5,51,6,0],[52,4,52,5,0],[54,4,54,17,0],[55,3,55,4,0],[63,3,63,4,0],[64,4,64,34,0],[65,4,65,36,0],[67,4,67,20,0],[68,4,68,5,0],[69,5,69,12,0],[69,14,69,20,0],[69,21,69,23,0],[69,24,69,27,0],[70,5,70,6,0],[71,6,71,42,0],[72,6,72,28,0],[73,6,73,7,0],[74,7,74,28,0],[75,6,75,7,0],[76,5,76,6,0],[77,4,77,5,0],[79,4,79,17,0],[80,3,80,4,0],[88,3,88,4,0],[89,4,89,90,0],[90,3,90,4,0],[98,3,98,4,0],[100,4,100,105,0],[101,3,101,4,0],[111,3,111,4,0],[113,4,113,27,0],[115,4,115,38,0],[116,4,116,5,0],[117,5,117,37,0],[118,4,118,5,0],[120,4,120,21,0],[121,3,121,4,0],[129,3,129,4,0],[132,4,132,5,0],[133,5,133,26,0],[135,4,135,9,0],[136,4,136,5,0],[137,5,137,17,0],[139,3,139,4,0],[147,3,147,4,0],[148,4,148,51,0],[150,4,150,11,0],[150,13,150,26,0],[150,27,150,29,0],[150,30,150,35,0],[151,4,151,5,0],[152,5,152,49,0],[153,5,153,6,0],[154,6,154,51,0],[155,5,155,6,0],[156,4,156,5,0],[158,4,158,22,0],[159,3,159,4,0]]);
    </script>
  </body>
</html>