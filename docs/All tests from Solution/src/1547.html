<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\IO\FileSystemExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.IO;
using System.Threading;

namespace Umbraco.Core.IO
{
    public static class FileSystemExtensions
    {

        /// &lt;summary&gt;
        /// Attempts to open the file at &lt;code&gt;filePath&lt;/code&gt; up to &lt;code&gt;maxRetries&lt;/code&gt; times,
        /// with a thread sleep time of &lt;code&gt;sleepPerRetryInMilliseconds&lt;/code&gt; between retries.
        /// &lt;/summary&gt;
        public static FileStream OpenReadWithRetry(this FileInfo file, int maxRetries = 5, int sleepPerRetryInMilliseconds = 50)
        {
            var retries = maxRetries;

            while (retries &gt; 0)
            {
                try
                {
                    return File.OpenRead(file.FullName);
                }
                catch(IOException)
                {
                    retries--;

                    if (retries == 0)
                    {
                        throw;
                    }

                    Thread.Sleep(sleepPerRetryInMilliseconds);
                }
            }

            throw new ArgumentException(&quot;Retries must be greater than zero&quot;);
        }

        public static long GetSize(this IFileSystem fs, string path)
        {
            using (var file = fs.OpenFile(path))
            {
                return file.Length;
            }
        }

        public static void CopyFile(this IFileSystem fs, string path, string newPath)
        {
            using (var stream = fs.OpenFile(path))
            {
                fs.AddFile(newPath, stream);
            }
        }

        public static string GetExtension(this IFileSystem fs, string path)
        {
            return Path.GetExtension(fs.GetFullPath(path));
        }

        public static string GetFileName(this IFileSystem fs, string path)
        {
            return Path.GetFileName(fs.GetFullPath(path));
        }

        //TODO: Currently this is the only way to do this
        internal static void CreateFolder(this IFileSystem fs, string folderPath)
        {
            var path = fs.GetRelativePath(folderPath);
            var tempFile = Path.Combine(path, Guid.NewGuid().ToString(&quot;N&quot;) + &quot;.tmp&quot;);
            using (var s = new MemoryStream())
            {
                fs.AddFile(tempFile, s);
            }
            fs.DeleteFile(tempFile);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,0],[16,13,16,38,0],[18,13,18,32,0],[19,13,19,14,0],[21,17,21,18,0],[22,21,22,57,0],[24,17,24,35,0],[25,17,25,18,0],[26,21,26,31,0],[28,21,28,38,0],[29,21,29,22,0],[30,25,30,31,0],[33,21,33,63,0],[34,17,34,18,0],[35,13,35,14,0],[37,13,37,78,0],[38,9,38,10,0],[41,9,41,10,1],[42,20,42,48,1],[43,13,43,14,1],[44,17,44,36,1],[46,9,46,10,1],[49,9,49,10,0],[50,20,50,50,0],[51,13,51,14,0],[52,17,52,45,0],[53,13,53,14,0],[54,9,54,10,0],[57,9,57,10,0],[58,13,58,60,0],[59,9,59,10,0],[62,9,62,10,0],[63,13,63,59,0],[64,9,64,10,0],[68,9,68,10,0],[69,13,69,55,0],[70,13,70,86,0],[71,20,71,46,0],[72,13,72,14,0],[73,17,73,41,0],[74,13,74,14,0],[75,13,75,37,0],[76,9,76,10,0]]);
    </script>
  </body>
</html>