<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Web\Controllers\WebApiEditors\MediaControllerUnitTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Web.Http;
using Moq;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Core.Models.Membership;
using Umbraco.Core.Services;
using Umbraco.Web.Editors;

namespace Umbraco.Tests.Web.Controllers.WebApiEditors
{
    [TestFixture]
    public class MediaControllerUnitTests
    {
        [Test]
        public void Access_Allowed_By_Path()
        {
            //arrange
            var userMock = new Mock&lt;IUser&gt;();
            userMock.Setup(u =&gt; u.Id).Returns(9);
            userMock.Setup(u =&gt; u.StartMediaId).Returns(-1);
            var user = userMock.Object;
            var mediaMock = new Mock&lt;IMedia&gt;();
            mediaMock.Setup(m =&gt; m.Path).Returns(&quot;-1,1234,5678&quot;);
            var media = mediaMock.Object;
            var mediaServiceMock = new Mock&lt;IMediaService&gt;();            
            mediaServiceMock.Setup(x =&gt; x.GetById(1234)).Returns(media);
            var mediaService = mediaServiceMock.Object;

            //act
            var result = MediaController.CheckPermissions(new Dictionary&lt;string, object&gt;(), user, mediaService, 1234);

            //assert
            Assert.IsTrue(result);
        }

        [Test]
        public void Throws_Exception_When_No_Media_Found()
        {
            //arrange
            var userMock = new Mock&lt;IUser&gt;();
            userMock.Setup(u =&gt; u.Id).Returns(9);
            userMock.Setup(u =&gt; u.StartMediaId).Returns(-1);
            var user = userMock.Object;
            var mediaMock = new Mock&lt;IMedia&gt;();
            mediaMock.Setup(m =&gt; m.Path).Returns(&quot;-1,1234,5678&quot;);
            var media = mediaMock.Object;
            var mediaServiceMock = new Mock&lt;IMediaService&gt;();
            mediaServiceMock.Setup(x =&gt; x.GetById(0)).Returns(media);
            var mediaService = mediaServiceMock.Object;
            
            //act/assert
            Assert.Throws&lt;HttpResponseException&gt;(() =&gt; MediaController.CheckPermissions(new Dictionary&lt;string, object&gt;(), user, mediaService, 1234));
        }

        [Test]
        public void No_Access_By_Path()
        {
            //arrange
            var userMock = new Mock&lt;IUser&gt;();
            userMock.Setup(u =&gt; u.Id).Returns(9);
            userMock.Setup(u =&gt; u.StartMediaId).Returns(9876);
            var user = userMock.Object;
            var mediaMock = new Mock&lt;IMedia&gt;();
            mediaMock.Setup(m =&gt; m.Path).Returns(&quot;-1,1234,5678&quot;);
            var media = mediaMock.Object;
            var mediaServiceMock = new Mock&lt;IMediaService&gt;();
            mediaServiceMock.Setup(x =&gt; x.GetById(1234)).Returns(media);
            var mediaService = mediaServiceMock.Object;
            
            //act
            var result = MediaController.CheckPermissions(new Dictionary&lt;string, object&gt;(), user, mediaService, 1234);

            //assert
            Assert.IsFalse(result);
        }

        [Test]
        public void Access_To_Root_By_Path()
        {
            //arrange
            var userMock = new Mock&lt;IUser&gt;();
            userMock.Setup(u =&gt; u.Id).Returns(0);
            userMock.Setup(u =&gt; u.StartMediaId).Returns(-1);
            var user = userMock.Object;
            
            //act
            var result = MediaController.CheckPermissions(new Dictionary&lt;string, object&gt;(), user, null, -1);

            //assert
            Assert.IsTrue(result);
        }

        [Test]
        public void No_Access_To_Root_By_Path()
        {
            //arrange
            var userMock = new Mock&lt;IUser&gt;();
            userMock.Setup(u =&gt; u.Id).Returns(0);
            userMock.Setup(u =&gt; u.StartMediaId).Returns(1234);
            var user = userMock.Object;

            //act
            var result = MediaController.CheckPermissions(new Dictionary&lt;string, object&gt;(), user, null, -1);

            //assert
            Assert.IsFalse(result);
        }

        [Test]
        public void Access_To_Recycle_Bin_By_Path()
        {
            //arrange
            var userMock = new Mock&lt;IUser&gt;();
            userMock.Setup(u =&gt; u.Id).Returns(0);
            userMock.Setup(u =&gt; u.StartMediaId).Returns(-1);
            var user = userMock.Object;

            //act
            var result = MediaController.CheckPermissions(new Dictionary&lt;string, object&gt;(), user, null, -21);

            //assert
            Assert.IsTrue(result);
        }

        [Test]
        public void No_Access_To_Recycle_Bin_By_Path()
        {
            //arrange
            var userMock = new Mock&lt;IUser&gt;();
            userMock.Setup(u =&gt; u.Id).Returns(0);
            userMock.Setup(u =&gt; u.StartMediaId).Returns(1234);
            var user = userMock.Object;

            //act
            var result = MediaController.CheckPermissions(new Dictionary&lt;string, object&gt;(), user, null, -21);

            //assert
            Assert.IsFalse(result);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[19,13,19,46,1],[20,13,20,50,1],[21,13,21,61,1],[22,13,22,40,1],[23,13,23,48,1],[24,13,24,66,1],[25,13,25,42,1],[26,13,26,62,1],[27,13,27,73,1],[28,13,28,56,1],[31,13,31,119,1],[34,13,34,35,1],[35,9,35,10,1],[39,9,39,10,1],[41,13,41,46,1],[42,13,42,50,1],[43,13,43,61,1],[44,13,44,40,1],[45,13,45,48,1],[46,13,46,66,1],[47,13,47,42,1],[48,13,48,62,1],[49,13,49,70,1],[50,13,50,56,1],[53,13,53,56,1],[53,56,53,148,1],[53,148,53,150,1],[53,13,53,150,1],[54,9,54,10,1],[58,9,58,10,1],[60,13,60,46,1],[61,13,61,50,1],[62,13,62,63,1],[63,13,63,40,1],[64,13,64,48,1],[65,13,65,66,1],[66,13,66,42,1],[67,13,67,62,1],[68,13,68,73,1],[69,13,69,56,1],[72,13,72,119,1],[75,13,75,36,1],[76,9,76,10,1],[80,9,80,10,1],[82,13,82,46,1],[83,13,83,50,1],[84,13,84,61,1],[85,13,85,40,1],[88,13,88,109,1],[91,13,91,35,1],[92,9,92,10,1],[96,9,96,10,1],[98,13,98,46,1],[99,13,99,50,1],[100,13,100,63,1],[101,13,101,40,1],[104,13,104,109,1],[107,13,107,36,1],[108,9,108,10,1],[112,9,112,10,1],[114,13,114,46,1],[115,13,115,50,1],[116,13,116,61,1],[117,13,117,40,1],[120,13,120,110,1],[123,13,123,35,1],[124,9,124,10,1],[128,9,128,10,1],[130,13,130,46,1],[131,13,131,50,1],[132,13,132,63,1],[133,13,133,40,1],[136,13,136,110,1],[139,13,139,36,1],[140,9,140,10,1]]);
    </script>
  </body>
</html>