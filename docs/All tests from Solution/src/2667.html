<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\Slider\SliderPrevalueEditor.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.UI;
using System.Web.UI.WebControls;
using umbraco.cms.businesslogic.datatype;

namespace umbraco.editorControls.Slider
{
    /// &lt;summary&gt;
    /// The PreValue Editor for the Slider data-type.
    /// &lt;/summary&gt;
    [ClientDependency.Core.ClientDependency(ClientDependency.Core.ClientDependencyType.Javascript, &quot;ui/jqueryui.js&quot;, &quot;UmbracoClient&quot;)]
    [ClientDependency.Core.ClientDependency(ClientDependency.Core.ClientDependencyType.Css, &quot;DateTimePicker/datetimepicker.css&quot;, &quot;UmbracoClient&quot;)]
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public class SliderPrevalueEditor : AbstractJsonPrevalueEditor
    {
        /// &lt;summary&gt;
        /// The DropDownList for the database data-type.
        /// &lt;/summary&gt;
        private DropDownList DatabaseDataType;

        /// &lt;summary&gt;
        /// The CheckBox control to enable the range for the slider.
        /// &lt;/summary&gt;
        private CheckBox EnableRange;

        /// &lt;summary&gt;
        /// The CheckBox control to enable incremental steps for the slider.
        /// &lt;/summary&gt;
        private CheckBox EnableStep;

        /// &lt;summary&gt;
        /// The TextBox control for the minimum value of the slider.
        /// &lt;/summary&gt;
        private TextBox MinValue;

        /// &lt;summary&gt;
        /// The TextBox control for the maximum value of the slider.
        /// &lt;/summary&gt;
        private TextBox MaxValue;

        /// &lt;summary&gt;
        /// The DropDownList control for the orientation of the slider.
        /// &lt;/summary&gt;
        private DropDownList Orientation;

        /// &lt;summary&gt;
        /// The DropDownList control for the range value.
        /// &lt;/summary&gt;
        private DropDownList RangeValue;

        /// &lt;summary&gt;
        /// The TextBox control for the incremental step value.
        /// &lt;/summary&gt;
        private TextBox StepValue;

        /// &lt;summary&gt;
        /// The TextBox control for the first value input.
        /// &lt;/summary&gt;
        private TextBox Value;

        /// &lt;summary&gt;
        /// The TextBox control for the second value input.
        /// &lt;/summary&gt;
        private TextBox Value2;

        ////private SliderControl PreviewSlider;

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;SliderPrevalueEditor&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dataType&quot;&gt;Type of the data.&lt;/param&gt;
        public SliderPrevalueEditor(umbraco.cms.businesslogic.datatype.BaseDataType dataType)
            : base(dataType)
        {
        }

        /// &lt;summary&gt;
        /// Saves the data-type PreValue options.
        /// &lt;/summary&gt;
        public override void Save()
        {
            // set the database data-type
            this.m_DataType.DBType = (umbraco.cms.businesslogic.datatype.DBTypes)Enum.Parse(typeof(umbraco.cms.businesslogic.datatype.DBTypes), this.DatabaseDataType.SelectedValue);

            // parse the integers &amp; doubles
            double maxValue, minValue, value, value2, stepValue;
            double.TryParse(this.MaxValue.Text, out maxValue);
            double.TryParse(this.MinValue.Text, out minValue);
            double.TryParse(this.Value.Text, out value);
            double.TryParse(this.Value2.Text, out value2);
            double.TryParse(this.StepValue.Text, out stepValue);

            // set the options
            var options = new SliderOptions()
            {
                DBType = (DBTypes)Enum.Parse(typeof(DBTypes), this.DatabaseDataType.SelectedValue),
                EnableRange = this.EnableRange.Checked,
                EnableStep = this.EnableStep.Checked,
                MaxValue = maxValue,
                MinValue = minValue,
                Orientation = this.Orientation.SelectedValue,
                RangeValue = this.RangeValue.SelectedValue,
                StepValue = stepValue,
                Value = value,
                Value2 = value2
            };

            // save the options as JSON
            this.SaveAsJson(options);

            // toggle the non-default fields
            this.ToggleFields();
        }

        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:System.Web.UI.Control.Init&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;An &lt;see cref=&quot;T:System.EventArgs&quot;/&gt; object that contains the event data.&lt;/param&gt;
        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);
            this.EnsureChildControls();
        }

        /// &lt;summary&gt;
        /// Creates child controls for this control
        /// &lt;/summary&gt;
        protected override void CreateChildControls()
        {
            base.CreateChildControls();

            // set-up child controls
            this.DatabaseDataType = new DropDownList() { ID = &quot;DatabaseDataType&quot; };
            this.EnableRange = new CheckBox() { ID = &quot;EnableRange&quot; };
            this.EnableStep = new CheckBox() { ID = &quot;EnableStep&quot; };
            this.MinValue = new TextBox() { ID = &quot;MinValue&quot;, CssClass = &quot;guiInputText slider-numeric slider-decimal&quot; };
            this.MaxValue = new TextBox() { ID = &quot;MaxValue&quot;, CssClass = &quot;guiInputText slider-numeric slider-decimal&quot; };
            this.Orientation = new DropDownList() { ID = &quot;Orientation&quot; };
            this.RangeValue = new DropDownList() { ID = &quot;RangeValue&quot; };
            this.StepValue = new TextBox() { ID = &quot;StepValue&quot;, CssClass = &quot;guiInputText slider-numeric slider-decimal&quot; };
            this.Value = new TextBox() { ID = &quot;Value&quot;, CssClass = &quot;guiInputText slider-numeric slider-decimal&quot; };
            this.Value2 = new TextBox() { ID = &quot;Value2&quot;, CssClass = &quot;guiInputText slider-numeric slider-decimal&quot; };
            ////this.PreviewSlider = new SliderControl() { ID = &quot;PreviewSlider&quot;, Options = new SliderOptions(true) };

            // add the database data-type options
            this.DatabaseDataType.Items.Clear();
            this.DatabaseDataType.Items.Add(DBTypes.Integer.ToString());
            //this.DatabaseDataType.Items.Add(DBTypes.Ntext.ToString());
            this.DatabaseDataType.Items.Add(DBTypes.Nvarchar.ToString());

            // add range options
            this.RangeValue.Items.Clear();
            this.RangeValue.Items.Add(string.Empty);
            this.RangeValue.Items.Add(new ListItem(&quot;Minimum Value&quot;, &quot;min&quot;));
            this.RangeValue.Items.Add(new ListItem(&quot;Maximum Value&quot;, &quot;max&quot;));

            // add orientation options
            this.Orientation.Items.Clear();
            this.Orientation.Items.Add(new ListItem(&quot;Horizontal (default)&quot;, &quot;horizontal&quot;));
            this.Orientation.Items.Add(new ListItem(&quot;Vertical&quot;, &quot;vertical&quot;));

            // add the child controls
            this.Controls.AddPrevalueControls(this.DatabaseDataType, this.EnableRange, this.EnableStep, this.MaxValue, this.MinValue, this.Orientation, this.RangeValue, this.StepValue, this.Value, this.Value2);
            ////this.Controls.Add(this.PreviewSlider);
        }

        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:System.Web.UI.Control.Load&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;T:System.EventArgs&quot;/&gt; object that contains the event data.&lt;/param&gt;
        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            // get PreValues, load them into the controls.
            var options = this.GetPreValueOptions&lt;SliderOptions&gt;();

            // if the options are null, then load the defaults
            if (options == null)
            {
                options = new SliderOptions(true);
            }

            // set the values
            this.DatabaseDataType.SelectedValue = this.m_DataType.DBType.ToString();
            this.EnableRange.Checked = options.EnableRange;
            this.EnableStep.Checked = options.EnableStep;
            this.MinValue.Text = options.MinValue.ToString();
            this.MaxValue.Text = options.MaxValue.ToString();
            this.Orientation.SelectedValue = options.Orientation;
            this.RangeValue.SelectedValue = options.RangeValue;
            this.StepValue.Text = options.StepValue.ToString();
            this.Value.Text = options.Value.ToString();
            this.Value2.Text = options.Value2.ToString();

            // toggle the non-default fields
            this.ToggleFields();
        }

        /// &lt;summary&gt;
        /// Renders the contents of the control to the specified writer. This method is used primarily by control developers.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;writer&quot;&gt;A &lt;see cref=&quot;T:System.Web.UI.HtmlTextWriter&quot;/&gt; that represents the output stream to render HTML content on the client.&lt;/param&gt;
        protected override void RenderContents(HtmlTextWriter writer)
        {
            // add property fields
            writer.AddPrevalueRow(&quot;Database Type:&quot;, this.DatabaseDataType);
            writer.AddPrevalueRow(&quot;Enable Range:&quot;, this.EnableRange);
            writer.AddPrevalueRow(&quot;Range:&quot;, this.RangeValue);
            writer.AddPrevalueRow(&quot;Initial Value:&quot;, this.Value);
            writer.AddPrevalueRow(&quot;Initial Value 2:&quot;, this.Value2);
            writer.AddPrevalueRow(&quot;Minimum Value:&quot;, this.MinValue);
            writer.AddPrevalueRow(&quot;Maximum Value:&quot;, this.MaxValue);
            writer.AddPrevalueRow(&quot;Enable Step Increments:&quot;, this.EnableStep);
            writer.AddPrevalueRow(&quot;Step Increments:&quot;, this.StepValue);
            writer.AddPrevalueRow(&quot;Orientation:&quot;, this.Orientation);

            ////writer.AddPrevalueRow(&quot;&amp;nbsp;&quot;, new LiteralControl(&quot;&lt;h2 class=&#39;propertypaneTitel&#39;&gt;Preview:&lt;/h2&gt;&lt;br/&gt;&quot;), this.PreviewSlider);

            // add jquery window load event for toggling fields.
            var javascriptMethod = string.Format(
                @&quot;
$(&#39;#{0}&#39;).click(function(){{
    var disable = !$(this).attr(&#39;checked&#39;);
    $(&#39;#{1},#{3}&#39;).attr(&#39;disabled&#39;, disable);
    $(&#39;#{6}&#39;).val(disable &amp;&amp; !checkDecimals() ? &#39;Integer&#39; : &#39;Nvarchar&#39;);
    if(!disable) disable = $(&#39;#{1}&#39;).val() != &#39;&#39;;
    
}});
$(&#39;#{1}&#39;).change(function(){{
    var disable = $(this).val() != &#39;&#39;;
    $(&#39;#{3}&#39;).attr(&#39;disabled&#39;, disable);
}});
$(&#39;#{4}&#39;).click(function(){{
    var disable = !$(this).attr(&#39;checked&#39;);
    $(&#39;#{5}&#39;).attr(&#39;disabled&#39;, disable);
}});
$(&#39;#{6}&#39;).change(function(){{
    var disable = $(this).val() == &#39;Integer&#39;;
    if (checkDecimals() &amp;&amp; disable) {{
        $(&#39;#{6}&#39;).val(&#39;Nvarchar&#39;);
        alert(&#39;Please remove decimal points below if you wish to use the Integer datatype&#39;);  
    }}
    else {{
    $(&#39;#{0}&#39;).removeAttr(&#39;checked&#39;);
    $(&#39;#{1},#{3}&#39;).attr(&#39;disabled&#39;, disable);
    }}
}});
$(&#39;.slider-numeric&#39;).keydown(function(event) {{
    // Allow only backspace and delete
    if ( event.keyCode == 46 || event.keyCode == 8 || ($(this).hasClass(&#39;slider-decimal&#39;) &amp;&amp; (event.keyCode == 110 || event.keyCode == 190))) {{
        // let it happen, don&#39;t do anything
    }} else {{
        // Ensure that it is a number and stop the keypress
        if ( (event.keyCode &lt; 48 || event.keyCode &gt; 57 ) &amp;&amp; (event.keyCode &lt; 96 || event.keyCode &gt; 105 ) ) {{
            event.preventDefault();
        }}
    }}
}});
$(&#39;.slider-numeric&#39;).keyup(function(event) {{
    if ($(&#39;#{6}&#39;).val() != &#39;Nvarchar&#39; &amp;&amp; checkDecimals()) {{
        $(&#39;#{6}&#39;).val(&#39;Nvarchar&#39;);
    }}
}});
function checkDecimals() {{
    foundDecimals = false;
    $(&#39;.slider-numeric&#39;).each(function() {{
            if ($(this).val().indexOf(&#39;.&#39;) &gt;= 0) {{
                foundDecimals = true;
                return false;
            }}  
        }});
    return foundDecimals;
}}
&quot;,
                this.EnableRange.ClientID,
                this.RangeValue.ClientID,
                this.Value.ClientID,
                this.Value2.ClientID,
                this.EnableStep.ClientID,
                this.StepValue.ClientID,
                this.DatabaseDataType.ClientID);
            var javascript = string.Concat(&quot;&lt;script type=&#39;text/javascript&#39;&gt;jQuery(window).load(function(){&quot;, javascriptMethod, &quot;});&lt;/script&gt;&quot;);
            writer.WriteLine(javascript);
        }

        /// &lt;summary&gt;
        /// Toggles the fields.
        /// &lt;/summary&gt;
        private void ToggleFields()
        {
            if (this.DatabaseDataType.SelectedIndex == 0)
            {
                this.EnableRange.Checked = false;
            }

            this.RangeValue.Enabled = this.EnableRange.Checked;
            this.Value2.Enabled = this.EnableRange.Checked &amp;&amp; this.RangeValue.SelectedValue == string.Empty;
            this.StepValue.Enabled = this.EnableStep.Checked;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[73,15,73,29,0],[74,9,74,10,0],[75,9,75,10,0],[81,9,81,10,0],[83,13,83,182,0],[87,13,87,63,0],[88,13,88,63,0],[89,13,89,57,0],[90,13,90,59,0],[91,13,91,65,0],[94,13,106,15,0],[109,13,109,38,0],[112,13,112,33,0],[113,9,113,10,0],[120,9,120,10,0],[121,13,121,28,0],[122,13,122,40,0],[123,9,123,10,0],[129,9,129,10,0],[130,13,130,40,0],[133,13,133,84,0],[134,13,134,70,0],[135,13,135,68,0],[136,13,136,120,0],[137,13,137,120,0],[138,13,138,74,0],[139,13,139,72,0],[140,13,140,122,0],[141,13,141,114,0],[142,13,142,116,0],[146,13,146,49,0],[147,13,147,73,0],[149,13,149,74,0],[152,13,152,43,0],[153,13,153,53,0],[154,13,154,77,0],[155,13,155,77,0],[158,13,158,44,0],[159,13,159,92,0],[160,13,160,78,0],[163,13,163,211,0],[165,9,165,10,0],[172,9,172,10,0],[173,13,173,28,0],[176,13,176,68,0],[179,13,179,33,0],[180,13,180,14,0],[181,17,181,51,0],[182,13,182,14,0],[185,13,185,85,0],[186,13,186,60,0],[187,13,187,58,0],[188,13,188,62,0],[189,13,189,62,0],[190,13,190,66,0],[191,13,191,64,0],[192,13,192,64,0],[193,13,193,56,0],[194,13,194,58,0],[197,13,197,33,0],[198,9,198,10,0],[205,9,205,10,0],[207,13,207,76,0],[208,13,208,70,0],[209,13,209,62,0],[210,13,210,65,0],[211,13,211,68,0],[212,13,212,68,0],[213,13,213,68,0],[214,13,214,79,0],[215,13,215,71,0],[216,13,216,69,0],[221,13,282,49,0],[283,13,283,144,0],[284,13,284,42,0],[285,9,285,10,0],[291,9,291,10,0],[292,13,292,58,0],[293,13,293,14,0],[294,17,294,50,0],[295,13,295,14,0],[297,13,297,64,0],[298,13,298,109,0],[299,13,299,62,0],[300,9,300,10,0]]);
    </script>
  </body>
</html>