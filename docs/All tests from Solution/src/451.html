<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\uQuery\MediaExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Xml;
using umbraco.cms.businesslogic.media;
using Umbraco.Core;

namespace umbraco
{
	/// &lt;summary&gt;
	/// Extension methods for umbraco.cms.businesslogic.media.Media
	/// &lt;/summary&gt;
	public static class MediaExtensions
	{
		/// &lt;summary&gt;
		/// Functionally similar to the XPath axis &#39;ancestor&#39;
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;returns&gt;Media nodes as IEnumerable&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetAncestorMedia(this Media media)
		{
			var ancestor = new Media(media.ParentId);

			while (ancestor != null &amp;&amp; ancestor.Id != -1)
			{
				yield return ancestor;

				ancestor = new Media(ancestor.ParentId);
			}
		}

		/// &lt;summary&gt;
		/// Funtionally similar to the XPath axis &#39;ancestor-or-self&#39;
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;returns&gt;Media nodes as IEnumerable&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetAncestorOrSelfMedia(this Media media)
		{
			yield return media;

			foreach (var ancestor in media.GetAncestorMedia())
			{
				yield return ancestor;
			}
		}

		/// &lt;summary&gt;
		/// Gets all sibling Media
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;returns&gt;Media nodes as IEnumerable&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetSiblingMedia(this Media media)
		{
			if (media.Parent != null)
			{
				var parentMedia = new Media(media.ParentId);

				foreach (var siblingMedia in parentMedia.GetChildMedia().Where(childMedia =&gt; childMedia.Id != media.Id))
				{
					yield return siblingMedia;
				}
			}
		}

		/// &lt;summary&gt;
		/// Functionally similar to the XPath axis &#39;descendant-or-self&#39;
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;returns&gt;Media nodes as IEnumerable&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetDescendantOrSelfMedia(this Media media)
		{
			yield return media;

			foreach (var descendant in media.GetDescendantMedia())
			{
				yield return descendant;
			}
		}

		/// &lt;summary&gt;
		/// Functionally similar to the XPath axis &#39;descendant&#39;
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;returns&gt;Media nodes as IEnumerable&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetDescendantMedia(this Media media)
		{
			foreach (var child in media.Children)
			{
				yield return child;

				foreach (var descendant in child.GetDescendantMedia())
				{
					yield return descendant;
				}
			}
		}

		/// &lt;summary&gt;
		/// Functionally similar to the XPath axis &#39;child&#39;
		/// Performance optimised for just imediate children.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;The &lt;c&gt;umbraco.cms.businesslogic.media.Media&lt;/c&gt; object.&lt;/param&gt;
		/// &lt;returns&gt;Media nodes as IEnumerable&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetChildMedia(this Media media)
		{
			foreach (var child in media.Children)
			{
				yield return child;
			}
		}

		/// &lt;summary&gt;
		/// Gets the child media that satisfy the &lt;c&gt;Func&lt;/c&gt; condition.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;The &lt;c&gt;umbraco.cms.businesslogic.media.Media&lt;/c&gt; object.&lt;/param&gt;
		/// &lt;param name=&quot;func&quot;&gt;The func.&lt;/param&gt;
		/// &lt;returns&gt;Media nodes as IEnumerable&lt;/returns&gt;
		public static IEnumerable&lt;Media&gt; GetChildMedia(this Media media, Func&lt;Media, bool&gt; func)
		{
			foreach (var child in media.Children)
			{
				if (func(child))
				{
					yield return child;
				}
			}
		}

        /////// &lt;summary&gt;
        /////// Extension method on Meia obj to get it&#39;s depth
        /////// &lt;/summary&gt;
        /////// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
        /////// &lt;returns&gt;an int representing the depth of the Media object in the tree&lt;/returns&gt;
        ////[Obsolete(&quot;Use .Level instead&quot;)]
        ////public static int GetDepth(this Media media)
        ////{
        ////    return media.Path.Split(&#39;,&#39;).ToList().Count;
        ////}

		/// &lt;summary&gt;
		/// Tell me the level of this node (0 = root)
		/// updated from Depth and changed to start at 0
		/// to align with other &#39;Level&#39; methods (eg xslt)
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static int Level(this Media media)
		{
			return media.Path.Split(&#39;,&#39;).Length - 1;
		}

		/// &lt;summary&gt;
		/// Returns the url for a given crop name using the built in Image Cropper datatype
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;param name=&quot;propertyAlias&quot;&gt;property alias&lt;/param&gt;
		/// &lt;param name=&quot;cropName&quot;&gt;name of crop to get url for&lt;/param&gt;
		/// &lt;returns&gt;emtpy string or url&lt;/returns&gt;
		public static string GetImageCropperUrl(this Media media, string propertyAlias, string cropName)
		{
			string cropUrl = string.Empty;

			/*
			* Example xml : 
			* 
			* &lt;crops date=&quot;28/11/2010 16:08:13&quot;&gt;
			*   &lt;crop name=&quot;Big&quot; x=&quot;0&quot; y=&quot;0&quot; x2=&quot;1024&quot; y2=&quot;768&quot; url=&quot;/media/135/image_Big.jpg&quot; /&gt;
			*   &lt;crop name=&quot;Small&quot; x=&quot;181&quot; y=&quot;0&quot; x2=&quot;608&quot; y2=&quot;320&quot; url=&quot;/media/135/image_Small.jpg&quot; /&gt;
			* &lt;/crops&gt;
			* 
			*/

			if (!string.IsNullOrEmpty(media.GetProperty&lt;string&gt;(propertyAlias)))
			{
				var xmlNode = media.getProperty(propertyAlias).ToXml(new XmlDocument());
				var cropNode = xmlNode.SelectSingleNode(string.Concat(&quot;descendant::crops/crop[@name=&#39;&quot;, cropName, &quot;&#39;]&quot;));

				if (cropNode != null)
				{
					cropUrl = cropNode.Attributes.GetNamedItem(&quot;url&quot;).InnerText;
				}
			}

			return cropUrl;
		}

		/// &lt;summary&gt;
		/// Gets the image URL.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static string GetImageUrl(this Media media)
		{
			if (media.ContentType.Alias.Equals(Constants.Conventions.MediaTypes.Image))
			{
				var url = media.GetProperty&lt;string&gt;(Constants.Conventions.Media.File);
				if (!string.IsNullOrEmpty(url))
				{
					return url;
				}
			}

			return string.Empty;
		}

		/// &lt;summary&gt;
		/// Gets the image thumbnail URL.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;media&quot;&gt;an umbraco.cms.businesslogic.media.Media object&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static string GetImageThumbnailUrl(this Media media)
		{
			if (media.ContentType.Alias.Equals(Constants.Conventions.MediaTypes.Image))
			{
				var url = media.GetProperty&lt;string&gt;(Constants.Conventions.Media.File);
				if (!string.IsNullOrEmpty(url))
				{
					var extension = media.GetProperty&lt;string&gt;(Constants.Conventions.Media.Extension);
                    return url.Replace(string.Concat(&quot;.&quot;, extension), &quot;_thumb.&quot; + extension, StringComparison.InvariantCultureIgnoreCase);
				}
			}

			return string.Empty;
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[148,3,148,4,0],[149,4,149,44,0],[150,3,150,4,0],[160,3,160,4,0],[161,4,161,34,0],[173,4,173,72,0],[174,4,174,5,0],[175,5,175,77,0],[176,5,176,110,0],[178,5,178,26,0],[179,5,179,6,0],[180,6,180,66,0],[181,5,181,6,0],[182,4,182,5,0],[184,4,184,19,0],[185,3,185,4,0],[193,3,193,4,0],[194,4,194,79,0],[195,4,195,5,0],[196,5,196,75,0],[197,5,197,36,0],[198,5,198,6,0],[199,6,199,17,0],[201,4,201,5,0],[203,4,203,24,0],[204,3,204,4,0],[212,3,212,4,0],[213,4,213,79,0],[214,4,214,5,0],[215,5,215,75,0],[216,5,216,36,0],[217,5,217,6,0],[218,6,218,87,0],[219,21,219,139,0],[221,4,221,5,0],[223,4,223,24,0],[224,3,224,4,0]]);
    </script>
  </body>
</html>