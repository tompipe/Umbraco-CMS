<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\create\ScriptTasks.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Umbraco.Core.IO;
using Umbraco.Web.UI;
using Umbraco.Core;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using umbraco.BusinessLogic;
using umbraco.BasePages;

namespace umbraco
{
    public class ScriptTasks : LegacyDialogTask
    {
     
        public override bool PerformSave()
        {
            var scriptFileAr = Alias.Split(&#39;\u00A4&#39;);

            var fileName = scriptFileAr[0];
            var fileType = scriptFileAr[1];
            
            var createFolder = ParentID;

            if (createFolder == 1)
            {
                ApplicationContext.Current.Services.FileService.CreateScriptFolder(fileName);
                return true;
            }

            // remove file extension
            if (fileName.ToLowerInvariant().EndsWith(fileType.ToLowerInvariant()))
            {
                fileName = fileName.Substring(0,
                                              fileName.ToLowerInvariant().LastIndexOf(fileType.ToLowerInvariant(), System.StringComparison.Ordinal) - 1);
            }

            var scriptPath = fileName + &quot;.&quot; + fileType;
            var found = ApplicationContext.Current.Services.FileService.GetScriptByName(scriptPath);
            if (found != null)
            {
                _returnUrl = string.Format(&quot;settings/scripts/editScript.aspx?file={0}&quot;, scriptPath.TrimStart(&#39;/&#39;));
                return true;
            }
            var script = new Script(fileName + &quot;.&quot; + fileType);
            ApplicationContext.Current.Services.FileService.SaveScript(script);
            _returnUrl = string.Format(&quot;settings/scripts/editScript.aspx?file={0}&quot;, scriptPath.TrimStart(&#39;/&#39;));
            return true;
        }

        public override bool PerformDelete()
        {
            if (Alias.Contains(&quot;.&quot;) == false)
            {
                //there is no extension so we&#39;ll assume it&#39;s a folder
                ApplicationContext.Current.Services.FileService.DeleteScriptFolder(Alias.TrimStart(&#39;/&#39;));
            }
            else
            {
                ApplicationContext.Current.Services.FileService.DeleteScript(Alias.TrimStart(&#39;/&#39;), User.Id);    
            }

            return true;
        }

        private string _returnUrl = &quot;&quot;;

        public override string ReturnUrl
        {
            get { return _returnUrl; }
        }

        public override string AssignedApp
        {
            get { return DefaultApps.settings.ToString(); }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,0],[16,13,16,54,0],[18,13,18,44,0],[19,13,19,44,0],[21,13,21,41,0],[23,13,23,35,0],[24,13,24,14,0],[25,17,25,94,0],[26,17,26,29,0],[30,13,30,83,0],[31,13,31,14,0],[32,17,33,154,0],[34,13,34,14,0],[36,13,36,56,0],[37,13,37,101,0],[38,13,38,31,0],[39,13,39,14,0],[40,17,40,116,0],[41,17,41,29,0],[43,13,43,64,0],[44,13,44,80,0],[45,13,45,112,0],[46,13,46,25,0],[47,9,47,10,0],[50,9,50,10,0],[51,13,51,46,0],[52,13,52,14,0],[54,17,54,106,0],[55,13,55,14,0],[57,13,57,14,0],[58,17,58,109,0],[59,13,59,14,0],[61,13,61,25,0],[62,9,62,10,0],[64,9,64,40,1],[68,17,68,18,0],[68,19,68,37,0],[68,38,68,39,0],[73,17,73,18,1],[73,19,73,58,1],[73,59,73,60,1]]);
    </script>
  </body>
</html>