<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\users\tom pipe\documents\hexadigital\code\umbraco\umbraco-cms\src\umbraco.web.ui\umbraco\create\partialview.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Web.UI;
using System.Web.UI.WebControls;
using umbraco.BasePages;
using Umbraco.Core;
using Umbraco.Core.IO;
using Umbraco.Core.Services;
using umbraco.presentation.create;

namespace Umbraco.Web.UI.Umbraco.Create
{
	public partial class PartialView : UI.Controls.UmbracoUserControl
	{
		protected override void OnLoad(EventArgs e)
		{
			base.OnLoad(e);
			DataBind();

		    LoadTemplates(PartialViewTemplate);

            // Enable new item in folders to place items in that folder.
		    if (Request[&quot;nodeType&quot;] == &quot;partialViewsFolder&quot;)
		        FileName.Text = Request[&quot;nodeId&quot;].EnsureEndsWith(&#39;/&#39;);
		}

        private void LoadTemplates(ListControl list)
        {
            var fileService = (FileService)Services.FileService;
            var snippets = fileService.GetPartialViewSnippetNames(
                //ignore these
                &quot;Gallery&quot;, 
                &quot;ListChildPagesFromChangeableSource&quot;, 
                &quot;ListChildPagesOrderedByProperty&quot;,
                &quot;ListImagesFromMediaFolder&quot;);

            foreach (var snippet in snippets)
            {
                var liText = snippet.SplitPascalCasing().ToFirstUpperInvariant();
                list.Items.Add(new ListItem(liText, snippet));
            }
        }

		protected void SubmitButton_Click(object sender, System.EventArgs e)
		{
			if (Page.IsValid)
			{			
				//Seriously, need to overhaul create dialogs, this is rediculous:
				// http://issues.umbraco.org/issue/U4-1373

				var createMacroVal = 0;

                string returnUrl = dialogHandler_temp.Create(Request.GetItemAsString(&quot;nodeType&quot;),
                    createMacroVal, //apparently we need to pass this value to &#39;ParentID&#39;... of course! :P then we&#39;ll extract it in PartialViewTasks to create it.
                    PartialViewTemplate.SelectedValue + &quot;|||&quot; + FileName.Text);
				
				BasePage.Current.ClientTools
					.ChangeContentFrameUrl(returnUrl)
					.ChildNodeCreated()
					.CloseModalWindow();				
			}

		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,3,18,4,0],[19,4,19,19,0],[20,4,20,15,0],[22,7,22,42,0],[25,7,25,55,0],[26,11,26,65,0],[27,3,27,4,0],[30,9,30,10,0],[31,13,31,65,0],[32,13,37,46,0],[39,13,39,20,0],[39,22,39,33,0],[39,34,39,36,0],[39,37,39,45,0],[40,13,40,14,0],[41,17,41,82,0],[42,17,42,63,0],[43,13,43,14,0],[44,9,44,10,0],[47,3,47,4,0],[48,4,48,21,0],[49,4,49,5,0],[53,5,53,28,0],[55,17,57,80,0],[59,5,62,26,0],[63,4,63,5,0],[65,3,65,4,0]]);
    </script>
  </body>
</html>