<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Install\InstallSteps\StarterKitInstallStep.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using umbraco.cms.businesslogic.packager;
using Umbraco.Core;
using Umbraco.Web.Install.Models;

namespace Umbraco.Web.Install.InstallSteps
{
    [InstallSetupStep(InstallationType.NewInstall,
        &quot;StarterKitInstall&quot;, 31, &quot;&quot;,
        PerformsAppRestart = true)]
    internal class StarterKitInstallStep : InstallSetupStep&lt;object&gt;
    {
        private readonly ApplicationContext _applicationContext;
        private readonly HttpContextBase _httContext;

        public StarterKitInstallStep(ApplicationContext applicationContext, HttpContextBase httContext)
        {
            _applicationContext = applicationContext;
            _httContext = httContext;
        }


        public override InstallSetupResult Execute(object model)
        {
            var installSteps = InstallStatusTracker.GetStatus().ToArray();            
            var previousStep = installSteps.Single(x =&gt; x.Name == &quot;StarterKitDownload&quot;);
            var manifestId = Convert.ToInt32(previousStep.AdditionalData[&quot;manifestId&quot;]);
            var packageFile = (string)previousStep.AdditionalData[&quot;packageFile&quot;];

            InstallBusinessLogic(manifestId, packageFile);

            _applicationContext.RestartApplicationPool(_httContext);

            return null;
        }

        private void InstallBusinessLogic(int manifestId, string packageFile)
        {
            packageFile = HttpUtility.UrlDecode(packageFile);
            var installer = new Installer();
            installer.LoadConfig(packageFile);
            installer.InstallBusinessLogic(manifestId, packageFile);            
        }

        public override bool RequiresExecution(object model)
        {            
            var installSteps = InstallStatusTracker.GetStatus().ToArray();
            //this step relies on the preious one completed - because it has stored some information we need
            if (installSteps.Any(x =&gt; x.Name == &quot;StarterKitDownload&quot; &amp;&amp; x.AdditionalData.ContainsKey(&quot;manifestId&quot;)) == false)
            {
                return false;
            }

            return true;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,104,0],[20,9,20,10,0],[21,13,21,54,0],[22,13,22,38,0],[23,9,23,10,0],[27,9,27,10,0],[28,13,28,75,0],[29,13,29,57,0],[29,57,29,87,0],[29,87,29,89,0],[29,13,29,89,0],[30,13,30,89,0],[31,13,31,82,0],[33,13,33,59,0],[35,13,35,69,0],[37,13,37,25,0],[38,9,38,10,0],[41,9,41,10,0],[42,13,42,62,0],[43,13,43,45,0],[44,13,44,47,0],[45,13,45,69,0],[46,9,46,10,0],[49,9,49,10,0],[50,13,50,75,0],[52,13,52,39,0],[52,39,52,115,0],[52,115,52,126,0],[52,13,52,126,0],[53,13,53,14,0],[54,17,54,30,0],[57,13,57,25,0],[58,9,58,10,0]]);
    </script>
  </body>
</html>