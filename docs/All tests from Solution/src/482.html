<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\settings\EditDictionaryItem.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.UI;
using System.Web.UI.WebControls;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic;
using umbraco.cms.presentation.Trees;
using Umbraco.Core;

namespace umbraco.settings
{
    /// &lt;summary&gt;
    /// Summary description for EditDictionaryItem.
    /// &lt;/summary&gt;
    [WebformsPageTreeAuthorize(Constants.Trees.Dictionary)]
    public partial class EditDictionaryItem : BasePages.UmbracoEnsuredPage
    {

        protected LiteralControl keyTxt = new LiteralControl();
        protected uicontrols.TabView tbv = new uicontrols.TabView();
        private System.Collections.ArrayList languageFields = new System.Collections.ArrayList();
        private cms.businesslogic.Dictionary.DictionaryItem currentItem;
        protected TextBox boxChangeKey;
        protected Label labelChangeKey;
        protected Literal txt;
        protected User currentUser;

        protected void Page_Load(object sender, System.EventArgs e)
        {
            currentItem = new cms.businesslogic.Dictionary.DictionaryItem(int.Parse(Request.QueryString[&quot;id&quot;]));
            currentUser = getUser();

            // Put user code to initialize the page here
            Panel1.hasMenu = true;
            Panel1.Text = ui.Text(&quot;editdictionary&quot;) + &quot;: &quot; + currentItem.key;

            var save = Panel1.Menu.NewButton();
            save.Text = ui.Text(&quot;save&quot;);
            save.Click += save_Click;
            save.ToolTip = ui.Text(&quot;save&quot;);
            save.ID = &quot;save&quot;;
            save.ButtonType = uicontrols.MenuButtonType.Primary;

            uicontrols.Pane p = new uicontrols.Pane();

            boxChangeKey = new TextBox
            {
                ID = &quot;changeKey-&quot; + currentItem.id,
                CssClass = &quot;umbEditorTextField&quot;,
                Text = currentItem.key
            };

            labelChangeKey = new Label
            {
                ID = &quot;changeKeyLabel&quot;,
                CssClass = &quot;text-error&quot;
            };

            p.addProperty(new Literal
            {
                Text = &quot;&lt;p&gt;&quot; + ui.Text(&quot;dictionaryItem&quot;, &quot;changeKey&quot;, currentUser) + &quot;&lt;/p&gt;&quot;
            });
            p.addProperty(boxChangeKey);
            p.addProperty(labelChangeKey);


            txt = new Literal();
            txt.Text = &quot;&lt;br/&gt;&lt;p&gt;&quot; + ui.Text(&quot;dictionaryItem&quot;, &quot;description&quot;, currentItem.key, currentUser) + &quot;&lt;/p&gt;&lt;br/&gt;&quot;;
            p.addProperty(txt);

            foreach (cms.businesslogic.language.Language l in cms.businesslogic.language.Language.getAll)
            {

                TextBox languageBox = new TextBox();
                languageBox.TextMode = TextBoxMode.MultiLine;
                languageBox.ID = l.id.ToString();
                languageBox.CssClass = &quot;umbEditorTextFieldMultiple&quot;;

                if (!IsPostBack)
                    languageBox.Text = currentItem.Value(l.id);

                languageFields.Add(languageBox);
                p.addProperty(l.FriendlyName, languageBox);

            }


            if (!IsPostBack)
            {
                var path = BuildPath(currentItem);
                ClientTools
                    .SetActiveTreeType(TreeDefinitionCollection.Instance.FindTree&lt;loadDictionary&gt;().Tree.Alias)
                    .SyncTree(path, false);
            }

            Panel1.Controls.Add(p);
        }

        private string BuildPath(cms.businesslogic.Dictionary.DictionaryItem current)
        {
            var parentPath = current.IsTopMostItem() ? &quot;&quot; : BuildPath(current.Parent) + &quot;,&quot;;
            return parentPath + current.id;
        }

        void save_Click(object sender, EventArgs e)
        {
            foreach (TextBox t in languageFields)
            {
                //check for null but allow empty string!
                // http://issues.umbraco.org/issue/U4-1931
                if (t.Text != null)
                {
                    currentItem.setValue(int.Parse(t.ID), t.Text);
                }
            }

            labelChangeKey.Text = &quot;&quot;; // reset error text 
            var newKey = boxChangeKey.Text;
            if (string.IsNullOrWhiteSpace(newKey) == false &amp;&amp; newKey != currentItem.key)
            {
                // key already exists, save but inform
                if (Dictionary.DictionaryItem.hasKey(newKey) == true)
                {
                    labelChangeKey.Text = ui.Text(&quot;dictionaryItem&quot;, &quot;changeKeyError&quot;, newKey, currentUser);
                    boxChangeKey.Text = currentItem.key; // reset key                    
                }
                else
                {
                    // set the new key
                    currentItem.setKey(newKey);

                    // update the title with the new key
                    Panel1.title.InnerHtml = ui.Text(&quot;editdictionary&quot;) + &quot;: &quot; + newKey;

                    // sync the content tree
                    var path = BuildPath(currentItem);
                    ClientTools.SyncTree(path, true);
                }
            }
            txt.Text = &quot;&lt;br/&gt;&lt;p&gt;&quot; + ui.Text(&quot;dictionaryItem&quot;, &quot;description&quot;, currentItem.key, currentUser) + &quot;&lt;/p&gt;&lt;br/&gt;&quot;;
            ClientTools.ShowSpeechBubble(speechBubbleIcon.save, ui.Text(&quot;speechBubbles&quot;, &quot;dictionaryItemSaved&quot;), &quot;&quot;);
        }

        #region Web Form Designer generated code

        override protected void OnInit(EventArgs e)
        {
            InitializeComponent();
            base.OnInit(e);
        }

        /// &lt;summary&gt;
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// &lt;/summary&gt;
        private void InitializeComponent()
        {
        }

        #endregion


        private class languageTextbox : TextBox
        {

            private int _languageid;

            public int languageid
            {
                set { _languageid = value; }
                get { return _languageid; }
            }

            public languageTextbox(int languageId) : base()
            {
                this.TextMode = TextBoxMode.MultiLine;
                this.Rows = 10;
                this.Columns = 40;
                this.Attributes.Add(&quot;style&quot;, &quot;margin: 3px; width: 98%;&quot;);

                this.languageid = languageId;
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,64,0],[19,9,19,69,0],[20,9,20,98,0],[28,9,28,10,0],[29,13,29,113,0],[30,13,30,37,0],[33,13,33,35,0],[34,13,34,78,0],[36,13,36,48,0],[37,13,37,41,0],[38,13,38,38,0],[39,13,39,44,0],[40,13,40,30,0],[41,13,41,65,0],[43,13,43,55,0],[45,13,50,15,0],[52,13,56,15,0],[58,13,61,16,0],[62,13,62,41,0],[63,13,63,43,0],[66,13,66,33,0],[67,13,67,122,0],[68,13,68,32,0],[70,13,70,20,0],[70,22,70,59,0],[70,60,70,62,0],[70,63,70,105,0],[71,13,71,14,0],[73,17,73,53,0],[74,17,74,62,0],[75,17,75,50,0],[76,17,76,69,0],[78,17,78,33,0],[79,21,79,64,0],[81,17,81,49,0],[82,17,82,60,0],[84,13,84,14,0],[87,13,87,29,0],[88,13,88,14,0],[89,17,89,51,0],[90,17,92,44,0],[93,13,93,14,0],[95,13,95,36,0],[96,9,96,10,0],[99,9,99,10,0],[100,13,100,93,0],[101,13,101,44,0],[102,9,102,10,0],[105,9,105,10,0],[106,13,106,20,0],[106,22,106,31,0],[106,32,106,34,0],[106,35,106,49,0],[107,13,107,14,0],[110,17,110,36,0],[111,17,111,18,0],[112,21,112,67,0],[113,17,113,18,0],[114,13,114,14,0],[116,13,116,38,0],[117,13,117,44,0],[118,13,118,89,0],[119,13,119,14,0],[121,17,121,70,0],[122,17,122,18,0],[123,21,123,108,0],[124,21,124,57,0],[125,17,125,18,0],[127,17,127,18,0],[129,21,129,48,0],[132,21,132,88,0],[135,21,135,55,0],[136,21,136,54,0],[137,17,137,18,0],[138,13,138,14,0],[139,13,139,122,0],[140,13,140,118,0],[141,9,141,10,0],[146,9,146,10,0],[147,13,147,35,0],[148,13,148,28,0],[149,9,149,10,0],[156,9,156,10,0],[157,9,157,10,0],[169,21,169,22,0],[169,23,169,43,0],[169,44,169,45,0],[170,21,170,22,0],[170,23,170,42,0],[170,43,170,44,0],[173,54,173,60,0],[174,13,174,14,0],[175,17,175,55,0],[176,17,176,32,0],[177,17,177,35,0],[178,17,178,74,0],[180,17,180,46,0],[181,13,181,14,0]]);
    </script>
  </body>
</html>