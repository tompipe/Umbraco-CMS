<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Services\UserServiceExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.Security;
using Umbraco.Core.Models.Membership;

namespace Umbraco.Core.Services
{
    internal static class UserServiceExtensions
    {
        /// &lt;summary&gt;
        /// Remove all permissions for this user for all nodes specified
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;entityIds&quot;&gt;&lt;/param&gt;
        public static void RemoveUserPermissions(this IUserService userService, int userId, params int[] entityIds)
        {
            userService.ReplaceUserPermissions(userId, new char[] {}, entityIds);
        }

        /// &lt;summary&gt;
        /// Remove all permissions for this user for all nodes
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        public static void RemoveUserPermissions(this IUserService userService, int userId)
        {
            userService.ReplaceUserPermissions(userId, new char[] { });
        }

        /// &lt;summary&gt;
        /// Maps a custom provider&#39;s information to an umbraco user account
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userService&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;member&quot;&gt;&lt;/param&gt;
        /// &lt;remarks&gt;
        /// To maintain compatibility we have to check the login name if the provider key lookup fails but otherwise
        /// we&#39;ll store the provider user key in the login column.
        /// &lt;/remarks&gt;
        public static IUser CreateUserMappingForCustomProvider(this IUserService userService, MembershipUser member)
        {
            if (member == null) throw new ArgumentNullException(&quot;member&quot;);


            var valToLookup = member.ProviderUserKey == null ? member.UserName : member.ProviderUserKey.ToString();
            var found = userService.GetByUsername(valToLookup);
            if (found == null &amp;&amp; member.ProviderUserKey != null)
            {
                //try by username
                found = userService.GetByUsername(member.UserName);
            }

            if (found == null)
            {
                var writer = userService.GetUserTypeByAlias(&quot;writer&quot;);
                if (writer == null)
                {
                    throw new InvalidOperationException(&quot;Could not map the custom user to an Umbraco user, no &#39;writer&#39; user type could be found&quot;);
                }
                var user = new User(
                    member.UserName,
                    member.Email ?? Guid.NewGuid().ToString(&quot;N&quot;) + &quot;@example.com&quot;, //email cannot be empty
                    member.ProviderUserKey == null ? member.UserName : member.ProviderUserKey.ToString(),
                    Guid.NewGuid().ToString(&quot;N&quot;), //pass cannot be empty
                    writer);
                user.AddAllowedSection(Constants.Applications.Content);
                userService.Save(user);
                return user;
            }

            return found;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,10,0],[17,13,17,82,0],[18,9,18,10,0],[26,9,26,10,0],[27,13,27,72,0],[28,9,28,10,0],[40,9,40,10,0],[41,13,41,32,0],[41,33,41,75,0],[44,13,44,116,0],[45,13,45,64,0],[46,13,46,65,0],[47,13,47,14,0],[49,17,49,68,0],[50,13,50,14,0],[52,13,52,31,0],[53,13,53,14,0],[54,17,54,71,0],[55,17,55,36,0],[56,17,56,18,0],[57,21,57,147,0],[59,17,64,29,0],[65,17,65,72,0],[66,17,66,40,0],[67,17,67,29,0],[70,13,70,26,0],[71,9,71,10,0]]);
    </script>
  </body>
</html>