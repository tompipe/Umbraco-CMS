<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Trees\PartialViewsTree.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Web;
using Umbraco.Core;
using Umbraco.Core.Configuration;
using Umbraco.Core.IO;
using umbraco.BusinessLogic.Actions;
using umbraco.businesslogic;
using umbraco.cms.businesslogic.template;
using umbraco.cms.presentation.Trees;
using umbraco.interfaces;

namespace Umbraco.Web.Trees
{
	/// &lt;summary&gt;
	/// Tree for displaying partial views in the settings app
	/// &lt;/summary&gt;
	[Tree(Constants.Applications.Settings, &quot;partialViews&quot;, &quot;Partial Views&quot;, sortOrder: 2)]
	public class PartialViewsTree : FileSystemTree
	{
		public PartialViewsTree(string application) : base(application) { }

		public override void RenderJS(ref StringBuilder javascript)
		{
			javascript.Append(
                @&quot;
		                 function openPartialView(id) {
		                    UmbClientMgr.contentFrame(&#39;Settings/Views/EditView.aspx?treeType=partialViews&amp;file=&#39; + id);
					    }
		                &quot;);
		}

		protected override void CreateRootNode(ref XmlTreeNode rootNode)
		{
			rootNode.NodeType = TreeAlias;
			rootNode.NodeID = &quot;init&quot;;
		}

		protected override string FilePath
		{
			get { return SystemDirectories.MvcViews + &quot;/Partials/&quot;; }
		}

		protected override string FileSearchPattern
		{
			get { return &quot;*.cshtml&quot;; }
		}

		/// &lt;summary&gt;
		/// Ensures that no folders can be added
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;xNode&quot;&gt;&lt;/param&gt;
		protected override void OnRenderFolderNode(ref XmlTreeNode xNode)
		{
            // We should allow folder hierarchy for organization in large sites.
            xNode.Action = &quot;javascript:void(0);&quot;;
            xNode.NodeType = &quot;partialViewsFolder&quot;;
            xNode.Menu = new List&lt;IAction&gt;(new IAction[]
            {
                ActionNew.Instance, 
                ContextMenuSeperator.Instance, 
                ActionDelete.Instance, 
                ContextMenuSeperator.Instance, 
                ActionRefresh.Instance
            });
            
		}

		protected virtual void ChangeNodeAction(XmlTreeNode xNode)
		{
			xNode.Action = xNode.Action.Replace(&quot;openFile&quot;, &quot;openPartialView&quot;);
		}

		protected override void OnRenderFileNode(ref XmlTreeNode xNode)
		{
			ChangeNodeAction(xNode);
			xNode.Icon = &quot;icon-article&quot;;
			xNode.OpenIcon = &quot;icon-article&quot;;

            xNode.Text = xNode.Text.StripFileExtension();
		}

		
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[24,49,24,66,0],[24,67,24,68,0],[24,69,24,70,0],[27,3,27,4,0],[28,4,33,22,0],[34,3,34,4,0],[37,3,37,4,0],[38,4,38,34,0],[39,4,39,29,0],[40,3,40,4,0],[44,8,44,9,0],[44,10,44,59,0],[44,60,44,61,0],[49,8,49,9,0],[49,10,49,28,0],[49,29,49,30,0],[57,3,57,4,0],[59,13,59,50,0],[60,13,60,51,0],[61,13,68,16,0],[70,3,70,4,0],[73,3,73,4,0],[74,4,74,71,0],[75,3,75,4,0],[78,3,78,4,0],[79,4,79,28,0],[80,4,80,32,0],[81,4,81,36,0],[83,13,83,58,0],[84,3,84,4,0]]);
    </script>
  </body>
</html>