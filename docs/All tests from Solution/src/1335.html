<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Editors\MemberTypeController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using System.Web.Security;
using AutoMapper;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Core.Services;
using Umbraco.Core.Security;
using Umbraco.Web.Models.ContentEditing;
using Umbraco.Web.Mvc;
using Umbraco.Web.WebApi.Filters;
using Constants = Umbraco.Core.Constants;
using System.Web.Http;
using System.Net;
using Umbraco.Core.PropertyEditors;
using System;
using System.Net.Http;
using ContentType = System.Net.Mime.ContentType;

namespace Umbraco.Web.Editors
{
    
    /// &lt;summary&gt;
    /// An API controller used for dealing with content types
    /// &lt;/summary&gt;
    [PluginController(&quot;UmbracoApi&quot;)]
    [UmbracoTreeAuthorize(Constants.Trees.MemberTypes)]    
    public class MemberTypeController : ContentTypeControllerBase
    {
        /// &lt;summary&gt;
        /// Constructor
        /// &lt;/summary&gt;
        public MemberTypeController()
            : this(UmbracoContext.Current)
        {
            _provider = Core.Security.MembershipProviderExtensions.GetMembersMembershipProvider();
        }

        /// &lt;summary&gt;
        /// Constructor
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;umbracoContext&quot;&gt;&lt;/param&gt;
        public MemberTypeController(UmbracoContext umbracoContext)
            : base(umbracoContext)
        {
            _provider = Core.Security.MembershipProviderExtensions.GetMembersMembershipProvider();
        }

        private readonly MembershipProvider _provider;

        public MemberTypeDisplay GetById(int id)
        {
            var ct = Services.MemberTypeService.Get(id);
            if (ct == null)
            {
                throw new HttpResponseException(HttpStatusCode.NotFound);
            }

            var dto = Mapper.Map&lt;IMemberType, MemberTypeDisplay&gt;(ct);
            return dto;
        }

        /// &lt;summary&gt;
        /// Deletes a document type wth a given ID
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [HttpDelete]
        [HttpPost]
        public HttpResponseMessage DeleteById(int id)
        {
            var foundType = Services.MemberTypeService.Get(id);
            if (foundType == null)
            {
                throw new HttpResponseException(HttpStatusCode.NotFound);
            }

            Services.MemberTypeService.Delete(foundType, Security.CurrentUser.Id);
            return Request.CreateResponse(HttpStatusCode.OK);
        }

        /// &lt;summary&gt;
        /// Returns the avilable compositions for this content type
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;contentTypeId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;filterContentTypes&quot;&gt;
        /// This is normally an empty list but if additional content type aliases are passed in, any content types containing those aliases will be filtered out
        /// along with any content types that have matching property types that are included in the filtered content types
        /// &lt;/param&gt;
        /// &lt;param name=&quot;filterPropertyTypes&quot;&gt;
        /// This is normally an empty list but if additional property type aliases are passed in, any content types that have these aliases will be filtered out.
        /// This is required because in the case of creating/modifying a content type because new property types being added to it are not yet persisted so cannot
        /// be looked up via the db, they need to be passed in.
        /// &lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public HttpResponseMessage GetAvailableCompositeMemberTypes(int contentTypeId,
            [FromUri]string[] filterContentTypes,
            [FromUri]string[] filterPropertyTypes)
        {
            var result = PerformGetAvailableCompositeContentTypes(contentTypeId, UmbracoObjectTypes.MemberType, filterContentTypes, filterPropertyTypes)
                .Select(x =&gt; new
                {
                    contentType = x.Item1,
                    allowed = x.Item2
                });
            return Request.CreateResponse(result);
        }

        public MemberTypeDisplay GetEmpty()
        {
            var ct = new MemberType(-1);
            ct.Icon = &quot;icon-user&quot;;

            var dto = Mapper.Map&lt;IMemberType, MemberTypeDisplay&gt;(ct);
            return dto;
        }

       
        /// &lt;summary&gt;
        /// Returns all member types
        /// &lt;/summary&gt;
        public IEnumerable&lt;ContentTypeBasic&gt; GetAllTypes()
        {
            if (_provider.IsUmbracoMembershipProvider())
            {
                return Services.MemberTypeService.GetAll()
                               .Select(Mapper.Map&lt;IMemberType, ContentTypeBasic&gt;);    
            }
            return Enumerable.Empty&lt;ContentTypeBasic&gt;();
        }

        public MemberTypeDisplay PostSave(MemberTypeSave contentTypeSave)
        {
            var savedCt = PerformPostSave&lt;IMemberType, MemberTypeDisplay, MemberTypeSave, MemberPropertyTypeBasic&gt;(
                contentTypeSave:            contentTypeSave,
                getContentType:             i =&gt; Services.MemberTypeService.Get(i),
                saveContentType:            type =&gt; Services.MemberTypeService.Save(type));

            var display = Mapper.Map&lt;MemberTypeDisplay&gt;(savedCt);

            display.AddSuccessNotification(
                            Services.TextService.Localize(&quot;speechBubbles/memberTypeSavedHeader&quot;),
                            string.Empty);

            return display;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[34,15,34,43,0],[35,9,35,10,0],[36,13,36,99,0],[37,9,37,10,0],[44,15,44,35,0],[45,9,45,10,0],[46,13,46,99,0],[47,9,47,10,0],[52,9,52,10,0],[53,13,53,57,0],[54,13,54,28,0],[55,13,55,14,0],[56,17,56,74,0],[59,13,59,70,0],[60,13,60,24,0],[61,9,61,10,0],[71,9,71,10,0],[72,13,72,64,0],[73,13,73,35,0],[74,13,74,14,0],[75,17,75,74,0],[78,13,78,83,0],[79,13,79,62,0],[80,9,80,10,0],[99,9,99,10,0],[100,13,101,30,0],[101,30,105,18,0],[105,18,105,20,0],[100,13,105,20,0],[106,13,106,51,0],[107,9,107,10,0],[110,9,110,10,0],[111,13,111,41,0],[112,13,112,35,0],[114,13,114,70,0],[115,13,115,24,0],[116,9,116,10,0],[123,9,123,10,0],[124,13,124,57,0],[125,13,125,14,0],[126,17,127,83,0],[129,13,129,57,0],[130,9,130,10,0],[133,9,133,10,0],[134,13,136,50,0],[136,50,136,83,0],[136,83,137,53,0],[137,53,137,90,0],[137,90,137,92,0],[134,13,137,92,0],[139,13,139,66,0],[141,13,143,43,0],[145,13,145,28,0],[146,9,146,10,0]]);
    </script>
  </body>
</html>