<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\developer\Xslt\editXslt.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Text.RegularExpressions;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Xml;
using System.Xml.Xsl;
using Umbraco.Core;
using Umbraco.Core.IO;
using umbraco.BasePages;
using umbraco.uicontrols;
using System.Net;
using umbraco.cms.presentation.Trees;
using umbraco.cms.helpers;

namespace umbraco.cms.presentation.developer
{
	/// &lt;summary&gt;
	/// Summary description for editXslt.
	/// &lt;/summary&gt;
    [WebformsPageTreeAuthorize(Constants.Trees.Xslt)]
	public partial class editXslt : UmbracoEnsuredPage
	{

		protected PlaceHolder buttons;

        protected MenuButton SaveButton;

		protected void Page_Load(object sender, EventArgs e)
		{
			if (!IsPostBack)
			{
				string file = Request.QueryString[&quot;file&quot;];
				string path = DeepLink.GetTreePathFromFilePath(file);
				ClientTools
					.SetActiveTreeType(TreeDefinitionCollection.Instance.FindTree&lt;loadXslt&gt;().Tree.Alias)
					.SyncTree(path, false);
			}



		}

		protected override void OnInit(EventArgs e)
		{			
			base.OnInit(e);

            SaveButton = UmbracoPanel1.Menu.NewButton();
            SaveButton.ToolTip = &quot;Save Xslt File&quot;;
            SaveButton.Text = ui.Text(&quot;save&quot;);
            SaveButton.ButtonType = MenuButtonType.Primary;
            SaveButton.ID = &quot;save&quot;;
            SaveButton.CssClass = &quot;client-side&quot;;

            var code = UmbracoPanel1.NewTabPage(&quot;xslt&quot;);
            code.Controls.Add(pane1);

            var props = UmbracoPanel1.NewTabPage(&quot;properties&quot;);
            props.Controls.Add(pane2);

            var tmp = editorSource.Menu.NewIcon();
			tmp.ImageURL = IOHelper.ResolveUrl(SystemDirectories.Umbraco) + &quot;/images/editor/insField.GIF&quot;;
			tmp.OnClickCommand = ClientTools.Scripts.OpenModalWindow(IOHelper.ResolveUrl(SystemDirectories.Umbraco) + &quot;/developer/xslt/xsltinsertvalueof.aspx?objectId=&quot; + editorSource.ClientID, &quot;Insert value&quot;, 750, 250);
			//&quot;umbracoInsertField(document.getElementById(&#39;editorSource&#39;), &#39;xsltInsertValueOf&#39;, &#39;&#39;,&#39;felt&#39;, 750, 230, &#39;&#39;);&quot;;
			tmp.AltText = &quot;Insert xslt:value-of&quot;;

            editorSource.Menu.InsertSplitter();

            tmp = editorSource.Menu.NewIcon();
			tmp.ImageURL = SystemDirectories.Umbraco + &quot;/images/editor/insMemberItem.GIF&quot;;
			tmp.OnClickCommand = &quot;UmbEditor.Insert(&#39;&lt;xsl:variable name=\&quot;\&quot; select=\&quot;&#39;, &#39;\&quot;/&gt;\\n&#39;, &#39;&quot; + editorSource.ClientID + &quot;&#39;); return false;&quot;;
			tmp.AltText = &quot;Insert xsl:variable&quot;;

            editorSource.Menu.InsertSplitter();

            tmp = editorSource.Menu.NewIcon();
			tmp.ImageURL = SystemDirectories.Umbraco + &quot;/images/editor/insChildTemplateNew.GIF&quot;;
			tmp.OnClickCommand = &quot;UmbEditor.Insert(&#39;&lt;xsl:if test=\&quot;CONDITION\&quot;&gt;\\n&#39;, &#39;\\n&lt;/xsl:if&gt;\\n&#39;, &#39;&quot; + editorSource.ClientID + &quot;&#39;); return false;&quot;;
			tmp.AltText = &quot;Insert xsl:if&quot;;

            tmp = editorSource.Menu.NewIcon();
			tmp.ImageURL = SystemDirectories.Umbraco + &quot;/images/editor/insChildTemplateNew.GIF&quot;;
			tmp.OnClickCommand = &quot;UmbEditor.Insert(&#39;&lt;xsl:for-each select=\&quot;QUERY\&quot;&gt;\\n&#39;, &#39;\\n&lt;/xsl:for-each&gt;\\n&#39;, &#39;&quot; + editorSource.ClientID + &quot;&#39;); return false;&quot;;
			tmp.AltText = &quot;Insert xsl:for-each&quot;;

            editorSource.Menu.InsertSplitter();

            tmp = editorSource.Menu.NewIcon();
			tmp.ImageURL = SystemDirectories.Umbraco + &quot;/images/editor/insFieldByLevel.GIF&quot;;
			tmp.OnClickCommand = &quot;UmbEditor.Insert(&#39;&lt;xsl:choose&gt;\\n&lt;xsl:when test=\&quot;CONDITION\&quot;&gt;\\n&#39;, &#39;\\n&lt;/xsl:when&gt;\\n&lt;xsl:otherwise&gt;\\n&lt;/xsl:otherwise&gt;\\n&lt;/xsl:choose&gt;\\n&#39;, &#39;&quot; + editorSource.ClientID + &quot;&#39;); return false;&quot;;
			tmp.AltText = &quot;Insert xsl:choose&quot;;

            editorSource.Menu.InsertSplitter();

            tmp = editorSource.Menu.NewIcon();
			tmp.ImageURL = SystemDirectories.Umbraco + &quot;/images/editor/xslVisualize.GIF&quot;;
			tmp.OnClickCommand = &quot;xsltVisualize();&quot;;
			tmp.AltText = &quot;Visualize XSLT&quot;;


			// Add source and filename
			var file = IOHelper.MapPath(SystemDirectories.Xslt + &quot;/&quot; + Request.QueryString[&quot;file&quot;]);

			// validate file
			IOHelper.ValidateEditPath(file, SystemDirectories.Xslt);
			// validate extension
			IOHelper.ValidateFileExtension(file, new List&lt;string&gt;() { &quot;xslt&quot;, &quot;xsl&quot; });


			xsltFileName.Text = file.Replace(IOHelper.MapPath(SystemDirectories.Xslt), &quot;&quot;).Substring(1).Replace(@&quot;\&quot;, &quot;/&quot;);

			StreamReader SR;
			string S;
			SR = File.OpenText(file);

			S = SR.ReadToEnd();
			SR.Close();

			editorSource.Text = S;
		}


		protected override void OnPreRender(EventArgs e)
		{
			base.OnPreRender(e);

			ScriptManager.GetCurrent(Page).Services.Add(new ServiceReference(IOHelper.ResolveUrl(SystemDirectories.WebServices) + &quot;/codeEditorSave.asmx&quot;));
			ScriptManager.GetCurrent(Page).Services.Add(new ServiceReference(IOHelper.ResolveUrl(SystemDirectories.WebServices) + &quot;/legacyAjaxCalls.asmx&quot;));
		}


		/// &lt;summary&gt;
		/// JsInclude1 control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::ClientDependency.Core.Controls.JsInclude JsInclude1;

		/// &lt;summary&gt;
		/// UmbracoPanel1 control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::umbraco.uicontrols.TabView UmbracoPanel1;

		/// &lt;summary&gt;
		/// Pane1 control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::umbraco.uicontrols.Pane pane1;
        protected global::umbraco.uicontrols.Pane pane2;

		/// &lt;summary&gt;
		/// pp_filename control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::umbraco.uicontrols.PropertyPanel pp_filename;

		/// &lt;summary&gt;
		/// xsltFileName control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::System.Web.UI.WebControls.TextBox xsltFileName;

		/// &lt;summary&gt;
		/// pp_testing control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::umbraco.uicontrols.PropertyPanel pp_testing;

		/// &lt;summary&gt;
		/// SkipTesting control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::System.Web.UI.WebControls.CheckBox SkipTesting;

		/// &lt;summary&gt;
		/// pp_errorMsg control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::umbraco.uicontrols.PropertyPanel pp_errorMsg;

		/// &lt;summary&gt;
		/// editorSource control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::umbraco.uicontrols.CodeArea editorSource;

		/// &lt;summary&gt;
		/// editorJs control.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// Auto-generated field.
		/// To modify move field declaration from designer file to code-behind file.
		/// &lt;/remarks&gt;
		protected global::System.Web.UI.WebControls.Literal editorJs;
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[32,3,32,4,0],[33,4,33,20,0],[34,4,34,5,0],[35,5,35,47,0],[36,5,36,58,0],[37,5,39,29,0],[40,4,40,5,0],[44,3,44,4,0],[47,3,47,4,0],[48,4,48,19,0],[50,13,50,57,0],[51,13,51,51,0],[52,13,52,47,0],[53,13,53,60,0],[54,13,54,36,0],[55,13,55,49,0],[57,13,57,57,0],[58,13,58,38,0],[60,13,60,64,0],[61,13,61,39,0],[63,13,63,51,0],[64,4,64,98,0],[65,4,65,212,0],[67,4,67,41,0],[69,13,69,48,0],[71,13,71,47,0],[72,4,72,82,0],[73,4,73,140,0],[74,4,74,40,0],[76,13,76,48,0],[78,13,78,47,0],[79,4,79,88,0],[80,4,80,145,0],[81,4,81,34,0],[83,13,83,47,0],[84,4,84,88,0],[85,4,85,155,0],[86,4,86,40,0],[88,13,88,48,0],[90,13,90,47,0],[91,4,91,84,0],[92,4,92,217,0],[93,4,93,38,0],[95,13,95,48,0],[97,13,97,47,0],[98,4,98,81,0],[99,4,99,44,0],[100,4,100,35,0],[104,4,104,92,0],[107,4,107,60,0],[109,4,109,79,0],[112,4,112,115,0],[116,4,116,29,0],[118,4,118,23,0],[119,4,119,15,0],[121,4,121,26,0],[122,3,122,4,0],[126,3,126,4,0],[127,4,127,24,0],[129,4,129,147,0],[130,4,130,148,0],[131,3,131,4,0]]);
    </script>
  </body>
</html>