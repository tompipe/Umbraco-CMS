<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\Identity\IdentityModelMappings.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using AutoMapper;

using Umbraco.Core.Models.Mapping;
using Umbraco.Core.Models.Membership;
using Umbraco.Core.Security;

namespace Umbraco.Core.Models.Identity
{
    public class IdentityModelMappings : MapperConfiguration
    {
        public override void ConfigureMappings(IConfiguration config, ApplicationContext applicationContext)
        {
            config.CreateMap&lt;IUser, BackOfficeIdentityUser&gt;()
                .ForMember(user =&gt; user.LastLoginDateUtc, expression =&gt; expression.MapFrom(user =&gt; user.LastLoginDate.ToUniversalTime()))
                .ForMember(user =&gt; user.Email, expression =&gt; expression.MapFrom(user =&gt; user.Email))
                .ForMember(user =&gt; user.Id, expression =&gt; expression.MapFrom(user =&gt; user.Id))
                .ForMember(user =&gt; user.LockoutEndDateUtc, expression =&gt; expression.MapFrom(user =&gt; user.IsLockedOut ? DateTime.MaxValue.ToUniversalTime() : (DateTime?)null))                
                .ForMember(user =&gt; user.UserName, expression =&gt; expression.MapFrom(user =&gt; user.Username))
                .ForMember(user =&gt; user.PasswordHash, expression =&gt; expression.MapFrom(user =&gt; GetPasswordHash(user.RawPasswordValue)))
                .ForMember(user =&gt; user.Culture, expression =&gt; expression.MapFrom(user =&gt; user.GetUserCulture(applicationContext.Services.TextService)))
                .ForMember(user =&gt; user.Name, expression =&gt; expression.MapFrom(user =&gt; user.Name))
                .ForMember(user =&gt; user.StartMediaId, expression =&gt; expression.MapFrom(user =&gt; user.StartMediaId))
                .ForMember(user =&gt; user.StartContentId, expression =&gt; expression.MapFrom(user =&gt; user.StartContentId))
                .ForMember(user =&gt; user.UserTypeAlias, expression =&gt; expression.MapFrom(user =&gt; user.UserType.Alias))
                .ForMember(user =&gt; user.AccessFailedCount, expression =&gt; expression.MapFrom(user =&gt; user.FailedPasswordAttempts))
                .ForMember(user =&gt; user.AllowedSections, expression =&gt; expression.MapFrom(user =&gt; user.AllowedSections.ToArray()));

            config.CreateMap&lt;BackOfficeIdentityUser, UserData&gt;()
                .ConstructUsing((BackOfficeIdentityUser user) =&gt; new UserData(Guid.NewGuid().ToString(&quot;N&quot;))) //this is the &#39;session id&#39;
                .ForMember(detail =&gt; detail.Id, opt =&gt; opt.MapFrom(user =&gt; user.Id))
                .ForMember(detail =&gt; detail.AllowedApplications, opt =&gt; opt.MapFrom(user =&gt; user.AllowedSections))
                .ForMember(detail =&gt; detail.RealName, opt =&gt; opt.MapFrom(user =&gt; user.Name))
                .ForMember(detail =&gt; detail.Roles, opt =&gt; opt.MapFrom(user =&gt; new[] { user.UserTypeAlias }))
                .ForMember(detail =&gt; detail.StartContentNode, opt =&gt; opt.MapFrom(user =&gt; user.StartContentId))
                .ForMember(detail =&gt; detail.StartMediaNode, opt =&gt; opt.MapFrom(user =&gt; user.StartMediaId))
                .ForMember(detail =&gt; detail.Username, opt =&gt; opt.MapFrom(user =&gt; user.UserName))
                .ForMember(detail =&gt; detail.Culture, opt =&gt; opt.MapFrom(user =&gt; user.Culture))
                .ForMember(detail =&gt; detail.SessionId, opt =&gt; opt.MapFrom(user =&gt; user.SecurityStamp.IsNullOrWhiteSpace() ? Guid.NewGuid().ToString(&quot;N&quot;) : user.SecurityStamp));
        }

        private string GetPasswordHash(string storedPass)
        {
            return storedPass.StartsWith(&quot;___UIDEMPTYPWORD__&quot;) ? null : storedPass;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,10,0],[15,13,16,73,0],[16,73,16,137,0],[16,137,17,62,0],[17,62,17,100,0],[17,100,18,59,0],[18,59,18,94,0],[18,94,19,74,0],[19,74,19,174,0],[19,174,20,65,0],[20,65,20,106,0],[20,106,21,69,0],[21,69,21,135,0],[21,135,22,64,0],[22,64,22,152,0],[22,152,23,61,0],[23,61,23,98,0],[23,98,24,69,0],[24,69,24,114,0],[24,114,25,71,0],[25,71,25,118,0],[25,118,26,70,0],[26,70,26,117,0],[26,117,27,74,0],[27,74,27,129,0],[27,129,28,72,0],[28,72,28,130,0],[28,130,28,132,0],[15,13,28,132,0],[30,13,31,66,0],[31,66,31,108,0],[31,108,32,56,0],[32,56,32,84,0],[32,84,33,73,0],[33,73,33,114,0],[33,114,34,62,0],[34,62,34,92,0],[34,92,35,59,0],[35,59,35,108,0],[35,108,36,70,0],[36,70,36,110,0],[36,110,37,68,0],[37,68,37,106,0],[37,106,38,62,0],[38,62,38,96,0],[38,96,39,61,0],[39,61,39,94,0],[39,94,40,63,0],[40,63,40,175,0],[40,175,40,177,0],[30,13,40,177,0],[41,9,41,10,0],[44,9,44,10,0],[45,13,45,84,0],[46,9,46,10,0]]);
    </script>
  </body>
</html>