<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Routing\UrlProviderExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Web.Security;
using Umbraco.Core.Models;
using umbraco;
using Umbraco.Core;
using Umbraco.Core.Configuration;
using Umbraco.Core.Logging;

namespace Umbraco.Web.Routing
{
    internal static class UrlProviderExtensions
    {
        /// &lt;summary&gt;
        /// Gets the URLs for the content item
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;content&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;umbracoContext&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// Use this when displaying URLs, if there are errors genertaing the urls the urls themselves will
        /// contain the errors.
        /// &lt;/remarks&gt;
        public static IEnumerable&lt;string&gt; GetContentUrls(this IContent content, UmbracoContext umbracoContext)
        {
            if (content == null) throw new ArgumentNullException(&quot;content&quot;);
            if (umbracoContext == null) throw new ArgumentNullException(&quot;umbracoContext&quot;);

            var urls = new List&lt;string&gt;();

            if (content.HasPublishedVersion == false)
            {
                urls.Add(ui.Text(&quot;content&quot;, &quot;itemNotPublished&quot;, umbracoContext.Security.CurrentUser));
                return urls;
            }

            string url;
            var urlProvider = umbracoContext.RoutingContext.UrlProvider;
            try
            {
                url = urlProvider.GetUrl(content.Id);
            }
            catch (Exception e)
            {
                LogHelper.Error&lt;UrlProvider&gt;(&quot;GetUrl exception.&quot;, e);
                url = &quot;#ex&quot;;
            }
            if (url == &quot;#&quot;)
            {
                // document as a published version yet it&#39;s url is &quot;#&quot; =&gt; a parent must be
                // unpublished, walk up the tree until we find it, and report.
                var parent = content;
                do
                {
                    parent = parent.ParentId &gt; 0 ? parent.Parent() : null;
                }
                while (parent != null &amp;&amp; parent.Published);

                if (parent == null) // oops - internal error
                    urls.Add(ui.Text(&quot;content&quot;, &quot;parentNotPublishedAnomaly&quot;, umbracoContext.Security.CurrentUser));
                else
                    urls.Add(ui.Text(&quot;content&quot;, &quot;parentNotPublished&quot;, parent.Name, umbracoContext.Security.CurrentUser));
            }
            else if (url == &quot;#ex&quot;)
            {
                urls.Add(ui.Text(&quot;content&quot;, &quot;getUrlException&quot;, umbracoContext.Security.CurrentUser));
            }
            else
            {
                // test for collisions
                var uri = new Uri(url.TrimEnd(&#39;/&#39;), UriKind.RelativeOrAbsolute);
                if (uri.IsAbsoluteUri == false) uri = uri.MakeAbsolute(UmbracoContext.Current.CleanedUmbracoUrl);
                var pcr = new PublishedContentRequest(uri, UmbracoContext.Current.RoutingContext, UmbracoConfig.For.UmbracoSettings().WebRouting, s =&gt; Roles.Provider.GetRolesForUser(s));
                pcr.Engine.TryRouteRequest();

                if (pcr.HasPublishedContent == false)
                {
                    urls.Add(ui.Text(&quot;content&quot;, &quot;routeError&quot;, &quot;(error)&quot;, umbracoContext.Security.CurrentUser));
                }
                else if (pcr.PublishedContent.Id != content.Id)
                {
                    var o = pcr.PublishedContent;
                    string s;
                    if (o == null)
                    {
                        s = &quot;(unknown)&quot;;
                    }
                    else
                    {
                        var l = new List&lt;string&gt;();
                        while (o != null)
                        {
                            l.Add(o.Name);
                            o = o.Parent;
                        }
                        l.Reverse();
                        s = &quot;/&quot; + string.Join(&quot;/&quot;, l) + &quot; (id=&quot; + pcr.PublishedContent.Id + &quot;)&quot;;

                    }
                    urls.Add(ui.Text(&quot;content&quot;, &quot;routeError&quot;, s, umbracoContext.Security.CurrentUser));
                }
                else
                {
                    urls.Add(url);
                    urls.AddRange(urlProvider.GetOtherUrls(content.Id));
                }
            }
            return urls;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[25,9,25,10,0],[26,13,26,33,0],[26,34,26,77,0],[27,13,27,40,0],[27,41,27,91,0],[29,13,29,43,0],[31,13,31,54,0],[32,13,32,14,0],[33,17,33,103,0],[34,17,34,29,0],[38,13,38,73,0],[40,13,40,14,0],[41,17,41,54,0],[42,13,42,14,0],[43,13,43,32,0],[44,13,44,14,0],[45,17,45,70,0],[46,17,46,29,0],[47,13,47,14,0],[48,13,48,28,0],[49,13,49,14,0],[52,17,52,38,0],[54,17,54,18,0],[55,21,55,75,0],[56,17,56,18,0],[57,17,57,60,0],[59,17,59,36,0],[60,21,60,116,0],[62,21,62,122,0],[63,13,63,14,0],[64,18,64,35,0],[65,13,65,14,0],[66,17,66,102,0],[67,13,67,14,0],[69,13,69,14,0],[71,17,71,81,0],[72,17,72,48,0],[72,49,72,114,0],[73,17,73,152,0],[73,152,73,185,0],[73,185,73,187,0],[73,17,73,187,0],[74,17,74,46,0],[76,17,76,54,0],[77,17,77,18,0],[78,21,78,112,0],[79,17,79,18,0],[80,22,80,64,0],[81,17,81,18,0],[82,21,82,50,0],[84,21,84,35,0],[85,21,85,22,0],[86,25,86,41,0],[87,21,87,22,0],[89,21,89,22,0],[90,25,90,52,0],[91,25,91,42,0],[92,25,92,26,0],[93,29,93,43,0],[94,29,94,42,0],[95,25,95,26,0],[96,25,96,37,0],[97,25,97,97,0],[99,21,99,22,0],[100,21,100,104,0],[101,17,101,18,0],[103,17,103,18,0],[104,21,104,35,0],[105,21,105,73,0],[106,17,106,18,0],[107,13,107,14,0],[108,13,108,25,0],[109,9,109,10,0]]);
    </script>
  </body>
</html>