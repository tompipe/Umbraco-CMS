<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\DefaultData.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using Umbraco.Core.Logging;
using umbraco.BusinessLogic;
using umbraco.DataLayer;

namespace umbraco.editorControls
{
    [Obsolete(&quot;Use umbraco.cms.businesslogic.datatype.DefaultData instead&quot;)]
    public class DefaultData : interfaces.IData
    {
        private int _propertyId;
        private object _value;
        protected BaseDataType _dataType;

        /// &lt;summary&gt;
        /// Unused, please do not use
        /// &lt;/summary&gt;
        [Obsolete(&quot;Obsolete, For querying the database use the new UmbracoDatabase object ApplicationContext.Current.DatabaseContext.Database&quot;, false)]
        protected static ISqlHelper SqlHelper
        {
            get { return Application.SqlHelper; }
        }

		public DefaultData(BaseDataType DataType) {
            _dataType = DataType;
        }

        #region IData Members

        public virtual System.Xml.XmlNode ToXMl(System.Xml.XmlDocument d)
        {
            if (this._dataType.DBType == DBTypes.Ntext)
                return d.CreateCDataSection(this.Value.ToString());
            return d.CreateTextNode(Value.ToString());
        }

        public object Value
        {
            get
            {
                return _value;
            }
            set
            {
                // Try to set null values if possible
                try
                {
                    if (value == null)
                        using (var sqlHelper = Application.SqlHelper)
						    sqlHelper.ExecuteNonQuery(&quot;update cmsPropertyData set &quot;+ _dataType.DataFieldName +&quot; = NULL where id = &quot; + _propertyId);
                    else
                        using (var sqlHelper = Application.SqlHelper)
						    sqlHelper.ExecuteNonQuery(&quot;update cmsPropertyData set &quot;+ _dataType.DataFieldName +&quot; = @value where id = &quot; + _propertyId, sqlHelper.CreateParameter(&quot;@value&quot;, value) );
                    _value = value;
                }
                catch (Exception e)
                {
					LogHelper.Error(typeof(DefaultData), &quot;Error updating item: &quot; + e.ToString(), e);

					if (value==null) value =&quot;&quot;;
                    using (var sqlHelper = Application.SqlHelper)
                        sqlHelper.ExecuteNonQuery(&quot;update cmsPropertyData set &quot;+ _dataType.DataFieldName +&quot; = @value where id = &quot; + _propertyId, sqlHelper.CreateParameter(&quot;@value&quot;, value) );
					_value = value;
				}
            }
        }

        public virtual void MakeNew(int PropertyId)
        {
            // this default implementation of makenew does not do anything s�nce 
            // it uses the default datastorage of umbraco, and the row is already populated by the &quot;property&quot; object
            // If the datatype needs to have a default value, inherit this class and override this method.
        }

		public void Delete() {
            // this default implementation of delete does not do anything s�nce 
            // it uses the default datastorage of umbraco, and the row is already deleted by the &quot;property&quot; object
        }

        public int PropertyId
        {
			get {
                return _propertyId;
            }
            set
            {
                _propertyId = value;
                using (var sqlHelper = Application.SqlHelper)
				    _value = sqlHelper.ExecuteScalar&lt;object&gt;(&quot;Select &quot; + _dataType.DataFieldName + &quot; from cmsPropertyData where id = &quot; + value);
            }
        }

        // TODO: clean up Legacy - these are needed by the wysiwyeditor, in order to feed the richtextholder with version and nodeid
        // solution, create a new version of the richtextholder, which does not depend on these.
		public Guid Version {
			get {
                using (var sqlHelper = Application.SqlHelper)
                    return new Guid(sqlHelper.ExecuteScalar&lt;string&gt;(&quot;Select versionId from cmsPropertyData where id = &quot; + PropertyId).ToString());
            }
        }

		public int NodeId {
			get {
                using (var sqlHelper = Application.SqlHelper)
                    return sqlHelper.ExecuteScalar&lt;int&gt;(&quot;Select contentNodeid from cmsPropertyData where id = &quot; + PropertyId);
			}
		}
        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,17,21,18,0],[21,19,21,48,0],[21,49,21,50,0],[24,3,24,44,0],[24,45,24,46,0],[25,13,25,34,0],[26,9,26,10,0],[31,9,31,10,0],[32,13,32,56,0],[33,17,33,68,0],[34,13,34,55,0],[35,9,35,10,0],[40,13,40,14,0],[41,17,41,31,0],[42,13,42,14,0],[44,13,44,14,0],[47,17,47,18,0],[48,21,48,39,0],[49,32,49,69,0],[50,11,50,130,0],[52,32,52,69,0],[53,11,53,177,0],[54,21,54,36,0],[55,17,55,18,0],[56,17,56,36,0],[57,17,57,18,0],[58,6,58,86,0],[60,6,60,22,0],[60,23,60,33,0],[61,28,61,65,0],[62,25,62,191,0],[63,6,63,21,0],[64,5,64,6,0],[65,13,65,14,0],[69,9,69,10,0],[73,9,73,10,0],[75,24,75,25,0],[78,9,78,10,0],[82,8,82,9,0],[83,17,83,36,0],[84,13,84,14,0],[86,13,86,14,0],[87,17,87,37,0],[88,24,88,61,0],[89,9,89,133,0],[90,13,90,14,0],[96,8,96,9,0],[97,24,97,61,0],[98,21,98,147,0],[99,13,99,14,0],[103,8,103,9,0],[104,24,104,61,0],[105,21,105,127,0],[106,4,106,5,0]]);
    </script>
  </body>
</html>