<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\PropertyEditors\MultiValuePropertyEditorTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using Moq;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Core.PropertyEditors;
using Umbraco.Core.Services;
using Umbraco.Web.PropertyEditors;

namespace Umbraco.Tests.PropertyEditors
{
    /// &lt;summary&gt;
    /// Tests for the base classes of ValueEditors and PreValueEditors that are used for Property Editors that edit
    /// multiple values such as the drop down list, check box list, color picker, etc....
    /// &lt;/summary&gt;
    [TestFixture]
    public class MultiValuePropertyEditorTests
    {
        //TODO: Test the other formatting methods for the drop down classes

        [Test]
        public void DropDownMultipleValueEditor_With_Keys_Format_Data_For_Cache()
        {
            var dataTypeServiceMock = new Mock&lt;IDataTypeService&gt;();
            var dataTypeService = dataTypeServiceMock.Object;
            var editor = new PublishValuesMultipleValueEditor(true, dataTypeService, new PropertyValueEditor());

            var prop = new Property(1, Guid.NewGuid(),
                                    new PropertyType(new DataTypeDefinition(1, &quot;Test.TestEditor&quot;)),
                                    &quot;1234,4567,8910&quot;);

            var result = editor.ConvertDbToString(prop, prop.PropertyType, new Mock&lt;IDataTypeService&gt;().Object);

            Assert.AreEqual(&quot;1234,4567,8910&quot;, result);
        }

        [Test]
        public void DropDownMultipleValueEditor_No_Keys_Format_Data_For_Cache()
        {
            var dataTypeServiceMock = new Mock&lt;IDataTypeService&gt;();

            dataTypeServiceMock
                .Setup(x =&gt; x.GetPreValuesCollectionByDataTypeId(It.IsAny&lt;int&gt;()))
                           .Returns(new PreValueCollection(new Dictionary&lt;string, PreValue&gt;
                               {
                                   {&quot;key0&quot;, new PreValue(4567, &quot;Value 1&quot;)},
                                   {&quot;key1&quot;, new PreValue(1234, &quot;Value 2&quot;)},
                                   {&quot;key2&quot;, new PreValue(8910, &quot;Value 3&quot;)}
                               }));

            var dataTypeService = dataTypeServiceMock.Object;
            var editor = new PublishValuesMultipleValueEditor(false, dataTypeService, new PropertyValueEditor());

            var prop = new Property(1, Guid.NewGuid(),
                                    new PropertyType(new DataTypeDefinition(1, &quot;Test.TestEditor&quot;)),
                                    &quot;1234,4567,8910&quot;);

            var result = editor.ConvertDbToString(prop, prop.PropertyType, new Mock&lt;IDataTypeService&gt;().Object);

            Assert.AreEqual(&quot;Value 1,Value 2,Value 3&quot;, result);
        }

        [Test]
        public void DropDownValueEditor_Format_Data_For_Cache()
        {
            var dataTypeServiceMock = new Mock&lt;IDataTypeService&gt;();
            dataTypeServiceMock
                .Setup(x =&gt; x.GetPreValuesCollectionByDataTypeId(It.IsAny&lt;int&gt;()))
                           .Returns(new PreValueCollection(new Dictionary&lt;string, PreValue&gt;
                               {
                                   {&quot;key0&quot;, new PreValue(10, &quot;Value 1&quot;)},
                                   {&quot;key1&quot;, new PreValue(1234, &quot;Value 2&quot;)},
                                   {&quot;key2&quot;, new PreValue(11, &quot;Value 3&quot;)}
                               }));

            var dataTypeService = dataTypeServiceMock.Object;
            var editor = new PublishValueValueEditor(dataTypeService, new PropertyValueEditor());

            var prop = new Property(1, Guid.NewGuid(),
                                    new PropertyType(new DataTypeDefinition(1, &quot;Test.TestEditor&quot;)),
                                    &quot;1234&quot;);

            var result = editor.ConvertDbToString(prop, prop.PropertyType, new Mock&lt;IDataTypeService&gt;().Object);

            Assert.AreEqual(&quot;Value 2&quot;, result);
        }

        [Test]
        public void DropDownPreValueEditor_Format_Data_For_Editor()
        {

            var defaultVals = new Dictionary&lt;string, object&gt;();
            var persisted = new PreValueCollection(new Dictionary&lt;string, PreValue&gt;
                {
                    {&quot;item1&quot;, new PreValue(1, &quot;Item 1&quot;)},
                    {&quot;item2&quot;, new PreValue(2, &quot;Item 2&quot;)},
                    {&quot;item3&quot;, new PreValue(3, &quot;Item 3&quot;)}
                });

            var editor = new ValueListPreValueEditor();

            var result = editor.ConvertDbToEditor(defaultVals, persisted);

            Assert.AreEqual(1, result.Count);
            Assert.IsTrue(result.ContainsKey(&quot;items&quot;));
            var items = result[&quot;items&quot;] as IDictionary&lt;int, IDictionary&lt;string, object&gt;&gt;;
            Assert.IsNotNull(items);
            Assert.AreEqual(&quot;Item 1&quot;, items[1][&quot;value&quot;]);
            Assert.AreEqual(&quot;Item 2&quot;, items[2][&quot;value&quot;]);
            Assert.AreEqual(&quot;Item 3&quot;, items[3][&quot;value&quot;]);
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,1],[24,13,24,68,1],[25,13,25,62,1],[26,13,26,113,1],[28,13,30,55,1],[32,13,32,113,1],[34,13,34,55,1],[35,9,35,10,1],[39,9,39,10,1],[40,13,40,68,1],[42,13,49,36,1],[51,13,51,62,1],[52,13,52,114,1],[54,13,56,55,1],[58,13,58,113,1],[60,13,60,64,1],[61,9,61,10,1],[65,9,65,10,1],[66,13,66,68,1],[67,13,74,36,1],[76,13,76,62,1],[77,13,77,98,1],[79,13,81,45,1],[83,13,83,113,1],[85,13,85,48,1],[86,9,86,10,1],[90,9,90,10,1],[92,13,92,64,1],[93,13,98,20,1],[100,13,100,56,1],[102,13,102,75,1],[104,13,104,46,1],[105,13,105,56,1],[106,13,106,90,1],[107,13,107,37,1],[108,13,108,58,1],[109,13,109,58,1],[110,13,110,58,1],[111,9,111,10,1]]);
    </script>
  </body>
</html>