<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Repositories\SimilarNodeNameComparer.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;

namespace Umbraco.Core.Persistence.Repositories
{
    /// &lt;summary&gt;
    /// Comparer that takes into account the duplicate index of a node name
    /// This is needed as a normal alphabetic sort would go Page (1), Page (10), Page (2) etc.
    /// &lt;/summary&gt;
    internal class SimilarNodeNameComparer : IComparer&lt;string&gt;
    {
        public int Compare(string x, string y)
        {
            if (x.LastIndexOf(&#39;(&#39;) != -1 &amp;&amp; x.LastIndexOf(&#39;)&#39;) == x.Length - 1 &amp;&amp; y.LastIndexOf(&#39;)&#39;) == y.Length - 1)
            {
                if (x.ToLower().Substring(0, x.LastIndexOf(&#39;(&#39;)) == y.ToLower().Substring(0, y.LastIndexOf(&#39;(&#39;)))
                {
                    int xDuplicateIndex = ExtractDuplicateIndex(x);
                    int yDuplicateIndex = ExtractDuplicateIndex(y);

                    if (xDuplicateIndex != 0 &amp;&amp; yDuplicateIndex != 0)
                    {
                        return xDuplicateIndex.CompareTo(yDuplicateIndex);
                    }
                }
            }
            return String.Compare(x.ToLower(), y.ToLower(), StringComparison.Ordinal);
        }

        private int ExtractDuplicateIndex(string text)
        {
            int index = 0;

            if (text.LastIndexOf(&#39;(&#39;) != -1 &amp;&amp; text.LastIndexOf(&#39;(&#39;) &lt; text.Length - 2)
            {
                int startPos = text.LastIndexOf(&#39;(&#39;) + 1;
                int length = text.Length - 1 - startPos;

                int.TryParse(text.Substring(startPos, length), out index);
            }

            return index;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,10,1],[14,13,14,118,1],[15,13,15,14,1],[16,17,16,114,1],[17,17,17,18,1],[18,21,18,68,1],[19,21,19,68,1],[21,21,21,70,1],[22,21,22,22,1],[23,25,23,75,1],[25,17,25,18,0],[26,13,26,14,0],[27,13,27,87,1],[28,9,28,10,1],[31,9,31,10,1],[32,13,32,27,1],[34,13,34,88,1],[35,13,35,14,1],[36,17,36,58,1],[37,17,37,57,1],[39,17,39,75,1],[40,13,40,14,1],[42,13,42,26,1],[43,9,43,10,1]]);
    </script>
  </body>
</html>