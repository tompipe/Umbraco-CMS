<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\tags\library.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Text;
using System.Xml;
using System.Xml.XPath;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.web;
using umbraco.DataLayer;
using System.Linq;

using System.Collections.Generic;
using umbraco.interfaces;

namespace umbraco.editorControls.tags
{
    [Obsolete(&quot;Use the TagService to query tags or the UmbracoHelper on the front-end and use the SetTags, RemoveTags extension methods on IContentBase to manipulate tags&quot;)]
    public class library
    {
        /// &lt;summary&gt;
        /// Gets everything (content, media, members) in Umbraco with the specified tags.
        /// It returns the found nodes as:
        /// &lt;root&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// etc...
        /// &lt;/root&gt;
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tags&quot;&gt;Commaseparated tags.&lt;/param&gt;
        /// &lt;returns&gt;
        /// A XpathNodeIterator
        ///&lt;/returns&gt;
        public static XPathNodeIterator getEverythingWithTags(string tags)
        {
            var nodes = umbraco.cms.businesslogic.Tags.Tag.GetNodesWithTags(tags);

            XmlDocument xmlDoc = new XmlDocument();
            XmlNode root = xmlDoc.CreateElement(&quot;root&quot;);
            foreach (var n in nodes)
            {
                root.AppendChild(n.ToXml(xmlDoc, true));
            }

            xmlDoc.AppendChild(root);
            return xmlDoc.CreateNavigator().Select(&quot;.&quot;);
        }

        /// &lt;summary&gt;
        /// Gets all content nodes in Umbraco with the specified tag.
        /// It returns the found nodes as:
        /// &lt;root&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// etc...
        /// &lt;/root&gt;
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tags&quot;&gt;Commaseparated tags.&lt;/param&gt;
        /// &lt;returns&gt;
        /// A XpathNodeIterator
        ///&lt;/returns&gt;
        public static XPathNodeIterator getContentsWithTags(string tags)
        {
            XmlDocument xmlDoc = new XmlDocument();

            var docs = umbraco.cms.businesslogic.Tags.Tag.GetDocumentsWithTags(tags);                       

            XmlNode root = xmlDoc.CreateElement(&quot;root&quot;);
            foreach(var d in docs)
            {                                
                root.AppendChild(d.ToXml(xmlDoc, true));
            }

            xmlDoc.AppendChild(root);
            
            return xmlDoc.CreateNavigator().Select(&quot;.&quot;);
        }

        /// &lt;summary&gt;
        /// Returns all members (does not care about groups and types) in Umbraco with the specified tag.
        /// It returns the found nodes as:
        /// &lt;root&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// etc...
        /// &lt;/root&gt;
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tags&quot;&gt;Comma separated tags.&lt;/param&gt;
        /// &lt;returns&gt;
        /// A XpathNodeIterator
        ///&lt;/returns&gt;
        public static XPathNodeIterator getMembersWithTags(string tags)
        {
            //TODO: Implement a &#39;real&#39; getter to get media items. 
            //I ported this code to the cms assembly and noticed none of these methods actually do anything different:
            // getMediaWithTags
            // getMembersWithTags
            //they just return CMSNodes!

            var nodes = umbraco.cms.businesslogic.Tags.Tag.GetNodesWithTags(tags);

            XmlDocument xmlDoc = new XmlDocument();
            XmlNode root = xmlDoc.CreateElement(&quot;root&quot;);
            foreach (var n in nodes)
            {
                root.AppendChild(n.ToXml(xmlDoc, true));
            }

            xmlDoc.AppendChild(root);
            return xmlDoc.CreateNavigator().Select(&quot;.&quot;);
        }

        /// &lt;summary&gt;
        /// Returns all media nodes in Umbraco with the specified tag.
        /// It returns the found nodes as:
        /// &lt;root&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// &lt;node&gt;&lt;data/&gt;...&lt;/node&gt;
        /// etc...
        /// &lt;/root&gt;
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tags&quot;&gt;Commaseparated tags.&lt;/param&gt;
        /// &lt;returns&gt;
        /// A XpathNodeIterator
        ///&lt;/returns&gt;
        public static XPathNodeIterator getMediaWithTags(string tags)
        {
            //TODO: Implement a &#39;real&#39; getter to get media items. 
            //I ported this code to the cms assembly and noticed none of these methods actually do anything different:
            // getMediaWithTags
            // getMembersWithTags
            //they just return CMSNodes!

            var nodes = umbraco.cms.businesslogic.Tags.Tag.GetNodesWithTags(tags);

            XmlDocument xmlDoc = new XmlDocument();
            XmlNode root = xmlDoc.CreateElement(&quot;root&quot;);
            foreach(var n in nodes)
            {
                root.AppendChild(n.ToXml(xmlDoc, true));
            }

            xmlDoc.AppendChild(root);
            return xmlDoc.CreateNavigator().Select(&quot;.&quot;);
        }


        /// &lt;summary&gt;
        /// Gets all tags
        /// It returns the found nodes as:
        /// &lt;tags&gt;
        /// &lt;tag id=&quot;&quot; nodesTagged=&quot;&quot; group=&quot;&quot;&gt;tagname&lt;tag&gt;
        /// etc...
        /// &lt;/tags&gt;
        /// Each tag node will contain it&#39;s numeric ID, number of nodes tagged with it, and the tags group.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// A XpathNodeIterator
        ///&lt;/returns&gt;
        public static XPathNodeIterator getAllTags()
        {
            string xmlVal = &quot;&lt;tags&gt;\n&quot;;

            var tags = umbraco.cms.businesslogic.Tags.Tag.GetTags();

            foreach(var t in tags)
            {
                xmlVal += &quot;&lt;tag id=\&quot;&quot; + t.Id.ToString() + &quot;\&quot; group=\&quot;&quot; + t.Group + &quot;\&quot; nodesTagged=\&quot;&quot; + t.NodeCount.ToString() + &quot;\&quot;&gt;&quot; + t.TagCaption + &quot;&lt;/tag&gt;\n&quot;;
            }
            xmlVal += &quot;&lt;/tags&gt;&quot;;

            XmlDocument doc = new XmlDocument();
            doc.LoadXml(xmlVal);

            return doc.CreateNavigator().Select(&quot;.&quot;);
        }

        /// &lt;summary&gt;
        /// Gets all tags in a specific group
        /// It returns the found nodes as:
        /// &lt;tags&gt;
        /// &lt;tag id=&quot;&quot; nodesTagged=&quot;&quot; group=&quot;&quot;&gt;tagname&lt;tag&gt;
        /// etc...
        /// &lt;/tags&gt;
        /// Each tag node will contain it&#39;s numeric ID, number of nodes tagged with it, and the tags group.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// A XpathNodeIterator
        ///&lt;/returns&gt;
        public static XPathNodeIterator getAllTagsInGroup(string group)
        {
            string xmlVal = &quot;&lt;tags&gt;\n&quot;;

            var tags = umbraco.cms.businesslogic.Tags.Tag.GetTags(group);
            
            foreach (var t in tags)
            {
                xmlVal += &quot;&lt;tag id=\&quot;&quot; + t.Id.ToString() +&quot;\&quot; group=\&quot;&quot; + t.Group + &quot;\&quot; nodesTagged=\&quot;&quot; + t.NodeCount.ToString() + &quot;\&quot;&gt;&quot; + t.TagCaption + &quot;&lt;/tag&gt;\n&quot;;
            }
            xmlVal += &quot;&lt;/tags&gt;&quot;;

            XmlDocument doc = new XmlDocument();
            doc.LoadXml(xmlVal);

            return doc.CreateNavigator().Select(&quot;.&quot;);
        }

        /// &lt;summary&gt;
        /// Gets all tags associated with a specific node ID
        /// It returns the found nodes as:
        /// &lt;tags&gt;
        /// &lt;tag id=&quot;&quot; nodesTagged=&quot;&quot; group=&quot;&quot;&gt;tagname&lt;tag&gt;
        /// etc...
        /// &lt;/tags&gt;
        /// Each tag node will contain it&#39;s numeric ID, number of nodes tagged with it, and the tags group.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// A XpathNodeIterator
        ///&lt;/returns&gt;
        public static XPathNodeIterator getTagsFromNode(string nodeId)
        {
            string xmlVal = &quot;&lt;tags&gt;\n&quot;;

            var tags = umbraco.cms.businesslogic.Tags.Tag.GetTags(int.Parse(nodeId));

            foreach (var t in tags)
            {
                xmlVal += &quot;&lt;tag id=\&quot;&quot; + t.Id.ToString() + &quot;\&quot; group=\&quot;&quot; + t.Group + &quot;\&quot; nodesTagged=\&quot;&quot; + t.NodeCount.ToString() + &quot;\&quot;&gt;&quot; + t.TagCaption + &quot;&lt;/tag&gt;\n&quot;;
            }
            xmlVal += &quot;&lt;/tags&gt;&quot;;

            XmlDocument doc = new XmlDocument();
            doc.LoadXml(xmlVal);

            return doc.CreateNavigator().Select(&quot;.&quot;);
        }

        #region Obsolete
        [Obsolete(&quot;use the umbraco.cms.businesslogic.Tags.Tag class instead&quot;)]
        public static void addTagsToNode(int nodeId, string tags, string group)
        {
            umbraco.cms.businesslogic.Tags.Tag.AddTagsToNode(nodeId, tags, group);
        }

        [Obsolete(&quot;use the umbraco.cms.businesslogic.Tags.Tag class instead&quot;)]
        public static void RemoveTagFromNode(int nodeId, string tag, string group)
        {
            umbraco.cms.businesslogic.Tags.Tag.RemoveTagFromNode(nodeId, tag, group);
        }

        [Obsolete(&quot;use the umbraco.cms.businesslogic.Tags.Tag class instead&quot;)]
        public static int AddTag(string tag, string group)
        {
            return umbraco.cms.businesslogic.Tags.Tag.AddTag(tag, group);
        }

        [Obsolete(&quot;use the umbraco.cms.businesslogic.Tags.Tag class instead&quot;)]
        public static int GetTagId(string tag, string group)
        {
            return umbraco.cms.businesslogic.Tags.Tag.GetTagId(tag, group);
        }

        /// &lt;summary&gt;
        /// Gets the tags from node as ITag objects.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nodeId&quot;&gt;The node id.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [Obsolete(&quot;Use the umbraco.cms.businesslogic.Tags.Tag class instead&quot;)]
        public static List&lt;umbraco.interfaces.ITag&gt; GetTagsFromNodeAsITags(int nodeId)
        {
            return umbraco.cms.businesslogic.Tags.Tag.GetTags(nodeId).Cast&lt;ITag&gt;().ToList();
        }

        /// &lt;summary&gt;
        /// Gets the tags from group as ITag objects.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;group&quot;&gt;The group.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [Obsolete(&quot;Use the umbraco.cms.businesslogic.Tags.Tag class instead&quot;)]
        public static List&lt;umbraco.interfaces.ITag&gt; GetTagsFromGroupAsITags(string group)
        {
            return umbraco.cms.businesslogic.Tags.Tag.GetTags(group).Cast&lt;ITag&gt;().ToList();
        }

        /// &lt;summary&gt;
        /// Gets all the tags as ITag objects
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nodeId&quot;&gt;The node id.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [Obsolete(&quot;Use the umbraco.cms.businesslogic.Tags.Tag class instead&quot;)]
        public static List&lt;umbraco.interfaces.ITag&gt; GetTagsAsITags()
        {
            return umbraco.cms.businesslogic.Tags.Tag.GetTags().Cast&lt;ITag&gt;().ToList();
        }

        #endregion
        
    }

    [Obsolete(&quot;Use the TagService to query tags or the UmbracoHelper on the front-end and use the SetTags, RemoveTags extension methods on IContentBase to manipulate tags&quot;)]
    public class Tag : umbraco.interfaces.ITag
    {

        public Tag() { }
        public Tag(int id, string tag, string group)
        {
            Id = id;
            TagCaption = tag;
            Group = group;
        }

        #region ITag Members

        public int Id
        {
            get;
            set;
        }

        public string TagCaption
        {
            get;
            set;
        }

        public string Group
        {
            get;
            set;
        }

        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[33,9,33,10,0],[34,13,34,83,0],[36,13,36,52,0],[37,13,37,57,0],[38,13,38,20,0],[38,22,38,27,0],[38,28,38,30,0],[38,31,38,36,0],[39,13,39,14,0],[40,17,40,57,0],[41,13,41,14,0],[43,13,43,38,0],[44,13,44,57,0],[45,9,45,10,0],[61,9,61,10,0],[62,13,62,52,0],[64,13,64,86,0],[66,13,66,57,0],[67,13,67,20,0],[67,21,67,26,0],[67,27,67,29,0],[67,30,67,34,0],[68,13,68,14,0],[69,17,69,57,0],[70,13,70,14,0],[72,13,72,38,0],[74,13,74,57,0],[75,9,75,10,0],[91,9,91,10,0],[98,13,98,83,0],[100,13,100,52,0],[101,13,101,57,0],[102,13,102,20,0],[102,22,102,27,0],[102,28,102,30,0],[102,31,102,36,0],[103,13,103,14,0],[104,17,104,57,0],[105,13,105,14,0],[107,13,107,38,0],[108,13,108,57,0],[109,9,109,10,0],[125,9,125,10,0],[132,13,132,83,0],[134,13,134,52,0],[135,13,135,57,0],[136,13,136,20,0],[136,21,136,26,0],[136,27,136,29,0],[136,30,136,35,0],[137,13,137,14,0],[138,17,138,57,0],[139,13,139,14,0],[141,13,141,38,0],[142,13,142,57,0],[143,9,143,10,0],[159,9,159,10,0],[160,13,160,40,0],[162,13,162,69,0],[164,13,164,20,0],[164,21,164,26,0],[164,27,164,29,0],[164,30,164,34,0],[165,13,165,14,0],[166,17,166,167,0],[167,13,167,14,0],[168,13,168,33,0],[170,13,170,49,0],[171,13,171,33,0],[173,13,173,54,0],[174,9,174,10,0],[189,9,189,10,0],[190,13,190,40,0],[192,13,192,74,0],[194,13,194,20,0],[194,22,194,27,0],[194,28,194,30,0],[194,31,194,35,0],[195,13,195,14,0],[196,17,196,166,0],[197,13,197,14,0],[198,13,198,33,0],[200,13,200,49,0],[201,13,201,33,0],[203,13,203,54,0],[204,9,204,10,0],[219,9,219,10,0],[220,13,220,40,0],[222,13,222,86,0],[224,13,224,20,0],[224,22,224,27,0],[224,28,224,30,0],[224,31,224,35,0],[225,13,225,14,0],[226,17,226,167,0],[227,13,227,14,0],[228,13,228,33,0],[230,13,230,49,0],[231,13,231,33,0],[233,13,233,54,0],[234,9,234,10,0],[239,9,239,10,0],[240,13,240,83,0],[241,9,241,10,0],[245,9,245,10,0],[246,13,246,86,0],[247,9,247,10,0],[251,9,251,10,0],[252,13,252,74,0],[253,9,253,10,0],[257,9,257,10,0],[258,13,258,76,0],[259,9,259,10,0],[268,9,268,10,0],[269,13,269,93,0],[270,9,270,10,0],[279,9,279,10,0],[280,13,280,92,0],[281,9,281,10,0],[290,9,290,10,0],[291,13,291,87,0],[292,9,292,10,0],[302,9,302,21,0],[302,22,302,23,0],[302,24,302,25,0],[303,9,303,53,0],[304,9,304,10,0],[305,13,305,21,0],[306,13,306,30,0],[307,13,307,27,0],[308,9,308,10,0],[314,13,314,17,0],[315,13,315,17,0],[320,13,320,17,0],[321,13,321,17,0],[326,13,326,17,0],[327,13,327,17,0]]);
    </script>
  </body>
</html>