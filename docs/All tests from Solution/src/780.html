<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\WebApi\HttpRequestMessageExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Threading.Tasks;
using System.Web;
using System.Web.Http;
using System.Web.Http.ModelBinding;
using System.Web.Http.Results;
using Microsoft.Owin;
using Umbraco.Core;
using Umbraco.Web.Models.ContentEditing;

namespace Umbraco.Web.WebApi
{
    
    public static class HttpRequestMessageExtensions
    {

        /// &lt;summary&gt;
        /// Borrowed from the latest Microsoft.AspNet.WebApi.Owin package which we cannot use because of a later webapi dependency
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal static Attempt&lt;IOwinContext&gt; TryGetOwinContext(this HttpRequestMessage request)
        {
            var httpContext = request.TryGetHttpContext();
            return httpContext 
                ? Attempt.Succeed(httpContext.Result.GetOwinContext()) 
                : Attempt&lt;IOwinContext&gt;.Fail();
        }

        /// &lt;summary&gt;
        /// Tries to retrieve the current HttpContext if one exists.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static Attempt&lt;HttpContextBase&gt; TryGetHttpContext(this HttpRequestMessage request)
        {
            object context;
            if (request.Properties.TryGetValue(&quot;MS_HttpContext&quot;, out context))
            {
                var httpContext = context as HttpContextBase;
                if (httpContext != null)
                {
                    return Attempt.Succeed(httpContext);
                }
            }
            if (HttpContext.Current != null)
            {
                return Attempt&lt;HttpContextBase&gt;.Succeed(new HttpContextWrapper(HttpContext.Current));
            }

            return Attempt&lt;HttpContextBase&gt;.Fail();
        }

        /// &lt;summary&gt;
        /// Create a 403 (Forbidden) response indicating that hte current user doesn&#39;t have access to the resource
        /// requested or the action it needs to take.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// This is different from a 401 which indicates that the user is not logged in.
        /// &lt;/remarks&gt;
        public static HttpResponseMessage CreateUserNoAccessResponse(this HttpRequestMessage request)
        {
            return request.CreateResponse(HttpStatusCode.Forbidden);
        }

        /// &lt;summary&gt;
        /// Create a 400 response message indicating that a validation error occurred
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static HttpResponseMessage CreateValidationErrorResponse&lt;T&gt;(this HttpRequestMessage request, T value)
        {
            var msg = request.CreateResponse(HttpStatusCode.BadRequest, value);
            msg.Headers.Add(&quot;X-Status-Reason&quot;, &quot;Validation failed&quot;);
            return msg;
        }

        /// &lt;summary&gt;
        /// Create a 400 response message indicating that a validation error occurred
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static HttpResponseMessage CreateValidationErrorResponse(this HttpRequestMessage request)
        {
            var msg = request.CreateResponse(HttpStatusCode.BadRequest);
            msg.Headers.Add(&quot;X-Status-Reason&quot;, &quot;Validation failed&quot;);
            return msg;
        }

        /// &lt;summary&gt;
        /// Create a 400 response message indicating that a validation error occurred
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;errorMessage&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static HttpResponseMessage CreateValidationErrorResponse(this HttpRequestMessage request, string errorMessage)
        {
            var msg = request.CreateErrorResponse(HttpStatusCode.BadRequest, errorMessage);
            msg.Headers.Add(&quot;X-Status-Reason&quot;, &quot;Validation failed&quot;);
            return msg;
        }

        /// &lt;summary&gt;
        /// Creates an error response with notifications in the result to be displayed in the UI
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;errorMessage&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static HttpResponseMessage CreateNotificationValidationErrorResponse(this HttpRequestMessage request, string errorMessage)
        {
            var notificationModel = new SimpleNotificationModel
            {
                Message = errorMessage
            };
            notificationModel.AddErrorNotification(errorMessage, string.Empty);
            return request.CreateValidationErrorResponse(notificationModel);
        }

        /// &lt;summary&gt;
        /// Creates a succressful response with notifications in the result to be displayed in the UI
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;successMessage&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static HttpResponseMessage CreateNotificationSuccessResponse(this HttpRequestMessage request, string successMessage)
        {
            var notificationModel = new SimpleNotificationModel
            {
                Message = successMessage
            };
            notificationModel.AddSuccessNotification(successMessage, string.Empty);
            return request.CreateResponse(HttpStatusCode.OK, notificationModel);
        }

        /// &lt;summary&gt;
        /// Create a 400 response message indicating that a validation error occurred
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;request&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;modelState&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static HttpResponseMessage CreateValidationErrorResponse(this HttpRequestMessage request, ModelStateDictionary modelState)
        {
            var msg = request.CreateErrorResponse(HttpStatusCode.BadRequest, modelState);
            msg.Headers.Add(&quot;X-Status-Reason&quot;, &quot;Validation failed&quot;);
            return msg;
        }
    }

}

    </pre>
    <script type="text/javascript">
      highlightRanges([[29,9,29,10,0],[30,13,30,59,0],[31,13,33,48,0],[34,9,34,10,0],[41,9,41,10,0],[43,13,43,79,0],[44,13,44,14,0],[45,17,45,62,0],[46,17,46,41,0],[47,17,47,18,0],[48,21,48,57,0],[50,13,50,14,0],[51,13,51,45,0],[52,13,52,14,0],[53,17,53,102,0],[56,13,56,52,0],[57,9,57,10,0],[69,9,69,10,0],[70,13,70,69,0],[71,9,71,10,0],[81,9,81,10,0],[82,13,82,80,0],[83,13,83,69,0],[84,13,84,24,0],[85,9,85,10,0],[93,9,93,10,0],[94,13,94,73,0],[95,13,95,69,0],[96,13,96,24,0],[97,9,97,10,0],[106,9,106,10,0],[107,13,107,92,0],[108,13,108,69,0],[109,13,109,24,0],[110,9,110,10,0],[119,9,119,10,0],[120,13,123,15,0],[124,13,124,80,0],[125,13,125,77,0],[126,9,126,10,0],[135,9,135,10,0],[136,13,139,15,0],[140,13,140,84,0],[141,13,141,81,0],[142,9,142,10,0],[151,9,151,10,0],[152,13,152,90,0],[153,13,153,69,0],[154,13,154,24,0],[155,9,155,10,0]]);
    </script>
  </body>
</html>