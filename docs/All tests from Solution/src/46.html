<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\PublishedContent\PublishedContentTestBase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.IO;
using System.Linq;
using Umbraco.Core;
using Umbraco.Core.Configuration;
using Umbraco.Core.Models;
using Umbraco.Core.Models.PublishedContent;
using Umbraco.Core.PropertyEditors;
using Umbraco.Core.PropertyEditors.ValueConverters;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web;
using Umbraco.Web.PublishedCache;
using Umbraco.Web.PublishedCache.XmlPublishedCache;

namespace Umbraco.Tests.PublishedContent
{
    /// &lt;summary&gt;
    /// Abstract base class for tests for published content and published media
    /// &lt;/summary&gt;
    public abstract class PublishedContentTestBase : BaseRoutingTest
    {
        public override void Initialize()
        {
            base.Initialize();
            
            // need to specify a custom callback for unit tests
            var propertyTypes = new[]
                {
                    // AutoPublishedContentType will auto-generate other properties
                    new PublishedPropertyType(&quot;content&quot;, 0, Constants.PropertyEditors.TinyMCEAlias), 
                };
            var type = new AutoPublishedContentType(0, &quot;anything&quot;, propertyTypes);
            PublishedContentType.GetPublishedContentTypeCallback = (alias) =&gt; type;

            var rCtx = GetRoutingContext(&quot;/test&quot;, 1234);
            UmbracoContext.Current = rCtx.UmbracoContext;
            
        }

        protected override void FreezeResolution()
        {
            if (PropertyValueConvertersResolver.HasCurrent == false)
                PropertyValueConvertersResolver.Current = new PropertyValueConvertersResolver(
                    new ActivatorServiceProvider(), Logger,
                    new[]
                        {
                            typeof(DatePickerValueConverter),
                            typeof(TinyMceValueConverter),
                            typeof(YesNoValueConverter)
                        });    

            PublishedCachesResolver.Current = new PublishedCachesResolver(new PublishedCaches(
                new PublishedContentCache(), new PublishedMediaCache(ApplicationContext)));

            if (PublishedContentModelFactoryResolver.HasCurrent == false)
                PublishedContentModelFactoryResolver.Current = new PublishedContentModelFactoryResolver();

            base.FreezeResolution();
        }

        public override void TearDown()
        {
            base.TearDown();
            
            UmbracoContext.Current = null;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,1],[24,13,24,31,1],[27,13,31,19,1],[32,13,32,83,1],[33,13,33,79,1],[33,79,33,83,1],[33,83,33,84,1],[33,13,33,84,1],[35,13,35,57,1],[36,13,36,58,1],[38,9,38,10,1],[41,9,41,10,1],[42,13,42,69,1],[43,17,50,28,1],[52,13,53,92,1],[55,13,55,74,1],[56,17,56,107,1],[58,13,58,37,1],[59,9,59,10,1],[62,9,62,10,1],[63,13,63,29,1],[65,13,65,43,1],[66,9,66,10,1]]);
    </script>
  </body>
</html>