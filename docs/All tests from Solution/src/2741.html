<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\dictionaryPicker\dictionaryPicker.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Web.UI.WebControls;

namespace umbraco.editorControls.dictionaryPicker
{
	/// &lt;summary&gt;
	/// Summary description for dictionaryPicker.
	/// &lt;/summary&gt;
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
	public class dictionaryPicker : System.Web.UI.WebControls.CheckBoxList, interfaces.IDataEditor
	{
		private interfaces.IData _data;
		private SortedList _prevalues;
		private string _text;

		public dictionaryPicker(interfaces.IData Data, SortedList Prevalues) 
		{
			_data = Data;
			_prevalues = Prevalues;
		}
		#region IDataEditor Members
		public override String Text 
		{
			get 
			{
				if (_data != null &amp;&amp; _data.Value != null)
					return _data.Value.ToString();
				else
					return &quot;&quot;;
				
			
			}
			set {_text = value;}
		}

		public bool ShowLabel
		{
			get
			{
				// TODO:  Add dictionaryPicker.ShowLabel getter implementation
				return true;
			}
		}

		public System.Web.UI.Control Editor
		{
			get
			{
				return this;
			}
		}

		public void Save()
		{
			_text = &quot;&quot;;
			foreach(ListItem li in base.Items) 
			{
				if (li.Selected) 
				{
					_text += li.Value + &quot;,&quot;;
				}
			}

			if (_text.Length &gt; 0)
				_text = _text.Substring(0, _text.Length-1);
			_data.Value = _text;
		}

		public bool TreatAsRichTextEditor
		{
			get
			{
				// TODO:  Add dictionaryPicker.TreatAsRichTextEditor getter implementation
				return false;
			}
		}

		protected override void OnInit(EventArgs e)
		{
			base.OnInit (e);

			if (_prevalues.Keys.Count &gt; 0) 
			{
				// Find associated domain
				int languageId = 0;
                cms.businesslogic.web.Domain[] domains = library.GetCurrentDomains(((umbraco.cms.businesslogic.datatype.DefaultData)_data).NodeId);
				if (domains != null) 
					if (domains.Length &gt; -1) 
						languageId = domains[0].Language.id;


				string key = _prevalues.GetByIndex(0).ToString();
				addDictionaries(&quot;&quot;, key, languageId);
			}
		}

		private void addDictionaries(string indent, string key, int language) 
		{
			cms.businesslogic.Dictionary.DictionaryItem di = new cms.businesslogic.Dictionary.DictionaryItem(key);

			foreach(cms.businesslogic.Dictionary.DictionaryItem item in di.Children) 
			{
				ListItem li;
				if (language != 0)
					li = new ListItem(indent + &quot; &quot; + item.Value(language), item.key);
				else
					li = new ListItem(indent + &quot; &quot; + item.Value(), item.key);

				if ((&quot;,&quot;+Text+&quot;,&quot;).IndexOf(&quot;,&quot;+li.Value.ToString()+&quot;,&quot;) &gt; -1 &amp;&amp; !Page.IsPostBack)
					li.Selected = true;
				this.Items.Add(li);
				addDictionaries(indent + &quot;--&quot;, item.key, language);
			}
		}


		#endregion
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[17,3,17,71,0],[18,3,18,4,0],[19,4,19,17,0],[20,4,20,27,0],[21,3,21,4,0],[26,4,26,5,0],[27,5,27,46,0],[28,6,28,36,0],[30,6,30,16,0],[33,4,33,5,0],[34,8,34,9,0],[34,9,34,23,0],[34,23,34,24,0],[40,4,40,5,0],[42,5,42,17,0],[43,4,43,5,0],[49,4,49,5,0],[50,5,50,17,0],[51,4,51,5,0],[55,3,55,4,0],[56,4,56,15,0],[57,4,57,11,0],[57,12,57,23,0],[57,24,57,26,0],[57,27,57,37,0],[58,4,58,5,0],[59,5,59,21,0],[60,5,60,6,0],[61,6,61,30,0],[62,5,62,6,0],[63,4,63,5,0],[65,4,65,25,0],[66,5,66,48,0],[67,4,67,24,0],[68,3,68,4,0],[73,4,73,5,0],[75,5,75,18,0],[76,4,76,5,0],[80,3,80,4,0],[81,4,81,20,0],[83,4,83,34,0],[84,4,84,5,0],[86,5,86,24,0],[87,17,87,148,0],[88,5,88,25,0],[89,6,89,30,0],[90,7,90,43,0],[93,5,93,54,0],[94,5,94,42,0],[95,4,95,5,0],[96,3,96,4,0],[99,3,99,4,0],[100,4,100,106,0],[102,4,102,11,0],[102,12,102,60,0],[102,61,102,63,0],[102,64,102,75,0],[103,4,103,5,0],[105,5,105,23,0],[106,6,106,71,0],[108,6,108,63,0],[110,5,110,86,0],[111,6,111,25,0],[112,5,112,24,0],[113,5,113,56,0],[114,4,114,5,0],[115,3,115,4,0]]);
    </script>
  </body>
</html>