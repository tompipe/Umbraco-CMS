<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\HttpUrlHelperExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using System.Linq.Expressions;
using System.Web.Http.Routing;
using Umbraco.Core;
using Umbraco.Web.Mvc;
using Umbraco.Web.WebApi;

namespace Umbraco.Web
{
    public static class HttpUrlHelperExtensions
    {
        /// &lt;summary&gt;
        /// Return the Url for a Web Api service
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;actionName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string GetUmbracoApiService&lt;T&gt;(this UrlHelper url, string actionName, object id = null)
            where T : UmbracoApiController
        {
            return url.GetUmbracoApiService(actionName, typeof(T), id);
        }

        public static string GetUmbracoApiService&lt;T&gt;(this UrlHelper url, Expression&lt;Func&lt;T, object&gt;&gt; methodSelector)
            where T : UmbracoApiController
        {
            var method = ExpressionHelper.GetMethodInfo(methodSelector);
            var methodParams = ExpressionHelper.GetMethodParams(methodSelector);
            if (method == null)
            {
                throw new MissingMethodException(&quot;Could not find the method &quot; + methodSelector + &quot; on type &quot; + typeof(T) + &quot; or the result &quot;);
            }

            if (methodParams.Any() == false)
            {
                return url.GetUmbracoApiService&lt;T&gt;(method.Name);    
            }
            return url.GetUmbracoApiService&lt;T&gt;(method.Name, methodParams.Values.First());
        }

        /// &lt;summary&gt;
        /// Return the Url for a Web Api service
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;actionName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;apiControllerType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string GetUmbracoApiService(this UrlHelper url, string actionName, Type apiControllerType, object id = null)
        {
            Mandate.ParameterNotNullOrEmpty(actionName, &quot;actionName&quot;);
            Mandate.ParameterNotNull(apiControllerType, &quot;apiControllerType&quot;);

            var area = &quot;&quot;;

            var apiController = UmbracoApiControllerResolver.Current.RegisteredUmbracoApiControllers
                .SingleOrDefault(x =&gt; x == apiControllerType);
            if (apiController == null)
                throw new InvalidOperationException(&quot;Could not find the umbraco api controller of type &quot; + apiControllerType.FullName);
            var metaData = PluginController.GetMetadata(apiController);
            if (metaData.AreaName.IsNullOrWhiteSpace() == false)
            {
                //set the area to the plugin area
                area = metaData.AreaName;
            }
            return url.GetUmbracoApiService(actionName, ControllerExtensions.GetControllerName(apiControllerType), area, id);
        }

        /// &lt;summary&gt;
        /// Return the Url for a Web Api service
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;actionName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;controllerName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string GetUmbracoApiService(this UrlHelper url, string actionName, string controllerName, object id = null)
        {
            return url.GetUmbracoApiService(actionName, controllerName, &quot;&quot;, id);
        }

        /// &lt;summary&gt;
        /// Return the Url for a Web Api service
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;actionName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;controllerName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;area&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string GetUmbracoApiService(this UrlHelper url, string actionName, string controllerName, string area, object id = null)
        {
            Mandate.ParameterNotNullOrEmpty(controllerName, &quot;controllerName&quot;);
            Mandate.ParameterNotNullOrEmpty(actionName, &quot;actionName&quot;);

            string routeName;
            if (area.IsNullOrWhiteSpace())
            {
                routeName = string.Format(&quot;umbraco-{0}-{1}&quot;, &quot;api&quot;, controllerName);
                if (id == null)
                {
                    return url.Route(routeName, new { controller = controllerName, action = actionName, httproute = &quot;&quot; });
                }
                else
                {
                    return url.Route(routeName, new { controller = controllerName, action = actionName, id = id, httproute = &quot;&quot; });
                }
            }
            else
            {
                routeName = string.Format(&quot;umbraco-{0}-{1}-{2}&quot;, &quot;api&quot;, area, controllerName);
                if (id == null)
                {
                    return url.Route(routeName, new { controller = controllerName, action = actionName, httproute = &quot;&quot; });
                }
                else
                {
                    return url.Route(routeName, new { controller = controllerName, action = actionName, id = id, httproute = &quot;&quot; });
                }
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,0],[24,13,24,72,0],[25,9,25,10,0],[29,9,29,10,0],[30,13,30,73,0],[31,13,31,81,0],[32,13,32,32,0],[33,13,33,14,0],[34,17,34,143,0],[37,13,37,45,0],[38,13,38,14,0],[39,17,39,65,0],[41,13,41,90,0],[42,9,42,10,0],[53,9,53,10,0],[54,13,54,71,0],[55,13,55,78,0],[57,13,57,27,0],[59,13,60,39,0],[60,39,60,61,0],[60,61,60,63,0],[59,13,60,63,0],[61,13,61,39,0],[62,17,62,136,0],[63,13,63,72,0],[64,13,64,65,0],[65,13,65,14,0],[67,17,67,42,0],[68,13,68,14,0],[69,13,69,126,0],[70,9,70,10,0],[81,9,81,10,0],[82,13,82,81,0],[83,9,83,10,0],[95,9,95,10,0],[96,13,96,79,0],[97,13,97,71,0],[100,13,100,43,0],[101,13,101,14,0],[102,17,102,85,0],[103,17,103,32,0],[104,17,104,18,0],[105,21,105,123,0],[108,17,108,18,0],[109,21,109,132,0],[113,13,113,14,0],[114,17,114,95,0],[115,17,115,32,0],[116,17,116,18,0],[117,21,117,123,0],[120,17,120,18,0],[121,21,121,132,0],[124,9,124,10,0]]);
    </script>
  </body>
</html>