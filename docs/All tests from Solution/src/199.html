<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Collections\DeepCloneableListTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using NUnit.Framework;
using Umbraco.Core.Collections;
using Umbraco.Core.Models;

namespace Umbraco.Tests.Collections
{
    [TestFixture]
    public class DeepCloneableListTests
    {
        [Test]
        public void Deep_Clones_Each_Item_Once()
        {
            var list = new DeepCloneableList&lt;TestClone&gt;(ListCloneBehavior.CloneOnce);
            list.Add(new TestClone());
            list.Add(new TestClone());
            list.Add(new TestClone());

            var cloned = list.DeepClone() as DeepCloneableList&lt;TestClone&gt;;

            //Test that each item in the sequence is equal - based on the equality comparer of TestClone (i.e. it&#39;s ID)
            Assert.IsTrue(list.SequenceEqual(cloned));

            //Test that each instance in the list is not the same one
            foreach (var item in list)
            {
                var clone = cloned.Single(x =&gt; x.Id == item.Id);
                Assert.AreNotSame(item, clone);
            }

            //clone again from the clone - since it&#39;s clone once the items should be the same
            var cloned2 = cloned.DeepClone() as DeepCloneableList&lt;TestClone&gt;;

            //Test that each item in the sequence is equal - based on the equality comparer of TestClone (i.e. it&#39;s ID)
            Assert.IsTrue(cloned.SequenceEqual(cloned2));

            //Test that each instance in the list is the same one
            foreach (var item in cloned)
            {
                var clone = cloned2.Single(x =&gt; x.Id == item.Id);
                Assert.AreSame(item, clone);
            }
        }

        [Test]
        public void Deep_Clones_All_Elements()
        {
            var list = new DeepCloneableList&lt;TestClone&gt;(ListCloneBehavior.Always);
            list.Add(new TestClone());
            list.Add(new TestClone());
            list.Add(new TestClone());

            var cloned = list.DeepClone() as DeepCloneableList&lt;TestClone&gt;;

            Assert.IsNotNull(cloned);
            Assert.AreNotSame(list, cloned);
            Assert.AreEqual(list.Count, cloned.Count);
        }

        [Test]
        public void Clones_Each_Item()
        {
            var list = new DeepCloneableList&lt;TestClone&gt;(ListCloneBehavior.Always);
            list.Add(new TestClone());
            list.Add(new TestClone());
            list.Add(new TestClone());

            var cloned = (DeepCloneableList&lt;TestClone&gt;) list.DeepClone();

            foreach (var item in cloned)
            {
                Assert.IsTrue(item.IsClone);
            }
        }

        [Test]
        public void Cloned_Sequence_Equals()
        {
            var list = new DeepCloneableList&lt;TestClone&gt;(ListCloneBehavior.Always);
            list.Add(new TestClone());
            list.Add(new TestClone());
            list.Add(new TestClone());

            var cloned = (DeepCloneableList&lt;TestClone&gt;)list.DeepClone();

            //Test that each item in the sequence is equal - based on the equality comparer of TestClone (i.e. it&#39;s ID)
            Assert.IsTrue(list.SequenceEqual(cloned));

            //Test that each instance in the list is not the same one
            foreach (var item in list)
            {
                var clone = cloned.Single(x =&gt; x.Id == item.Id);
                Assert.AreNotSame(item, clone);
            }
        }

        public class TestClone : IDeepCloneable, IEquatable&lt;TestClone&gt;
        {
            public TestClone(Guid id)
            {
                Id = id;
                IsClone = true;
            }

            public TestClone()
            {
                Id = Guid.NewGuid();
            }

            public Guid Id { get; private set; }
            public bool IsClone { get; private set; }

            public object DeepClone()
            {
                return new TestClone(Id);
            }

            /// &lt;summary&gt;
            /// Indicates whether the current object is equal to another object of the same type.
            /// &lt;/summary&gt;
            /// &lt;returns&gt;
            /// true if the current object is equal to the &lt;paramref name=&quot;other&quot;/&gt; parameter; otherwise, false.
            /// &lt;/returns&gt;
            /// &lt;param name=&quot;other&quot;&gt;An object to compare with this object.&lt;/param&gt;
            public bool Equals(TestClone other)
            {
                if (ReferenceEquals(null, other)) return false;
                if (ReferenceEquals(this, other)) return true;
                return Id.Equals(other.Id);
            }

            /// &lt;summary&gt;
            /// Determines whether the specified object is equal to the current object.
            /// &lt;/summary&gt;
            /// &lt;returns&gt;
            /// true if the specified object  is equal to the current object; otherwise, false.
            /// &lt;/returns&gt;
            /// &lt;param name=&quot;obj&quot;&gt;The object to compare with the current object. &lt;/param&gt;
            public override bool Equals(object obj)
            {
                if (ReferenceEquals(null, obj)) return false;
                if (ReferenceEquals(this, obj)) return true;
                if (obj.GetType() != this.GetType()) return false;
                return Equals((TestClone)obj);
            }

            /// &lt;summary&gt;
            /// Serves as the default hash function. 
            /// &lt;/summary&gt;
            /// &lt;returns&gt;
            /// A hash code for the current object.
            /// &lt;/returns&gt;
            public override int GetHashCode()
            {
                return Id.GetHashCode();
            }

            public static bool operator ==(TestClone left, TestClone right)
            {
                return Equals(left, right);
            }

            public static bool operator !=(TestClone left, TestClone right)
            {
                return Equals(left, right) == false;
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[18,13,18,86,1],[19,13,19,39,1],[20,13,20,39,1],[21,13,21,39,1],[23,13,23,75,1],[26,13,26,55,1],[29,13,29,20,1],[29,22,29,30,1],[29,31,29,33,1],[29,34,29,38,1],[30,13,30,14,1],[31,17,31,48,1],[31,48,31,63,1],[31,63,31,65,1],[31,17,31,65,1],[32,17,32,48,1],[33,13,33,14,1],[36,13,36,78,1],[39,13,39,58,1],[42,13,42,20,1],[42,22,42,30,1],[42,31,42,33,1],[42,34,42,40,1],[43,13,43,14,1],[44,17,44,49,1],[44,49,44,64,1],[44,64,44,66,1],[44,17,44,66,1],[45,17,45,45,1],[46,13,46,14,1],[47,9,47,10,1],[51,9,51,10,1],[52,13,52,83,1],[53,13,53,39,1],[54,13,54,39,1],[55,13,55,39,1],[57,13,57,75,1],[59,13,59,38,1],[60,13,60,45,1],[61,13,61,55,1],[62,9,62,10,1],[66,9,66,10,1],[67,13,67,83,1],[68,13,68,39,1],[69,13,69,39,1],[70,13,70,39,1],[72,13,72,74,1],[74,13,74,20,1],[74,22,74,30,1],[74,31,74,33,1],[74,34,74,40,1],[75,13,75,14,1],[76,17,76,45,1],[77,13,77,14,1],[78,9,78,10,1],[82,9,82,10,1],[83,13,83,83,1],[84,13,84,39,1],[85,13,85,39,1],[86,13,86,39,1],[88,13,88,73,1],[91,13,91,55,1],[94,13,94,20,1],[94,22,94,30,1],[94,31,94,33,1],[94,34,94,38,1],[95,13,95,14,1],[96,17,96,48,1],[96,48,96,63,1],[96,63,96,65,1],[96,17,96,65,1],[97,17,97,48,1],[98,13,98,14,1],[99,9,99,10,1],[103,13,103,38,1],[104,13,104,14,1],[105,17,105,25,1],[106,17,106,32,1],[107,13,107,14,1],[109,13,109,31,1],[110,13,110,14,1],[111,17,111,37,1],[112,13,112,14,1],[114,30,114,34,1],[114,35,114,47,1],[115,35,115,39,1],[115,40,115,52,1],[118,13,118,14,1],[119,17,119,42,1],[120,13,120,14,1],[130,13,130,14,1],[131,17,131,50,1],[131,51,131,64,0],[132,17,132,50,1],[132,51,132,63,1],[133,17,133,44,1],[134,13,134,14,1],[144,13,144,14,0],[145,17,145,48,0],[145,49,145,62,0],[146,17,146,48,0],[146,49,146,61,0],[147,17,147,53,0],[147,54,147,67,0],[148,17,148,47,0],[149,13,149,14,0],[158,13,158,14,0],[159,17,159,41,0],[160,13,160,14,0],[163,13,163,14,0],[164,17,164,44,0],[165,13,165,14,0],[168,13,168,14,0],[169,17,169,53,0],[170,13,170,14,0]]);
    </script>
  </body>
</html>