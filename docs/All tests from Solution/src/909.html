<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Security\Providers\MembersRoleProvider.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Specialized;
using System.Configuration.Provider;
using System.Linq;
using System.Web.Security;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Core.Persistence.Querying;
using Umbraco.Core.Services;

namespace Umbraco.Web.Security.Providers
{
    public class MembersRoleProvider : RoleProvider
    {
        private readonly IMembershipRoleService&lt;IMember&gt; _roleService;

        public MembersRoleProvider(IMembershipRoleService&lt;IMember&gt; roleService)
        {
            _roleService = roleService;
        }

        public MembersRoleProvider()
            : this(ApplicationContext.Current.Services.MemberService)
        {            
        }

        private string _applicationName;
        
        public override bool IsUserInRole(string username, string roleName)
        {
            return GetRolesForUser(username).Any(x =&gt; x == roleName);
        }

        public override string[] GetRolesForUser(string username)
        {
            return _roleService.GetAllRoles(username).ToArray();
        }

        public override void CreateRole(string roleName)
        {
            _roleService.AddRole(roleName);
        }

        public override bool DeleteRole(string roleName, bool throwOnPopulatedRole)
        {
            return _roleService.DeleteRole(roleName, throwOnPopulatedRole);
        }

        public override bool RoleExists(string roleName)
        {
            return _roleService.GetAllRoles().Any(x =&gt; x == roleName);
        }

        public override void AddUsersToRoles(string[] usernames, string[] roleNames)
        {
            _roleService.AssignRoles(usernames, roleNames);
        }

        public override void RemoveUsersFromRoles(string[] usernames, string[] roleNames)
        {
            _roleService.DissociateRoles(usernames, roleNames);
        }

        public override string[] GetUsersInRole(string roleName)
        {
            return _roleService.GetMembersInRole(roleName).Select(x =&gt; x.Username).ToArray();
        }

        public override string[] GetAllRoles()
        {
            return _roleService.GetAllRoles().ToArray();
        }

        public override string[] FindUsersInRole(string roleName, string usernameToMatch)
        {
            return _roleService.FindMembersInRole(roleName, usernameToMatch, StringPropertyMatchType.Wildcard).Select(x =&gt; x.Username).ToArray();
        }

        /// &lt;summary&gt;
        /// The name of the application using the custom role provider.
        /// &lt;/summary&gt;
        /// &lt;value&gt;&lt;/value&gt;
        /// &lt;returns&gt;The name of the application using the custom membership provider.&lt;/returns&gt;
        public override string ApplicationName
        {
            get
            {
                return _applicationName;
            }
            set
            {
                if (string.IsNullOrEmpty(value))
                    throw new ProviderException(&quot;ApplicationName cannot be empty.&quot;);

                if (value.Length &gt; 0x100)
                    throw new ProviderException(&quot;Provider application name too long.&quot;);

                _applicationName = value;
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,80,0],[17,9,17,10,0],[18,13,18,40,0],[19,9,19,10,0],[22,15,22,70,0],[23,9,23,10,0],[24,9,24,10,0],[29,9,29,10,0],[30,13,30,55,0],[30,55,30,68,0],[30,68,30,70,0],[30,13,30,70,0],[31,9,31,10,0],[34,9,34,10,0],[35,13,35,65,0],[36,9,36,10,0],[39,9,39,10,0],[40,13,40,44,0],[41,9,41,10,0],[44,9,44,10,0],[45,13,45,76,0],[46,9,46,10,0],[49,9,49,10,0],[50,13,50,56,0],[50,56,50,69,0],[50,69,50,71,0],[50,13,50,71,0],[51,9,51,10,0],[54,9,54,10,0],[55,13,55,60,0],[56,9,56,10,0],[59,9,59,10,0],[60,13,60,64,0],[61,9,61,10,0],[64,9,64,10,0],[65,13,65,72,0],[65,72,65,82,0],[65,82,65,94,0],[65,13,65,94,0],[66,9,66,10,0],[69,9,69,10,0],[70,13,70,57,0],[71,9,71,10,0],[74,9,74,10,0],[75,13,75,124,0],[75,124,75,134,0],[75,134,75,146,0],[75,13,75,146,0],[76,9,76,10,0],[86,13,86,14,0],[87,17,87,41,0],[88,13,88,14,0],[90,13,90,14,0],[91,17,91,49,0],[92,21,92,85,0],[94,17,94,42,0],[95,21,95,88,0],[97,17,97,42,0],[98,13,98,14,0]]);
    </script>
  </body>
</html>