<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.datalayer\SqlHelpers\MySql\MySqlHelper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
/************************************************************************************
 * 
 *  Umbraco Data Layer
 *  MIT Licensed work
 *  ï¿½2008 Ruben Verborgh
 * 
 ***********************************************************************************/

using System;
using System.Data;
using System.Data.SqlClient;
using System.Xml;
using MSC = MySql.Data.MySqlClient;

namespace umbraco.DataLayer.SqlHelpers.MySql
{
    /// &lt;summary&gt;
    /// Sql Helper for a MySQL 5.0 database.
    /// &lt;/summary&gt;
    public class MySqlHelper : SqlHelper&lt;MSC.MySqlParameter&gt;
    {
        /// &lt;summary&gt;SQL parser that replaces the SQL-Server specific tokens by their MySQL equivalent.&lt;/summary&gt;
        private MySqlParser m_SqlParser = new MySqlParser();

        /// &lt;summary&gt;Initializes a new instance of the &lt;see cref=&quot;MySqlHelper&quot;/&gt; class.&lt;/summary&gt;
        /// &lt;param name=&quot;connectionString&quot;&gt;The connection string.&lt;/param&gt;
        public MySqlHelper(string connectionString)
            : base(connectionString)
        {
            m_Utility = new MySqlUtility(this);
        }

        /// &lt;summary&gt;
        /// Creates a new parameter for use with this specific implementation of ISqlHelper.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;parameterName&quot;&gt;Name of the parameter.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;Value of the parameter.&lt;/param&gt;
        /// &lt;returns&gt;A new parameter of the correct type.&lt;/returns&gt;
        /// &lt;remarks&gt;Abstract factory pattern&lt;/remarks&gt;
        public override IParameter CreateParameter(string parameterName, object value)
        {
            return new MySqlParameter(parameterName, value);
        }

        /// &lt;summary&gt;Converts a the command before executing.&lt;/summary&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;returns&gt;The original command text.&lt;/returns&gt;
        protected override string ConvertCommand(string commandText)
        {
            return m_SqlParser.Parse(commandText);
        }

        /// &lt;summary&gt;Executes a command that returns a single value.&lt;/summary&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;param name=&quot;parameters&quot;&gt;The parameters.&lt;/param&gt;
        /// &lt;returns&gt;The return value of the command.&lt;/returns&gt;
        protected override object ExecuteScalar(string commandText, MSC.MySqlParameter[] parameters)
        {
            return MSC.MySqlHelper.ExecuteScalar(ConnectionString, commandText, parameters);
        }

        /// &lt;summary&gt;Executes a command and returns the number of rows affected.&lt;/summary&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;param name=&quot;parameters&quot;&gt;The parameters.&lt;/param&gt;
        /// &lt;returns&gt;
        /// The number of rows affected by the command.
        /// &lt;/returns&gt;
        protected override int ExecuteNonQuery(string commandText, MSC.MySqlParameter[] parameters)
        {
            return MSC.MySqlHelper.ExecuteNonQuery(ConnectionString, commandText, parameters);
        }

        /// &lt;summary&gt;Executes a command and returns a records reader containing the results.&lt;/summary&gt;
        /// &lt;param name=&quot;commandText&quot;&gt;The command text.&lt;/param&gt;
        /// &lt;param name=&quot;parameters&quot;&gt;The parameters.&lt;/param&gt;
        /// &lt;returns&gt;
        /// A data reader containing the results of the command.
        /// &lt;/returns&gt;
        protected override IRecordsReader ExecuteReader(string commandText, MSC.MySqlParameter[] parameters)
        {
            return new MySqlDataReader(MSC.MySqlHelper.ExecuteReader(ConnectionString, commandText, parameters));
        }

        /// &lt;summary&gt;Converts the scalar value to the given type.&lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;Desired type of the value.&lt;/typeparam&gt;
        /// &lt;param name=&quot;scalar&quot;&gt;A scalar returned by ExecuteScalar.&lt;/param&gt;
        /// &lt;returns&gt;The scalar, converted to type T.&lt;/returns&gt;
        protected override T ConvertScalar&lt;T&gt;(object scalar)
        {
            if (scalar == null)
                return default(T);

            switch (typeof(T).FullName)
            {
                case &quot;System.Boolean&quot;: return (T)(object)((1).Equals(scalar));
                case &quot;System.Guid&quot;: return (T)(object)(Guid.Parse(scalar.ToString()));
                default: return base.ConvertScalar&lt;T&gt;(scalar);
            }
        }

		/// &lt;summary&gt;
		/// Creates a concatenation fragment for use in an SQL query.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;values&quot;&gt;The values that need to be concatenated&lt;/param&gt;
		/// &lt;returns&gt;The SQL query fragment.&lt;/returns&gt;
		/// &lt;remarks&gt;SQL Server uses a+b, MySql uses concat(a,b), Oracle uses a||b...&lt;/remarks&gt;
		public override string Concat(params string[] values)
		{
			// mysql has a concat function
			return &quot;concat(&quot; + string.Join(&quot;,&quot;, values) + &quot;)&quot;;
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,61,0],[28,15,28,37,0],[29,9,29,10,0],[30,13,30,48,0],[31,9,31,10,0],[41,9,41,10,0],[42,13,42,61,0],[43,9,43,10,0],[49,9,49,10,0],[50,13,50,51,0],[51,9,51,10,0],[58,9,58,10,0],[59,13,59,93,0],[60,9,60,10,0],[69,9,69,10,0],[70,13,70,95,0],[71,9,71,10,0],[80,9,80,10,0],[81,13,81,114,0],[82,9,82,10,0],[89,9,89,10,0],[90,13,90,32,0],[91,17,91,35,0],[93,13,93,40,0],[95,40,95,79,0],[96,37,96,87,0],[97,26,97,63,0],[99,9,99,10,0],[108,3,108,4,0],[110,4,110,54,0],[111,3,111,4,0]]);
    </script>
  </body>
</html>