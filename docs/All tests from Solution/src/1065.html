<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Mvc\UmbracoControllerFactory.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.Mvc;
using System.Web.Routing;
using System.Web.SessionState;
using Umbraco.Core;

namespace Umbraco.Web.Mvc
{
    /// &lt;summary&gt;
    /// Abstract filtered controller factory used for all Umbraco controller factory implementations
    /// &lt;/summary&gt;
    public abstract class UmbracoControllerFactory : IFilteredControllerFactory
    {
        private readonly OverridenDefaultControllerFactory _innerFactory = new OverridenDefaultControllerFactory();

        public abstract bool CanHandle(RequestContext request);
        
        public virtual Type GetControllerType(RequestContext requestContext, string controllerName)
        {
            return _innerFactory.GetControllerType(requestContext, controllerName);
        }

        /// &lt;summary&gt;
        /// Creates the specified controller by using the specified request context.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// The controller.
        /// &lt;/returns&gt;
        /// &lt;param name=&quot;requestContext&quot;&gt;The request context.&lt;/param&gt;&lt;param name=&quot;controllerName&quot;&gt;The name of the controller.&lt;/param&gt;
        public virtual IController CreateController(RequestContext requestContext, string controllerName)
        {
            var controllerType = GetControllerType(requestContext, controllerName) ??
                                 _innerFactory.GetControllerType(
                                     requestContext,
                                     ControllerExtensions.GetControllerName(
                                         DefaultRenderMvcControllerResolver.Current.GetDefaultControllerType()));

            return _innerFactory.GetControllerInstance(requestContext, controllerType);
        }

        /// &lt;summary&gt;
        /// Gets the controller&#39;s session behavior.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;
        /// The controller&#39;s session behavior.
        /// &lt;/returns&gt;
        /// &lt;param name=&quot;requestContext&quot;&gt;The request context.&lt;/param&gt;&lt;param name=&quot;controllerName&quot;&gt;The name of the controller whose session behavior you want to get.&lt;/param&gt;
        public SessionStateBehavior GetControllerSessionBehavior(RequestContext requestContext, string controllerName)
        {
            return ((IControllerFactory)_innerFactory).GetControllerSessionBehavior(requestContext, controllerName);
        }

        /// &lt;summary&gt;
        /// Releases the specified controller.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;controller&quot;&gt;The controller.&lt;/param&gt;
        public virtual void ReleaseController(IController controller)
        {
            _innerFactory.ReleaseController(controller);
        }

        /// &lt;summary&gt;
        /// By default, &lt;see cref=&quot;DefaultControllerFactory&quot;/&gt; only exposes &lt;see cref=&quot;IControllerFactory.CreateController&quot;/&gt; which throws an exception
        /// if the controller is not found. Since we want to try creating a controller, and then fall back to &lt;see cref=&quot;RenderMvcController&quot;/&gt; if one isn&#39;t found,
        /// this nested class changes the visibility of &lt;see cref=&quot;DefaultControllerFactory&quot;/&gt;&#39;s internal methods in order to not have to rely on a try-catch.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;&lt;/remarks&gt;
        internal class OverridenDefaultControllerFactory : DefaultControllerFactory
        {
            public new IController GetControllerInstance(RequestContext requestContext, Type controllerType)
            {
                return base.GetControllerInstance(requestContext, controllerType);
            }

            public new Type GetControllerType(RequestContext requestContext, string controllerName)
            {
                if (controllerName.IsNullOrWhiteSpace())
                {
                    return null;
                }
                return base.GetControllerType(requestContext, controllerName);
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,116,0],[19,9,19,10,0],[20,13,20,84,0],[21,9,21,10,0],[31,9,31,10,0],[32,13,36,114,0],[38,13,38,88,0],[39,9,39,10,0],[49,9,49,10,0],[50,13,50,117,0],[51,9,51,10,0],[58,9,58,10,0],[59,13,59,57,0],[60,9,60,10,0],[71,13,71,14,0],[72,17,72,83,0],[73,13,73,14,0],[76,13,76,14,0],[77,17,77,57,0],[78,17,78,18,0],[79,21,79,33,0],[81,17,81,79,0],[82,13,82,14,0]]);
    </script>
  </body>
</html>