<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Services\LocalizedTextServiceTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml.Linq;
using Moq;
using NUnit.Framework;
using Umbraco.Core.Logging;
using Umbraco.Core.Services;

namespace Umbraco.Tests.Services
{
    [TestFixture]
    public class LocalizedTextServiceTests
    {
        [Test]
        public void Using_Dictionary_Gets_All_Stored_Values()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, IDictionary&lt;string, IDictionary&lt;string, string&gt;&gt;&gt;
                {
                    {
                        culture, new Dictionary&lt;string, IDictionary&lt;string, string&gt;&gt;
                        {
                            {
                                &quot;testArea1&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;testKey1&quot;, &quot;testValue1&quot;},
                                    {&quot;testKey2&quot;, &quot;testValue2&quot;}
                                }
                            },
                            {
                                &quot;testArea2&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;blah1&quot;, &quot;blahValue1&quot;},
                                    {&quot;blah2&quot;, &quot;blahValue2&quot;}
                                }
                            },
                        }
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.GetAllStoredValues(culture);

            Assert.AreEqual(4, result.Count());
            Assert.AreEqual(&quot;testArea1/testKey1&quot;, result.ElementAt(0).Key);
            Assert.AreEqual(&quot;testArea1/testKey2&quot;, result.ElementAt(1).Key);
            Assert.AreEqual(&quot;testArea2/blah1&quot;, result.ElementAt(2).Key);
            Assert.AreEqual(&quot;testArea2/blah2&quot;, result.ElementAt(3).Key);
            Assert.AreEqual(&quot;testValue1&quot;, result[&quot;testArea1/testKey1&quot;]);
            Assert.AreEqual(&quot;testValue2&quot;, result[&quot;testArea1/testKey2&quot;]);
            Assert.AreEqual(&quot;blahValue1&quot;, result[&quot;testArea2/blah1&quot;]);
            Assert.AreEqual(&quot;blahValue2&quot;, result[&quot;testArea2/blah2&quot;]);

        }

        [Test]
        public void Using_XDocument_Gets_All_Stored_Values()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;language&quot;,
                                new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea1&quot;),
                                    new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey1&quot;), &quot;testValue1&quot;),
                                    new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey2&quot;), &quot;testValue2&quot;)),
                                new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea2&quot;),
                                    new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;blah1&quot;), &quot;blahValue1&quot;),
                                    new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;blah2&quot;), &quot;blahValue2&quot;)))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.GetAllStoredValues(culture);

            Assert.AreEqual(4, result.Count());
            Assert.AreEqual(&quot;testArea1/testKey1&quot;, result.ElementAt(0).Key);
            Assert.AreEqual(&quot;testArea1/testKey2&quot;, result.ElementAt(1).Key);
            Assert.AreEqual(&quot;testArea2/blah1&quot;, result.ElementAt(2).Key);
            Assert.AreEqual(&quot;testArea2/blah2&quot;, result.ElementAt(3).Key);
            Assert.AreEqual(&quot;testValue1&quot;, result[&quot;testArea1/testKey1&quot;]);
            Assert.AreEqual(&quot;testValue2&quot;, result[&quot;testArea1/testKey2&quot;]);
            Assert.AreEqual(&quot;blahValue1&quot;, result[&quot;testArea2/blah1&quot;]);
            Assert.AreEqual(&quot;blahValue2&quot;, result[&quot;testArea2/blah2&quot;]);

        }


        [Test]
        public void Using_XDocument_Gets_All_Stored_Values_With_Duplicates()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                  new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;language&quot;,
                                new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea1&quot;),
                                    new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey1&quot;), &quot;testValue1&quot;),
                                    new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey1&quot;), &quot;testValue1&quot;)))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.GetAllStoredValues(culture);

            Assert.AreEqual(1, result.Count());

        }

        [Test]
        public void Using_Dictionary_Returns_Text_With_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, IDictionary&lt;string, IDictionary&lt;string, string&gt;&gt;&gt;
                {
                    {
                        culture, new Dictionary&lt;string, IDictionary&lt;string, string&gt;&gt;
                        {
                            {
                                &quot;testArea&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;testKey&quot;, &quot;testValue&quot;}
                                }
                            }
                        }
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testArea/testKey&quot;, culture);

            Assert.AreEqual(&quot;testValue&quot;, result);
        }

        [Test]
        public void Using_Dictionary_Returns_Text_Without_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, IDictionary&lt;string, IDictionary&lt;string, string&gt;&gt;&gt;
                {
                    {
                        culture, new Dictionary&lt;string, IDictionary&lt;string, string&gt;&gt;
                        {
                            {
                                &quot;testArea&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;testKey&quot;, &quot;testValue&quot;}
                                }
                            }
                        }
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testKey&quot;, culture);

            Assert.AreEqual(&quot;testValue&quot;, result);
        }

        [Test]
        public void Using_Dictionary_Returns_Default_Text_When_Not_Found_With_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, IDictionary&lt;string, IDictionary&lt;string, string&gt;&gt;&gt;
                {
                    {
                        culture, new Dictionary&lt;string, IDictionary&lt;string, string&gt;&gt;
                        {
                            {
                                &quot;testArea&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;testKey&quot;, &quot;testValue&quot;}
                                }
                            }
                        }
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testArea/doNotFind&quot;, culture);

            //NOTE: Based on how legacy works, the default text does not contain the area, just the key
            Assert.AreEqual(&quot;[doNotFind]&quot;, result);
        }

        [Test]
        public void Using_Dictionary_Returns_Default_Text_When_Not_Found_Without_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, IDictionary&lt;string, IDictionary&lt;string, string&gt;&gt;&gt;
                {
                    {
                        culture, new Dictionary&lt;string, IDictionary&lt;string, string&gt;&gt;
                        {
                            {
                                &quot;testArea&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;testKey&quot;, &quot;testValue&quot;}
                                }
                            }
                        }
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;doNotFind&quot;, culture);

            Assert.AreEqual(&quot;[doNotFind]&quot;, result);
        }

        [Test]
        public void Using_Dictionary_Returns_Tokenized_Text()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, IDictionary&lt;string, IDictionary&lt;string, string&gt;&gt;&gt;
                {
                    {
                        culture, new Dictionary&lt;string, IDictionary&lt;string, string&gt;&gt;
                        {
                            {
                                &quot;testArea&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;testKey&quot;, &quot;Hello %0%, you are such a %1% %2%&quot;}
                                }
                            }
                        }
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testKey&quot;, culture,
                new Dictionary&lt;string, string&gt; { { &quot;0&quot;, &quot;world&quot; }, { &quot;1&quot;, &quot;great&quot; }, { &quot;2&quot;, &quot;planet&quot; } });

            Assert.AreEqual(&quot;Hello world, you are such a great planet&quot;, result);
        }

        [Test]
        public void Using_XDocument_Returns_Text_With_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea&quot;),
                                new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey&quot;), 
                                    &quot;testValue&quot;))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testArea/testKey&quot;, culture);

            Assert.AreEqual(&quot;testValue&quot;, result);
        }

        [Test]
        public void Using_XDocument_Returns_Text_Without_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea&quot;),
                                new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey&quot;), 
                                    &quot;testValue&quot;))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testKey&quot;, culture);

            Assert.AreEqual(&quot;testValue&quot;, result);
        }

        [Test]
        public void Using_XDocument_Returns_Default_Text_When_Not_Found_With_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea&quot;),
                                new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey&quot;), 
                                    &quot;testValue&quot;))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testArea/doNotFind&quot;, culture);

            //NOTE: Based on how legacy works, the default text does not contain the area, just the key
            Assert.AreEqual(&quot;[doNotFind]&quot;, result);
        }

        [Test]
        public void Using_XDocument_Returns_Default_Text_When_Not_Found_Without_Area()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea&quot;),
                                new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey&quot;), 
                                    &quot;testValue&quot;))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;doNotFind&quot;, culture);

            Assert.AreEqual(&quot;[doNotFind]&quot;, result);
        }

        [Test]
        public void Using_XDocument_Returns_Tokenized_Text()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea&quot;),
                                new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey&quot;), 
                                    &quot;Hello %0%, you are such a %1% %2%&quot;))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            var result = txtService.Localize(&quot;testKey&quot;, culture,
                new Dictionary&lt;string, string&gt; { { &quot;0&quot;, &quot;world&quot; }, { &quot;1&quot;, &quot;great&quot; }, { &quot;2&quot;, &quot;planet&quot; } });

            Assert.AreEqual(&quot;Hello world, you are such a great planet&quot;, result);
        }

        [Test]
        public void Using_Dictionary_Returns_Default_Text__When_No_Culture_Found()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, IDictionary&lt;string, IDictionary&lt;string, string&gt;&gt;&gt;
                {
                    {
                        culture, new Dictionary&lt;string, IDictionary&lt;string, string&gt;&gt;
                        {
                            {
                                &quot;testArea&quot;, new Dictionary&lt;string, string&gt;
                                {
                                    {&quot;testKey&quot;, &quot;testValue&quot;}
                                }
                            }
                        }
                    }
                }, Mock.Of&lt;ILogger&gt;());

            Assert.AreEqual(&quot;[testKey]&quot;, txtService.Localize(&quot;testArea/testKey&quot;, CultureInfo.GetCultureInfo(&quot;en-AU&quot;)));
        }

        [Test]
        public void Using_XDocument_Returns_Default_Text_When_No_Culture_Found()
        {
            var culture = CultureInfo.GetCultureInfo(&quot;en-US&quot;);
            var txtService = new LocalizedTextService(
                new Dictionary&lt;CultureInfo, Lazy&lt;XDocument&gt;&gt;
                {
                    {
                        culture, new Lazy&lt;XDocument&gt;(() =&gt; new XDocument(
                            new XElement(&quot;area&quot;, new XAttribute(&quot;alias&quot;, &quot;testArea&quot;),
                                new XElement(&quot;key&quot;, new XAttribute(&quot;alias&quot;, &quot;testKey&quot;), 
                                    &quot;testValue&quot;))))
                    }
                }, Mock.Of&lt;ILogger&gt;());

            Assert.AreEqual(&quot;[testKey]&quot;, txtService.Localize(&quot;testArea/testKey&quot;, CultureInfo.GetCultureInfo(&quot;en-AU&quot;)));
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,10,1],[21,13,21,63,1],[22,13,44,40,1],[46,13,46,65,1],[48,13,48,48,1],[49,13,49,76,1],[50,13,50,76,1],[51,13,51,73,1],[52,13,52,73,1],[53,13,53,73,1],[54,13,54,73,1],[55,13,55,70,1],[56,13,56,70,1],[58,9,58,10,1],[62,9,62,10,1],[63,13,63,63,1],[64,13,67,60,1],[67,60,74,107,1],[74,107,76,40,1],[64,13,76,40,1],[78,13,78,65,1],[80,13,80,48,1],[81,13,81,76,1],[82,13,82,76,1],[83,13,83,73,1],[84,13,84,73,1],[85,13,85,73,1],[86,13,86,73,1],[87,13,87,70,1],[88,13,88,70,1],[90,9,90,10,1],[95,9,95,10,1],[96,13,96,63,1],[97,13,101,60,1],[101,60,105,110,1],[105,110,107,40,1],[97,13,107,40,1],[109,13,109,65,1],[111,13,111,48,1],[113,9,113,10,1],[117,9,117,10,1],[118,13,118,63,1],[119,13,133,40,1],[135,13,135,75,1],[137,13,137,50,1],[138,9,138,10,1],[142,9,142,10,1],[143,13,143,63,1],[144,13,158,40,1],[160,13,160,66,1],[162,13,162,50,1],[163,9,163,10,1],[167,9,167,10,1],[168,13,168,63,1],[169,13,183,40,1],[185,13,185,77,1],[188,13,188,52,1],[189,9,189,10,1],[193,9,193,10,1],[194,13,194,63,1],[195,13,209,40,1],[211,13,211,68,1],[213,13,213,52,1],[214,9,214,10,1],[218,9,218,10,1],[219,13,219,63,1],[220,13,234,40,1],[236,13,237,107,1],[239,13,239,81,1],[240,9,240,10,1],[244,9,244,10,1],[245,13,245,63,1],[246,13,250,60,1],[250,60,253,51,1],[253,51,255,40,1],[246,13,255,40,1],[257,13,257,75,1],[259,13,259,50,1],[260,9,260,10,1],[264,9,264,10,1],[265,13,265,63,1],[266,13,270,60,1],[270,60,273,51,1],[273,51,275,40,1],[266,13,275,40,1],[277,13,277,66,1],[279,13,279,50,1],[280,9,280,10,1],[284,9,284,10,1],[285,13,285,63,1],[286,13,290,60,1],[290,60,293,51,1],[293,51,295,40,1],[286,13,295,40,1],[297,13,297,77,1],[300,13,300,52,1],[301,9,301,10,1],[305,9,305,10,1],[306,13,306,63,1],[307,13,311,60,1],[311,60,314,51,1],[314,51,316,40,1],[307,13,316,40,1],[318,13,318,68,1],[320,13,320,52,1],[321,9,321,10,1],[325,9,325,10,1],[326,13,326,63,1],[327,13,331,60,1],[331,60,334,75,1],[334,75,336,40,1],[327,13,336,40,1],[338,13,339,107,1],[341,13,341,81,1],[342,9,342,10,1],[346,9,346,10,1],[347,13,347,63,1],[348,13,362,40,1],[364,13,364,120,1],[365,9,365,10,1],[369,9,369,10,1],[370,13,370,63,1],[371,13,375,60,1],[375,60,378,51,0],[378,51,380,40,1],[371,13,380,40,1],[382,13,382,120,1],[383,9,383,10,1]]);
    </script>
  </body>
</html>