<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Models\Mapping\EntityModelMapper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using AutoMapper;
using Examine;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Core.Models.Mapping;
using Umbraco.Core.Models.Membership;
using Umbraco.Web.Models.ContentEditing;
using UmbracoExamine;

namespace Umbraco.Web.Models.Mapping
{
    internal class EntityModelMapper : MapperConfiguration
    {
        public override void ConfigureMappings(IConfiguration config, ApplicationContext applicationContext)
        {
            config.CreateMap&lt;UmbracoEntity, EntityBasic&gt;()
                .ForMember(basic =&gt; basic.Icon, expression =&gt; expression.MapFrom(entity =&gt; entity.ContentTypeIcon))
                .ForMember(dto =&gt; dto.Trashed, expression =&gt; expression.Ignore())
                .ForMember(x =&gt; x.Alias, expression =&gt; expression.Ignore());

            config.CreateMap&lt;PropertyType, EntityBasic&gt;()
                .ForMember(basic =&gt; basic.Icon, expression =&gt; expression.UseValue(&quot;icon-box&quot;))
                .ForMember(basic =&gt; basic.Path, expression =&gt; expression.UseValue(&quot;&quot;))
                .ForMember(basic =&gt; basic.ParentId, expression =&gt; expression.UseValue(-1))
                .ForMember(dto =&gt; dto.Trashed, expression =&gt; expression.Ignore())
                .ForMember(x =&gt; x.AdditionalData, expression =&gt; expression.Ignore());

            config.CreateMap&lt;PropertyGroup, EntityBasic&gt;()
                .ForMember(basic =&gt; basic.Icon, expression =&gt; expression.UseValue(&quot;icon-tab&quot;))
                .ForMember(basic =&gt; basic.Path, expression =&gt; expression.UseValue(&quot;&quot;))
                .ForMember(basic =&gt; basic.ParentId, expression =&gt; expression.UseValue(-1))
                //in v6 the &#39;alias&#39; is it&#39;s lower cased name so we&#39;ll stick to that.
                .ForMember(basic =&gt; basic.Alias, expression =&gt; expression.MapFrom(group =&gt; group.Name.ToLowerInvariant()))
                .ForMember(dto =&gt; dto.Trashed, expression =&gt; expression.Ignore())
                .ForMember(x =&gt; x.AdditionalData, expression =&gt; expression.Ignore());

            config.CreateMap&lt;IUser, EntityBasic&gt;()
                .ForMember(basic =&gt; basic.Icon, expression =&gt; expression.UseValue(&quot;icon-user&quot;))
                .ForMember(basic =&gt; basic.Path, expression =&gt; expression.UseValue(&quot;&quot;))
                .ForMember(basic =&gt; basic.ParentId, expression =&gt; expression.UseValue(-1))
                .ForMember(basic =&gt; basic.Alias, expression =&gt; expression.MapFrom(user =&gt; user.Username))
                .ForMember(dto =&gt; dto.Trashed, expression =&gt; expression.Ignore())
                .ForMember(x =&gt; x.AdditionalData, expression =&gt; expression.Ignore());

            config.CreateMap&lt;ITemplate, EntityBasic&gt;()
               .ForMember(basic =&gt; basic.Icon, expression =&gt; expression.UseValue(&quot;icon-layout&quot;))
               .ForMember(basic =&gt; basic.Path, expression =&gt; expression.MapFrom(template =&gt; template.Path))
               .ForMember(basic =&gt; basic.ParentId, expression =&gt; expression.UseValue(-1))
               .ForMember(dto =&gt; dto.Trashed, expression =&gt; expression.Ignore())
               .ForMember(x =&gt; x.AdditionalData, expression =&gt; expression.Ignore());

            //config.CreateMap&lt;EntityBasic, ITemplate&gt;()
            //    .ConstructUsing(basic =&gt; new Template(basic.Name, basic.Alias)
            //    {
            //        Id = Convert.ToInt32(basic.Id),
            //        Key = basic.Key
            //    })
            //   .ForMember(t =&gt; t.Path, expression =&gt; expression.Ignore())
            //   .ForMember(t =&gt; t.Id, expression =&gt; expression.MapFrom(template =&gt; Convert.ToInt32(template.Id)))
            //   .ForMember(x =&gt; x.VirtualPath, expression =&gt; expression.Ignore())
            //   .ForMember(x =&gt; x.CreateDate, expression =&gt; expression.Ignore())
            //   .ForMember(x =&gt; x.UpdateDate, expression =&gt; expression.Ignore())
            //   .ForMember(x =&gt; x.Content, expression =&gt; expression.Ignore());

            config.CreateMap&lt;EntityBasic, ContentTypeSort&gt;()
                .ForMember(x =&gt; x.Id, expression =&gt; expression.MapFrom(entity =&gt; new Lazy&lt;int&gt;(() =&gt; Convert.ToInt32(entity.Id))))
                .ForMember(x =&gt; x.SortOrder, expression =&gt; expression.Ignore());

            config.CreateMap&lt;IContentTypeComposition, EntityBasic&gt;()
                .ForMember(basic =&gt; basic.Path, expression =&gt; expression.MapFrom(x =&gt; x.Path))
                .ForMember(basic =&gt; basic.ParentId, expression =&gt; expression.MapFrom(x =&gt; x.ParentId))
                .ForMember(dto =&gt; dto.Trashed, expression =&gt; expression.Ignore())
                .ForMember(x =&gt; x.AdditionalData, expression =&gt; expression.Ignore());

            config.CreateMap&lt;SearchResult, EntityBasic&gt;()
                //default to document icon
                  .ForMember(x =&gt; x.Icon, expression =&gt; expression.Ignore())
                  .ForMember(x =&gt; x.Id, expression =&gt; expression.MapFrom(result =&gt; result.Id))
                  .ForMember(x =&gt; x.Name, expression =&gt; expression.Ignore())
                  .ForMember(x =&gt; x.Key, expression =&gt; expression.Ignore())
                  .ForMember(x =&gt; x.ParentId, expression =&gt; expression.Ignore())
                  .ForMember(x =&gt; x.Alias, expression =&gt; expression.Ignore())
                  .ForMember(x =&gt; x.Path, expression =&gt; expression.Ignore())
                  .ForMember(dto =&gt; dto.Trashed, expression =&gt; expression.Ignore())
                  .ForMember(x =&gt; x.AdditionalData, expression =&gt; expression.Ignore())
                  .AfterMap((result, basic) =&gt;
                      {
                          //get the icon if there is one
                          basic.Icon = result.Fields.ContainsKey(UmbracoContentIndexer.IconFieldName) 
                              ? result.Fields[UmbracoContentIndexer.IconFieldName] 
                              : &quot;icon-document&quot;;

                          basic.Name = result.Fields.ContainsKey(&quot;nodeName&quot;) ? result.Fields[&quot;nodeName&quot;] : &quot;[no name]&quot;;
                          if (result.Fields.ContainsKey(&quot;__NodeKey&quot;))
                          {
                              Guid key;
                              if (Guid.TryParse(result.Fields[&quot;__NodeKey&quot;], out key))
                              {
                                  basic.Key = key;
                              }
                          }
                          if (result.Fields.ContainsKey(&quot;parentID&quot;))
                          {
                              int parentId;
                              if (int.TryParse(result.Fields[&quot;parentID&quot;], out parentId))
                              {
                                  basic.ParentId = parentId;
                              }
                              else
                              {
                                  basic.ParentId = -1;
                              }
                          }
                          basic.Path = result.Fields.ContainsKey(&quot;__Path&quot;) ? result.Fields[&quot;__Path&quot;] : &quot;&quot;;
                          
                          if (result.Fields.ContainsKey(UmbracoContentIndexer.NodeTypeAliasFieldName))
                          {
                              basic.AdditionalData.Add(&quot;contentType&quot;, result.Fields[UmbracoContentIndexer.NodeTypeAliasFieldName]);
                          }
                      });

            config.CreateMap&lt;ISearchResults, IEnumerable&lt;EntityBasic&gt;&gt;()
                  .ConvertUsing(results =&gt; results.Select(Mapper.Map&lt;EntityBasic&gt;).ToList());
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,10,1],[19,13,20,63,1],[20,63,20,115,1],[20,115,21,62,1],[21,62,21,81,1],[21,81,22,56,1],[22,56,22,75,1],[22,75,22,77,1],[19,13,22,77,1],[24,13,25,63,1],[25,63,25,94,1],[25,94,26,63,1],[26,63,26,86,1],[26,86,27,67,1],[27,67,27,90,1],[27,90,28,62,1],[28,62,28,81,1],[28,81,29,65,1],[29,65,29,84,1],[29,84,29,86,1],[24,13,29,86,1],[31,13,32,63,1],[32,63,32,94,1],[32,94,33,63,1],[33,63,33,86,1],[33,86,34,67,1],[34,67,34,90,1],[34,90,36,64,1],[36,64,36,122,1],[36,122,37,62,1],[37,62,37,81,1],[37,81,38,65,1],[38,65,38,84,1],[38,84,38,86,1],[31,13,38,86,1],[40,13,41,63,1],[41,63,41,95,1],[41,95,42,63,1],[42,63,42,86,1],[42,86,43,67,1],[43,67,43,90,1],[43,90,44,64,1],[44,64,44,105,1],[44,105,45,62,1],[45,62,45,81,1],[45,81,46,65,1],[46,65,46,84,1],[46,84,46,86,1],[40,13,46,86,1],[48,13,49,62,1],[49,62,49,96,1],[49,96,50,62,1],[50,62,50,107,1],[50,107,51,66,1],[51,66,51,89,1],[51,89,52,61,1],[52,61,52,80,1],[52,80,53,64,1],[53,64,53,83,1],[53,83,53,85,1],[48,13,53,85,1],[68,13,69,53,1],[69,53,69,130,1],[69,130,70,60,1],[70,60,70,79,1],[70,79,70,81,1],[68,13,70,81,1],[72,13,73,63,1],[73,63,73,94,1],[73,94,74,67,1],[74,67,74,102,1],[74,102,75,62,1],[75,62,75,81,1],[75,81,76,65,1],[76,65,76,84,1],[76,84,76,86,1],[72,13,76,86,1],[78,13,80,57,1],[80,57,80,76,1],[80,76,81,55,1],[81,55,81,94,1],[81,94,82,57,1],[82,57,82,76,1],[82,76,83,56,1],[83,56,83,75,1],[83,75,84,61,1],[84,61,84,80,1],[84,80,85,58,1],[85,58,85,77,1],[85,77,86,57,1],[86,57,86,76,1],[86,76,87,64,1],[87,64,87,83,1],[87,83,88,67,1],[88,67,88,86,1],[88,86,90,23,1],[90,23,90,24,0],[90,24,92,27,1],[92,27,94,49,0],[94,49,96,27,1],[96,27,96,120,0],[96,120,97,27,1],[97,27,97,70,0],[97,70,98,27,1],[98,27,98,28,0],[98,28,100,31,1],[100,31,100,86,0],[100,86,101,31,1],[101,31,101,32,0],[101,32,102,35,1],[102,35,102,51,0],[102,51,103,31,1],[103,31,103,32,0],[103,32,104,27,1],[104,27,104,28,0],[104,28,105,27,1],[105,27,105,69,0],[105,69,106,27,1],[106,27,106,28,0],[106,28,108,31,1],[108,31,108,89,0],[108,89,109,31,1],[109,31,109,32,0],[109,32,110,35,1],[110,35,110,61,0],[110,61,111,31,1],[111,31,111,32,0],[111,32,113,31,1],[113,31,113,32,0],[113,32,114,35,1],[114,35,114,55,0],[114,55,115,31,1],[115,31,115,32,0],[115,32,116,27,1],[116,27,116,28,0],[116,28,117,27,1],[117,27,117,107,0],[117,107,119,27,1],[119,27,119,103,0],[119,103,120,27,1],[120,27,120,28,0],[120,28,121,31,1],[121,31,121,132,0],[121,132,122,27,1],[122,27,122,28,0],[122,28,123,23,1],[123,23,123,24,0],[123,24,123,26,1],[78,13,123,26,1],[125,13,126,44,1],[126,44,126,92,0],[126,92,126,94,1],[125,13,126,94,1],[127,9,127,10,1]]);
    </script>
  </body>
</html>