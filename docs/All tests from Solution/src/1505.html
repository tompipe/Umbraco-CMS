<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Services\RedirectUrlService.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using Umbraco.Core.Events;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Persistence;
using Umbraco.Core.Persistence.UnitOfWork;

namespace Umbraco.Core.Services
{
    internal class RedirectUrlService : RepositoryService, IRedirectUrlService
    {
        public RedirectUrlService(IDatabaseUnitOfWorkProvider provider, RepositoryFactory repositoryFactory, ILogger logger, IEventMessagesFactory eventMessagesFactory) 
            : base(provider, repositoryFactory, logger, eventMessagesFactory)
        { }

        public void Register(string url, Guid contentKey)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                var redir = repo.Get(url, contentKey);
                if (redir != null)
                    redir.CreateDateUtc = DateTime.UtcNow;
                else
                    redir = new RedirectUrl { Key = Guid.NewGuid(), Url = url, ContentKey = contentKey };
                repo.AddOrUpdate(redir);
                uow.Commit();
            }
        }
        
        public void Delete(IRedirectUrl redirectUrl)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                repo.Delete(redirectUrl);
                uow.Commit();
            }
        }

        public void Delete(Guid id)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                repo.Delete(id);
                uow.Commit();
            }
        }

        public void DeleteContentRedirectUrls(Guid contentKey)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                repo.DeleteContentUrls(contentKey);
                uow.Commit();
            }
        }

        public void DeleteAll()
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                repo.DeleteAll();
                uow.Commit();
            }
        }

        public IRedirectUrl GetMostRecentRedirectUrl(string url)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                var rule = repo.GetMostRecentUrl(url);
                return rule;
            }
        }

        public IEnumerable&lt;IRedirectUrl&gt; GetContentRedirectUrls(Guid contentKey)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                var rules = repo.GetContentUrls(contentKey);
                return rules;
            }
        }

        public IEnumerable&lt;IRedirectUrl&gt; GetAllRedirectUrls(long pageIndex, int pageSize, out long total)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                var rules = repo.GetAllUrls(pageIndex, pageSize, out total);
                return rules;
            }
        }

        public IEnumerable&lt;IRedirectUrl&gt; GetAllRedirectUrls(int rootContentId, long pageIndex, int pageSize, out long total)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                var rules = repo.GetAllUrls(rootContentId, pageIndex, pageSize, out total);
                return rules;
            }
        }
        public IEnumerable&lt;IRedirectUrl&gt; SearchRedirectUrls(string searchTerm, long pageIndex, int pageSize, out long total)
        {
            using (var uow = UowProvider.GetUnitOfWork())
            using (var repo = RepositoryFactory.CreateRedirectUrlRepository(uow))
            {
                var rules = repo.SearchUrls(searchTerm, pageIndex, pageSize, out total);
                return rules;
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,15,14,78,0],[15,9,15,10,0],[15,11,15,12,0],[18,9,18,10,0],[19,20,19,57,0],[20,20,20,81,0],[21,13,21,14,0],[22,17,22,55,0],[23,17,23,35,0],[24,21,24,59,0],[26,21,26,106,0],[27,17,27,41,0],[28,17,28,30,0],[29,13,29,14,0],[30,9,30,10,0],[33,9,33,10,0],[34,20,34,57,0],[35,20,35,81,0],[36,13,36,14,0],[37,17,37,42,0],[38,17,38,30,0],[39,13,39,14,0],[40,9,40,10,0],[43,9,43,10,0],[44,20,44,57,0],[45,20,45,81,0],[46,13,46,14,0],[47,17,47,33,0],[48,17,48,30,0],[49,13,49,14,0],[50,9,50,10,0],[53,9,53,10,0],[54,20,54,57,0],[55,20,55,81,0],[56,13,56,14,0],[57,17,57,52,0],[58,17,58,30,0],[59,13,59,14,0],[60,9,60,10,0],[63,9,63,10,0],[64,20,64,57,0],[65,20,65,81,0],[66,13,66,14,0],[67,17,67,34,0],[68,17,68,30,0],[69,13,69,14,0],[70,9,70,10,0],[73,9,73,10,0],[74,20,74,57,0],[75,20,75,81,0],[76,13,76,14,0],[77,17,77,55,0],[78,17,78,29,0],[80,9,80,10,0],[83,9,83,10,0],[84,20,84,57,0],[85,20,85,81,0],[86,13,86,14,0],[87,17,87,61,0],[88,17,88,30,0],[90,9,90,10,0],[93,9,93,10,0],[94,20,94,57,0],[95,20,95,81,0],[96,13,96,14,0],[97,17,97,77,0],[98,17,98,30,0],[100,9,100,10,0],[103,9,103,10,0],[104,20,104,57,0],[105,20,105,81,0],[106,13,106,14,0],[107,17,107,92,0],[108,17,108,30,0],[110,9,110,10,0],[112,9,112,10,0],[113,20,113,57,0],[114,20,114,81,0],[115,13,115,14,0],[116,17,116,89,0],[117,17,117,30,0],[119,9,119,10,0]]);
    </script>
  </body>
</html>