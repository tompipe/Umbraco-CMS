<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\users\tom pipe\documents\hexadigital\code\umbraco\umbraco-cms\src\umbraco.web.ui\umbraco\developer\packages\starterkits.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using Umbraco.Core;
using Umbraco.Core.Configuration;
using Umbraco.Core.IO;
using Umbraco.Core.Logging;
using Umbraco.Web.UI.Install.Steps.Skinning;
using Umbraco.Web.UI.Pages;
using System.IO;
using umbraco.cms.businesslogic.packager;

namespace Umbraco.Web.UI.Umbraco.Developer.Packages
{
    

    public partial class StarterKits : UmbracoEnsuredPage
    {
        private const string RepoGuid = &quot;65194810-1f85-11dd-bd0b-0800200c9a66&quot;;

        protected void Page_Load(object sender, EventArgs e)
        {
            //check if a starter kit is already isntalled

            var installed = InstalledPackage.GetAllInstalledPackages();

            if (installed.Count == 0)
            {
                ShowStarterKits();
                return;
            }
            
            var repo = global::umbraco.cms.businesslogic.packager.repositories.Repository.getByGuid(RepoGuid);
            if (repo.HasConnection())
            {
                try
                {
                    var kits = repo.Webservice.StarterKits();
                    var kitIds = kits.Select(x =&gt; x.RepoGuid).ToArray();

                    //if a starter kit is already installed show finish
                    if (installed.Any(x =&gt; kitIds.Contains(Guid.Parse(x.Data.PackageGuid))))
                    {
                        StarterKitNotInstalled.Visible = false;
                        installationCompleted.Visible = true;
                    }
                    else
                    {
                        ShowStarterKits();    
                    }
                }
                catch (Exception ex)
                {
                    LogHelper.Error&lt;StarterKits&gt;(&quot;Cannot connect to package repository&quot;, ex);
                    InstallationDirectoryNotAvailable.Visible = true;
                    StarterKitNotInstalled.Visible = false;
                }
            }
            else
            {
                InstallationDirectoryNotAvailable.Visible = true;
                StarterKitNotInstalled.Visible = false;
            }            
        }

        private void ShowStarterKits()
        {
            if (Directory.Exists(Server.MapPath(GlobalSettings.Path.EnsureEndsWith(&#39;/&#39;) + &quot;install/Legacy&quot;)) == false)
            {
                InstallationDirectoryNotAvailable.Visible = true;
                StarterKitNotInstalled.Visible = false;
            
                return;
            }


            var starterkitsctrl = (LoadStarterKits)LoadControl(GlobalSettings.Path.EnsureEndsWith(&#39;/&#39;) + &quot;install/Legacy/loadStarterKits.ascx&quot;);
            
            ph_starterkits.Controls.Add(starterkitsctrl);

            StarterKitNotInstalled.Visible = true;

        }
        
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,10,0],[24,13,24,72,0],[26,13,26,38,0],[27,13,27,14,0],[28,17,28,35,0],[29,17,29,24,0],[32,13,32,111,0],[33,13,33,38,0],[34,13,34,14,0],[36,17,36,18,0],[37,21,37,62,0],[38,21,38,51,0],[38,51,38,61,0],[38,61,38,73,0],[38,21,38,73,0],[41,21,41,44,0],[41,44,41,91,0],[41,91,41,93,0],[41,21,41,93,0],[42,21,42,22,0],[43,25,43,64,0],[44,25,44,62,0],[45,21,45,22,0],[47,21,47,22,0],[48,25,48,43,0],[49,21,49,22,0],[50,17,50,18,0],[51,17,51,37,0],[52,17,52,18,0],[53,21,53,94,0],[54,21,54,70,0],[55,21,55,60,0],[56,17,56,18,0],[57,13,57,14,0],[59,13,59,14,0],[60,17,60,66,0],[61,17,61,56,0],[62,13,62,14,0],[63,9,63,10,0],[66,9,66,10,0],[67,13,67,119,0],[68,13,68,14,0],[69,17,69,66,0],[70,17,70,56,0],[72,17,72,24,0],[76,13,76,145,0],[78,13,78,58,0],[80,13,80,51,0],[82,9,82,10,0]]);
    </script>
  </body>
</html>