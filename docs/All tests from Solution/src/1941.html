<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Media\Exif\ExifExtendedProperty.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Text;

namespace Umbraco.Core.Media.Exif
{
    /// &lt;summary&gt;
    /// Represents an enumerated value.
    /// &lt;/summary&gt;
    internal class ExifEnumProperty&lt;T&gt; : ExifProperty
    {
        protected T mValue;
        protected bool mIsBitField;
        protected override object _Value { get { return Value; } set { Value = (T)value; } }
        public new T Value { get { return mValue; } set { mValue = value; } }
        public bool IsBitField { get { return mIsBitField; } }

        static public implicit operator T(ExifEnumProperty&lt;T&gt; obj) { return (T)obj.mValue; }

        public override string ToString() { return mValue.ToString(); }

        public ExifEnumProperty(ExifTag tag, T value, bool isbitfield)
            : base(tag)
        {
            mValue = value;
            mIsBitField = isbitfield;
        }

        public ExifEnumProperty(ExifTag tag, T value)
            : this(tag, value, false)
        {
            ;
        }

        public override ExifInterOperability Interoperability
        {
            get
            {
                ushort tagid = ExifTagFactory.GetTagID(mTag);

                Type type = typeof(T);
                Type basetype = Enum.GetUnderlyingType(type);

                if (type == typeof(FileSource) || type == typeof(SceneType))
                {
                    // UNDEFINED
                    return new ExifInterOperability(tagid, 7, 1, new byte[] { (byte)((object)mValue) });
                }
                else if (type == typeof(GPSLatitudeRef) || type == typeof(GPSLongitudeRef) ||
                    type == typeof(GPSStatus) || type == typeof(GPSMeasureMode) ||
                    type == typeof(GPSSpeedRef) || type == typeof(GPSDirectionRef) ||
                    type == typeof(GPSDistanceRef))
                {
                    // ASCII
                    return new ExifInterOperability(tagid, 2, 2, new byte[] { (byte)((object)mValue), 0 });
                }
                else if (basetype == typeof(byte))
                {
                    // BYTE
                    return new ExifInterOperability(tagid, 1, 1, new byte[] { (byte)((object)mValue) });
                }
                else if (basetype == typeof(ushort))
                {
                    // SHORT
                    return new ExifInterOperability(tagid, 3, 1, ExifBitConverter.GetBytes((ushort)((object)mValue), BitConverterEx.SystemByteOrder, BitConverterEx.SystemByteOrder));
                }
                else
                    throw new UnknownEnumTypeException();
            }
        }
    }

    /// &lt;summary&gt;
    /// Represents an ASCII string. (EXIF Specification: UNDEFINED) Used for the UserComment field.
    /// &lt;/summary&gt;
    internal class ExifEncodedString : ExifProperty
    {
        protected string mValue;
        private Encoding mEncoding;
        protected override object _Value { get { return Value; } set { Value = (string)value; } }
        public new string Value { get { return mValue; } set { mValue = value; } }
        public Encoding Encoding { get { return mEncoding; } set { mEncoding = value; } }

        static public implicit operator string(ExifEncodedString obj) { return obj.mValue; }

        public override string ToString() { return mValue; }

        public ExifEncodedString(ExifTag tag, string value, Encoding encoding)
            : base(tag)
        {
            mValue = value;
            mEncoding = encoding;
        }

        public override ExifInterOperability Interoperability
        {
            get
            {
                string enc = &quot;&quot;;
                if (mEncoding == null)
                    enc = &quot;\0\0\0\0\0\0\0\0&quot;;
                else if (mEncoding.EncodingName == &quot;US-ASCII&quot;)
                    enc = &quot;ASCII\0\0\0&quot;;
                else if (mEncoding.EncodingName == &quot;Japanese (JIS 0208-1990 and 0212-1990)&quot;)
                    enc = &quot;JIS\0\0\0\0\0&quot;;
                else if (mEncoding.EncodingName == &quot;Unicode&quot;)
                    enc = &quot;Unicode\0&quot;;
                else
                    enc = &quot;\0\0\0\0\0\0\0\0&quot;;

                byte[] benc = Encoding.ASCII.GetBytes(enc);
                byte[] bstr = (mEncoding == null ? Encoding.ASCII.GetBytes(mValue) : mEncoding.GetBytes(mValue));
                byte[] data = new byte[benc.Length + bstr.Length];
                Array.Copy(benc, 0, data, 0, benc.Length);
                Array.Copy(bstr, 0, data, benc.Length, bstr.Length);

                return new ExifInterOperability(ExifTagFactory.GetTagID(mTag), 7, (uint)data.Length, data);
            }
        }
    }

    /// &lt;summary&gt;
    /// Represents an ASCII string formatted as DateTime. (EXIF Specification: ASCII) Used for the date time fields.
    /// &lt;/summary&gt;
    internal class ExifDateTime : ExifProperty
    {
        protected DateTime mValue;
        protected override object _Value { get { return Value; } set { Value = (DateTime)value; } }
        public new DateTime Value { get { return mValue; } set { mValue = value; } }

        static public implicit operator DateTime(ExifDateTime obj) { return obj.mValue; }

        public override string ToString() { return mValue.ToString(&quot;yyyy.MM.dd HH:mm:ss&quot;); }

        public ExifDateTime(ExifTag tag, DateTime value)
            : base(tag)
        {
            mValue = value;
        }

        public override ExifInterOperability Interoperability
        {
            get
            {
                return new ExifInterOperability(ExifTagFactory.GetTagID(mTag), 2, (uint)20, ExifBitConverter.GetBytes(mValue, true));
            }
        }
    }

    /// &lt;summary&gt;
    /// Represents the exif version as a 4 byte ASCII string. (EXIF Specification: UNDEFINED) 
    /// Used for the ExifVersion, FlashpixVersion, InteroperabilityVersion and GPSVersionID fields.
    /// &lt;/summary&gt;
    internal class ExifVersion : ExifProperty
    {
        protected string mValue;
        protected override object _Value { get { return Value; } set { Value = (string)value; } }
        public new string Value { get { return mValue; } set { mValue = value.Substring(0, 4); } }

        public ExifVersion(ExifTag tag, string value)
            : base(tag)
        {
            if (value.Length &gt; 4)
                mValue = value.Substring(0, 4);
            else if (value.Length &lt; 4)
                mValue = value + new string(&#39; &#39;, 4 - value.Length);
            else
                mValue = value;
        }

        public override string ToString()
        {
            return mValue;
        }

        public override ExifInterOperability Interoperability
        {
            get
            {
                if (mTag == ExifTag.ExifVersion || mTag == ExifTag.FlashpixVersion || mTag == ExifTag.InteroperabilityVersion)
                    return new ExifInterOperability(ExifTagFactory.GetTagID(mTag), 7, 4, Encoding.ASCII.GetBytes(mValue));
                else
                {
                    byte[] data = new byte[4];
                    for (int i = 0; i &lt; 4; i++)
                        data[i] = byte.Parse(mValue[0].ToString());
                    return new ExifInterOperability(ExifTagFactory.GetTagID(mTag), 7, 4, data);
                }
            }
        }
    }

    /// &lt;summary&gt;
    /// Represents the location and area of the subject (EXIF Specification: 2xSHORT)
    /// The coordinate values, width, and height are expressed in relation to the 
    /// upper left as origin, prior to rotation processing as per the Rotation tag.
    /// &lt;/summary&gt;
    internal class ExifPointSubjectArea : ExifUShortArray
    {
        protected new ushort[] Value { get { return mValue; } set { mValue = value; } }
        public ushort X { get { return mValue[0]; } set { mValue[0] = value; } }
        public ushort Y { get { return mValue[1]; } set { mValue[1] = value; } }

        public override string ToString()
        {
            StringBuilder sb = new StringBuilder();
            sb.AppendFormat(&quot;({0:d}, {1:d})&quot;, mValue[0], mValue[1]);
            return sb.ToString();
        }

        public ExifPointSubjectArea(ExifTag tag, ushort[] value)
            : base(tag, value)
        {
            ;
        }

        public ExifPointSubjectArea(ExifTag tag, ushort x, ushort y)
            : base(tag, new ushort[] { x, y })
        {
            ;
        }
    }

    /// &lt;summary&gt;
    /// Represents the location and area of the subject (EXIF Specification: 3xSHORT)
    /// The coordinate values, width, and height are expressed in relation to the 
    /// upper left as origin, prior to rotation processing as per the Rotation tag.
    /// &lt;/summary&gt;
    internal class ExifCircularSubjectArea : ExifPointSubjectArea
    {
        public ushort Diamater { get { return mValue[2]; } set { mValue[2] = value; } }

        public override string ToString()
        {
            StringBuilder sb = new StringBuilder();
            sb.AppendFormat(&quot;({0:d}, {1:d}) {2:d}&quot;, mValue[0], mValue[1], mValue[2]);
            return sb.ToString();
        }

        public ExifCircularSubjectArea(ExifTag tag, ushort[] value)
            : base(tag, value)
        {
            ;
        }

        public ExifCircularSubjectArea(ExifTag tag, ushort x, ushort y, ushort d)
            : base(tag, new ushort[] { x, y, d })
        {
            ;
        }
    }

    /// &lt;summary&gt;
    /// Represents the location and area of the subject (EXIF Specification: 4xSHORT)
    /// The coordinate values, width, and height are expressed in relation to the 
    /// upper left as origin, prior to rotation processing as per the Rotation tag.
    /// &lt;/summary&gt;
    internal class ExifRectangularSubjectArea : ExifPointSubjectArea
    {
        public ushort Width { get { return mValue[2]; } set { mValue[2] = value; } }
        public ushort Height { get { return mValue[3]; } set { mValue[3] = value; } }

        public override string ToString()
        {
            StringBuilder sb = new StringBuilder();
            sb.AppendFormat(&quot;({0:d}, {1:d}) ({2:d} x {3:d})&quot;, mValue[0], mValue[1], mValue[2], mValue[3]);
            return sb.ToString();
        }

        public ExifRectangularSubjectArea(ExifTag tag, ushort[] value)
            : base(tag, value)
        {
            ;
        }

        public ExifRectangularSubjectArea(ExifTag tag, ushort x, ushort y, ushort w, ushort h)
            : base(tag, new ushort[] { x, y, w, h })
        {
            ;
        }
    }

    /// &lt;summary&gt;
    /// Represents GPS latitudes and longitudes (EXIF Specification: 3xRATIONAL)
    /// &lt;/summary&gt;
    internal class GPSLatitudeLongitude : ExifURationalArray
    {
        protected new MathEx.UFraction32[] Value { get { return mValue; } set { mValue = value; } }
        public MathEx.UFraction32 Degrees { get { return mValue[0]; } set { mValue[0] = value; } }
        public MathEx.UFraction32 Minutes { get { return mValue[1]; } set { mValue[1] = value; } }
        public MathEx.UFraction32 Seconds { get { return mValue[2]; } set { mValue[2] = value; } }

        public static explicit operator float(GPSLatitudeLongitude obj) { return obj.ToFloat(); }
        public float ToFloat()
        {
            return (float)Degrees + ((float)Minutes) / 60.0f + ((float)Seconds) / 3600.0f;
        }

        public override string ToString()
        {
            return string.Format(&quot;{0:F2}&#176;{1:F2}&#39;{2:F2}\&quot;&quot;, (float)Degrees, (float)Minutes, (float)Seconds);
        }

        public GPSLatitudeLongitude(ExifTag tag, MathEx.UFraction32[] value)
            : base(tag, value)
        {
            ;
        }

        public GPSLatitudeLongitude(ExifTag tag, float d, float m, float s)
            : base(tag, new MathEx.UFraction32[] { new MathEx.UFraction32(d), new MathEx.UFraction32(m), new MathEx.UFraction32(s) })
        {
            ;
        }
    }

    /// &lt;summary&gt;
    /// Represents a GPS time stamp as UTC (EXIF Specification: 3xRATIONAL)
    /// &lt;/summary&gt;
    internal class GPSTimeStamp : ExifURationalArray
    {
        protected new MathEx.UFraction32[] Value { get { return mValue; } set { mValue = value; } }
        public MathEx.UFraction32 Hour { get { return mValue[0]; } set { mValue[0] = value; } }
        public MathEx.UFraction32 Minute { get { return mValue[1]; } set { mValue[1] = value; } }
        public MathEx.UFraction32 Second { get { return mValue[2]; } set { mValue[2] = value; } }

        public override string ToString()
        {
            return string.Format(&quot;{0:F2}:{1:F2}:{2:F2}\&quot;&quot;, (float)Hour, (float)Minute, (float)Second);
        }

        public GPSTimeStamp(ExifTag tag, MathEx.UFraction32[] value)
            : base(tag, value)
        {
            ;
        }

        public GPSTimeStamp(ExifTag tag, float h, float m, float s)
            : base(tag, new MathEx.UFraction32[] { new MathEx.UFraction32(h), new MathEx.UFraction32(m), new MathEx.UFraction32(s) })
        {
            ;
        }
    }

    /// &lt;summary&gt;
    /// Represents an ASCII string. (EXIF Specification: BYTE) 
    /// Used by Windows XP.
    /// &lt;/summary&gt;
    internal class WindowsByteString : ExifProperty
    {
        protected string mValue;
        protected override object _Value { get { return Value; } set { Value = (string)value; } }
        public new string Value { get { return mValue; } set { mValue = value; } }

        static public implicit operator string(WindowsByteString obj) { return obj.mValue; }

        public override string ToString() { return mValue; }

        public WindowsByteString(ExifTag tag, string value)
            : base(tag)
        {
            mValue = value;
        }

        public override ExifInterOperability Interoperability
        {
            get
            {
                byte[] data = Encoding.Unicode.GetBytes(mValue);
                return new ExifInterOperability(ExifTagFactory.GetTagID(mTag), 1, (uint)data.Length, data);
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,48,13,49,0],[13,50,13,63,0],[13,64,13,65,0],[13,70,13,71,0],[13,72,13,89,0],[13,90,13,91,0],[14,34,14,35,0],[14,36,14,50,0],[14,51,14,52,0],[14,57,14,58,0],[14,59,14,74,0],[14,75,14,76,0],[15,38,15,39,0],[15,40,15,59,0],[15,60,15,61,0],[17,68,17,69,0],[17,70,17,91,0],[17,92,17,93,0],[19,43,19,44,0],[19,45,19,70,0],[19,71,19,72,0],[22,15,22,24,0],[23,9,23,10,0],[24,13,24,28,0],[25,13,25,38,0],[26,9,26,10,0],[29,15,29,38,0],[30,9,30,10,0],[31,13,31,14,0],[32,9,32,10,0],[37,13,37,14,0],[38,17,38,62,0],[40,17,40,39,0],[41,17,41,62,0],[43,17,43,77,0],[44,17,44,18,0],[46,21,46,105,0],[48,22,51,52,0],[52,17,52,18,0],[54,21,54,108,0],[56,22,56,51,0],[57,17,57,18,0],[59,21,59,105,0],[61,22,61,53,0],[62,17,62,18,0],[64,21,64,183,0],[67,21,67,58,0],[68,13,68,14,0],[79,48,79,49,0],[79,50,79,63,0],[79,64,79,65,0],[79,70,79,71,0],[79,72,79,94,0],[79,95,79,96,0],[80,39,80,40,0],[80,41,80,55,0],[80,56,80,57,0],[80,62,80,63,0],[80,64,80,79,0],[80,80,80,81,0],[81,40,81,41,0],[81,42,81,59,0],[81,60,81,61,0],[81,66,81,67,0],[81,68,81,86,0],[81,87,81,88,0],[83,71,83,72,0],[83,73,83,91,0],[83,92,83,93,0],[85,43,85,44,0],[85,45,85,59,0],[85,60,85,61,0],[88,15,88,24,0],[89,9,89,10,0],[90,13,90,28,0],[91,13,91,34,0],[92,9,92,10,0],[97,13,97,14,0],[98,17,98,33,0],[99,17,99,39,0],[100,21,100,46,0],[101,22,101,63,0],[102,21,102,41,0],[103,22,103,93,0],[104,21,104,43,0],[105,22,105,62,0],[106,21,106,39,0],[108,21,108,46,0],[110,17,110,60,0],[111,17,111,114,0],[112,17,112,67,0],[113,17,113,59,0],[114,17,114,69,0],[116,17,116,108,0],[117,13,117,14,0],[127,48,127,49,0],[127,50,127,63,0],[127,64,127,65,0],[127,70,127,71,0],[127,72,127,96,0],[127,97,127,98,0],[128,41,128,42,0],[128,43,128,57,0],[128,58,128,59,0],[128,64,128,65,0],[128,66,128,81,0],[128,82,128,83,0],[130,68,130,69,0],[130,70,130,88,0],[130,89,130,90,0],[132,43,132,44,0],[132,45,132,91,0],[132,92,132,93,0],[135,15,135,24,0],[136,9,136,10,0],[137,13,137,28,0],[138,9,138,10,0],[143,13,143,14,0],[144,17,144,134,0],[145,13,145,14,0],[156,48,156,49,0],[156,50,156,63,0],[156,64,156,65,0],[156,70,156,71,0],[156,72,156,94,0],[156,95,156,96,0],[157,39,157,40,0],[157,41,157,55,0],[157,56,157,57,0],[157,62,157,63,0],[157,64,157,95,0],[157,96,157,97,0],[160,15,160,24,0],[161,9,161,10,0],[162,13,162,34,0],[163,17,163,48,0],[164,18,164,39,0],[165,17,165,68,0],[167,17,167,32,0],[168,9,168,10,0],[171,9,171,10,0],[172,13,172,27,0],[173,9,173,10,0],[178,13,178,14,0],[179,17,179,127,0],[180,21,180,123,0],[182,17,182,18,0],[183,21,183,47,0],[184,26,184,35,0],[184,37,184,42,0],[184,44,184,47,0],[185,25,185,68,0],[186,21,186,96,0],[188,13,188,14,0],[199,44,199,45,0],[199,46,199,60,0],[199,61,199,62,0],[199,67,199,68,0],[199,69,199,84,0],[199,85,199,86,0],[200,31,200,32,0],[200,33,200,50,0],[200,51,200,52,0],[200,57,200,58,0],[200,59,200,77,0],[200,78,200,79,0],[201,31,201,32,0],[201,33,201,50,0],[201,51,201,52,0],[201,57,201,58,0],[201,59,201,77,0],[201,78,201,79,0],[204,9,204,10,0],[205,13,205,52,0],[206,13,206,69,0],[207,13,207,34,0],[208,9,208,10,0],[211,15,211,31,0],[212,9,212,10,0],[213,13,213,14,0],[214,9,214,10,0],[217,15,217,47,0],[218,9,218,10,0],[219,13,219,14,0],[220,9,220,10,0],[230,38,230,39,0],[230,40,230,57,0],[230,58,230,59,0],[230,64,230,65,0],[230,66,230,84,0],[230,85,230,86,0],[233,9,233,10,0],[234,13,234,52,0],[235,13,235,86,0],[236,13,236,34,0],[237,9,237,10,0],[240,15,240,31,0],[241,9,241,10,0],[242,13,242,14,0],[243,9,243,10,0],[246,15,246,50,0],[247,9,247,10,0],[248,13,248,14,0],[249,9,249,10,0],[259,35,259,36,0],[259,37,259,54,0],[259,55,259,56,0],[259,61,259,62,0],[259,63,259,81,0],[259,82,259,83,0],[260,36,260,37,0],[260,38,260,55,0],[260,56,260,57,0],[260,62,260,63,0],[260,64,260,82,0],[260,83,260,84,0],[263,9,263,10,0],[264,13,264,52,0],[265,13,265,107,0],[266,13,266,34,0],[267,9,267,10,0],[270,15,270,31,0],[271,9,271,10,0],[272,13,272,14,0],[273,9,273,10,0],[276,15,276,53,0],[277,9,277,10,0],[278,13,278,14,0],[279,9,279,10,0],[287,56,287,57,0],[287,58,287,72,0],[287,73,287,74,0],[287,79,287,80,0],[287,81,287,96,0],[287,97,287,98,0],[288,49,288,50,0],[288,51,288,68,0],[288,69,288,70,0],[288,75,288,76,0],[288,77,288,95,0],[288,96,288,97,0],[289,49,289,50,0],[289,51,289,68,0],[289,69,289,70,0],[289,75,289,76,0],[289,77,289,95,0],[289,96,289,97,0],[290,49,290,50,0],[290,51,290,68,0],[290,69,290,70,0],[290,75,290,76,0],[290,77,290,95,0],[290,96,290,97,0],[292,73,292,74,0],[292,75,292,96,0],[292,97,292,98,0],[294,9,294,10,0],[295,13,295,91,0],[296,9,296,10,0],[299,9,299,10,0],[300,13,300,108,0],[301,9,301,10,0],[304,15,304,31,0],[305,9,305,10,0],[306,13,306,14,0],[307,9,307,10,0],[310,15,310,134,0],[311,9,311,10,0],[312,13,312,14,0],[313,9,313,10,0],[321,56,321,57,0],[321,58,321,72,0],[321,73,321,74,0],[321,79,321,80,0],[321,81,321,96,0],[321,97,321,98,0],[322,46,322,47,0],[322,48,322,65,0],[322,66,322,67,0],[322,72,322,73,0],[322,74,322,92,0],[322,93,322,94,0],[323,48,323,49,0],[323,50,323,67,0],[323,68,323,69,0],[323,74,323,75,0],[323,76,323,94,0],[323,95,323,96,0],[324,48,324,49,0],[324,50,324,67,0],[324,68,324,69,0],[324,74,324,75,0],[324,76,324,94,0],[324,95,324,96,0],[327,9,327,10,0],[328,13,328,103,0],[329,9,329,10,0],[332,15,332,31,0],[333,9,333,10,0],[334,13,334,14,0],[335,9,335,10,0],[338,15,338,134,0],[339,9,339,10,0],[340,13,340,14,0],[341,9,341,10,0],[351,48,351,49,0],[351,50,351,63,0],[351,64,351,65,0],[351,70,351,71,0],[351,72,351,94,0],[351,95,351,96,0],[352,39,352,40,0],[352,41,352,55,0],[352,56,352,57,0],[352,62,352,63,0],[352,64,352,79,0],[352,80,352,81,0],[354,71,354,72,0],[354,73,354,91,0],[354,92,354,93,0],[356,43,356,44,0],[356,45,356,59,0],[356,60,356,61,0],[359,15,359,24,0],[360,9,360,10,0],[361,13,361,28,0],[362,9,362,10,0],[367,13,367,14,0],[368,17,368,65,0],[369,17,369,108,0],[370,13,370,14,0]]);
    </script>
  </body>
</html>