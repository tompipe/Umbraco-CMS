<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\WebApi\Filters\DisableBrowserCacheAttribute.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Net.Http.Headers;
using System.Web.Http.Filters;

namespace Umbraco.Web.WebApi.Filters
{
    /// &lt;summary&gt;
    /// Ensures that the request is not cached by the browser
    /// &lt;/summary&gt;
    public class DisableBrowserCacheAttribute : ActionFilterAttribute
    {
        public override void OnActionExecuted(HttpActionExecutedContext actionExecutedContext)
        {
            //See: http://stackoverflow.com/questions/17755239/how-to-stop-chrome-from-caching-rest-response-from-webapi

            base.OnActionExecuted(actionExecutedContext);
            if (actionExecutedContext == null || actionExecutedContext.Response == null ||
                    actionExecutedContext.Response.Headers == null)
            {
                return;
            }
            //NOTE: Until we upgraded to WebApi 2, this didn&#39;t work correctly and we had to revert to using
            // HttpContext.Current responses. I&#39;ve changed this back to what it should be now since it works
            // and now with WebApi2, the HttpContext.Current responses dont! Anyways, all good now.
            actionExecutedContext.Response.Headers.CacheControl = new CacheControlHeaderValue()
            {
                NoCache = true,
                NoStore = true,
                MaxAge = new TimeSpan(0),
                MustRevalidate = true
            };

            actionExecutedContext.Response.Headers.Pragma.Add(new NameValueHeaderValue(&quot;no-cache&quot;));
            if (actionExecutedContext.Response.Content != null)
            {
                actionExecutedContext.Response.Content.Headers.Expires =
                        //Mon, 01 Jan 1990 00:00:00 GMT
                        new DateTimeOffset(1990, 1, 1, 0, 0, 0, TimeSpan.Zero);
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,10,0],[16,13,16,58,0],[17,13,18,68,0],[19,13,19,14,0],[20,17,20,24,0],[25,13,31,15,0],[33,13,33,101,0],[34,13,34,64,0],[35,13,35,14,0],[36,17,38,80,0],[39,13,39,14,0],[40,9,40,10,0]]);
    </script>
  </body>
</html>