<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Routing\ContentFinderByNotFoundHandler.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using Umbraco.Core.Logging;
using umbraco.interfaces;

namespace Umbraco.Web.Routing
{
	/// &lt;summary&gt;
	/// Provides an implementation of &lt;see cref=&quot;IContentFinder&quot;/&gt; that runs a legacy NotFoundHandler.
	/// &lt;/summary&gt;
	/// &lt;remarks&gt;Provided for backward compatibility.&lt;/remarks&gt;
	public class ContentFinderByNotFoundHandler&lt;THandler&gt; : IContentFinder
	{
		/// &lt;summary&gt;
		/// Tries to find and assign an Umbraco document to a &lt;c&gt;PublishedContentRequest&lt;/c&gt;.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;pcr&quot;&gt;The &lt;c&gt;PublishedContentRequest&lt;/c&gt;.&lt;/param&gt;		
		/// &lt;returns&gt;A value indicating whether an Umbraco document was found and assigned.&lt;/returns&gt;
		public bool TryFindContent(PublishedContentRequest pcr)
		{
			var type = typeof(THandler);
			var handler = GetHandler(type);
			
			if (handler == null)
				return false;

			var url = NotFoundHandlerHelper.GetLegacyUrlForNotFoundHandlers();
            LogHelper.Debug&lt;ContentFinderByNotFoundHandler&lt;THandler&gt;&gt;(&quot;Running for legacy url=&#39;{0}&#39;.&quot;, () =&gt; url);

			if (handler.Execute(url) &amp;&amp; handler.redirectID &gt; 0)
			{
				LogHelper.Debug&lt;ContentFinderByNotFoundHandler&lt;THandler&gt;&gt;(&quot;Handler &#39;{0}&#39; returned id={1}.&quot;, () =&gt; type.FullName, () =&gt; handler.redirectID);

                var content = pcr.RoutingContext.UmbracoContext.ContentCache.GetById(handler.redirectID);

			    LogHelper.Debug&lt;ContentFinderByNotFoundHandler&lt;THandler&gt;&gt;(content == null
			        ? &quot;Could not find content with that id.&quot;
			        : &quot;Found corresponding content.&quot;);

			    pcr.PublishedContent = content;
				return content != null;
			}
		    
            LogHelper.Debug&lt;ContentFinderByNotFoundHandler&lt;THandler&gt;&gt;(&quot;Handler &#39;{0}&#39; returned nothing.&quot;, () =&gt; type.FullName);
		    return false;
		}

		INotFoundHandler GetHandler(Type type)
		{
			try
			{
				return Activator.CreateInstance(type) as INotFoundHandler;
			}
			catch (Exception e)
			{
				LogHelper.Error&lt;ContentFinderByNotFoundHandler&lt;THandler&gt;&gt;(string.Format(&quot;Error instanciating handler {0}, ignoring.&quot;, type.FullName), e);
				return null;
			}
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,3,19,4,0],[20,4,20,32,0],[21,4,21,35,0],[23,4,23,24,0],[24,5,24,18,0],[26,4,26,70,0],[27,13,27,110,0],[27,110,27,113,0],[27,113,27,115,0],[27,13,27,115,0],[29,4,29,55,0],[30,4,30,5,0],[31,5,31,103,0],[31,103,31,116,0],[31,116,31,124,0],[31,124,31,142,0],[31,142,31,144,0],[31,5,31,144,0],[33,17,33,106,0],[35,8,37,46,0],[39,8,39,39,0],[40,5,40,28,0],[43,13,43,112,0],[43,112,43,125,0],[43,125,43,127,0],[43,13,43,127,0],[44,7,44,20,0],[45,3,45,4,0],[48,3,48,4,0],[50,4,50,5,0],[51,5,51,63,0],[53,4,53,23,0],[54,4,54,5,0],[55,5,55,142,0],[56,5,56,17,0],[58,3,58,4,0]]);
    </script>
  </body>
</html>