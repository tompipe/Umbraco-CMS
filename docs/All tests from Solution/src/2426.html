<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\Packager\PackageActions\addDashboardSection.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Xml;
using Umbraco.Core;
using Umbraco.Core.IO;

namespace umbraco.cms.businesslogic.packager.standardPackageActions
{
	/// &lt;summary&gt;
	/// 
	/// &lt;/summary&gt;
	public class addDashboardSection : umbraco.interfaces.IPackageAction
	{
		#region IPackageAction Members

		/// &lt;summary&gt;
		/// Installs a dashboard section. This action reuses the action XML, so it has to be valid dashboard markup.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;packageName&quot;&gt;Name of the package.&lt;/param&gt;
		/// &lt;param name=&quot;xmlData&quot;&gt;The XML data.&lt;/param&gt;
		/// &lt;returns&gt;true if successfull&lt;/returns&gt;
		/// &lt;example&gt;
		/// &lt;code&gt;
		/// &lt;Action runat=&quot;install&quot; [undo=&quot;false&quot;] alias=&quot;addDashboardSection&quot; dashboardAlias=&quot;MyDashboardSection&quot;&gt;
		///     &lt;section&gt;
		///         &lt;areas&gt;
		///         &lt;area&gt;default&lt;/area&gt;
		///         &lt;area&gt;content&lt;/area&gt;
		///         &lt;/areas&gt;
		///	        &lt;tab caption=&quot;Last Edits&quot;&gt;
		///             &lt;control&gt;/usercontrols/dashboard/latestEdits.ascx&lt;/control&gt;
		///             &lt;control&gt;/usercontrols/umbracoBlog/dashboardBlogPostCreate.ascx&lt;/control&gt;
		///         &lt;/tab&gt;
		///         &lt;tab caption=&quot;Create blog post&quot;&gt;
		///             &lt;control&gt;/usercontrols/umbracoBlog/dashboardBlogPostCreate.ascx&lt;/control&gt;
		///         &lt;/tab&gt;
		///     &lt;/section&gt;
		/// &lt;/Action&gt;
		/// &lt;/code&gt;
		/// &lt;/example&gt;
		public bool Execute(string packageName, XmlNode xmlData)
		{
			//this will need a complete section node to work... 

			if (xmlData.HasChildNodes)
			{
                string sectionAlias = xmlData.Attributes[&quot;dashboardAlias&quot;].Value;
                string dbConfig = SystemFiles.DashboardConfig;

                XmlNode section = xmlData.SelectSingleNode(&quot;./section&quot;);
                XmlDocument dashboardFile = XmlHelper.OpenAsXmlDocument(dbConfig);

                //don&#39;t continue if it already exists
                var found = dashboardFile.SelectNodes(&quot;//section[@alias=&#39;&quot; + sectionAlias + &quot;&#39;]&quot;);
                if (found == null || found.Count &lt;= 0)
                {
                    XmlNode importedSection = dashboardFile.ImportNode(section, true);

                    XmlAttribute alias = XmlHelper.AddAttribute(dashboardFile, &quot;alias&quot;, sectionAlias);
                    importedSection.Attributes.Append(alias);

                    dashboardFile.DocumentElement.AppendChild(importedSection);

                    dashboardFile.Save(IOHelper.MapPath(dbConfig));
                }

                return true;
            }

			return false;
		}


		public string Alias()
		{
			return &quot;addDashboardSection&quot;;
		}

		public bool Undo(string packageName, XmlNode xmlData)
		{

			string sectionAlias = xmlData.Attributes[&quot;dashboardAlias&quot;].Value;
			string dbConfig = SystemFiles.DashboardConfig;
            XmlDocument dashboardFile = XmlHelper.OpenAsXmlDocument(dbConfig);

			XmlNode section = dashboardFile.SelectSingleNode(&quot;//section [@alias = &#39;&quot; + sectionAlias + &quot;&#39;]&quot;);

			if (section != null)
			{

				dashboardFile.SelectSingleNode(&quot;/dashBoard&quot;).RemoveChild(section);
				dashboardFile.Save(IOHelper.MapPath(dbConfig));
			}

			return true;
		}

		#endregion

		public XmlNode SampleXml()
		{
			throw new NotImplementedException();
		}

	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[41,3,41,4,0],[44,4,44,30,0],[45,4,45,5,0],[46,17,46,82,0],[47,17,47,63,0],[49,17,49,73,0],[50,17,50,83,0],[53,17,53,99,0],[54,17,54,55,0],[55,17,55,18,0],[56,21,56,87,0],[58,21,58,103,0],[59,21,59,62,0],[61,21,61,80,0],[63,21,63,68,0],[64,17,64,18,0],[66,17,66,29,0],[69,4,69,17,0],[70,3,70,4,0],[74,3,74,4,0],[75,4,75,33,0],[76,3,76,4,0],[79,3,79,4,0],[81,4,81,69,0],[82,4,82,50,0],[83,13,83,79,0],[85,4,85,100,0],[87,4,87,24,0],[88,4,88,5,0],[90,5,90,71,0],[91,5,91,52,0],[92,4,92,5,0],[94,4,94,16,0],[95,3,95,4,0],[100,3,100,4,0],[101,4,101,40,0]]);
    </script>
  </body>
</html>