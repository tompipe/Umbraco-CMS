<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.controls\DatePicker\DateTimePicker.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using ClientDependency.Core;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;

namespace umbraco.uicontrols.DatePicker
{

    [ClientDependency(ClientDependencyType.Css, &quot;DateTimePicker/datetimepicker.css&quot;, &quot;UmbracoClient&quot;)]
    [ClientDependency(ClientDependencyType.Javascript, &quot;ui/jquery.js&quot;, &quot;UmbracoClient&quot;)]
    [ClientDependency(ClientDependencyType.Javascript, &quot;MaskedInput/jquery.maskedinput-1.3.min.js&quot;, &quot;UmbracoClient&quot;)]
    [ClientDependency(ClientDependencyType.Javascript, &quot;ui/jqueryui.js&quot;, &quot;UmbracoClient&quot;)]
    [ClientDependency(ClientDependencyType.Javascript, &quot;DateTimePicker/timepicker.js&quot;, &quot;UmbracoClient&quot;)]
    [ClientDependency(ClientDependencyType.Javascript, &quot;DateTimePicker/umbDateTimePicker.js&quot;, &quot;UmbracoClient&quot;)]
    public class DateTimePicker : Control
    {
        /// &lt;summary&gt;
        /// Constructor, set defaults.
        /// &lt;/summary&gt;
        public DateTimePicker()
        {
            ShowTime = true;
            DateTime = DateTime.MinValue;
        }

        protected TextBox m_DateTextBox;
        protected HtmlGenericControl m_InfoDiv;
        protected HtmlAnchor m_ClearDate;

        public string Text
        {
            get
            {
                return m_DateTextBox.Text;
            }
        }

        public DateTime DateTime
        {
            get
            {
                EnsureChildControls();
                DateTime d = DateTime.MinValue;
                DateTime.TryParse(m_DateTextBox.Text, out d);
                return d;
            }
            set
            {
                EnsureChildControls();
                if (value == DateTime.MinValue)
                {
                    m_DateTextBox.Text = &quot;&quot;;
                }
                else
                {
                    m_DateTextBox.Text = value.ToString(ShowTime ? &quot;yyyy-MM-dd HH:mm&quot; : &quot;yyyy-MM-dd&quot;);
                }
            }
        }

        public bool ShowTime { get; set; }

        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);
            EnableViewState = false;
            EnsureChildControls();
        }

        protected override void CreateChildControls()
        {
            base.CreateChildControls();

            var div = new HtmlGenericControl(&quot;div&quot;);
            div.Attributes.Add(&quot;class&quot;, &quot;umbDateTimePicker&quot;);

            m_DateTextBox = new TextBox();
            div.Controls.Add(m_DateTextBox);

            m_InfoDiv = new HtmlGenericControl(&quot;div&quot;);
            m_InfoDiv.InnerText = ui.Text(&quot;noDate&quot;); ;
            div.Controls.Add(m_InfoDiv);

            m_ClearDate = new HtmlAnchor();
            m_ClearDate.InnerText = ui.Text(&quot;removeDate&quot;);
            div.Controls.Add(m_ClearDate);

            this.Controls.Add(div);
        }

        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);

            if (this.DateTime != DateTime.MinValue)
            {
                m_InfoDiv.Visible = false;
            }
            else
            {
                m_ClearDate.Visible = false;
            }


            string js = @&quot;
jQuery(document).ready(function() {  
    jQuery(&#39;#&quot; + m_DateTextBox.ClientID + @&quot;&#39;).umbDateTimePicker(&quot; 
               + this.ShowTime.ToString().ToLower() + &quot;,&#39;&quot; 
               + ui.Text(&quot;choose&quot;) + &quot; &quot; + ui.Text(&quot;date&quot;) + &quot;&#39;,&#39;&quot;
               + ui.Text(&quot;noDate&quot;) + &quot;&#39;,&#39;&quot;
               + ui.Text(&quot;removeDate&quot;) + &quot;&#39;);&quot;
               + &quot;jQuery(&#39;#&quot; + m_DateTextBox.ClientID + &quot;&#39;).mask(&#39;&quot;+ (this.ShowTime ? &quot;9999-99-99 99:99&quot; : &quot;9999-99-99&quot;)  +&quot;&#39;);&quot; 
               + &quot;});&quot;;
    
            try
            {
                if (ScriptManager.GetCurrent(Page).IsInAsyncPostBack)
                    ScriptManager.RegisterClientScriptBlock(this, this.GetType(), &quot;DateTime_&quot; + this.ClientID, js, true);
                else
                    Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;DateTime_&quot; + this.ClientID, js, true);
            }
            catch
            {
                Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;DateTime_&quot; + this.ClientID, js, true);
            }

        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,32,0],[22,9,22,10,0],[23,13,23,29,0],[24,13,24,42,0],[25,9,25,10,0],[34,13,34,14,0],[35,17,35,43,0],[36,13,36,14,0],[42,13,42,14,0],[43,17,43,39,0],[44,17,44,48,0],[45,17,45,62,0],[46,17,46,26,0],[47,13,47,14,0],[49,13,49,14,0],[50,17,50,39,0],[51,17,51,48,0],[52,17,52,18,0],[53,21,53,45,0],[54,17,54,18,0],[56,17,56,18,0],[57,21,57,103,0],[58,17,58,18,0],[59,13,59,14,0],[62,32,62,36,0],[62,37,62,41,0],[65,9,65,10,0],[66,13,66,28,0],[67,13,67,37,0],[68,13,68,35,0],[69,9,69,10,0],[72,9,72,10,0],[73,13,73,40,0],[75,13,75,53,0],[76,13,76,62,0],[78,13,78,43,0],[79,13,79,45,0],[81,13,81,55,0],[82,13,82,53,0],[82,54,82,55,0],[83,13,83,41,0],[85,13,85,44,0],[86,13,86,59,0],[87,13,87,43,0],[89,13,89,36,0],[90,9,90,10,0],[93,9,93,10,0],[94,13,94,33,0],[96,13,96,52,0],[97,13,97,14,0],[98,17,98,43,0],[99,13,99,14,0],[101,13,101,14,0],[102,17,102,45,0],[103,13,103,14,0],[106,13,114,24,0],[117,13,117,14,0],[118,17,118,70,0],[119,21,119,122,0],[121,21,121,116,0],[122,13,122,14,0],[123,13,123,18,0],[124,13,124,14,0],[125,17,125,112,0],[126,13,126,14,0],[128,9,128,10,0]]);
    </script>
  </body>
</html>