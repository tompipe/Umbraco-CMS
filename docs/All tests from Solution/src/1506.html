<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Services\DomainService.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Umbraco.Core.Events;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Persistence;
using Umbraco.Core.Persistence.Querying;
using Umbraco.Core.Persistence.UnitOfWork;

namespace Umbraco.Core.Services
{
    public class DomainService : RepositoryService, IDomainService
    {
        public DomainService(IDatabaseUnitOfWorkProvider provider, RepositoryFactory repositoryFactory, ILogger logger, IEventMessagesFactory eventMessagesFactory)
            : base(provider, repositoryFactory, logger, eventMessagesFactory)
        {
        }

        public bool Exists(string domainName)
        {
            var uow = UowProvider.GetUnitOfWork();
            using (var repo = RepositoryFactory.CreateDomainRepository(uow))
            {
                return repo.Exists(domainName);
            } 
        }

        public Attempt&lt;OperationStatus&gt; Delete(IDomain domain)
        {
            var evtMsgs = EventMessagesFactory.Get();
            if (Deleting.IsRaisedEventCancelled(
                   new DeleteEventArgs&lt;IDomain&gt;(domain, evtMsgs),
                   this))
            {
                return OperationStatus.Cancelled(evtMsgs);
            }

            var uow = UowProvider.GetUnitOfWork();
            using (var repository = RepositoryFactory.CreateDomainRepository(uow))
            {
                repository.Delete(domain);
                uow.Commit();               
            }

            var args = new DeleteEventArgs&lt;IDomain&gt;(domain, false, evtMsgs);
            Deleted.RaiseEvent(args, this);
            return OperationStatus.Success(evtMsgs);
        }

        public IDomain GetByName(string name)
        {
            var uow = UowProvider.GetUnitOfWork();
            using (var repository = RepositoryFactory.CreateDomainRepository(uow))
            {
                return repository.GetByName(name);
            }
        }

        public IDomain GetById(int id)
        {
            var uow = UowProvider.GetUnitOfWork();
            using (var repo = RepositoryFactory.CreateDomainRepository(uow))
            {
                return repo.Get(id);
            }
        }

        public IEnumerable&lt;IDomain&gt; GetAll(bool includeWildcards)
        {
            var uow = UowProvider.GetUnitOfWork();
            using (var repo = RepositoryFactory.CreateDomainRepository(uow))
            {
                return repo.GetAll(includeWildcards);
            }
        }

        public IEnumerable&lt;IDomain&gt; GetAssignedDomains(int contentId, bool includeWildcards)
        {
            var uow = UowProvider.GetUnitOfWork();
            using (var repo = RepositoryFactory.CreateDomainRepository(uow))
            {
                return repo.GetAssignedDomains(contentId, includeWildcards);
            }
        }

        public Attempt&lt;OperationStatus&gt; Save(IDomain domainEntity)
        {
            var evtMsgs = EventMessagesFactory.Get();
            if (Saving.IsRaisedEventCancelled(
                    new SaveEventArgs&lt;IDomain&gt;(domainEntity, evtMsgs),
                    this))
            {
                return OperationStatus.Cancelled(evtMsgs);
            }

            var uow = UowProvider.GetUnitOfWork();
            using (var repository = RepositoryFactory.CreateDomainRepository(uow))
            {
                repository.AddOrUpdate(domainEntity);
                uow.Commit();
            }

            Saved.RaiseEvent(new SaveEventArgs&lt;IDomain&gt;(domainEntity, false, evtMsgs), this);
            return OperationStatus.Success(evtMsgs);
        }

        #region Event Handlers
        /// &lt;summary&gt;
        /// Occurs before Delete
        /// &lt;/summary&gt;		
        public static event TypedEventHandler&lt;IDomainService, DeleteEventArgs&lt;IDomain&gt;&gt; Deleting;

        /// &lt;summary&gt;
        /// Occurs after Delete
        /// &lt;/summary&gt;
        public static event TypedEventHandler&lt;IDomainService, DeleteEventArgs&lt;IDomain&gt;&gt; Deleted;
      
        /// &lt;summary&gt;
        /// Occurs before Save
        /// &lt;/summary&gt;
        public static event TypedEventHandler&lt;IDomainService, SaveEventArgs&lt;IDomain&gt;&gt; Saving;

        /// &lt;summary&gt;
        /// Occurs after Save
        /// &lt;/summary&gt;
        public static event TypedEventHandler&lt;IDomainService, SaveEventArgs&lt;IDomain&gt;&gt; Saved;

      
        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,15,16,78,1],[17,9,17,10,1],[18,9,18,10,1],[21,9,21,10,0],[22,13,22,51,0],[23,20,23,76,0],[24,13,24,14,0],[25,17,25,48,0],[27,9,27,10,0],[30,9,30,10,0],[31,13,31,54,0],[32,13,34,26,0],[35,13,35,14,0],[36,17,36,59,0],[39,13,39,51,0],[40,20,40,82,0],[41,13,41,14,0],[42,17,42,43,0],[43,17,43,30,0],[44,13,44,14,0],[46,13,46,77,0],[47,13,47,44,0],[48,13,48,53,0],[49,9,49,10,0],[52,9,52,10,0],[53,13,53,51,0],[54,20,54,82,0],[55,13,55,14,0],[56,17,56,51,0],[58,9,58,10,0],[61,9,61,10,0],[62,13,62,51,0],[63,20,63,76,0],[64,13,64,14,0],[65,17,65,37,0],[67,9,67,10,0],[70,9,70,10,1],[71,13,71,51,1],[72,20,72,76,1],[73,13,73,14,1],[74,17,74,54,1],[76,9,76,10,1],[79,9,79,10,1],[80,13,80,51,1],[81,20,81,76,1],[82,13,82,14,1],[83,17,83,77,1],[85,9,85,10,1],[88,9,88,10,1],[89,13,89,54,1],[90,13,92,27,1],[93,13,93,14,0],[94,17,94,59,0],[97,13,97,51,1],[98,20,98,82,1],[99,13,99,14,1],[100,17,100,54,1],[101,17,101,30,1],[102,13,102,14,1],[104,13,104,94,1],[105,13,105,53,1],[106,9,106,10,1]]);
    </script>
  </body>
</html>