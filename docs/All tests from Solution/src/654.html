<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Trees\LegacyTree.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Text;
using System.Web;
using System.Xml;
using System.Configuration;
using umbraco.BasePages;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.cache;
using umbraco.cms.businesslogic.contentitem;
using umbraco.cms.businesslogic.datatype;
using umbraco.cms.businesslogic.language;
using umbraco.cms.businesslogic.media;
using umbraco.cms.businesslogic.member;
using umbraco.cms.businesslogic.property;
using umbraco.cms.businesslogic.web;
using umbraco.interfaces;
using umbraco.DataLayer;
using umbraco.BusinessLogic.Utils;

namespace umbraco.cms.presentation.Trees
{

	/// &lt;summary&gt;
	/// A simple wrapper for an ITree that doesn&#39;t extend BaseTree. This is used for backwards compatibility with versions previous to 5.
	/// &lt;/summary&gt;
	public class LegacyTree : BaseTree
	{

        public LegacyTree(ITree tree, string application, XmlTreeNode rootNode)
            : base(application)
        {
            _tree = tree;
            _rootNode = rootNode;

            //we need to re-initialize the class now that we have a root node
            Initialize();
        }

		private ITree _tree;
        private XmlTreeNode _rootNode;

        public void SetRootNode(XmlTreeNode rootNode)
        {
            _rootNode = rootNode;
        }

        protected override void CreateRootNode(ref XmlTreeNode rootNode)
        {
            //if the _rootNode is not defined yet, just return an empty one
            if (_rootNode == null)
            {
                NullTree nullTree = new NullTree(this.app);
                _rootNode = XmlTreeNode.CreateRoot(nullTree);
            }                

            rootNode.Menu = _rootNode.Menu;
            rootNode.Text = _rootNode.Text;
            rootNode.Action = _rootNode.Action;
            rootNode.Source = _rootNode.Source;
            rootNode.Icon = _rootNode.Icon;
            rootNode.OpenIcon = _rootNode.OpenIcon;
            rootNode.NodeType = _rootNode.NodeType;
            rootNode.NodeID = _rootNode.NodeID;
        }

        /// &lt;summary&gt;
        /// This will call the normal Render method by passing the converted XmlTree to an XmlDocument.
        /// This is used only for backwards compatibility of converting normal ITrees to BasicTree&#39;s
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tree&quot;&gt;&lt;/param&gt;
        public override void Render(ref XmlTree tree)
        {
            XmlDocument xDoc = new XmlDocument();
            xDoc.LoadXml(tree.ToString(SerializedTreeType.XmlTree));
            Render(ref xDoc);
            tree = SerializableData.Deserialize(xDoc.OuterXml, typeof(XmlTree)) as XmlTree;
			
            foreach (XmlTreeNode node in tree)
            {
                //ensure that the tree type is set for each node
                node.TreeType = this.TreeAlias;
            }
        }

		public override void Render(ref System.Xml.XmlDocument Tree)
		{
            _tree.app = this.m_app;
            _tree.id = this.m_id;
			_tree.Render(ref Tree);
		}

		public override void RenderJS(ref System.Text.StringBuilder Javascript)
		{
            _tree.app = this.m_app;
            _tree.id = this.m_id;
			_tree.RenderJS(ref Javascript);
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[35,15,35,32,0],[36,9,36,10,0],[37,13,37,26,0],[38,13,38,34,0],[41,13,41,26,0],[42,9,42,10,0],[48,9,48,10,0],[49,13,49,34,0],[50,9,50,10,0],[53,9,53,10,0],[55,13,55,35,0],[56,13,56,14,0],[57,17,57,60,0],[58,17,58,62,0],[59,13,59,14,0],[61,13,61,44,0],[62,13,62,44,0],[63,13,63,48,0],[64,13,64,48,0],[65,13,65,44,0],[66,13,66,52,0],[67,13,67,52,0],[68,13,68,48,0],[69,9,69,10,0],[77,9,77,10,0],[78,13,78,50,0],[79,13,79,69,0],[80,13,80,30,0],[81,13,81,92,0],[83,13,83,20,0],[83,22,83,38,0],[83,39,83,41,0],[83,42,83,46,0],[84,13,84,14,0],[86,17,86,48,0],[87,13,87,14,0],[88,9,88,10,0],[91,3,91,4,0],[92,13,92,36,0],[93,13,93,34,0],[94,4,94,27,0],[95,3,95,4,0],[98,3,98,4,0],[99,13,99,36,0],[100,13,100,34,0],[101,4,101,35,0],[102,3,102,4,0]]);
    </script>
  </body>
</html>