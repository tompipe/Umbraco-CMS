<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.providers\members\UmbracoProfileProvider.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
#region namespace
using System;
using System.Collections.Generic;
using System.Text;
using System.Web.Security;
using System.Configuration;
using umbraco.BusinessLogic;
using System.Security.Cryptography;
using System.Web.Util;
using System.Collections.Specialized;
using System.Configuration.Provider;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.member;
using System.Collections;
using System.Web.Profile;
#endregion

namespace umbraco.providers.members
{
    public class UmbracoProfileProvider : ProfileProvider
    {

        private string _applicationName = &quot;&quot;;

        public override string ApplicationName
        {
            get
            {
                return _applicationName;
            }
            set
            {
                _applicationName = value;
            }
        }
        public override string Description
        {
            get
            {
                return &quot;Profile Provider for umbraco member profile data&quot;;
            }
        }
        public override string Name
        {
            get
            {
                return base.Name;
            }
        }
        public override void Initialize(string name, NameValueCollection config)
        {

            if (config == null)
                throw new ArgumentNullException(&quot;Null configuration parameters&quot;);

            if (String.IsNullOrEmpty(name))
                name = &quot;UmbracoProfileProvider&quot;;

            base.Initialize(name, config);

            _applicationName = config[&quot;applicationName&quot;];
            if (String.IsNullOrEmpty(_applicationName))
                _applicationName = System.Web.Hosting.HostingEnvironment.ApplicationVirtualPath;
            config.Remove(&quot;applicationName&quot;);

            // if the config element contains unused parameters we should throw an exception
            if (config.Count &gt; 0)
            {
                var attrib = config.GetKey(0);
                if (string.IsNullOrEmpty(attrib) == false)
                {
                    throw new ProviderException(String.Format(&quot;Unrecognized attribute: {0}&quot;, attrib));
                }

            }


        }

        public override int DeleteInactiveProfiles(ProfileAuthenticationOption authenticationOption, DateTime userInactiveSinceDate)
        {
            throw new NotSupportedException();
        }

        public override int DeleteProfiles(string[] usernames)
        {
            throw new NotSupportedException();
        }

        public override int DeleteProfiles(ProfileInfoCollection profiles)
        {
            throw new NotSupportedException();
        }

        public override ProfileInfoCollection FindInactiveProfilesByUserName(ProfileAuthenticationOption authenticationOption, string usernameToMatch, DateTime userInactiveSinceDate, int pageIndex, int pageSize, out int totalRecords)
        {
            throw new NotSupportedException();
        }

        public override ProfileInfoCollection FindProfilesByUserName(ProfileAuthenticationOption authenticationOption, string usernameToMatch, int pageIndex, int pageSize, out int totalRecords)
        {
            throw new NotSupportedException();
        }

        public override ProfileInfoCollection GetAllInactiveProfiles(ProfileAuthenticationOption authenticationOption, DateTime userInactiveSinceDate, int pageIndex, int pageSize, out int totalRecords)
        {
            throw new NotSupportedException();
        }
        public override ProfileInfoCollection GetAllProfiles(ProfileAuthenticationOption authenticationOption, int pageIndex, int pageSize, out int totalRecords)
        {
            throw new NotSupportedException();
        }
        public override int GetNumberOfInactiveProfiles(ProfileAuthenticationOption authenticationOption, DateTime userInactiveSinceDate)
        {
            throw new NotSupportedException();
        }
        /// &lt;summary&gt;
        /// Returns the collection of settings property values for the current umbraco member.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;context&quot;&gt;A &lt;see cref=&quot;T:System.Configuration.SettingsContext&quot;/&gt; describing the current application use.&lt;/param&gt;
        /// &lt;param name=&quot;collection&quot;&gt;A &lt;see cref=&quot;T:System.Configuration.SettingsPropertyCollection&quot;/&gt; containing the settings property group whose values are to be retrieved.&lt;/param&gt;
        /// &lt;returns&gt;
        /// A &lt;see cref=&quot;T:System.Configuration.SettingsPropertyValueCollection&quot;/&gt; containing the values for the specified settings property group.
        /// &lt;/returns&gt;
        public override SettingsPropertyValueCollection GetPropertyValues(SettingsContext context, SettingsPropertyCollection collection)
        {
            var settings = new SettingsPropertyValueCollection();

            if (collection.Count == 0)
                return settings;

            foreach (SettingsProperty property in collection)
            {
                var pv = new SettingsPropertyValue(property);
                settings.Add(pv);
            }

            // get the current user
            var username = (string)context[&quot;UserName&quot;];
            var m = Member.GetMemberFromLoginName(username);
            if (m == null)
                throw new ProviderException(String.Format(&quot;No member with username &#39;{0}&#39; exists&quot;, username));

            foreach (SettingsPropertyValue spv in settings)
            {
                if (m.getProperty(spv.Name) != null)
                {
                    spv.Deserialized = true;
                    spv.PropertyValue = m.getProperty(spv.Name).Value;
                }
            }

            return settings;

        }

        /// &lt;summary&gt;
        /// Sets the values of the specified group of property settings for the current umbraco member.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;context&quot;&gt;A &lt;see cref=&quot;T:System.Configuration.SettingsContext&quot;/&gt; describing the current application usage.&lt;/param&gt;
        /// &lt;param name=&quot;collection&quot;&gt;A &lt;see cref=&quot;T:System.Configuration.SettingsPropertyValueCollection&quot;/&gt; representing the group of property settings to set.&lt;/param&gt;
        public override void SetPropertyValues(SettingsContext context, SettingsPropertyValueCollection collection)
        {

            var username = (string)context[&quot;UserName&quot;];
            var authenticated = (bool)context[&quot;IsAuthenticated&quot;];

            if (string.IsNullOrEmpty(username) || collection.Count == 0)
                return;

            var m = Member.GetMemberFromLoginName(username);
            if (m == null)
                throw new ProviderException(String.Format(&quot;No member with username &#39;{0}&#39; exists&quot;, username));


            foreach (SettingsPropertyValue spv in collection)
            {
                if (authenticated == false &amp;&amp; (bool)spv.Property.Attributes[&quot;AllowAnonymous&quot;] == false)
                    continue;

                if (m.getProperty(spv.Name) != null)
                    m.getProperty(spv.Name).Value = spv.PropertyValue;
            }
            m.Save();
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,46,0],[28,13,28,14,0],[29,17,29,41,0],[30,13,30,14,0],[32,13,32,14,0],[33,17,33,42,0],[34,13,34,14,0],[39,13,39,14,0],[40,17,40,75,0],[41,13,41,14,0],[46,13,46,14,0],[47,17,47,34,0],[48,13,48,14,0],[51,9,51,10,0],[53,13,53,32,0],[54,17,54,82,0],[56,13,56,44,0],[57,17,57,49,0],[59,13,59,43,0],[61,13,61,58,0],[62,13,62,56,0],[63,17,63,97,0],[64,13,64,46,0],[67,13,67,34,0],[68,13,68,14,0],[69,17,69,47,0],[70,17,70,59,0],[71,17,71,18,0],[72,21,72,103,0],[75,13,75,14,0],[78,9,78,10,0],[81,9,81,10,0],[82,13,82,47,0],[86,9,86,10,0],[87,13,87,47,0],[91,9,91,10,0],[92,13,92,47,0],[96,9,96,10,0],[97,13,97,47,0],[101,9,101,10,0],[102,13,102,47,0],[106,9,106,10,0],[107,13,107,47,0],[110,9,110,10,0],[111,13,111,47,0],[114,9,114,10,0],[115,13,115,47,0],[126,9,126,10,0],[127,13,127,66,0],[129,13,129,39,0],[130,17,130,33,0],[132,13,132,20,0],[132,22,132,47,0],[132,48,132,50,0],[132,51,132,61,0],[133,13,133,14,0],[134,17,134,62,0],[135,17,135,34,0],[136,13,136,14,0],[139,13,139,56,0],[140,13,140,61,0],[141,13,141,27,0],[142,17,142,110,0],[144,13,144,20,0],[144,22,144,47,0],[144,48,144,50,0],[144,51,144,59,0],[145,13,145,14,0],[146,17,146,53,0],[147,17,147,18,0],[148,21,148,45,0],[149,21,149,71,0],[150,17,150,18,0],[151,13,151,14,0],[153,13,153,29,0],[155,9,155,10,0],[163,9,163,10,0],[165,13,165,56,0],[166,13,166,66,0],[168,13,168,73,0],[169,17,169,24,0],[171,13,171,61,0],[172,13,172,27,0],[173,17,173,110,0],[176,13,176,20,0],[176,22,176,47,0],[176,48,176,50,0],[176,51,176,61,0],[177,13,177,14,0],[178,17,178,104,0],[179,21,179,30,0],[181,17,181,53,0],[182,21,182,71,0],[183,13,183,14,0],[184,13,184,22,0],[185,9,185,10,0]]);
    </script>
  </body>
</html>