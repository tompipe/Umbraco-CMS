<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\dialogs\AssignDomain2.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Text;
using System.Linq;
using umbraco.BusinessLogic.Actions;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Web.UI.Pages;
using Umbraco.Web;
using Umbraco.Web.Routing;
using Umbraco.Web.WebServices;


namespace umbraco.dialogs
{
    public partial class AssignDomain2 : UmbracoEnsuredPage
    {
        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            var nodeId = GetNodeId();
            var node = Services.ContentService.GetById(nodeId);

            if (node == null)
            {
                feedback.Text = ui.Text(&quot;assignDomain&quot;, &quot;invalidNode&quot;);
                pane_language.Visible = false;
                pane_domains.Visible = false;
                p_buttons.Visible = false;
                return;
            }

            if (UmbracoUser.GetPermissions(node.Path).Contains(ActionAssignDomain.Instance.Letter) == false)
            {
                feedback.Text = ui.Text(&quot;assignDomain&quot;, &quot;permissionDenied&quot;);
                pane_language.Visible = false;
                pane_domains.Visible = false;
                p_buttons.Visible = false;
                return;
            }

            pane_language.Title = ui.Text(&quot;assignDomain&quot;, &quot;setLanguage&quot;);
            pane_domains.Title = ui.Text(&quot;assignDomain&quot;, &quot;setDomains&quot;);
            prop_language.Text = ui.Text(&quot;assignDomain&quot;, &quot;language&quot;);

            var nodeDomains = Services.DomainService.GetAssignedDomains(nodeId, true).ToArray();
            var wildcard = nodeDomains.FirstOrDefault(d =&gt; d.IsWildcard);

            var sb = new StringBuilder();
            sb.Append(&quot;languages: [&quot;);
            var i = 0;
            foreach (var language in ApplicationContext.Current.Services.LocalizationService.GetAllLanguages())
                sb.AppendFormat(&quot;{0}{{ \&quot;Id\&quot;: {1}, \&quot;Code\&quot;: \&quot;{2}\&quot; }}&quot;, (i++ == 0 ? &quot;&quot; : &quot;,&quot;), language.Id, language.IsoCode);
            sb.Append(&quot;]\r\n&quot;);

            sb.AppendFormat(&quot;,language: {0}&quot;, wildcard == null ? &quot;undefined&quot; : wildcard.LanguageId.ToString());

            sb.Append(&quot;,domains: [&quot;);
            i = 0;
            foreach (var domain in nodeDomains.Where(d =&gt; d.IsWildcard == false))
                sb.AppendFormat(&quot;{0}{{ \&quot;Name\&quot;: \&quot;{1}\&quot;, \&quot;Lang\&quot;: \&quot;{2}\&quot; }}&quot;, (i++ == 0 ? &quot;&quot; :&quot;,&quot;), domain.DomainName, domain.LanguageId);
            sb.Append(&quot;]\r\n&quot;);

            data.Text = sb.ToString();
        }

        protected int GetNodeId()
        {
            int nodeId;
            if (int.TryParse(Request.QueryString[&quot;id&quot;], out nodeId) == false)
                nodeId = -1;
            return nodeId;
        }

        protected string GetRestServicePath()
        {
            const string action = &quot;ListDomains&quot;;
            var path = Url.GetUmbracoApiService&lt;DomainsApiController&gt;(action);
            return path.TrimEnd(action).EnsureEndsWith(&#39;/&#39;);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,10,0],[20,13,20,28,0],[22,13,22,38,0],[23,13,23,64,0],[25,13,25,30,0],[26,13,26,14,0],[27,17,27,72,0],[28,17,28,47,0],[29,17,29,46,0],[30,17,30,43,0],[31,17,31,24,0],[34,13,34,109,0],[35,13,35,14,0],[36,17,36,77,0],[37,17,37,47,0],[38,17,38,46,0],[39,17,39,43,0],[40,17,40,24,0],[43,13,43,74,0],[44,13,44,72,0],[45,13,45,70,0],[47,13,47,97,0],[48,13,48,60,0],[48,60,48,72,0],[48,72,48,74,0],[48,13,48,74,0],[50,13,50,42,0],[51,13,51,39,0],[52,13,52,23,0],[53,13,53,20,0],[53,22,53,34,0],[53,35,53,37,0],[53,38,53,111,0],[54,17,54,130,0],[55,13,55,32,0],[57,13,57,112,0],[59,13,59,38,0],[60,13,60,19,0],[61,13,61,20,0],[61,22,61,32,0],[61,33,61,35,0],[61,36,61,59,0],[61,59,61,80,0],[61,80,61,81,0],[61,36,61,81,0],[62,17,62,142,0],[63,13,63,32,0],[65,13,65,39,0],[66,9,66,10,0],[69,9,69,10,0],[71,13,71,78,0],[72,17,72,29,0],[73,13,73,27,0],[74,9,74,10,0],[77,9,77,10,0],[79,13,79,79,0],[80,13,80,61,0],[81,9,81,10,0]]);
    </script>
  </body>
</html>