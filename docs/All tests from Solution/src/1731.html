<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Repositories\UserTypeRepository.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Umbraco.Core.Logging;
using Umbraco.Core.Models.Membership;
using Umbraco.Core.Models.Rdbms;

using Umbraco.Core.Persistence.Factories;
using Umbraco.Core.Persistence.Querying;
using Umbraco.Core.Persistence.SqlSyntax;
using Umbraco.Core.Persistence.UnitOfWork;

namespace Umbraco.Core.Persistence.Repositories
{
    /// &lt;summary&gt;
    /// Represents the UserTypeRepository for doing CRUD operations for &lt;see cref=&quot;IUserType&quot;/&gt;
    /// &lt;/summary&gt;
    internal class UserTypeRepository : PetaPocoRepositoryBase&lt;int, IUserType&gt;, IUserTypeRepository
    {
        public UserTypeRepository(IDatabaseUnitOfWork work, CacheHelper cache, ILogger logger, ISqlSyntaxProvider sqlSyntax)
            : base(work, cache, logger, sqlSyntax)
        {
        }

        #region Overrides of RepositoryBase&lt;int,IUserType&gt;

        protected override IUserType PerformGet(int id)
        {
            return GetAll(new[] {id}).FirstOrDefault();
        }

        protected override IEnumerable&lt;IUserType&gt; PerformGetAll(params int[] ids)
        {
            var userTypeFactory = new UserTypeFactory();

            var sql = GetBaseQuery(false);
            
            if (ids.Any())
            {
                sql.Where(&quot;umbracoUserType.id in (@ids)&quot;, new { ids = ids });
            }
            else
            {
                sql.Where&lt;UserTypeDto&gt;(x =&gt; x.Id &gt;= 0);
            }

            var dtos = Database.Fetch&lt;UserTypeDto&gt;(sql);
            return dtos.Select(userTypeFactory.BuildEntity).ToArray();
        }

        protected override IEnumerable&lt;IUserType&gt; PerformGetByQuery(IQuery&lt;IUserType&gt; query)
        {
            var userTypeFactory = new UserTypeFactory();
            var sqlClause = GetBaseQuery(false);
            var translator = new SqlTranslator&lt;IUserType&gt;(sqlClause, query);
            var sql = translator.Translate();

            var dtos = Database.Fetch&lt;UserTypeDto&gt;(sql);

            return dtos.Select(userTypeFactory.BuildEntity).ToArray();
        }

        #endregion

        #region Overrides of PetaPocoRepositoryBase&lt;int,IUserType&gt;

        protected override Sql GetBaseQuery(bool isCount)
        {
            var sql = new Sql();
            sql.Select(isCount ? &quot;COUNT(*)&quot; : &quot;*&quot;)
                .From&lt;UserTypeDto&gt;();
            return sql;
        }

        protected override string GetBaseWhereClause()
        {
            return &quot;umbracoUserType.id = @Id&quot;;
        }

        protected override IEnumerable&lt;string&gt; GetDeleteClauses()
        {
            var list = new List&lt;string&gt;
                           {
                               &quot;DELETE FROM umbracoUser WHERE userType = @Id&quot;,
                               &quot;DELETE FROM umbracoUserType WHERE id = @Id&quot;
                           };
            return list;
        }

        protected override Guid NodeObjectTypeId
        {
            get { throw new NotImplementedException(); }
        }

        protected override void PersistNewItem(IUserType entity)
        {
            var userTypeFactory = new UserTypeFactory();
            var userTypeDto = userTypeFactory.BuildDto(entity);

            var id = Convert.ToInt32(Database.Insert(userTypeDto));
            entity.Id = id;
        }

        protected override void PersistUpdatedItem(IUserType entity)
        {
            var userTypeFactory = new UserTypeFactory();
            var userTypeDto = userTypeFactory.BuildDto(entity);

            Database.Update(userTypeDto);
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,15,21,51,1],[22,9,22,10,1],[23,9,23,10,1],[28,9,28,10,1],[29,13,29,56,1],[30,9,30,10,1],[33,9,33,10,1],[34,13,34,57,1],[36,13,36,43,1],[38,13,38,27,1],[39,13,39,14,1],[40,17,40,78,1],[41,13,41,14,1],[43,13,43,14,1],[44,17,44,56,1],[45,13,45,14,1],[47,13,47,57,1],[48,13,48,71,1],[49,9,49,10,1],[52,9,52,10,1],[53,13,53,57,1],[54,13,54,49,1],[55,13,55,77,1],[56,13,56,46,1],[58,13,58,57,1],[60,13,60,71,1],[61,9,61,10,1],[68,9,68,10,1],[69,13,69,33,1],[70,13,71,38,1],[72,13,72,24,1],[73,9,73,10,1],[76,9,76,10,1],[77,13,77,47,1],[78,9,78,10,1],[81,9,81,10,1],[82,13,86,30,1],[87,13,87,25,1],[88,9,88,10,1],[92,17,92,18,0],[92,19,92,55,0],[96,9,96,10,1],[97,13,97,57,1],[98,13,98,64,1],[100,13,100,68,1],[101,13,101,28,1],[102,9,102,10,1],[105,9,105,10,1],[106,13,106,57,1],[107,13,107,64,1],[109,13,109,42,1],[110,9,110,10,1]]);
    </script>
  </body>
</html>