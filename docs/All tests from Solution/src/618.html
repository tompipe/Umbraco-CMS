<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Help.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Xml;

namespace umbraco.presentation.umbraco
{
    public class Help
    {
        public string DefaultURL { get; set; }
        public List&lt;HelpConfigPage&gt; HelpConfigPages { get; set; }

        public Help(XmlNode helpConfigNode)
        {
            DefaultURL = GetXmlAttributeAsString(helpConfigNode.Attributes[&quot;defaultUrl&quot;]);

            HelpConfigPages = new List&lt;HelpConfigPage&gt;();

            foreach (XmlNode linkNode in helpConfigNode.SelectNodes(&quot;link&quot;))
            {

                HelpConfigPages.Add(new HelpConfigPage
                    {
                        Application = GetXmlAttributeAsString(linkNode.Attributes[&quot;application&quot;]),
                        ApplicationUrl = GetXmlAttributeAsString(linkNode.Attributes[&quot;applicationUrl&quot;]),
                        Language = GetXmlAttributeAsString(linkNode.Attributes[&quot;language&quot;]),
                        UserType = GetXmlAttributeAsString(linkNode.Attributes[&quot;userType&quot;]),
                        HelpUrl = GetXmlAttributeAsString(linkNode.Attributes[&quot;helpUrl&quot;])
                    });
            }
        }

        public string ResolveHelpUrl(HelpPage requestedHelpPage)
        {
            HelpConfigPage bestMatchingConfigPage = null;

            int currentBestMatchCount = 0;

            foreach (HelpConfigPage helpConfigPage in HelpConfigPages)
            {
                int attributeMatchCount = 0;
                
                if ((helpConfigPage.Application != &quot;&quot; &amp;&amp; String.Compare(helpConfigPage.Application, requestedHelpPage.Application, true) != 0) ||
                    (helpConfigPage.ApplicationUrl != &quot;&quot; &amp;&amp; String.Compare(helpConfigPage.ApplicationUrl, requestedHelpPage.ApplicationUrl, true) != 0) ||
                    (helpConfigPage.Language != &quot;&quot; &amp;&amp; String.Compare(helpConfigPage.Language, requestedHelpPage.Language, true) != 0) ||
                    (helpConfigPage.UserType != &quot;&quot; &amp;&amp; String.Compare(helpConfigPage.UserType, requestedHelpPage.UserType, true) != 0))
                {
                    continue;
                }

                if (String.Compare(helpConfigPage.Application, requestedHelpPage.Application, true) == 0) attributeMatchCount++;
                if (String.Compare(helpConfigPage.ApplicationUrl, requestedHelpPage.ApplicationUrl, true) == 0) attributeMatchCount++;
                if (String.Compare(helpConfigPage.Language, requestedHelpPage.Language, true) == 0) attributeMatchCount++;
                if (String.Compare(helpConfigPage.UserType, requestedHelpPage.UserType, true) == 0) attributeMatchCount++;

                if (attributeMatchCount &gt; currentBestMatchCount)
                {
                    currentBestMatchCount = attributeMatchCount;
                    bestMatchingConfigPage = helpConfigPage;
                }
            }
            return bestMatchingConfigPage == null ? GenerateDefaultUrl(requestedHelpPage) : GenerateConfiguredUrl(bestMatchingConfigPage);
        }

        public string GenerateConfiguredUrl(HelpConfigPage helpConfigPage)
        {
            return String.Format(helpConfigPage.HelpUrl,
                                 helpConfigPage.Application,
                                 helpConfigPage.ApplicationUrl,
                                 helpConfigPage.Language,
                                 helpConfigPage.UserType).ToLower();
        }

        public string GenerateDefaultUrl(HelpPage helpPage)
        {
            return string.Format(DefaultURL,
                                 helpPage.Application,
                                 helpPage.ApplicationUrl);
        }

        private string GetXmlAttributeAsString(XmlAttribute attribute) {

            if (attribute == null) return &quot;&quot;;

            return attribute.Value.Trim();

        }
    }

    public class HelpPage
    {
        public string Application { get; set; }
        public string ApplicationUrl { get; set; }
        public string Language { get; set; }
        public string UserType { get; set; }
    }

    public class HelpConfigPage : HelpPage
    {
        public string HelpUrl { get; set; }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[9,36,9,40,0],[9,41,9,45,0],[10,55,10,59,0],[10,60,10,64,0],[12,9,12,44,0],[13,9,13,10,0],[14,13,14,91,0],[16,13,16,58,0],[18,13,18,20,0],[18,22,18,38,0],[18,39,18,41,0],[18,42,18,76,0],[19,13,19,14,0],[21,17,28,24,0],[29,13,29,14,0],[30,9,30,10,0],[33,9,33,10,0],[34,13,34,58,0],[36,13,36,43,0],[38,13,38,20,0],[38,22,38,51,0],[38,52,38,54,0],[38,55,38,70,0],[39,13,39,14,0],[40,17,40,45,0],[42,17,45,135,0],[46,17,46,18,0],[47,21,47,30,0],[50,17,50,106,0],[50,107,50,129,0],[51,17,51,112,0],[51,113,51,135,0],[52,17,52,100,0],[52,101,52,123,0],[53,17,53,100,0],[53,101,53,123,0],[55,17,55,65,0],[56,17,56,18,0],[57,21,57,65,0],[58,21,58,61,0],[59,17,59,18,0],[60,13,60,14,0],[61,13,61,139,0],[62,9,62,10,0],[65,9,65,10,0],[66,13,70,69,0],[71,9,71,10,0],[74,9,74,10,0],[75,13,77,59,0],[78,9,78,10,0],[80,72,80,73,0],[82,13,82,35,0],[82,36,82,46,0],[84,13,84,43,0],[86,9,86,10,0],[91,37,91,41,0],[91,42,91,46,0],[92,40,92,44,0],[92,45,92,49,0],[93,34,93,38,0],[93,39,93,43,0],[94,34,94,38,0],[94,39,94,43,0],[99,33,99,37,0],[99,38,99,42,0]]);
    </script>
  </body>
</html>