<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Macros\MacroFieldEditorsResolver.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Linq;
using Umbraco.Core.Logging;
using Umbraco.Core.ObjectResolution;
using umbraco.interfaces;

namespace Umbraco.Core.Macros
{
	/// &lt;summary&gt;
	/// A resolver to return all IMacroGuiRendering objects
	/// &lt;/summary&gt;
	/// &lt;remarks&gt;
	/// Much of this classes methods are based on legacy code from umbraco.editorControls.macrocontainer.MacroControlFactory
	/// this code should probably be reviewed and cleaned up if necessary.
	/// &lt;/remarks&gt;
	internal sealed class MacroFieldEditorsResolver : LazyManyObjectsResolverBase&lt;MacroFieldEditorsResolver, IMacroGuiRendering&gt;
	{
	    /// &lt;summary&gt;
	    /// Constructor
	    /// &lt;/summary&gt;
	    /// &lt;param name=&quot;serviceProvider&quot;&gt;&lt;/param&gt;
	    /// &lt;param name=&quot;logger&quot;&gt;&lt;/param&gt;
	    /// &lt;param name=&quot;macroEditors&quot;&gt;&lt;/param&gt;		
	    internal MacroFieldEditorsResolver(IServiceProvider serviceProvider, ILogger logger, Func&lt;IEnumerable&lt;Type&gt;&gt; macroEditors)
            : base(serviceProvider, logger, macroEditors, ObjectLifetimeScope.Transient)
		{ }

		/// &lt;summary&gt;
		/// Gets the &lt;see cref=&quot;IMacroGuiRendering&quot;/&gt; implementations.
		/// &lt;/summary&gt;
		public IEnumerable&lt;IMacroGuiRendering&gt; MacroFieldEditors
		{
			get
			{
				return Values;
			}
		}

		/// &lt;summary&gt;
		/// Gets the value based on the type of control
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;macroControl&quot;&gt;&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		/// &lt;remarks&gt;
		/// This is legacy code migrated from umbraco.editorControls.macrocontainer.MacroControlFactory
		/// &lt;/remarks&gt;
		internal string GetValueFromMacroControl(Control macroControl)
		{
            return HttpUtility.HtmlDecode(((IMacroGuiRendering)macroControl).Value);
		}

		/// &lt;remarks&gt;
		/// This is legacy code migrated from umbraco.editorControls.macrocontainer.MacroControlFactory
		/// &lt;/remarks&gt;
		internal List&lt;Type&gt; MacroControlTypes
		{
			get { return InstanceTypes.ToList(); }
		}

		/// &lt;summary&gt;
		/// Create an instance of a Macro control and return it.
		/// Because the macro control uses inline client script whichs is not generated after postback
		/// That&#39;s why we use the Page Picker instead of the content picker of the macro.
		/// &lt;/summary&gt;
		/// &lt;remarks&gt;
		/// This is legacy code migrated from umbraco.editorControls.macrocontainer.MacroControlFactory
		/// &lt;/remarks&gt;
		internal Control GetMacroRenderControlByType(PersistableMacroProperty prop, string uniqueId)
		{
			var m = MacroControlTypes.FindLast(macroGuiCcontrol =&gt; macroGuiCcontrol.ToString() == string.Format(&quot;{0}.{1}&quot;, prop.AssemblyName, prop.TypeName));
			var instance = ServiceProvider.GetService(m) as IMacroGuiRendering;
			if (instance != null)
			{
				if (string.IsNullOrEmpty(prop.Value) == false)
				{
                    instance.Value = HttpUtility.HtmlDecode(prop.Value);
				}
				var macroControl = instance as Control;
				if (macroControl != null)
				{
					macroControl.ID = uniqueId;
					return macroControl;
				}
			}
			return null;
		}

	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[29,15,29,89,1],[30,3,30,4,1],[30,5,30,6,1],[38,4,38,5,0],[39,5,39,19,0],[40,4,40,5,0],[52,3,52,4,0],[53,13,53,85,0],[54,3,54,4,0],[61,8,61,9,1],[61,10,61,40,1],[61,41,61,42,1],[73,3,73,4,0],[74,4,74,59,0],[74,59,74,148,0],[74,148,74,150,0],[74,4,74,150,0],[75,4,75,71,0],[76,4,76,25,0],[77,4,77,5,0],[78,5,78,51,0],[79,5,79,6,0],[80,21,80,73,0],[81,5,81,6,0],[82,5,82,44,0],[83,5,83,30,0],[84,5,84,6,0],[85,6,85,33,0],[86,6,86,26,0],[88,4,88,5,0],[89,4,89,16,0],[90,3,90,4,0]]);
    </script>
  </body>
</html>