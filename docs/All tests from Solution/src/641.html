<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\tree.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using System.Xml;

using System.Reflection;
using umbraco.DataLayer;
using umbraco.cms.presentation.Trees;
using umbraco.BusinessLogic.Utils;
using umbraco.interfaces;
using umbraco.BusinessLogic;

using System.Collections.Generic;

namespace umbraco.cms.presentation
{

    /// &lt;summary&gt;
    /// This still outputs the xml format of the tree in case developers are using it.
    /// &lt;/summary&gt;
    [Obsolete(&quot;this is no longer used for the client side tree&quot;)]
    public partial class tree : umbraco.BasePages.UmbracoEnsuredPage
    {

        private XmlTree m_xTree = new XmlTree();
        TreeRequestParams m_treeParams = TreeRequestParams.FromQueryStrings();

        /// &lt;summary&gt;
        /// This checks to see which request parameters have been set for the Tree xml service
        /// to run. If there is no Tree Type specified, then this will return the xml structure
        /// of the initial tree nodes for all trees required for the current application. Otherwise
        /// this will return thre required tree xml based on the request parameters specified.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        protected void Page_Load(object sender, System.EventArgs e)
        {

            if (string.IsNullOrEmpty(m_treeParams.TreeType))
                if (!string.IsNullOrEmpty(m_treeParams.Application))
                    LoadAppTrees(m_treeParams.Application);
                else
                    LoadNullTree();
            else
                LoadTree(m_treeParams.TreeType);

            Response.Write(m_xTree.ToString(SerializedTreeType.XmlTree));
        }

        /// &lt;summary&gt;
        /// If the application supports multiple trees, then this function iterates over all of the trees assigned to it
        /// and creates their top level nodes and context menus.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;appAlias&quot;&gt;&lt;/param&gt;
        private void LoadAppTrees(string appAlias)
        {
            //find all tree definitions that have the current application alias
            List&lt;TreeDefinition&gt; treeDefs = TreeDefinitionCollection.Instance.FindActiveTrees(appAlias);

            foreach (TreeDefinition treeDef in treeDefs)
            {
                BaseTree bTree = treeDef.CreateInstance();
                bTree.SetTreeParameters(m_treeParams);
                m_xTree.Add(bTree.RootNode);
            }
        }

        /// &lt;summary&gt;
        /// This will load the particular ITree object and call it&#39;s render method to get the nodes that need to be rendered.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;appAlias&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;treeAlias&quot;&gt;&lt;/param&gt;
        private void LoadTree(string treeAlias)
        {

            TreeDefinition treeDef = TreeDefinitionCollection.Instance.FindTree(treeAlias);

            if (treeDef != null)
            {
                BaseTree bTree = treeDef.CreateInstance();
                bTree.SetTreeParameters(m_treeParams);
                bTree.Render(ref m_xTree);
            }
            else
                LoadNullTree();
        }

        /// &lt;summary&gt;
        /// Load an empty tree structure to show the end user that there was a problem loading the tree.
        /// &lt;/summary&gt;
        private void LoadNullTree()
        {
            BaseTree nullTree = new NullTree(m_treeParams.Application);
            nullTree.SetTreeParameters(m_treeParams);
            nullTree.Render(ref m_xTree);
        }

        #region Web Form Designer generated code
        override protected void OnInit(EventArgs e)
        {
            //
            // CODEGEN: This call is required by the ASP.NET Web Form Designer.
            //
            InitializeComponent();
            base.OnInit(e);
        }

        /// &lt;summary&gt;
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// &lt;/summary&gt;
        private void InitializeComponent()
        {

        }
        #endregion
    }


}

    </pre>
    <script type="text/javascript">
      highlightRanges([[32,9,32,49,0],[33,9,33,79,0],[44,9,44,10,0],[46,13,46,61,0],[47,17,47,69,0],[48,21,48,60,0],[50,21,50,36,0],[52,17,52,49,0],[54,13,54,74,0],[55,9,55,10,0],[63,9,63,10,0],[65,13,65,105,0],[67,13,67,20,0],[67,22,67,44,0],[67,45,67,47,0],[67,48,67,56,0],[68,13,68,14,0],[69,17,69,59,0],[70,17,70,55,0],[71,17,71,45,0],[72,13,72,14,0],[73,9,73,10,0],[81,9,81,10,0],[83,13,83,92,0],[85,13,85,33,0],[86,13,86,14,0],[87,17,87,59,0],[88,17,88,55,0],[89,17,89,43,0],[90,13,90,14,0],[92,17,92,32,0],[93,9,93,10,0],[99,9,99,10,0],[100,13,100,72,0],[101,13,101,54,0],[102,13,102,42,0],[103,9,103,10,0],[107,9,107,10,0],[111,13,111,35,0],[112,13,112,28,0],[113,9,113,10,0],[120,9,120,10,0],[122,9,122,10,0]]);
    </script>
  </body>
</html>