<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\datatype\PreValue.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.Text;
using System.Runtime.CompilerServices;

using umbraco.DataLayer;
using umbraco.BusinessLogic;

namespace umbraco.cms.businesslogic.datatype
{
    /// &lt;summary&gt;
    /// A simple class for storing predefined values on a datatype.
    /// A prevalue contains a value, a unique key and sort order.
    /// &lt;/summary&gt;
    [Obsolete(&quot;This class is no longer used and will be removed from the codebase in the future.&quot;)]
    public class PreValue
    {
        #region Contructors
        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;PreValue&quot;/&gt; class.
        /// &lt;/summary&gt;
        public PreValue()
        {

        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;PreValue&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;Id&quot;&gt;The id.&lt;/param&gt;
        /// &lt;param name=&quot;SortOrder&quot;&gt;The sort order.&lt;/param&gt;
        /// &lt;param name=&quot;Value&quot;&gt;The value.&lt;/param&gt;
        public PreValue(int Id, int SortOrder, string Value)
        {
            _id = Id;
            this.SortOrder = SortOrder;
            this.Value = Value;
        }

        public PreValue(int id, int sortOrder, string value, string alias)
        {
            _id = id;
            SortOrder = sortOrder;
            Value = value;
            Alias = alias;
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;PreValue&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;Id&quot;&gt;The id.&lt;/param&gt;
        public PreValue(int Id)
        {
            _id = Id;
            Initialize();
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;PreValue&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;DataTypeId&quot;&gt;The data type id.&lt;/param&gt;
        /// &lt;param name=&quot;Value&quot;&gt;The value.&lt;/param&gt;
        public PreValue(int DataTypeId, string Value)
        {
            using (var sqlHelper = Application.SqlHelper)
            {
                var id = sqlHelper.ExecuteScalar&lt;object&gt;(
                    &quot;Select id from cmsDataTypePreValues where [Value] = @value and DataTypeNodeId = @dataTypeId&quot;,
                    sqlHelper.CreateParameter(&quot;@dataTypeId&quot;, DataTypeId),
                    sqlHelper.CreateParameter(&quot;@value&quot;, Value));
                if (id != null)
                    _id = int.Parse(id.ToString());
            }
            Initialize();
        } 
        #endregion

        /// &lt;summary&gt;
        /// Create a new pre value with a value
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dataTypeDefId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [MethodImpl(MethodImplOptions.Synchronized)]
        public static PreValue MakeNew(int dataTypeDefId, string value)
        {
            using (var sqlHelper = Application.SqlHelper)
            {
                sqlHelper.ExecuteNonQuery(
                    &quot;insert into cmsDataTypePreValues (datatypenodeid,[value],sortorder,alias) values (@dtdefid,@value,0,&#39;&#39;)&quot;,
                    sqlHelper.CreateParameter(&quot;@dtdefid&quot;, dataTypeDefId),
                    sqlHelper.CreateParameter(&quot;@value&quot;, value));
                var id = sqlHelper.ExecuteScalar&lt;int&gt;(&quot;SELECT MAX(id) FROM cmsDataTypePreValues&quot;);
                return new PreValue(id);
            }
        }

        #region Private members

        private int? _id;

        #endregion

        #region Public properties

        /// &lt;summary&gt;
        /// Gets or sets the data type id.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The data type id.&lt;/value&gt;
        public int DataTypeId { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the id.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The id.&lt;/value&gt;
        public int Id
        {
            get { return _id.Value; }
            set { _id = value; }
        }

        /// &lt;summary&gt;
        /// Gets or sets the value.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The value.&lt;/value&gt;
        public string Value { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the sort order.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The sort order.&lt;/value&gt;
        public int SortOrder { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the sort order.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The sort order.&lt;/value&gt;
        public string Alias { get; set; }

        #endregion

        #region Public methods

        /// &lt;summary&gt;
        /// Deletes a prevalue item
        /// &lt;/summary&gt;
        public void Delete()
        {
            if (_id == null) 
            {
                throw new ArgumentNullException(&quot;Id&quot;);
            }

            using (var sqlHelper = Application.SqlHelper)
                sqlHelper.ExecuteNonQuery(&quot;delete from cmsDataTypePreValues where id = @id&quot;,
                sqlHelper.CreateParameter(&quot;@id&quot;, this.Id));
        }

        /// &lt;summary&gt;
        /// Saves this instance.
        /// &lt;/summary&gt;
        [MethodImpl(MethodImplOptions.Synchronized)]
        public void Save()
        {
            // Check for new
            if (Id == 0)
            {
                // Update sortOrder
                using (var sqlHelper = Application.SqlHelper)
                {
                    var tempSortOrder = sqlHelper.ExecuteScalar&lt;object&gt;(&quot;select max(sortorder) from cmsDataTypePreValues where datatypenodeid = @dataTypeId&quot;, sqlHelper.CreateParameter(&quot;@dataTypeId&quot;, DataTypeId));
                    var sortOrder = 0;

                    if (tempSortOrder != null &amp;&amp; int.TryParse(tempSortOrder.ToString(), out sortOrder))
                        SortOrder = sortOrder + 1;
                    else
                        SortOrder = 1;
             
                    var sqlParams = new IParameter[] {
								sqlHelper.CreateParameter(&quot;@value&quot;,Value),
								sqlHelper.CreateParameter(&quot;@dtdefid&quot;,DataTypeId),
                                sqlHelper.CreateParameter(&quot;@alias&quot;,Alias)};
                
                    // The method is synchronized
                    sqlHelper.ExecuteNonQuery(&quot;INSERT INTO cmsDataTypePreValues (datatypenodeid,[value],sortorder,alias) VALUES (@dtdefid,@value,0,&#39;@alias&#39;)&quot;, sqlParams);
                    _id = sqlHelper.ExecuteScalar&lt;int&gt;(&quot;SELECT MAX(id) FROM cmsDataTypePreValues&quot;);
                }
            }

            using (var sqlHelper = Application.SqlHelper)
                sqlHelper.ExecuteNonQuery(
                &quot;update cmsDataTypePreValues set sortorder = @sortOrder, [value] = @value, alias = @alias where id = @id&quot;,
                sqlHelper.CreateParameter(&quot;@sortOrder&quot;, SortOrder),
                sqlHelper.CreateParameter(&quot;@value&quot;, Value),
                sqlHelper.CreateParameter(&quot;@id&quot;, Id),
                sqlHelper.CreateParameter(&quot;@alias&quot;, Alias));
        } 
        
        #endregion

        #region Private methods
        /// &lt;summary&gt;
        /// Initializes this instance.
        /// &lt;/summary&gt;
        private void Initialize()
        {
            using (var sqlHelper = Application.SqlHelper)
            using (var dr = sqlHelper.ExecuteReader(
                &quot;Select id, sortorder, [value], alias from cmsDataTypePreValues where id = @id order by sortorder&quot;,
                sqlHelper.CreateParameter(&quot;@id&quot;, Id))) 
            { 
                if (dr.Read())
                {
                    SortOrder = dr.GetInt(&quot;sortorder&quot;);
                    Value = dr.GetString(&quot;value&quot;);
                    Alias = dr.GetString(&quot;alias&quot;);
                }
            }
        } 
        #endregion
       
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[24,9,24,26,0],[25,9,25,10,0],[27,9,27,10,0],[35,9,35,61,0],[36,9,36,10,0],[37,13,37,22,0],[38,13,38,40,0],[39,13,39,32,0],[40,9,40,10,0],[42,9,42,75,0],[43,9,43,10,0],[44,13,44,22,0],[45,13,45,35,0],[46,13,46,27,0],[47,13,47,27,0],[48,9,48,10,0],[54,9,54,32,0],[55,9,55,10,0],[56,13,56,22,0],[57,13,57,26,0],[58,9,58,10,0],[65,9,65,54,0],[66,9,66,10,0],[67,20,67,57,0],[68,13,68,14,0],[69,17,72,65,0],[73,17,73,32,0],[74,21,74,52,0],[75,13,75,14,0],[76,13,76,26,0],[77,9,77,10,0],[88,9,88,10,0],[89,20,89,57,0],[90,13,90,14,0],[91,17,94,65,0],[95,17,95,99,0],[96,17,96,41,0],[98,9,98,10,0],[112,33,112,37,0],[112,38,112,42,0],[120,17,120,18,0],[120,19,120,36,0],[120,37,120,38,0],[121,17,121,18,0],[121,19,121,31,0],[121,32,121,33,0],[128,31,128,35,0],[128,36,128,40,0],[134,32,134,36,0],[134,37,134,41,0],[140,31,140,35,0],[140,36,140,40,0],[150,9,150,10,0],[151,13,151,29,0],[152,13,152,14,0],[153,17,153,55,0],[156,20,156,57,0],[157,17,158,60,0],[159,9,159,10,0],[166,9,166,10,0],[168,13,168,25,0],[169,13,169,14,0],[171,24,171,61,0],[172,17,172,18,0],[173,21,173,213,0],[174,21,174,39,0],[176,21,176,104,0],[177,25,177,51,0],[179,25,179,39,0],[181,21,184,76,0],[187,21,187,171,0],[188,21,188,100,0],[189,17,189,18,0],[190,13,190,14,0],[192,20,192,57,0],[193,17,198,61,0],[199,9,199,10,0],[208,9,208,10,0],[209,20,209,57,0],[210,20,212,54,0],[213,13,213,14,0],[214,17,214,31,0],[215,17,215,18,0],[216,21,216,56,0],[217,21,217,51,0],[218,21,218,51,0],[219,17,219,18,0],[220,13,220,14,0],[221,9,221,10,0]]);
    </script>
  </body>
</html>