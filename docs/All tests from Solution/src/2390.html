<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\relation\Relation.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Collections.Generic;
using Umbraco.Core;
using Umbraco.Core.Models;
using umbraco.DataLayer;
using umbraco.BusinessLogic;

namespace umbraco.cms.businesslogic.relation
{
	/// &lt;summary&gt;
	/// Summary description for Relation.
	/// &lt;/summary&gt;
	[Obsolete(&quot;Use the IRelationService instead&quot;)]
	public class Relation
	{
        private CMSNode _parentNode;
        private CMSNode _childNode;

	    internal IRelation RelationEntity;

        internal Relation(IRelation relation)
        {
            RelationEntity = relation;
        }

        public Relation(int Id)
        {
            var found = ApplicationContext.Current.Services.RelationService.GetById(Id);
            if (found == null)
            {
                throw new NullReferenceException(&quot;No relation found with id &quot; + Id);
            }
            RelationEntity = found;
        }

        /// &lt;summary&gt;
        /// Unused, please do not use
        /// &lt;/summary&gt;
        [Obsolete(&quot;Obsolete, For querying the database use the new UmbracoDatabase object ApplicationContext.Current.DatabaseContext.Database&quot;, false)]
        protected static ISqlHelper SqlHelper
        {
            get { return Application.SqlHelper; }
        }

		public CMSNode Parent 
		{
		    get { return _parentNode ?? (_parentNode = new CMSNode(RelationEntity.ParentId)); }
		    set
		    {
                _parentNode = value;
		        RelationEntity.ParentId = value.Id;
		    }
		}

		public CMSNode Child 
		{
            get { return _childNode ?? (_childNode = new CMSNode(RelationEntity.ChildId)); }
            set
            {
                _childNode = value;
                RelationEntity.ChildId = value.Id;
            }
		}

		public string Comment 
		{
			get {return RelationEntity.Comment;}
			set { RelationEntity.Comment = value; }
		}

		public DateTime CreateDate 
		{
			get {return RelationEntity.CreateDate;}
		}

		public RelationType RelType
		{
			get { return new RelationType(RelationEntity.RelationType); }
			set { RelationEntity.RelationType = value.RelationTypeEntity; }
		}

		public int Id 
		{
			get {return RelationEntity.Id;}
		}

        /// &lt;summary&gt;
        /// Used to persist object changes to the database
        /// &lt;/summary&gt;
        public virtual void Save()
        {
            ApplicationContext.Current.Services.RelationService.Save(RelationEntity);
        }

		public void Delete()
		{
		    ApplicationContext.Current.Services.RelationService.Delete(RelationEntity);
		}

		public static Relation MakeNew(int ParentId, int ChildId, RelationType RelType, string Comment)
        {
            var relation = new Umbraco.Core.Models.Relation(ParentId, ChildId, RelType.RelationTypeEntity)
            {
                Comment = Comment
            };
            ApplicationContext.Current.Services.RelationService.Save(relation);
            return new Relation(relation);
        }

		public static List&lt;Relation&gt; GetRelationsAsList(int NodeId)
		{
		    return ApplicationContext.Current.Services.RelationService.GetByParentOrChildId(NodeId)
		        .Select(x =&gt; new Relation(x))
		        .ToList();
		}

        public static bool IsRelated(int ParentID, int ChildId)
        {
            return ApplicationContext.Current.Services.RelationService.AreRelated(ParentID, ChildId);
        }

        public static bool IsRelated(int ParentID, int ChildId, RelationType Filter) 
        {
            return ApplicationContext.Current.Services.RelationService.AreRelated(ParentID, ChildId, Filter.Alias);
        }

        public static Relation[] GetRelations(int NodeId)
        {
            return GetRelationsAsList(NodeId).ToArray();
        }

        public static Relation[] GetRelations(int NodeId, RelationType Filter)
        {
            return ApplicationContext.Current.Services.RelationService.GetByParentOrChildId(NodeId, Filter.RelationTypeEntity.Alias)
                .Select(x =&gt; new Relation(x))
                .ToArray();
        }
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[24,9,24,46,0],[25,9,25,10,0],[26,13,26,39,0],[27,9,27,10,0],[29,9,29,32,0],[30,9,30,10,0],[31,13,31,89,0],[32,13,32,31,0],[33,13,33,14,0],[34,17,34,85,0],[36,13,36,36,0],[37,9,37,10,0],[45,17,45,18,0],[45,19,45,48,0],[45,49,45,50,0],[50,11,50,12,0],[50,13,50,88,0],[50,89,50,90,0],[52,7,52,8,0],[53,17,53,37,0],[54,11,54,46,0],[55,7,55,8,0],[60,17,60,18,0],[60,19,60,91,0],[60,92,60,93,0],[62,13,62,14,0],[63,17,63,36,0],[64,17,64,51,0],[65,13,65,14,0],[70,8,70,9,0],[70,9,70,39,0],[70,39,70,40,0],[71,8,71,9,0],[71,10,71,41,0],[71,42,71,43,0],[76,8,76,9,0],[76,9,76,42,0],[76,42,76,43,0],[81,8,81,9,0],[81,10,81,63,0],[81,64,81,65,0],[82,8,82,9,0],[82,10,82,65,0],[82,66,82,67,0],[87,8,87,9,0],[87,9,87,34,0],[87,34,87,35,0],[94,9,94,10,0],[95,13,95,86,0],[96,9,96,10,0],[99,3,99,4,0],[100,7,100,82,0],[101,3,101,4,0],[104,9,104,10,0],[105,13,108,15,0],[109,13,109,80,0],[110,13,110,43,0],[111,9,111,10,0],[114,3,114,4,0],[115,7,116,24,0],[116,24,116,39,0],[116,39,117,21,0],[115,7,117,21,0],[118,3,118,4,0],[121,9,121,10,0],[122,13,122,102,0],[123,9,123,10,0],[126,9,126,10,0],[127,13,127,116,0],[128,9,128,10,0],[131,9,131,10,0],[132,13,132,57,0],[133,9,133,10,0],[136,9,136,10,0],[137,13,138,30,0],[138,30,138,45,0],[138,45,139,28,0],[137,13,139,28,0],[140,9,140,10,0]]);
    </script>
  </body>
</html>