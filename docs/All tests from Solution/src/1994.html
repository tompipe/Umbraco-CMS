<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\MacroProperty.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Reflection;
using System.Runtime.Serialization;
using Umbraco.Core.Models.EntityBase;
using Umbraco.Core.PropertyEditors;

namespace Umbraco.Core.Models
{
    /// &lt;summary&gt;
    /// Represents a Macro Property
    /// &lt;/summary&gt;
    [Serializable]
    [DataContract(IsReference = true)]
    public class MacroProperty : TracksChangesEntityBase, IMacroProperty, IRememberBeingDirty, IDeepCloneable
    {
        public MacroProperty()
        {
            
        }

        /// &lt;summary&gt;
        /// Ctor for creating a new property
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;alias&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;sortOrder&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;editorAlias&quot;&gt;&lt;/param&gt;
        public MacroProperty(string @alias, string name, int sortOrder, string editorAlias)
        {
            _alias = alias;
            _name = name;
            _sortOrder = sortOrder;

            //try to get the new mapped parameter editor
            var mapped = LegacyParameterEditorAliasConverter.GetNewAliasFromLegacyAlias(editorAlias, false);
            if (mapped.IsNullOrWhiteSpace() == false)
            {
                editorAlias = mapped;
            }

            _editorAlias = editorAlias;
        }

        /// &lt;summary&gt;
        /// Ctor for creating an existing property
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;alias&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;sortOrder&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;editorAlias&quot;&gt;&lt;/param&gt;
        internal MacroProperty(int id, string @alias, string name, int sortOrder, string editorAlias)
        {
            _id = id;
            _alias = alias;
            _name = name;
            _sortOrder = sortOrder;

            //try to get the new mapped parameter editor
            var mapped = LegacyParameterEditorAliasConverter.GetNewAliasFromLegacyAlias(editorAlias, false);
            if (mapped.IsNullOrWhiteSpace() == false)
            {
                editorAlias = mapped;
            }

            _editorAlias = editorAlias;
        }

        private string _alias;
        private string _name;
        private int _sortOrder;
        private int _id;
        private string _editorAlias;

        private static readonly Lazy&lt;PropertySelectors&gt; Ps = new Lazy&lt;PropertySelectors&gt;();

        private class PropertySelectors
        {
            public readonly PropertyInfo AliasSelector = ExpressionHelper.GetPropertyInfo&lt;MacroProperty, string&gt;(x =&gt; x.Alias);
            public readonly PropertyInfo NameSelector = ExpressionHelper.GetPropertyInfo&lt;MacroProperty, string&gt;(x =&gt; x.Name);
            public readonly PropertyInfo SortOrderSelector = ExpressionHelper.GetPropertyInfo&lt;MacroProperty, int&gt;(x =&gt; x.SortOrder);
            public readonly PropertyInfo IdSelector = ExpressionHelper.GetPropertyInfo&lt;Entity, int&gt;(x =&gt; x.Id);
            public readonly PropertyInfo PropertyTypeSelector = ExpressionHelper.GetPropertyInfo&lt;MacroProperty, string&gt;(x =&gt; x.EditorAlias);
        }

        /// &lt;summary&gt;
        /// Gets or sets the Alias of the Property
        /// &lt;/summary&gt;
        [DataMember]
        public int Id
        {
            get { return _id; }
            set { SetPropertyValueAndDetectChanges(value, ref _id, Ps.Value.IdSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the Alias of the Property
        /// &lt;/summary&gt;
        [DataMember]
        public string Alias
        {
            get { return _alias; }
            set { SetPropertyValueAndDetectChanges(value, ref _alias, Ps.Value.AliasSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the Name of the Property
        /// &lt;/summary&gt;
        [DataMember]
        public string Name
        {
            get { return _name; }
            set { SetPropertyValueAndDetectChanges(value, ref _name, Ps.Value.NameSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the Sort Order of the Property
        /// &lt;/summary&gt;
        [DataMember]
        public int SortOrder
        {
            get { return _sortOrder; }
            set { SetPropertyValueAndDetectChanges(value, ref _sortOrder, Ps.Value.SortOrderSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the Type for this Property
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// The MacroPropertyTypes acts as a plugin for Macros.
        /// All types was previously contained in the database, but has been ported to code.
        /// &lt;/remarks&gt;
        [DataMember]
        public string EditorAlias
        {
            get { return _editorAlias; }
            set
            {
                //try to get the new mapped parameter editor
                var mapped = LegacyParameterEditorAliasConverter.GetNewAliasFromLegacyAlias(value, false);
                var newVal = mapped.IsNullOrWhiteSpace() == false ? mapped : value;
                SetPropertyValueAndDetectChanges(newVal, ref _editorAlias, Ps.Value.PropertyTypeSelector);                
            }
        }

        public object DeepClone()
        {
            //Memberwise clone on MacroProperty will work since it doesn&#39;t have any deep elements
            // for any sub class this will work for standard properties as well that aren&#39;t complex object&#39;s themselves.
            var clone = (MacroProperty)MemberwiseClone();
            //Automatically deep clone ref properties that are IDeepCloneable
            DeepCloneHelper.DeepCloneRefProperties(this, clone);
            clone.ResetDirtyProperties(false);
            return clone;
        }

        protected bool Equals(MacroProperty other)
        {
            return string.Equals(_alias, other._alias) &amp;&amp; _id == other._id;
        }

        public override bool Equals(object obj)
        {
            if (ReferenceEquals(null, obj)) return false;
            if (ReferenceEquals(this, obj)) return true;
            if (obj.GetType() != this.GetType()) return false;
            return Equals((MacroProperty) obj);
        }

        public override int GetHashCode()
        {
            unchecked
            {
                return ((_alias != null ? _alias.GetHashCode() : 0)*397) ^ _id;
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,31,0],[17,9,17,10,0],[19,9,19,10,0],[28,9,28,92,1],[29,9,29,10,1],[30,13,30,28,1],[31,13,31,26,1],[32,13,32,36,1],[35,13,35,109,1],[36,13,36,54,1],[37,13,37,14,1],[38,17,38,38,1],[39,13,39,14,1],[41,13,41,40,1],[42,9,42,10,1],[52,9,52,102,1],[53,9,53,10,1],[54,13,54,22,1],[55,13,55,28,1],[56,13,56,26,1],[57,13,57,36,1],[60,13,60,109,1],[61,13,61,54,1],[62,13,62,14,0],[63,17,63,38,0],[64,13,64,14,0],[66,13,66,40,1],[67,9,67,10,1],[75,9,75,92,1],[79,13,79,128,1],[80,13,80,126,1],[81,13,81,133,1],[82,13,82,112,1],[83,13,83,141,1],[92,17,92,18,1],[92,19,92,30,1],[92,31,92,32,1],[93,17,93,18,1],[93,19,93,89,1],[93,90,93,91,1],[102,17,102,18,1],[102,19,102,33,1],[102,34,102,35,1],[103,17,103,18,1],[103,19,103,95,1],[103,96,103,97,1],[112,17,112,18,1],[112,19,112,32,1],[112,33,112,34,1],[113,17,113,18,1],[113,19,113,93,1],[113,94,113,95,1],[122,17,122,18,1],[122,19,122,37,1],[122,38,122,39,1],[123,17,123,18,1],[123,19,123,103,1],[123,104,123,105,1],[136,17,136,18,1],[136,19,136,39,1],[136,40,136,41,1],[138,13,138,14,1],[140,17,140,107,1],[141,17,141,84,1],[142,17,142,107,1],[143,13,143,14,1],[147,9,147,10,1],[150,13,150,58,1],[152,13,152,65,1],[153,13,153,47,1],[154,13,154,26,1],[155,9,155,10,1],[158,9,158,10,1],[159,13,159,76,1],[160,9,160,10,1],[163,9,163,10,1],[164,13,164,44,1],[164,45,164,58,0],[165,13,165,44,1],[165,45,165,57,1],[166,13,166,49,1],[166,50,166,63,0],[167,13,167,48,1],[168,9,168,10,1],[171,9,171,10,0],[173,13,173,14,0],[174,17,174,80,0],[176,9,176,10,0]]);
    </script>
  </body>
</html>