<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\BaseDataType.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;

using umbraco.DataLayer;
using umbraco.BusinessLogic;

namespace umbraco.editorControls
{
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public abstract class BaseDataType
    {
        private int _datatypedefinitionid;
        private string _datafield = &quot;&quot;;
        private DBTypes _DBType;

        /// &lt;summary&gt;
        /// Unused, please do not use
        /// &lt;/summary&gt;
        [Obsolete(&quot;Obsolete, For querying the database use the new UmbracoDatabase object ApplicationContext.Current.DatabaseContext.Database&quot;, false)]
        protected static ISqlHelper SqlHelper
        {
            get { return Application.SqlHelper; }
        }

        public BaseDataType()
        { }

        #region IDataType Members
        public abstract Guid Id { get; }
        public abstract string DataTypeName { get; }
        public abstract interfaces.IDataEditor DataEditor { get; }
        public abstract interfaces.IDataPrevalue PrevalueEditor { get; }
        public abstract interfaces.IData Data { get; }

		public int DataTypeDefinitionId {
			set {
				_datatypedefinitionid = value;
			}
			get {
			return _datatypedefinitionid;
			}
		}

		public DBTypes DBType {
			get {
				string test= &quot;&quot;;
				if (_datafield == &quot;&quot;)
					test = DataFieldName;
				return _DBType;
			}
			set {
                _DBType = value;
                using (var sqlHelper = Application.SqlHelper)
				 sqlHelper.ExecuteNonQuery(&quot;update cmsDataType set dbType = &#39;&quot; + value.ToString() + &quot;&#39; where nodeId = @datadefinitionid&quot;,
                     sqlHelper.CreateParameter(&quot;@datadefinitionid&quot;,_datatypedefinitionid)).ToString();
            }
        }
        // Umbraco legacy - get the datafield - the columnname of the cmsPropertyData table
        // where to find the data, since it&#39;s configurable - there is no way of telling if
        // its a bit, nvarchar, ntext or datetime field.
        // get it by lookup the value associated to the datatypedefinition id.
        public string DataFieldName
        {
			get {
                if (_datafield == &quot;&quot;)
                {
                    using (var sqlHelper = Application.SqlHelper)
                    {
                        string dbtypestr = sqlHelper.ExecuteScalar&lt;string&gt;(&quot;select dbType from cmsDataType where nodeId = @datadefinitionid&quot;,
                                sqlHelper.CreateParameter(&quot;@datadefinitionid&quot;, _datatypedefinitionid));
                        DBTypes DataTypeSQLType = (DBTypes) Enum.Parse(typeof(DBTypes), dbtypestr, true);

                        _DBType = DataTypeSQLType;
                        switch (DataTypeSQLType)
                        {
                            case DBTypes.Date:
                                _datafield = &quot;dataDate&quot;;
                                break;
                            case DBTypes.Integer:
                                _datafield = &quot;DataInt&quot;;
                                break;
                            case DBTypes.Ntext:
                                _datafield = &quot;dataNtext&quot;;
                                break;
                            case DBTypes.Nvarchar:
                                _datafield = &quot;dataNvarchar&quot;;
                                break;
                        }
                    }
                    return _datafield;
                }
                return _datafield;
            }
        }
        #endregion
    }
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public enum DBTypes
    {
        Integer,
        Date,
        Nvarchar,
        Ntext
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,40,0],[21,17,21,18,0],[21,19,21,48,0],[21,49,21,50,0],[24,9,24,30,0],[25,9,25,10,0],[25,11,25,12,0],[35,8,35,9,0],[36,5,36,35,0],[37,4,37,5,0],[38,8,38,9,0],[39,4,39,33,0],[40,4,40,5,0],[44,8,44,9,0],[45,5,45,21,0],[46,5,46,26,0],[47,6,47,27,0],[48,5,48,20,0],[49,4,49,5,0],[50,8,50,9,0],[51,17,51,33,0],[52,24,52,61,0],[53,6,54,103,0],[55,13,55,14,0],[63,8,63,9,0],[64,17,64,38,0],[65,17,65,18,0],[66,28,66,65,0],[67,21,67,22,0],[68,25,69,104,0],[70,25,70,106,0],[72,25,72,51,0],[73,25,73,49,0],[76,33,76,57,0],[77,33,77,39,0],[79,33,79,56,0],[80,33,80,39,0],[82,33,82,58,0],[83,33,83,39,0],[85,33,85,61,0],[86,33,86,39,0],[88,21,88,22,0],[89,21,89,39,0],[91,17,91,35,0],[92,13,92,14,0]]);
    </script>
  </body>
</html>