<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Mvc\PluginController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Concurrent;
using System.Web.Mvc;
using Umbraco.Core;
using Umbraco.Core.Logging;
using Umbraco.Core.Services;
using Umbraco.Web.Security;
using Umbraco.Web.WebApi;

namespace Umbraco.Web.Mvc
{
    /// &lt;summary&gt;
    /// A base class for all plugin controllers to inherit from
    /// &lt;/summary&gt;
    public abstract class PluginController : Controller
    {
        /// &lt;summary&gt;
        /// stores the metadata about plugin controllers
        /// &lt;/summary&gt;
        private static readonly ConcurrentDictionary&lt;Type, PluginControllerMetadata&gt; MetadataStorage = new ConcurrentDictionary&lt;Type, PluginControllerMetadata&gt;();

        private UmbracoHelper _umbracoHelper;        

        /// &lt;summary&gt;
        /// Default constructor
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;umbracoContext&quot;&gt;&lt;/param&gt;
        protected PluginController(UmbracoContext umbracoContext)
        {
            if (umbracoContext == null) throw new ArgumentNullException(&quot;umbracoContext&quot;);
            UmbracoContext = umbracoContext;
            InstanceId = Guid.NewGuid();
        }

        protected PluginController(UmbracoContext umbracoContext, UmbracoHelper umbracoHelper)
        {
            if (umbracoContext == null) throw new ArgumentNullException(&quot;umbracoContext&quot;);
            if (umbracoHelper == null) throw new ArgumentNullException(&quot;umbracoHelper&quot;);
            UmbracoContext = umbracoContext;
            InstanceId = Guid.NewGuid();
            _umbracoHelper = umbracoHelper;
        }

        /// &lt;summary&gt;
        /// Useful for debugging
        /// &lt;/summary&gt;
        internal Guid InstanceId { get; private set; }

        /// &lt;summary&gt;
        /// Returns the MemberHelper instance
        /// &lt;/summary&gt;
        public MembershipHelper Members
        {
            get { return Umbraco.MembershipHelper; }
        }

        /// &lt;summary&gt;
        /// Returns an UmbracoHelper object
        /// &lt;/summary&gt;
        public virtual UmbracoHelper Umbraco
        {
            get { return _umbracoHelper ?? (_umbracoHelper = new UmbracoHelper(UmbracoContext)); }
        }

        /// &lt;summary&gt;
        /// Returns an ILogger
        /// &lt;/summary&gt;
        public ILogger Logger
        {
            get { return ProfilingLogger.Logger; }
        }

        /// &lt;summary&gt;
        /// Returns a ProfilingLogger
        /// &lt;/summary&gt;
        public virtual ProfilingLogger ProfilingLogger
        {
            get { return UmbracoContext.Application.ProfilingLogger; }
        }

        /// &lt;summary&gt;
        /// Returns the current UmbracoContext
        /// &lt;/summary&gt;
        public virtual UmbracoContext UmbracoContext { get; private set; }

        /// &lt;summary&gt;
        /// Returns the current ApplicationContext
        /// &lt;/summary&gt;
        public virtual ApplicationContext ApplicationContext
        {
            get { return UmbracoContext.Application; }
        }

        /// &lt;summary&gt;
        /// Returns a ServiceContext
        /// &lt;/summary&gt;
        public ServiceContext Services
        {
            get { return ApplicationContext.Services; }
        }

        /// &lt;summary&gt;
        /// Returns a DatabaseContext
        /// &lt;/summary&gt;
        public DatabaseContext DatabaseContext
        {
            get { return ApplicationContext.DatabaseContext; }
        }

        /// &lt;summary&gt;
        /// Returns the metadata for this instance
        /// &lt;/summary&gt;
        internal PluginControllerMetadata Metadata
        {
            get { return GetMetadata(this.GetType()); }
        }

        /// &lt;summary&gt;
        /// Returns the metadata for a PluginController
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;type&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal static PluginControllerMetadata GetMetadata(Type type)
        {

            return MetadataStorage.GetOrAdd(type, type1 =&gt;
                {
                    var pluginAttribute = type.GetCustomAttribute&lt;PluginControllerAttribute&gt;(false);
                    //check if any inherited class of this type contains the IsBackOffice attribute
                    var backOfficeAttribute = type.GetCustomAttribute&lt;IsBackOfficeAttribute&gt;(true);

                    var meta = new PluginControllerMetadata()
                    {
                        AreaName = pluginAttribute == null ? null : pluginAttribute.AreaName,
                        ControllerName = ControllerExtensions.GetControllerName(type),
                        ControllerNamespace = type.Namespace,
                        ControllerType = type,
                        IsBackOffice = backOfficeAttribute != null
                    };

                    MetadataStorage.TryAdd(type, meta);

                    return meta;
                });

        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,163,1],[28,9,28,66,1],[29,9,29,10,1],[30,13,30,40,1],[30,41,30,91,0],[31,13,31,45,1],[32,13,32,41,1],[33,9,33,10,1],[35,9,35,95,0],[36,9,36,10,0],[37,13,37,40,0],[37,41,37,91,0],[38,13,38,39,0],[38,40,38,89,0],[39,13,39,45,0],[40,13,40,41,0],[41,13,41,44,0],[42,9,42,10,0],[47,36,47,40,0],[47,41,47,53,1],[54,17,54,18,0],[54,19,54,51,0],[54,52,54,53,0],[62,17,62,18,1],[62,19,62,97,1],[62,98,62,99,1],[70,17,70,18,0],[70,19,70,49,0],[70,50,70,51,0],[78,17,78,18,0],[78,19,78,69,0],[78,70,78,71,0],[84,56,84,60,1],[84,61,84,73,1],[91,17,91,18,0],[91,19,91,53,0],[91,54,91,55,0],[99,17,99,18,0],[99,19,99,54,0],[99,55,99,56,0],[107,17,107,18,0],[107,19,107,61,0],[107,62,107,63,0],[115,17,115,18,0],[115,19,115,54,0],[115,55,115,56,0],[124,9,124,10,1],[126,13,127,17,1],[127,17,127,18,1],[127,18,128,21,1],[128,21,128,101,1],[128,101,130,21,1],[130,21,130,100,1],[130,100,132,21,1],[132,21,139,23,1],[139,23,141,21,1],[141,21,141,56,1],[141,56,143,21,1],[143,21,143,33,1],[143,33,144,17,1],[144,17,144,18,1],[144,18,144,20,1],[126,13,144,20,1],[146,9,146,10,1]]);
    </script>
  </body>
</html>