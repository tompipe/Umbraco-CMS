<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Configuration\UmbracoConfig.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Configuration;
using System.IO;
using System.Linq;
using System.Threading;
using Umbraco.Core.Cache;
using Umbraco.Core.Configuration.BaseRest;
using Umbraco.Core.Configuration.Dashboard;
using Umbraco.Core.Configuration.Grid;
using Umbraco.Core.Configuration.UmbracoSettings;
using Umbraco.Core.Logging;

namespace Umbraco.Core.Configuration
{
    /// &lt;summary&gt;
    /// The gateway to all umbraco configuration
    /// &lt;/summary&gt;
    public class UmbracoConfig
    {
        #region Singleton

        private static readonly Lazy&lt;UmbracoConfig&gt; Lazy = new Lazy&lt;UmbracoConfig&gt;(() =&gt; new UmbracoConfig());

        public static UmbracoConfig For
        {
            get { return Lazy.Value; }            
        }

        #endregion

        /// &lt;summary&gt;
        /// Default constructor 
        /// &lt;/summary&gt;
        private UmbracoConfig()
        {
            if (_umbracoSettings == null)
            {
                var umbracoSettings = ConfigurationManager.GetSection(&quot;umbracoConfiguration/settings&quot;) as IUmbracoSettingsSection;                
                SetUmbracoSettings(umbracoSettings);
            }

            if (_baseRestExtensions == null)
            {
                var baseRestExtensions = ConfigurationManager.GetSection(&quot;umbracoConfiguration/BaseRestExtensions&quot;) as IBaseRestSection;                
                SetBaseRestExtensions(baseRestExtensions);
            }

            if (_dashboardSection == null)
            {
                var dashboardConfig = ConfigurationManager.GetSection(&quot;umbracoConfiguration/dashBoard&quot;) as IDashboardSection;                
                SetDashboardSettings(dashboardConfig);
            }
        }

        /// &lt;summary&gt;
        /// Constructor - can be used for testing
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;umbracoSettings&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;baseRestSettings&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dashboardSettings&quot;&gt;&lt;/param&gt;
        public UmbracoConfig(IUmbracoSettingsSection umbracoSettings, IBaseRestSection baseRestSettings, IDashboardSection dashboardSettings)
        {
            SetUmbracoSettings(umbracoSettings);
            SetBaseRestExtensions(baseRestSettings);
            SetDashboardSettings(dashboardSettings);
        }

        private IDashboardSection _dashboardSection;
        private IUmbracoSettingsSection _umbracoSettings;
        private IBaseRestSection _baseRestExtensions;
        private IGridConfig _gridConfig;

        /// &lt;summary&gt;
        /// Gets the IDashboardSection
        /// &lt;/summary&gt;
        public IDashboardSection DashboardSettings()
        {
            if (_dashboardSection == null)
            {
                var ex = new ConfigurationErrorsException(&quot;Could not load the &quot; + typeof(IDashboardSection) + &quot; from config file, ensure the web.config and Dashboard.config files are formatted correctly&quot;);
                LogHelper.Error&lt;UmbracoConfig&gt;(&quot;Config error&quot;, ex);
                throw ex;
            }

            return _dashboardSection;
        }        

        /// &lt;summary&gt;
        /// Only for testing
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        internal void SetDashboardSettings(IDashboardSection value)
        {
            _dashboardSection = value;
        }

        /// &lt;summary&gt;
        /// Only for testing
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        public void SetUmbracoSettings(IUmbracoSettingsSection value)
        {
            _umbracoSettings = value;
        }

        /// &lt;summary&gt;
        /// Gets the IUmbracoSettings
        /// &lt;/summary&gt;
        public IUmbracoSettingsSection UmbracoSettings()
        {
            if (_umbracoSettings == null)
            {
                var ex = new ConfigurationErrorsException(&quot;Could not load the &quot; + typeof (IUmbracoSettingsSection) + &quot; from config file, ensure the web.config and umbracoSettings.config files are formatted correctly&quot;);
                LogHelper.Error&lt;UmbracoConfig&gt;(&quot;Config error&quot;, ex);
                throw ex;
            }

            return _umbracoSettings;
        }
        
        /// &lt;summary&gt;
        /// Only for testing
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        public void SetBaseRestExtensions(IBaseRestSection value)
        {
            _baseRestExtensions = value;
        }

        /// &lt;summary&gt;
        /// Gets the IBaseRestSection
        /// &lt;/summary&gt;
        public IBaseRestSection BaseRestExtensions()
        {
            if (_baseRestExtensions == null)
            {
                var ex = new ConfigurationErrorsException(&quot;Could not load the &quot; + typeof(IBaseRestSection) + &quot; from config file, ensure the web.config and BaseRestExtensions.config files are formatted correctly&quot;);
                LogHelper.Error&lt;UmbracoConfig&gt;(&quot;Config error&quot;, ex);
                throw ex;
            }

            return _baseRestExtensions;
        }

        /// &lt;summary&gt;
        /// Only for testing
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        public void SetGridConfig(IGridConfig value)
        {
            _gridConfig = value;
        }

        /// &lt;summary&gt;
        /// Gets the IGridConfig
        /// &lt;/summary&gt;
        public IGridConfig GridConfig(ILogger logger, IRuntimeCacheProvider runtimeCache, DirectoryInfo appPlugins, DirectoryInfo configFolder, bool isDebug)
        {
            if (_gridConfig == null)
            {
                _gridConfig = new GridConfig(logger, runtimeCache, appPlugins, configFolder, isDebug);
            }

            return _gridConfig;
        }

        //TODO: Add other configurations here !
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[24,9,24,90,1],[24,90,24,109,1],[24,109,24,111,1],[24,9,24,111,1],[28,17,28,18,1],[28,19,28,37,1],[28,38,28,39,1],[36,9,36,32,1],[37,9,37,10,1],[38,13,38,42,1],[39,13,39,14,1],[40,17,40,131,1],[41,17,41,53,1],[42,13,42,14,1],[44,13,44,45,1],[45,13,45,14,1],[46,17,46,137,1],[47,17,47,59,1],[48,13,48,14,1],[50,13,50,43,1],[51,13,51,14,1],[52,17,52,126,1],[53,17,53,55,1],[54,13,54,14,1],[55,9,55,10,1],[63,9,63,142,0],[64,9,64,10,0],[65,13,65,49,0],[66,13,66,53,0],[67,13,67,53,0],[68,9,68,10,0],[79,9,79,10,0],[80,13,80,43,0],[81,13,81,14,0],[82,17,82,206,0],[83,17,83,68,0],[84,17,84,26,0],[87,13,87,38,0],[88,9,88,10,0],[95,9,95,10,1],[96,13,96,39,1],[97,9,97,10,1],[104,9,104,10,1],[105,13,105,38,1],[106,9,106,10,1],[112,9,112,10,1],[113,13,113,42,1],[114,13,114,14,0],[115,17,115,219,0],[116,17,116,68,0],[117,17,117,26,0],[120,13,120,37,1],[121,9,121,10,1],[128,9,128,10,1],[129,13,129,41,1],[130,9,130,10,1],[136,9,136,10,0],[137,13,137,45,0],[138,13,138,14,0],[139,17,139,214,0],[140,17,140,68,0],[141,17,141,26,0],[144,13,144,40,0],[145,9,145,10,0],[152,9,152,10,0],[153,13,153,33,0],[154,9,154,10,0],[160,9,160,10,0],[161,13,161,37,0],[162,13,162,14,0],[163,17,163,103,0],[164,13,164,14,0],[166,13,166,32,0],[167,9,167,10,0]]);
    </script>
  </body>
</html>