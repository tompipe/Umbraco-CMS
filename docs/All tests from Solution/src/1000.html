<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\PropertyEditors\UploadFileTypeValidator.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.IO;
using System.Linq;
using Newtonsoft.Json.Linq;
using Umbraco.Core;
using Umbraco.Core.Configuration;
using Umbraco.Core.Models;
using Umbraco.Core.PropertyEditors;
using umbraco;

namespace Umbraco.Web.PropertyEditors
{
    internal class UploadFileTypeValidator : IPropertyValidator
    {
        public IEnumerable&lt;ValidationResult&gt; Validate(object value, PreValueCollection preValues, PropertyEditor editor)
        {

            //now check the file type
            var asJson = value as JObject;
            if (asJson == null) yield break;
            if (asJson[&quot;selectedFiles&quot;] == null) yield break;
            var fileNames = asJson[&quot;selectedFiles&quot;].ToString().Split(new[] { &#39;,&#39; }, StringSplitOptions.RemoveEmptyEntries);
            foreach (var fileName in fileNames)
            {
                if (ValidateFileExtension(fileName) == false)
                {
                    yield return new ValidationResult(ui.Text(&quot;errors&quot;, &quot;dissallowedMediaType&quot;),
                                                      new[]
                                                          {
                                                              //we only store a single value for this editor so the &#39;member&#39; or &#39;field&#39; 
                                                              // we&#39;ll associate this error with will simply be called &#39;value&#39;
                                                              &quot;value&quot;
                                                          });   
                }
            }

        }

        internal static bool ValidateFileExtension(string fileName)
        {
            if (fileName.IndexOf(&#39;.&#39;) &lt;= 0) return false;
            var extension = Path.GetExtension(fileName).TrimStart(&quot;.&quot;);
            return UmbracoConfig.For.UmbracoSettings().Content.DisallowedUploadFiles.Any(x =&gt; StringExtensions.InvariantEquals(x, extension)) == false;
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[42,9,42,10,0],[43,13,43,44,0],[43,45,43,58,0],[44,13,44,72,0],[45,13,45,95,0],[45,95,45,141,0],[45,141,45,152,0],[45,13,45,152,0],[46,9,46,10,0]]);
    </script>
  </body>
</html>