<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\DataTypeDefinition.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Reflection;
using System.Runtime.Serialization;
using Umbraco.Core.Logging;
using Umbraco.Core.Models.EntityBase;
using Umbraco.Core.Persistence;
using Umbraco.Core.PropertyEditors;
using Umbraco.Core.Services;

namespace Umbraco.Core.Models
{
    /// &lt;summary&gt;
    /// Definition of a DataType/PropertyEditor
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// The definition exists as a database reference between an actual DataType/PropertyEditor 
    /// (identified by its control id), its prevalues (configuration) and the named DataType in the backoffice UI.
    /// &lt;/remarks&gt;
    [Serializable]
    [DataContract(IsReference = true)]
    public class DataTypeDefinition : Entity, IDataTypeDefinition
    {
        private int _parentId;
        private string _name;
        private int _sortOrder;
        private int _level;
        private string _path;
        private int _creatorId;
        private bool _trashed;
        private string _propertyEditorAlias;
        private DataTypeDatabaseType _databaseType;

        [Obsolete(&quot;Property editor&#39;s are defined by a string alias from version 7 onwards, use the alternative contructor that specifies an alias&quot;)]
        [EditorBrowsable(EditorBrowsableState.Never)]
        public DataTypeDefinition(int parentId, Guid controlId)
        {
            _parentId = parentId;

            _propertyEditorAlias = LegacyPropertyEditorIdToAliasConverter.GetAliasFromLegacyId(controlId, false);
            if (_propertyEditorAlias == null)
            {
                //convert to Label!
                LogHelper.Warn&lt;DataTypeDefinition&gt;(&quot;Could not find a GUID -&gt; Alias mapping for the legacy property editor with id &quot; + controlId + &quot;. The DataType has been converted to a Label.&quot;);
                _propertyEditorAlias = Constants.PropertyEditors.NoEditAlias;
            }

            _additionalData = new Dictionary&lt;string, object&gt;();
        }

        public DataTypeDefinition(int parentId, string propertyEditorAlias)
        {
            _parentId = parentId;
            _propertyEditorAlias = propertyEditorAlias;

            _additionalData = new Dictionary&lt;string, object&gt;();
        }

        public DataTypeDefinition(string propertyEditorAlias)
        {
            _parentId = -1;
            _propertyEditorAlias = propertyEditorAlias;

            _additionalData = new Dictionary&lt;string, object&gt;();
        }

        private static readonly Lazy&lt;PropertySelectors&gt; Ps = new Lazy&lt;PropertySelectors&gt;();

        private class PropertySelectors
        {
            public readonly PropertyInfo NameSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, string&gt;(x =&gt; x.Name);
            public readonly PropertyInfo ParentIdSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, int&gt;(x =&gt; x.ParentId);
            public readonly PropertyInfo SortOrderSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, int&gt;(x =&gt; x.SortOrder);
            public readonly PropertyInfo LevelSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, int&gt;(x =&gt; x.Level);
            public readonly PropertyInfo PathSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, string&gt;(x =&gt; x.Path);
            public readonly PropertyInfo UserIdSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, int&gt;(x =&gt; x.CreatorId);
            public readonly PropertyInfo TrashedSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, bool&gt;(x =&gt; x.Trashed);
            public readonly PropertyInfo PropertyEditorAliasSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, string&gt;(x =&gt; x.PropertyEditorAlias);
            public readonly PropertyInfo DatabaseTypeSelector = ExpressionHelper.GetPropertyInfo&lt;DataTypeDefinition, DataTypeDatabaseType&gt;(x =&gt; x.DatabaseType);
        }

        /// &lt;summary&gt;
        /// Gets or sets the Id of the Parent entity
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;Might not be necessary if handled as a relation?&lt;/remarks&gt;
        [DataMember]
        public int ParentId
        {
            get { return _parentId; }
            set { SetPropertyValueAndDetectChanges(value, ref _parentId, Ps.Value.ParentIdSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the name of the current entity
        /// &lt;/summary&gt;
        [DataMember]
        public string Name
        {
            get { return _name; }
            set { SetPropertyValueAndDetectChanges(value, ref _name, Ps.Value.NameSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the sort order of the content entity
        /// &lt;/summary&gt;
        [DataMember]
        public int SortOrder
        {
            get { return _sortOrder; }
            set { SetPropertyValueAndDetectChanges(value, ref _sortOrder, Ps.Value.SortOrderSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the level of the content entity
        /// &lt;/summary&gt;
        [DataMember]
        public int Level
        {
            get { return _level; }
            set { SetPropertyValueAndDetectChanges(value, ref _level, Ps.Value.LevelSelector); }
        }

        /// &lt;summary&gt;
        /// Gets or sets the path
        /// &lt;/summary&gt;
        [DataMember]
        public string Path //Setting this value should be handled by the class not the user
        {
            get { return _path; }
            set { SetPropertyValueAndDetectChanges(value, ref _path, Ps.Value.PathSelector); }
        }

        /// &lt;summary&gt;
        /// Id of the user who created this entity
        /// &lt;/summary&gt;
        [DataMember]
        public int CreatorId
        {
            get { return _creatorId; }
            set { SetPropertyValueAndDetectChanges(value, ref _creatorId, Ps.Value.UserIdSelector); }
        }

        //NOTE: SD: Why do we have this ??

        /// &lt;summary&gt;
        /// Boolean indicating whether this entity is Trashed or not.
        /// &lt;/summary&gt;
        [DataMember]
        public bool Trashed
        {
            get { return _trashed; }
            internal set
            {
                SetPropertyValueAndDetectChanges(value, ref _trashed, Ps.Value.TrashedSelector);
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                _additionalData[&quot;Trashed&quot;] = value;
            }
        }
               
        [DataMember]
        public string PropertyEditorAlias
        {
            get { return _propertyEditorAlias; }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _propertyEditorAlias, Ps.Value.PropertyEditorAliasSelector);
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                _additionalData[&quot;DatabaseType&quot;] = value;
            }
        }

        /// &lt;summary&gt;
        /// Id of the DataType control
        /// &lt;/summary&gt;
        [DataMember]
        [Obsolete(&quot;Property editor&#39;s are defined by a string alias from version 7 onwards, use the PropertyEditorAlias property instead. This method will return a generated GUID for any property editor alias not explicitly mapped to a legacy ID&quot;)]
        public Guid ControlId
        {
            get
            {
                return LegacyPropertyEditorIdToAliasConverter.GetLegacyIdFromAlias(
                    _propertyEditorAlias, LegacyPropertyEditorIdToAliasConverter.NotFoundLegacyIdResponseBehavior.GenerateId).Value;
            }
            set
            {
                var alias = LegacyPropertyEditorIdToAliasConverter.GetAliasFromLegacyId(value, true);
                PropertyEditorAlias = alias;
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                _additionalData[&quot;ControlId&quot;] = value;
            }
        }

        /// &lt;summary&gt;
        /// Gets or Sets the DatabaseType for which the DataType&#39;s value is saved as
        /// &lt;/summary&gt;
        [DataMember]
        public DataTypeDatabaseType DatabaseType
        {
            get { return _databaseType; }
            set 
            {
                SetPropertyValueAndDetectChanges(value, ref _databaseType, Ps.Value.DatabaseTypeSelector);                
                //This is a custom property that is not exposed in IUmbracoEntity so add it to the additional data
                _additionalData[&quot;DatabaseType&quot;] = value;
            }
        }

         private readonly IDictionary&lt;string, object&gt; _additionalData;
        /// &lt;summary&gt;
        /// Some entities may expose additional data that other&#39;s might not, this custom data will be available in this collection
        /// &lt;/summary&gt;
        [EditorBrowsable(EditorBrowsableState.Never)]
        IDictionary&lt;string, object&gt; IUmbracoEntity.AdditionalData
        {
            get { return _additionalData; }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[37,9,37,64,1],[38,9,38,10,1],[39,13,39,34,1],[41,13,41,114,1],[42,13,42,46,1],[43,13,43,14,1],[45,17,45,196,1],[46,17,46,78,1],[47,13,47,14,1],[49,13,49,64,1],[50,9,50,10,1],[52,9,52,76,1],[53,9,53,10,1],[54,13,54,34,1],[55,13,55,56,1],[57,13,57,64,1],[58,9,58,10,1],[60,9,60,62,1],[61,9,61,10,1],[62,13,62,28,1],[63,13,63,56,1],[65,13,65,64,1],[66,9,66,10,1],[68,9,68,92,1],[72,13,72,131,1],[73,13,73,136,1],[74,13,74,138,1],[75,13,75,130,1],[76,13,76,131,1],[77,13,77,135,1],[78,13,78,135,1],[79,13,79,161,1],[80,13,80,161,1],[90,17,90,18,1],[90,19,90,36,1],[90,37,90,38,1],[91,17,91,18,1],[91,19,91,101,1],[91,102,91,103,1],[100,17,100,18,1],[100,19,100,32,1],[100,33,100,34,1],[101,17,101,18,1],[101,19,101,93,1],[101,94,101,95,1],[110,17,110,18,1],[110,19,110,37,1],[110,38,110,39,1],[111,17,111,18,1],[111,19,111,103,1],[111,104,111,105,1],[120,17,120,18,1],[120,19,120,33,1],[120,34,120,35,1],[121,17,121,18,1],[121,19,121,95,1],[121,96,121,97,1],[130,17,130,18,1],[130,19,130,32,1],[130,33,130,34,1],[131,17,131,18,1],[131,19,131,93,1],[131,94,131,95,1],[140,17,140,18,1],[140,19,140,37,1],[140,38,140,39,1],[141,17,141,18,1],[141,19,141,100,1],[141,101,141,102,1],[152,17,152,18,1],[152,19,152,35,1],[152,36,152,37,1],[154,13,154,14,1],[155,17,155,97,1],[157,17,157,52,1],[158,13,158,14,1],[164,17,164,18,1],[164,19,164,47,1],[164,48,164,49,1],[166,13,166,14,1],[167,17,167,121,1],[169,17,169,57,1],[170,13,170,14,1],[181,13,181,14,1],[182,17,183,133,1],[184,13,184,14,1],[186,13,186,14,0],[187,17,187,102,0],[188,17,188,45,0],[190,17,190,54,0],[191,13,191,14,0],[200,17,200,18,1],[200,19,200,40,1],[200,41,200,42,1],[202,13,202,14,1],[203,17,203,107,1],[205,17,205,57,1],[206,13,206,14,1],[216,17,216,18,0],[216,19,216,42,0],[216,43,216,44,0]]);
    </script>
  </body>
</html>