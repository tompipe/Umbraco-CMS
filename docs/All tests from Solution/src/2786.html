<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\users\tom pipe\documents\hexadigital\code\umbraco\umbraco-cms\src\umbraco.tests.benchmarks\xmlbenchmarks.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml;
using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Configs;
using BenchmarkDotNet.Diagnostics.Windows;
using BenchmarkDotNet.Jobs;

namespace Umbraco.Tests.Benchmarks
{
    [Config(typeof(Config))]
    public class XmlBenchmarks
    {
        private class Config : ManualConfig
        {
            public Config()
            {
                Add(new MemoryDiagnoser());
                //Add(ExecutionValidator.FailOnError);

                //The &#39;quick and dirty&#39; settings, so it runs a little quicker
                // see benchmarkdotnet FAQ
                Add(Job.Default
                    .WithLaunchCount(1) // benchmark process will be launched only once
                    .WithIterationTime(100) // 100ms per iteration
                    .WithWarmupCount(3) // 3 warmup iteration
                    .WithTargetCount(3)); // 3 target iteration                
            }
        }

        [Setup]
        public void Setup()
        {
            var templateId = 0;
            var xmlText = @&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;utf-8&quot;&quot;?&gt;
&lt;!DOCTYPE root[ 
&lt;!ELEMENT Home ANY&gt;
&lt;!ATTLIST Home id ID #REQUIRED&gt;
&lt;!ELEMENT CustomDocument ANY&gt;
&lt;!ATTLIST CustomDocument id ID #REQUIRED&gt;
]&gt;
&lt;root id=&quot;&quot;-1&quot;&quot;&gt;
	&lt;Home id=&quot;&quot;1046&quot;&quot; parentID=&quot;&quot;-1&quot;&quot; level=&quot;&quot;1&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-06-12T14:13:17&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:50:43&quot;&quot; nodeName=&quot;&quot;Home&quot;&quot; urlName=&quot;&quot;home&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
		&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
		&lt;umbracoUrlAlias&gt;&lt;![CDATA[this/is/my/alias, anotheralias]]&gt;&lt;/umbracoUrlAlias&gt;
		&lt;umbracoNaviHide&gt;1&lt;/umbracoNaviHide&gt;
		&lt;Home id=&quot;&quot;1173&quot;&quot; parentID=&quot;&quot;1046&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-20T18:06:45&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:07:31&quot;&quot; nodeName=&quot;&quot;Sub1&quot;&quot; urlName=&quot;&quot;sub1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046,1173&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;content&gt;&lt;![CDATA[&lt;div&gt;This is some content&lt;/div&gt;]]&gt;&lt;/content&gt;
			&lt;umbracoUrlAlias&gt;&lt;![CDATA[page2/alias, 2ndpagealias]]&gt;&lt;/umbracoUrlAlias&gt;			
			&lt;Home id=&quot;&quot;1174&quot;&quot; parentID=&quot;&quot;1173&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-20T18:07:54&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:27&quot;&quot; nodeName=&quot;&quot;Sub2&quot;&quot; urlName=&quot;&quot;sub2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046,1173,1174&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;umbracoUrlAlias&gt;&lt;![CDATA[only/one/alias]]&gt;&lt;/umbracoUrlAlias&gt;
				&lt;creatorName&gt;&lt;![CDATA[Custom data with same property name as the member name]]&gt;&lt;/creatorName&gt;
			&lt;/Home&gt;
			&lt;Home id=&quot;&quot;1176&quot;&quot; parentID=&quot;&quot;1173&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;3&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;sub-3&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046,1173,1176&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
			&lt;/Home&gt;
			&lt;CustomDocument id=&quot;&quot;1177&quot;&quot; parentID=&quot;&quot;1173&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1234&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;4&quot;&quot; createDate=&quot;&quot;2012-07-16T15:26:59&quot;&quot; updateDate=&quot;&quot;2012-07-18T14:23:35&quot;&quot; nodeName=&quot;&quot;custom sub 1&quot;&quot; urlName=&quot;&quot;custom-sub-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046,1173,1177&quot;&quot; isDoc=&quot;&quot;&quot;&quot; /&gt;
			&lt;CustomDocument id=&quot;&quot;1178&quot;&quot; parentID=&quot;&quot;1173&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1234&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;4&quot;&quot; createDate=&quot;&quot;2012-07-16T15:26:59&quot;&quot; updateDate=&quot;&quot;2012-07-16T14:23:35&quot;&quot; nodeName=&quot;&quot;custom sub 2&quot;&quot; urlName=&quot;&quot;custom-sub-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046,1173,1178&quot;&quot; isDoc=&quot;&quot;&quot;&quot; /&gt;
		&lt;/Home&gt;
		&lt;Home id=&quot;&quot;1175&quot;&quot; parentID=&quot;&quot;1046&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;3&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:01&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:49:32&quot;&quot; nodeName=&quot;&quot;Sub 2&quot;&quot; urlName=&quot;&quot;sub-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046,1175&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
		&lt;/Home&gt;
	&lt;/Home&gt;
	&lt;CustomDocument id=&quot;&quot;1172&quot;&quot; parentID=&quot;&quot;-1&quot;&quot; level=&quot;&quot;1&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1234&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-16T15:26:59&quot;&quot; updateDate=&quot;&quot;2012-07-18T14:23:35&quot;&quot; nodeName=&quot;&quot;Test&quot;&quot; urlName=&quot;&quot;test-page&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1172&quot;&quot; isDoc=&quot;&quot;&quot;&quot; /&gt;
&lt;/root&gt;&quot;;
            _xml = new XmlDocument();
            _xml.LoadXml(xmlText);
        }

        [Cleanup]
        public void Cleanup()
        {
            _xml = null;
        }

        private XmlDocument _xml;

        [Benchmark]
        public void XmlWithXPath()
        {
            var xpath = &quot;/root/* [@isDoc and @urlName=&#39;home&#39;]//* [@isDoc and @urlName=&#39;sub1&#39;]//* [@isDoc and @urlName=&#39;sub2&#39;]&quot;;
            var elt = _xml.SelectSingleNode(xpath);
            if (elt == null) Console.WriteLine(&quot;ERR&quot;);
        }

        [Benchmark]
        public void XmlWithNavigation()
        {
            var elt = _xml.DocumentElement;
            var id = NavigateElementRoute(elt, new[] {&quot;home&quot;, &quot;sub1&quot;, &quot;sub2&quot;});
            if (id &lt;= 0) Console.WriteLine(&quot;ERR&quot;);
        }

        private const bool UseLegacySchema = false;

        private int NavigateElementRoute(XmlElement elt, string[] urlParts)
        {
            var found = true;
            var i = 0;
            while (found &amp;&amp; i &lt; urlParts.Length)
            {
                found = false;
                foreach (XmlElement child in elt.ChildNodes)
                {
                    var noNode = UseLegacySchema
                        ? child.Name != &quot;node&quot;
                        : child.GetAttributeNode(&quot;isDoc&quot;) == null;
                    if (noNode) continue;
                    if (child.GetAttribute(&quot;urlName&quot;) != urlParts[i]) continue;

                    found = true;
                    elt = child;
                    break;
                }
                i++;
            }
            return found ? int.Parse(elt.GetAttribute(&quot;id&quot;)) : -1;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,13,19,28,0],[20,13,20,14,0],[21,17,21,44,0],[26,17,30,42,0],[31,13,31,14,0],[36,9,36,10,0],[37,13,37,32,0],[38,13,68,10,0],[69,13,69,38,0],[70,13,70,35,0],[71,9,71,10,0],[75,9,75,10,0],[76,13,76,25,0],[77,9,77,10,0],[83,9,83,10,0],[84,13,84,128,0],[85,13,85,52,0],[86,13,86,29,0],[86,30,86,55,0],[87,9,87,10,0],[91,9,91,10,0],[92,13,92,44,0],[93,13,93,80,0],[94,13,94,25,0],[94,26,94,51,0],[95,9,95,10,0],[100,9,100,10,0],[101,13,101,30,0],[102,13,102,23,0],[103,13,103,49,0],[104,13,104,14,0],[105,17,105,31,0],[106,17,106,24,0],[106,26,106,42,0],[106,43,106,45,0],[106,46,106,60,0],[107,17,107,18,0],[108,21,110,67,0],[111,21,111,32,0],[111,33,111,42,0],[112,21,112,70,0],[112,71,112,80,0],[114,21,114,34,0],[115,21,115,33,0],[116,21,116,27,0],[118,17,118,21,0],[119,13,119,14,0],[120,13,120,67,0],[121,9,121,10,0]]);
    </script>
  </body>
</html>