<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Macros\MacroEngineFactoryTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Moq;
using NUnit.Framework;
using umbraco.cms.businesslogic.macro;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Logging;
using Umbraco.Core.Profiling;
using umbraco.interfaces;

namespace Umbraco.Tests.Macros
{
	[TestFixture]
	public class MacroEngineFactoryTests
	{
		[SetUp]
		public void Initialize()
		{
            var logger = new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;());

		    //this ensures its reset
		    PluginManager.Current = new PluginManager(new ActivatorServiceProvider(), new NullCacheProvider(),
		        logger,
		        false)
		    {
		        AssembliesToScan = new[]
		        {
		            this.GetType().Assembly
		        }
		    };

			//for testing, we&#39;ll specify which assemblies are scanned for the PluginTypeResolver
		}

        [TearDown]
        public void TearDown()
        {
            PluginManager.Current = null;
        }

		[Test]
		public void Get_All()
		{			
			var engines = MacroEngineFactory.GetAll();
			Assert.AreEqual(2, engines.Count());
		}

		[Test]
		public void Get_Engine()
		{
			var engine1 = MacroEngineFactory.GetEngine(&quot;MacroEngine1&quot;);
			Assert.IsNotNull(engine1);
		}

		[Test]
		public void Get_By_Filename()
		{
			var engine1 = MacroEngineFactory.GetByFilename(&quot;test.me1&quot;);
			var engine2 = MacroEngineFactory.GetByFilename(&quot;test.me2&quot;);
			Assert.IsNotNull(engine1);
			Assert.IsNotNull(engine2);
			Assert.Throws&lt;MacroEngineException&gt;(() =&gt; MacroEngineFactory.GetByFilename(&quot;test.blah&quot;));

		}

		[Test]
		public void Get_By_Extension()
		{
			var engine1 = MacroEngineFactory.GetByExtension(&quot;me1&quot;);
			var engine2 = MacroEngineFactory.GetByExtension(&quot;me2&quot;);
			Assert.IsNotNull(engine1);
			Assert.IsNotNull(engine2);
			Assert.Throws&lt;MacroEngineException&gt;(() =&gt; MacroEngineFactory.GetByExtension(&quot;blah&quot;));
		}

		#region Classes for tests
		public class MacroEngine1 : IMacroEngine
		{
			public string Name
			{
				get { return &quot;MacroEngine1&quot;; }
			}

			public IEnumerable&lt;string&gt; SupportedExtensions
			{
				get { return new[] {&quot;me1&quot;}; }
			}

			public IEnumerable&lt;string&gt; SupportedUIExtensions
			{
				get { throw new NotImplementedException(); }
			}

			public Dictionary&lt;string, IMacroGuiRendering&gt; SupportedProperties
			{
				get { throw new NotImplementedException(); }
			}

			public bool Validate(string code, string tempFileName, INode currentPage, out string errorMessage)
			{
				throw new NotImplementedException();
			}

			public string Execute(MacroModel macro, INode currentPage)
			{
				throw new NotImplementedException();
			}
		}

		public class MacroEngine2 : IMacroEngine
		{
			public string Name
			{
				get { return &quot;MacroEngine2&quot;; }
			}

			public IEnumerable&lt;string&gt; SupportedExtensions
			{
				get { return new[] { &quot;me2&quot; }; }
			}

			public IEnumerable&lt;string&gt; SupportedUIExtensions
			{
				get { throw new NotImplementedException(); }
			}

			public Dictionary&lt;string, IMacroGuiRendering&gt; SupportedProperties
			{
				get { throw new NotImplementedException(); }
			}

			public bool Validate(string code, string tempFileName, INode currentPage, out string errorMessage)
			{
				throw new NotImplementedException();
			}

			public string Execute(MacroModel macro, INode currentPage)
			{
				throw new NotImplementedException();
			}
		}
		#endregion
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,3,20,4,1],[21,13,21,88,1],[24,7,32,9,1],[35,3,35,4,1],[39,9,39,10,1],[40,13,40,42,1],[41,9,41,10,1],[45,3,45,4,1],[46,4,46,46,1],[47,4,47,40,1],[48,3,48,4,1],[52,3,52,4,1],[53,4,53,63,1],[54,4,54,30,1],[55,3,55,4,1],[59,3,59,4,1],[60,4,60,63,1],[61,4,61,63,1],[62,4,62,30,1],[63,4,63,30,1],[64,4,64,46,1],[64,46,64,91,1],[64,91,64,93,1],[64,4,64,93,1],[66,3,66,4,1],[70,3,70,4,1],[71,4,71,59,1],[72,4,72,59,1],[73,4,73,30,1],[74,4,74,30,1],[75,4,75,46,1],[75,46,75,87,1],[75,87,75,89,1],[75,4,75,89,1],[76,3,76,4,1],[83,9,83,10,1],[83,11,83,33,1],[83,34,83,35,1],[88,9,88,10,1],[88,11,88,32,1],[88,33,88,34,1],[93,9,93,10,0],[93,11,93,47,0],[98,9,98,10,0],[98,11,98,47,0],[102,4,102,5,0],[103,5,103,41,0],[107,4,107,5,0],[108,5,108,41,0],[116,9,116,10,0],[116,11,116,33,0],[116,34,116,35,0],[121,9,121,10,1],[121,11,121,34,1],[121,35,121,36,1],[126,9,126,10,0],[126,11,126,47,0],[131,9,131,10,0],[131,11,131,47,0],[135,4,135,5,0],[136,5,136,41,0],[140,4,140,5,0],[141,5,141,41,0]]);
    </script>
  </body>
</html>