<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Media\Exif\ImageFile.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.ComponentModel;
using System.Drawing;
using System.IO;
using System.Text;

namespace Umbraco.Core.Media.Exif
{
	/// &lt;summary&gt;
	/// Represents the base class for image files.
	/// &lt;/summary&gt;
	[TypeDescriptionProvider(typeof(ExifFileTypeDescriptionProvider))]
	internal abstract class ImageFile
	{
		#region Constructor
		/// &lt;summary&gt;
		/// Initializes a new instance of the &lt;see cref=&quot;ImageFile&quot;/&gt; class.
		/// &lt;/summary&gt;
		protected ImageFile ()
		{
			Format = ImageFileFormat.Unknown;
			Properties = new ExifPropertyCollection (this);
            Encoding = Encoding.Default;
		}
		#endregion

		#region Properties
		/// &lt;summary&gt;
		/// Returns the format of the &lt;see cref=&quot;ImageFile&quot;/&gt;.
		/// &lt;/summary&gt;
		public ImageFileFormat Format { get; protected set; }
		/// &lt;summary&gt;
		/// Gets the collection of Exif properties contained in the &lt;see cref=&quot;ImageFile&quot;/&gt;.
		/// &lt;/summary&gt;
		public ExifPropertyCollection Properties { get; private set; }
		/// &lt;summary&gt;
		/// Gets or sets the embedded thumbnail image.
		/// &lt;/summary&gt;
		public ImageFile Thumbnail { get; set; }
		/// &lt;summary&gt;
		/// Gets or sets the Exif property with the given key.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;key&quot;&gt;The Exif tag associated with the Exif property.&lt;/param&gt;
		public ExifProperty this[ExifTag key] {
			get { return Properties[key]; }
			set { Properties[key] = value; }
		}
        /// &lt;summary&gt;
        /// Gets the encoding used for text metadata when the source encoding is unknown.
        /// &lt;/summary&gt;
        public Encoding Encoding { get; protected set; }
		#endregion

		#region Instance Methods
		/// &lt;summary&gt;
		/// Converts the &lt;see cref=&quot;ImageFile&quot;/&gt; to a &lt;see cref=&quot;System.Drawing.Image&quot;/&gt;.
		/// &lt;/summary&gt;
		/// &lt;returns&gt;Returns a &lt;see cref=&quot;System.Drawing.Image&quot;/&gt; containing image data.&lt;/returns&gt;
		public abstract Image ToImage ();

		/// &lt;summary&gt;
		/// Saves the &lt;see cref=&quot;ImageFile&quot;/&gt; to the specified file.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;filename&quot;&gt;A string that contains the name of the file.&lt;/param&gt;
		public virtual void Save (string filename)
		{
			using (FileStream stream = new FileStream (filename, FileMode.Create, FileAccess.Write, FileShare.None)) {
				Save (stream);
			}
		}

		/// &lt;summary&gt;
		/// Saves the &lt;see cref=&quot;ImageFile&quot;/&gt; to the specified stream.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;stream&quot;&gt;A &lt;see cref=&quot;Sytem.IO.Stream&quot;/&gt; to save image data to.&lt;/param&gt;
		public abstract void Save (Stream stream);
		#endregion

		#region Static Methods
		/// &lt;summary&gt;
		/// Creates an &lt;see cref=&quot;ImageFile&quot;/&gt; from the specified file.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;filename&quot;&gt;A string that contains the name of the file.&lt;/param&gt;
		/// &lt;returns&gt;The &lt;see cref=&quot;ImageFile&quot;/&gt; created from the file.&lt;/returns&gt;
		public static ImageFile FromFile (string filename)
		{
            return FromFile(filename, Encoding.Default);
		}

        /// &lt;summary&gt;
        /// Creates an &lt;see cref=&quot;ImageFile&quot;/&gt; from the specified file.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filename&quot;&gt;A string that contains the name of the file.&lt;/param&gt;
        /// &lt;param name=&quot;encoding&quot;&gt;The encoding to be used for text metadata when the source encoding is unknown.&lt;/param&gt;
        /// &lt;returns&gt;The &lt;see cref=&quot;ImageFile&quot;/&gt; created from the file.&lt;/returns&gt;
        public static ImageFile FromFile(string filename, Encoding encoding)
        {
            using (FileStream stream = new FileStream(filename, FileMode.Open, FileAccess.Read, FileShare.Read))
            {
                return FromStream(stream, encoding);
            }
        }

        /// &lt;summary&gt;
		/// Creates an &lt;see cref=&quot;ImageFile&quot;/&gt; from the specified data stream.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;stream&quot;&gt;A &lt;see cref=&quot;Sytem.IO.Stream&quot;/&gt; that contains image data.&lt;/param&gt;
		/// &lt;returns&gt;The &lt;see cref=&quot;ImageFile&quot;/&gt; created from the file.&lt;/returns&gt;
        public static ImageFile FromStream(Stream stream)
        {
            return FromStream(stream, Encoding.Default);
        }

		/// &lt;summary&gt;
		/// Creates an &lt;see cref=&quot;ImageFile&quot;/&gt; from the specified data stream.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;stream&quot;&gt;A &lt;see cref=&quot;Sytem.IO.Stream&quot;/&gt; that contains image data.&lt;/param&gt;
        /// &lt;param name=&quot;encoding&quot;&gt;The encoding to be used for text metadata when the source encoding is unknown.&lt;/param&gt;
		/// &lt;returns&gt;The &lt;see cref=&quot;ImageFile&quot;/&gt; created from the file.&lt;/returns&gt;
        public static ImageFile FromStream(Stream stream, Encoding encoding)
		{
			stream.Seek (0, SeekOrigin.Begin);
			byte[] header = new byte[8];
			stream.Seek (0, SeekOrigin.Begin);
			if (stream.Read (header, 0, header.Length) != header.Length)
				throw new NotValidImageFileException ();
			
			// JPEG
			if (header[0] == 0xFF &amp;&amp; header[1] == 0xD8)
				return new JPEGFile (stream, encoding);
			
			// TIFF
			string tiffHeader = Encoding.ASCII.GetString (header, 0, 4);
			if (tiffHeader == &quot;MM\x00\x2a&quot; || tiffHeader == &quot;II\x2a\x00&quot;)
				return new TIFFFile (stream, encoding);
			
			throw new NotValidImageFileException ();
		}
		#endregion
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[18,3,18,25,0],[19,3,19,4,0],[20,4,20,37,0],[21,4,21,51,0],[22,13,22,41,0],[23,3,23,4,0],[30,35,30,39,0],[30,40,30,54,0],[34,46,34,50,0],[34,51,34,63,0],[38,32,38,36,0],[38,37,38,41,0],[44,8,44,9,0],[44,10,44,33,0],[44,34,44,35,0],[45,8,45,9,0],[45,10,45,34,0],[45,35,45,36,0],[50,36,50,40,0],[50,41,50,55,0],[65,3,65,4,0],[66,11,66,107,0],[66,109,66,110,0],[67,5,67,19,0],[68,4,68,5,0],[69,3,69,4,0],[85,3,85,4,0],[86,13,86,57,0],[87,3,87,4,0],[96,9,96,10,0],[97,20,97,112,0],[98,13,98,14,0],[99,17,99,53,0],[101,9,101,10,0],[109,9,109,10,0],[110,13,110,57,0],[111,9,111,10,0],[120,3,120,4,0],[121,4,121,38,0],[122,4,122,32,0],[123,4,123,38,0],[124,4,124,64,0],[125,5,125,45,0],[128,4,128,47,0],[129,5,129,44,0],[132,4,132,64,0],[133,4,133,65,0],[134,5,134,44,0],[136,4,136,44,0],[137,3,137,4,0]]);
    </script>
  </body>
</html>