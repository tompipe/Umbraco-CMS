<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\media\MediaType.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using Umbraco.Core;
using Umbraco.Core.Models;
using System.Linq;
using umbraco.BusinessLogic;

namespace umbraco.cms.businesslogic.media
{
    /// &lt;summary&gt;
    /// The Mediatype
    /// 
    /// Due to the inheritance of the ContentType class,it enables definition of generic datafields on a Media.
    /// &lt;/summary&gt;
    [Obsolete(&quot;Obsolete, Use Umbraco.Core.Models.MediaType&quot;, false)]
    public class MediaType : ContentType
    {
        #region Constructors

        /// &lt;summary&gt;
        /// Constructs a MediaTypeobject given the id
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;Id of the mediatype&lt;/param&gt;
        public MediaType(int id) : base(id) { }

        /// &lt;summary&gt;
        /// Constructs a MediaTypeobject given the id
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;Id of the mediatype&lt;/param&gt;
        public MediaType(Guid id) : base(id) { }

        public MediaType(int id, bool noSetup) : base(id, noSetup) { }

        internal MediaType(IMediaType mediaType)
            : base(mediaType)
        {
            SetupNode(mediaType);
        }

        #endregion

        #region Constants and static members

        public static Guid _objectType = new Guid(Constants.ObjectTypes.MediaType);

        #endregion

        #region Private Members

        private IMediaType MediaTypeItem
        {
            get { return base.ContentTypeItem as IMediaType; }
            set { base.ContentTypeItem = value; }
        }

        #endregion

        #region Static Methods
        /// &lt;summary&gt;
        /// Retrieve a MediaType by it&#39;s alias
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;Alias&quot;&gt;The alias of the MediaType&lt;/param&gt;
        /// &lt;returns&gt;The MediaType with the alias&lt;/returns&gt;
        [Obsolete(&quot;Obsolete, Use Umbraco.Core.Services.ContentTypeService.GetMediaType()&quot;, false)]
        public static new MediaType GetByAlias(string Alias)
        {
            var mediaType = ApplicationContext.Current.Services.ContentTypeService.GetMediaType(Alias);
            return new MediaType(mediaType);
        }

        /// &lt;summary&gt;
        /// Retrieve all MediaTypes in the umbraco installation
        /// &lt;/summary&gt;
        [Obsolete(&quot;Use the GetAllAsList() method instead&quot;)]
        public new static MediaType[] GetAll
        {
            get
            {
                return GetAllAsList().ToArray();
            }
        }

        [Obsolete(&quot;Obsolete, Use Umbraco.Core.Services.ContentTypeService.GetMediaType()&quot;, false)]
        public static IEnumerable&lt;MediaType&gt; GetAllAsList()
        {
            var mediaTypes = ApplicationContext.Current.Services.ContentTypeService.GetAllMediaTypes();
            return mediaTypes.OrderBy(x =&gt; x.Name).Select(x =&gt; new MediaType(x));
        }

        /// &lt;summary&gt;
        /// Create a new Mediatype
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;u&quot;&gt;The Umbraco user context&lt;/param&gt;
        /// &lt;param name=&quot;Text&quot;&gt;The name of the MediaType&lt;/param&gt;
        /// &lt;returns&gt;The new MediaType&lt;/returns&gt;
        [Obsolete(&quot;Obsolete, Use Umbraco.Core.Models.MediaType and Umbraco.Core.Services.ContentTypeService.Save()&quot;, false)]
        public static MediaType MakeNew(User u, string Text)
        {
            return MakeNew(u, Text, -1);
        }

        internal static MediaType MakeNew(User u, string text, int parentId)
        {
            var mediaType = new Umbraco.Core.Models.MediaType(parentId) { Name = text, Alias = text, CreatorId = u.Id, Thumbnail = &quot;icon-folder&quot;, Icon = &quot;icon-folder&quot; };
            ApplicationContext.Current.Services.ContentTypeService.Save(mediaType, u.Id);
            var mt = new MediaType(mediaType.Id);

            NewEventArgs e = new NewEventArgs();
            mt.OnNew(e);

            return mt;
        }
        #endregion

        #region Public Methods
        /// &lt;summary&gt;
        /// Used to persist object changes to the database. In Version3.0 it&#39;s just a stub for future compatibility
        /// &lt;/summary&gt;
        public override void Save()
        {
            SaveEventArgs e = new SaveEventArgs();
            FireBeforeSave(e);

            if (!e.Cancel)
            {
                var current = User.GetCurrent();
                int userId = current == null ? 0 : current.Id;
                ApplicationContext.Current.Services.ContentTypeService.Save(MediaTypeItem, userId);

                base.Save();

                FireAfterSave(e);
            }
        }

        /// &lt;summary&gt;
        /// Deletes the current MediaType and all created Medias of the type.
        /// &lt;/summary&gt;
        public override void delete()
        {
            DeleteEventArgs e = new DeleteEventArgs();
            FireBeforeDelete(e);

            if (!e.Cancel)
            {
                // check that no media types uses me as a master
                if (GetAllAsList().Any(dt =&gt; dt.MasterContentTypes.Contains(this.Id)))
                {
                    throw new ArgumentException(&quot;Can&#39;t delete a Media Type used as a Master Content Type. Please remove all references first!&quot;);
                }

                ApplicationContext.Current.Services.ContentTypeService.Delete(MediaTypeItem);

                FireAfterDelete(e);
            }
        }
        #endregion

        #region Protected Methods

        protected override void setupNode()
        {
            var mediaType = ApplicationContext.Current.Services.ContentTypeService.GetMediaType(Id);
            // If it&#39;s null, it&#39;s probably a folder
            if (mediaType != null)
                SetupNode(mediaType);
        }

        #endregion

        #region Private Methods
        private void SetupNode(IMediaType mediaType)
        {
            MediaTypeItem = mediaType;

            base.PopulateContentTypeFromContentTypeBase(MediaTypeItem);
            base.PopulateCMSNodeFromUmbracoEntity(MediaTypeItem, _objectType);
        }
        #endregion

        #region Events

        /// &lt;summary&gt;
        /// The save event handler
        /// &lt;/summary&gt;
        public delegate void SaveEventHandler(MediaType sender, SaveEventArgs e);
        /// &lt;summary&gt;
        /// The new event handler
        /// &lt;/summary&gt;
        public delegate void NewEventHandler(MediaType sender, NewEventArgs e);
        /// &lt;summary&gt;
        /// The delete event handler
        /// &lt;/summary&gt;
        public delegate void DeleteEventHandler(MediaType sender, DeleteEventArgs e);


        /// &lt;summary&gt;
        /// Occurs when [before save].
        /// &lt;/summary&gt;
        public static new event SaveEventHandler BeforeSave;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:BeforeSave&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        protected override void FireBeforeSave(SaveEventArgs e)
        {
            if (BeforeSave != null)
                BeforeSave(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [after save].
        /// &lt;/summary&gt;
        public static new event SaveEventHandler AfterSave;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:AfterSave&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        protected override void FireAfterSave(SaveEventArgs e)
        {
            if (AfterSave != null)
                AfterSave(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [new].
        /// &lt;/summary&gt;
        public static event NewEventHandler New;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:New&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        protected virtual void OnNew(NewEventArgs e)
        {
            if (New != null)
                New(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [before delete].
        /// &lt;/summary&gt;
        public static new event DeleteEventHandler BeforeDelete;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:BeforeDelete&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        protected override void FireBeforeDelete(DeleteEventArgs e)
        {
            if (BeforeDelete != null)
                BeforeDelete(this, e);
        }

        /// &lt;summary&gt;
        /// Occurs when [after delete].
        /// &lt;/summary&gt;
        public static new event DeleteEventHandler AfterDelete;
        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:AfterDelete&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;System.EventArgs&quot;/&gt; instance containing the event data.&lt;/param&gt;
        protected override void FireAfterDelete(DeleteEventArgs e)
        {
            if (AfterDelete != null)
                AfterDelete(this, e);
        }
        #endregion

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[24,36,24,44,1],[24,45,24,46,1],[24,47,24,48,1],[30,37,30,45,0],[30,46,30,47,0],[30,48,30,49,0],[32,50,32,67,0],[32,68,32,69,0],[32,70,32,71,0],[35,15,35,30,0],[36,9,36,10,0],[37,13,37,34,0],[38,9,38,10,0],[44,9,44,84,1],[52,17,52,18,1],[52,19,52,61,1],[52,62,52,63,1],[53,17,53,18,1],[53,19,53,48,1],[53,49,53,50,1],[66,9,66,10,0],[67,13,67,104,0],[68,13,68,45,0],[69,9,69,10,0],[78,13,78,14,0],[79,17,79,49,0],[80,13,80,14,0],[85,9,85,10,0],[86,13,86,104,0],[87,13,87,44,0],[87,44,87,50,0],[87,50,87,64,0],[87,64,87,80,0],[87,80,87,82,0],[87,13,87,82,0],[88,9,88,10,0],[98,9,98,10,1],[99,13,99,41,1],[100,9,100,10,1],[103,9,103,10,1],[104,13,104,170,1],[105,13,105,90,1],[106,13,106,50,1],[108,13,108,49,1],[109,13,109,25,1],[111,13,111,23,1],[112,9,112,10,1],[120,9,120,10,0],[121,13,121,51,0],[122,13,122,31,0],[124,13,124,27,0],[125,13,125,14,0],[126,17,126,49,0],[127,17,127,63,0],[128,17,128,100,0],[130,17,130,29,0],[132,17,132,34,0],[133,13,133,14,0],[134,9,134,10,0],[140,9,140,10,0],[141,13,141,55,0],[142,13,142,33,0],[144,13,144,27,0],[145,13,145,14,0],[147,17,147,46,0],[147,46,147,85,0],[147,85,147,87,0],[147,17,147,87,0],[148,17,148,18,0],[149,21,149,145,0],[152,17,152,94,0],[154,17,154,36,0],[155,13,155,14,0],[156,9,156,10,0],[162,9,162,10,1],[163,13,163,101,1],[165,13,165,35,1],[166,17,166,38,1],[167,9,167,10,1],[173,9,173,10,1],[174,13,174,39,1],[176,13,176,72,1],[177,13,177,79,1],[178,9,178,10,1],[206,9,206,10,0],[207,13,207,36,0],[208,17,208,37,0],[209,9,209,10,0],[220,9,220,10,0],[221,13,221,35,0],[222,17,222,36,0],[223,9,223,10,0],[234,9,234,10,1],[235,13,235,29,1],[236,17,236,30,0],[237,9,237,10,1],[248,9,248,10,0],[249,13,249,38,0],[250,17,250,39,0],[251,9,251,10,0],[262,9,262,10,0],[263,13,263,37,0],[264,17,264,38,0],[265,9,265,10,0]]);
    </script>
  </body>
</html>