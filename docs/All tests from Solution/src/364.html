<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Persistence\Repositories\TagRepositoryTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using Moq;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Configuration.UmbracoSettings;
using Umbraco.Core.IO;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Models.Rdbms;
using Umbraco.Core.Persistence;

using Umbraco.Core.Persistence.Repositories;
using Umbraco.Core.Persistence.UnitOfWork;
using Umbraco.Tests.TestHelpers;
using Umbraco.Tests.TestHelpers.Entities;

namespace Umbraco.Tests.Persistence.Repositories
{
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerTest)]
    [TestFixture]
    public class TagRepositoryTest : BaseDatabaseFactoryTest
    {
        [SetUp]
        public override void Initialize()
        {
            base.Initialize();
        }

        [TearDown]
        public override void TearDown()
        {
            base.TearDown();
        }

        private TagRepository CreateRepository(IDatabaseUnitOfWork unitOfWork)
        {
            var tagRepository = new TagRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax);
            return tagRepository;
        }

        [Test]
        public void Can_Perform_Add_On_Repository()
        {
            // Arrange
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            using (var repository = CreateRepository(unitOfWork))
            {
                var tag = new Tag()
                    {
                        Group = &quot;Test&quot;,
                        Text = &quot;Test&quot;
                    };

                // Act
                repository.AddOrUpdate(tag);
                unitOfWork.Commit();

                // Assert
                Assert.That(tag.HasIdentity, Is.True);
            }
        }

        [Test]
        public void Can_Perform_Multiple_Adds_On_Repository()
        {
            // Arrange
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            using (var repository = CreateRepository(unitOfWork))
            {
                var tag = new Tag()
                    {
                        Group = &quot;Test&quot;,
                        Text = &quot;Test&quot;
                    };

                // Act
                repository.AddOrUpdate(tag);
                unitOfWork.Commit();

                var tag2 = new Tag()
                    {
                        Group = &quot;Test&quot;,
                        Text = &quot;Test2&quot;
                    };
                repository.AddOrUpdate(tag2);
                unitOfWork.Commit();

                // Assert
                Assert.That(tag.HasIdentity, Is.True);
                Assert.That(tag2.HasIdentity, Is.True);
                Assert.AreNotEqual(tag.Id, tag2.Id);
            }

        }

        [Test]
        public void Can_Create_Tag_Relations()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                            }, false);

                    Assert.AreEqual(2, repository.GetTagsForEntity(content.Id).Count());
                }
            }
        }

        [Test]
        public void Can_Append_Tag_Relations()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                            }, false);

                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;},
                            }, false);

                    Assert.AreEqual(4, repository.GetTagsForEntity(content.Id).Count());
                }
            }
        }

        [Test]
        public void Can_Replace_Tag_Relations()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                            }, false);

                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;},
                            }, true);

                    var result = repository.GetTagsForEntity(content.Id);
                    Assert.AreEqual(2, result.Count());
                    Assert.AreEqual(&quot;tag3&quot;, result.ElementAt(0).Text);
                    Assert.AreEqual(&quot;tag4&quot;, result.ElementAt(1).Text);
                }
            }
        }

        [Test]
        public void Can_Merge_Tag_Relations()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                            }, false);

                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                            }, false);

                    var result = repository.GetTagsForEntity(content.Id);
                    Assert.AreEqual(3, result.Count());                    
                }
            }
        }

        [Test]
        public void Can_Clear_Tag_Relations()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                            }, false);

                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        Enumerable.Empty&lt;ITag&gt;(), true);                    

                    var result = repository.GetTagsForEntity(content.Id);
                    Assert.AreEqual(0, result.Count());
                }
            }
        }

        [Test]
        public void Can_Remove_Specific_Tags_From_Property()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.RemoveTagsFromProperty(
                        content.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;}                             
                            });

                    var result = repository.GetTagsForEntity(content.Id);
                    Assert.AreEqual(2, result.Count());
                    Assert.AreEqual(&quot;tag1&quot;, result.ElementAt(0).Text);
                    Assert.AreEqual(&quot;tag4&quot;, result.ElementAt(1).Text);
                }
            }
        }

        [Test]
        public void Can_Get_Tags_For_Content_By_Id()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                var content2 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content2);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content2.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;}
                            }, false);

                    var result = repository.GetTagsForEntity(content2.Id);
                    Assert.AreEqual(2, result.Count());

                }
            }
        }

        [Test]
        public void Can_Get_Tags_For_Content_By_Key()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                var content2 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content2);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content2.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;}
                            }, false);
                    
                    //get by key
                    var result = repository.GetTagsForEntity(content2.Key);
                    Assert.AreEqual(2, result.Count());
                }
            }
        }

        [Test]
        public void Can_Get_All()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                var content2 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content2);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                            }, false);

                    var result = repository.GetAll();
                    Assert.AreEqual(4, result.Count());
                }
            }
        }

        [Test]
        public void Can_Get_All_With_Ids()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                var content2 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content2);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    var tags = new[]
                    {
                        new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                        new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                        new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                        new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                    };
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        tags, false);

                    //TODO: This would be nice to be able to map the ids back but unfortunately we are not doing this
                    //var result = repository.GetAll(new[] {tags[0].Id, tags[1].Id, tags[2].Id});
                    var all = repository.GetAll().ToArray();

                    var result = repository.GetAll(new[] { all[0].Id, all[1].Id, all[2].Id });
                    Assert.AreEqual(3, result.Count());
                }
            }
        }

        [Test]
        public void Can_Get_Tags_For_Content_For_Group()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                var content2 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content2);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test1&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content2.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;}
                            }, false);

                    var result = repository.GetTagsForEntity(content1.Id, &quot;test1&quot;);
                    Assert.AreEqual(2, result.Count());
                }
            }
        }

        [Test]
        public void Can_Get_Tags_For_Property_By_Id()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);                
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;}
                            }, false);

                    var result1 = repository.GetTagsForProperty(content1.Id, contentType.PropertyTypes.First().Alias).ToArray();
                    var result2 = repository.GetTagsForProperty(content1.Id, contentType.PropertyTypes.Last().Alias).ToArray();
                    Assert.AreEqual(4, result1.Count());
                    Assert.AreEqual(2, result2.Count());
                }
            }

        }

        [Test]
        public void Can_Get_Tags_For_Property_By_Key()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;}
                            }, false);

                    var result1 = repository.GetTagsForProperty(content1.Key, contentType.PropertyTypes.First().Alias).ToArray();
                    var result2 = repository.GetTagsForProperty(content1.Key, contentType.PropertyTypes.Last().Alias).ToArray();
                    Assert.AreEqual(4, result1.Count());
                    Assert.AreEqual(2, result2.Count());
                }
            }

        }

        [Test]
        public void Can_Get_Tags_For_Property_For_Group()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test1&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;}
                            }, false);

                    var result1 = repository.GetTagsForProperty(content1.Id, contentType.PropertyTypes.First().Alias, &quot;test1&quot;).ToArray();
                    var result2 = repository.GetTagsForProperty(content1.Id, contentType.PropertyTypes.Last().Alias, &quot;test1&quot;).ToArray();

                    Assert.AreEqual(2, result1.Count());
                    Assert.AreEqual(1, result2.Count());

                }
            }

        }

        [Test]
        public void Can_Get_Tags_For_Entity_Type()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            MediaTypeRepository mediaTypeRepository;
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            using (var mediaRepository = CreateMediaRepository(unitOfWork, out mediaTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                unitOfWork.Commit();
                var mediaType = MockedContentTypes.CreateImageMediaType(&quot;image2&quot;);
                mediaTypeRepository.AddOrUpdate(mediaType);
                unitOfWork.Commit();
                var media1 = MockedMedia.CreateMediaImage(mediaType, -1);
                mediaRepository.AddOrUpdate(media1);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        media1.Id,
                        mediaType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test1&quot;}
                            }, false);

                    var result1 = repository.GetTagsForEntityType(TaggableObjectTypes.Content).ToArray();
                    var result2 = repository.GetTagsForEntityType(TaggableObjectTypes.Media).ToArray();
                    var result3 = repository.GetTagsForEntityType(TaggableObjectTypes.All).ToArray();

                    Assert.AreEqual(3, result1.Count());
                    Assert.AreEqual(2, result2.Count());
                    Assert.AreEqual(4, result3.Count());

                    Assert.AreEqual(1, result1.Single(x =&gt; x.Text == &quot;tag1&quot;).NodeCount);
                    Assert.AreEqual(2, result3.Single(x =&gt; x.Text == &quot;tag1&quot;).NodeCount);
                    Assert.AreEqual(1, result3.Single(x =&gt; x.Text == &quot;tag4&quot;).NodeCount);

                }
            }

        }

        [Test]
        public void Can_Get_Tags_For_Entity_Type_For_Group()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            MediaTypeRepository mediaTypeRepository;
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            using (var mediaRepository = CreateMediaRepository(unitOfWork, out mediaTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                unitOfWork.Commit();
                var mediaType = MockedContentTypes.CreateImageMediaType(&quot;image2&quot;);
                mediaTypeRepository.AddOrUpdate(mediaType);
                unitOfWork.Commit();
                var media1 = MockedMedia.CreateMediaImage(mediaType, -1);
                mediaRepository.AddOrUpdate(media1);
                unitOfWork.Commit();
                
                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test1&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        media1.Id,
                        mediaType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;}
                            }, false);

                    var result1 = repository.GetTagsForEntityType(TaggableObjectTypes.Content,  &quot;test1&quot;).ToArray();
                    var result2 = repository.GetTagsForEntityType(TaggableObjectTypes.Media, &quot;test1&quot;).ToArray();

                    Assert.AreEqual(2, result1.Count());
                    Assert.AreEqual(1, result2.Count());

                }
            }

        }

        [Test]
        public void Cascade_Deletes_Tag_Relations()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag4&quot;, Group = &quot;test&quot;}
                            }, false);
                    
                    contentRepository.Delete(content1);

                    unitOfWork.Commit();

                    Assert.AreEqual(0, DatabaseContext.Database.ExecuteScalar&lt;int&gt;(
                        &quot;SELECT COUNT(*) FROM cmsTagRelationship WHERE nodeId=@nodeId AND propertyTypeId=@propTypeId&quot;,
                        new { nodeId = content1.Id, propTypeId = contentType.PropertyTypes.First().Id }));
                }
            }

        }

        [Test]
        public void Can_Get_Tagged_Entities_For_Tag_Group()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            MediaTypeRepository mediaTypeRepository;
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            using (var mediaRepository = CreateMediaRepository(unitOfWork, out mediaTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();
                
                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                unitOfWork.Commit();

                var content2 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content2);
                unitOfWork.Commit();

                var mediaType = MockedContentTypes.CreateImageMediaType(&quot;image2&quot;);
                mediaTypeRepository.AddOrUpdate(mediaType);
                unitOfWork.Commit();
                var media1 = MockedMedia.CreateMediaImage(mediaType, -1);
                mediaRepository.AddOrUpdate(media1);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content2.Id,
                        contentType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        media1.Id,
                        mediaType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;}
                            }, false);

                    var contentTestIds = repository.GetTaggedEntitiesByTagGroup(TaggableObjectTypes.Content, &quot;test&quot;).ToArray();
                    //there are two content items tagged against the &#39;test&#39; group
                    Assert.AreEqual(2, contentTestIds.Count());
                    //there are a total of two property types tagged against the &#39;test&#39; group
                    Assert.AreEqual(2, contentTestIds.SelectMany(x =&gt; x.TaggedProperties).Count());
                    //there are a total of 2 tags tagged against the &#39;test&#39; group
                    Assert.AreEqual(2, contentTestIds.SelectMany(x =&gt; x.TaggedProperties).SelectMany(x =&gt; x.Tags).Select(x =&gt; x.Id).Distinct().Count());

                    var contentTest1Ids = repository.GetTaggedEntitiesByTagGroup(TaggableObjectTypes.Content, &quot;test1&quot;).ToArray();
                    //there are two content items tagged against the &#39;test1&#39; group
                    Assert.AreEqual(2, contentTest1Ids.Count());
                    //there are a total of two property types tagged against the &#39;test1&#39; group
                    Assert.AreEqual(2, contentTest1Ids.SelectMany(x =&gt; x.TaggedProperties).Count());
                    //there are a total of 1 tags tagged against the &#39;test1&#39; group
                    Assert.AreEqual(1, contentTest1Ids.SelectMany(x =&gt; x.TaggedProperties).SelectMany(x =&gt; x.Tags).Select(x =&gt; x.Id).Distinct().Count());

                    var mediaTestIds = repository.GetTaggedEntitiesByTagGroup(TaggableObjectTypes.Media, &quot;test&quot;);
                    Assert.AreEqual(1, mediaTestIds.Count());

                    var mediaTest1Ids = repository.GetTaggedEntitiesByTagGroup(TaggableObjectTypes.Media, &quot;test1&quot;);
                    Assert.AreEqual(1, mediaTest1Ids.Count());
                }
            }

        }

        [Test]
        public void Can_Get_Tagged_Entities_For_Tag()
        {
            var provider = new PetaPocoUnitOfWorkProvider(Logger);
            var unitOfWork = provider.GetUnitOfWork();
            MediaTypeRepository mediaTypeRepository;
            ContentTypeRepository contentTypeRepository;
            using (var contentRepository = CreateContentRepository(unitOfWork, out contentTypeRepository))
            using (var mediaRepository = CreateMediaRepository(unitOfWork, out mediaTypeRepository))
            {
                //create data to relate to
                var contentType = MockedContentTypes.CreateSimpleContentType(&quot;test&quot;, &quot;Test&quot;);
                contentTypeRepository.AddOrUpdate(contentType);
                unitOfWork.Commit();

                var content1 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content1);
                unitOfWork.Commit();

                var content2 = MockedContent.CreateSimpleContent(contentType);
                contentRepository.AddOrUpdate(content2);
                unitOfWork.Commit();

                var mediaType = MockedContentTypes.CreateImageMediaType(&quot;image2&quot;);
                mediaTypeRepository.AddOrUpdate(mediaType);
                unitOfWork.Commit();
                var media1 = MockedMedia.CreateMediaImage(mediaType, -1);
                mediaRepository.AddOrUpdate(media1);
                unitOfWork.Commit();

                using (var repository = CreateRepository(unitOfWork))
                {
                    repository.AssignTagsToProperty(
                        content1.Id,
                        contentType.PropertyTypes.First().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                                new Tag {Text = &quot;tag3&quot;, Group = &quot;test&quot;}
                            }, false);

                    repository.AssignTagsToProperty(
                        content2.Id,
                        contentType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;},
                            }, false);

                    repository.AssignTagsToProperty(
                        media1.Id,
                        mediaType.PropertyTypes.Last().Id,
                        new[]
                            {
                                new Tag {Text = &quot;tag1&quot;, Group = &quot;test&quot;},
                                new Tag {Text = &quot;tag2&quot;, Group = &quot;test1&quot;}
                            }, false);

                    var contentTestIds = repository.GetTaggedEntitiesByTag(TaggableObjectTypes.Content, &quot;tag1&quot;).ToArray();
                    //there are two content items tagged against the &#39;tag1&#39; tag
                    Assert.AreEqual(2, contentTestIds.Count());
                    //there are a total of two property types tagged against the &#39;tag1&#39; tag
                    Assert.AreEqual(2, contentTestIds.SelectMany(x =&gt; x.TaggedProperties).Count());
                    //there are a total of 1 tags since we&#39;re only looking against one tag
                    Assert.AreEqual(1, contentTestIds.SelectMany(x =&gt; x.TaggedProperties).SelectMany(x =&gt; x.Tags).Select(x =&gt; x.Id).Distinct().Count());

                    var contentTest1Ids = repository.GetTaggedEntitiesByTag(TaggableObjectTypes.Content, &quot;tag3&quot;).ToArray();
                    //there are 1 content items tagged against the &#39;tag3&#39; tag
                    Assert.AreEqual(1, contentTest1Ids.Count());
                    //there are a total of two property types tagged against the &#39;tag3&#39; tag
                    Assert.AreEqual(1, contentTest1Ids.SelectMany(x =&gt; x.TaggedProperties).Count());
                    //there are a total of 1 tags since we&#39;re only looking against one tag
                    Assert.AreEqual(1, contentTest1Ids.SelectMany(x =&gt; x.TaggedProperties).SelectMany(x =&gt; x.Tags).Select(x =&gt; x.Id).Distinct().Count());

                    var mediaTestIds = repository.GetTaggedEntitiesByTag(TaggableObjectTypes.Media, &quot;tag1&quot;);
                    Assert.AreEqual(1, mediaTestIds.Count());
                    
                }
            }

        }

        private ContentRepository CreateContentRepository(IDatabaseUnitOfWork unitOfWork, out ContentTypeRepository contentTypeRepository)
        {
            var templateRepository = new TemplateRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax, Mock.Of&lt;IFileSystem&gt;(), Mock.Of&lt;IFileSystem&gt;(), Mock.Of&lt;ITemplatesSection&gt;());
            var tagRepository = new TagRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax);
            contentTypeRepository = new ContentTypeRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax, templateRepository);
            var repository = new ContentRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax, contentTypeRepository, templateRepository, tagRepository, Mock.Of&lt;IContentSection&gt;());
            return repository;
        }

        private MediaRepository CreateMediaRepository(IDatabaseUnitOfWork unitOfWork, out MediaTypeRepository mediaTypeRepository)
        {
            var tagRepository = new TagRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax);
            mediaTypeRepository = new MediaTypeRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax);
            var repository = new MediaRepository(unitOfWork, CacheHelper.CreateDisabledCacheHelper(), Mock.Of&lt;ILogger&gt;(), SqlSyntax, mediaTypeRepository, tagRepository, Mock.Of&lt;IContentSection&gt;());
            return repository;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[27,13,27,31,1],[28,9,28,10,1],[32,9,32,10,1],[33,13,33,29,1],[34,9,34,10,1],[37,9,37,10,1],[38,13,38,135,1],[39,13,39,34,1],[40,9,40,10,1],[44,9,44,10,1],[46,13,46,67,1],[47,13,47,55,1],[48,20,48,65,1],[49,13,49,14,1],[50,17,54,23,1],[57,17,57,45,1],[58,17,58,37,1],[61,17,61,55,1],[62,13,62,14,1],[63,9,63,10,1],[67,9,67,10,1],[69,13,69,67,1],[70,13,70,55,1],[71,20,71,65,1],[72,13,72,14,1],[73,17,77,23,1],[80,17,80,45,1],[81,17,81,37,1],[83,17,87,23,1],[88,17,88,46,1],[89,17,89,37,1],[92,17,92,55,1],[93,17,93,56,1],[94,17,94,53,1],[95,13,95,14,1],[97,9,97,10,1],[101,9,101,10,1],[102,13,102,67,1],[103,13,103,55,1],[105,20,105,106,1],[106,13,106,14,1],[108,17,108,94,1],[109,17,109,64,1],[110,17,110,37,1],[111,17,111,78,1],[112,17,112,56,1],[113,17,113,37,1],[115,24,115,69,1],[116,17,116,18,1],[117,21,124,39,1],[126,21,126,89,1],[127,17,127,18,1],[128,13,128,14,1],[129,9,129,10,1],[133,9,133,10,1],[134,13,134,67,1],[135,13,135,55,1],[137,20,137,106,1],[138,13,138,14,1],[140,17,140,94,1],[141,17,141,64,1],[142,17,142,37,1],[143,17,143,78,1],[144,17,144,56,1],[145,17,145,37,1],[147,24,147,69,1],[148,17,148,18,1],[149,21,156,39,1],[158,21,165,39,1],[167,21,167,89,1],[168,17,168,18,1],[169,13,169,14,1],[170,9,170,10,1],[174,9,174,10,1],[175,13,175,67,1],[176,13,176,55,1],[178,20,178,106,1],[179,13,179,14,1],[181,17,181,94,1],[182,17,182,64,1],[183,17,183,37,1],[184,17,184,78,1],[185,17,185,56,1],[186,17,186,37,1],[188,24,188,69,1],[189,17,189,18,1],[190,21,197,39,1],[199,21,206,38,1],[208,21,208,74,1],[209,21,209,56,1],[210,21,210,71,1],[211,21,211,71,1],[212,17,212,18,1],[213,13,213,14,1],[214,9,214,10,1],[218,9,218,10,1],[219,13,219,67,1],[220,13,220,55,1],[222,20,222,106,1],[223,13,223,14,1],[225,17,225,94,1],[226,17,226,64,1],[227,17,227,37,1],[228,17,228,78,1],[229,17,229,56,1],[230,17,230,37,1],[232,24,232,69,1],[233,17,233,18,1],[234,21,241,39,1],[243,21,250,39,1],[252,21,252,74,1],[253,21,253,56,1],[254,17,254,18,1],[255,13,255,14,1],[256,9,256,10,1],[260,9,260,10,1],[261,13,261,67,1],[262,13,262,55,1],[264,20,264,106,1],[265,13,265,14,1],[267,17,267,94,1],[268,17,268,64,1],[269,17,269,37,1],[270,17,270,78,1],[271,17,271,56,1],[272,17,272,37,1],[274,24,274,69,1],[275,17,275,18,1],[276,21,283,39,1],[285,21,288,57,1],[290,21,290,74,1],[291,21,291,56,1],[292,17,292,18,1],[293,13,293,14,1],[294,9,294,10,1],[298,9,298,10,1],[299,13,299,67,1],[300,13,300,55,1],[302,20,302,106,1],[303,13,303,14,1],[305,17,305,94,1],[306,17,306,64,1],[307,17,307,37,1],[308,17,308,78,1],[309,17,309,56,1],[310,17,310,37,1],[312,24,312,69,1],[313,17,313,18,1],[314,21,323,39,1],[325,21,332,32,1],[334,21,334,74,1],[335,21,335,56,1],[336,21,336,71,1],[337,21,337,71,1],[338,17,338,18,1],[339,13,339,14,1],[340,9,340,10,1],[344,9,344,10,1],[345,13,345,67,1],[346,13,346,55,1],[348,20,348,106,1],[349,13,349,14,1],[351,17,351,94,1],[352,17,352,64,1],[353,17,353,37,1],[354,17,354,79,1],[355,17,355,57,1],[356,17,356,79,1],[357,17,357,57,1],[358,17,358,37,1],[360,24,360,69,1],[361,17,361,18,1],[362,21,371,39,1],[373,21,380,39,1],[382,21,382,75,1],[383,21,383,56,1],[385,17,385,18,1],[386,13,386,14,1],[387,9,387,10,1],[391,9,391,10,1],[392,13,392,67,1],[393,13,393,55,1],[395,20,395,106,1],[396,13,396,14,1],[398,17,398,94,1],[399,17,399,64,1],[400,17,400,37,1],[401,17,401,79,1],[402,17,402,57,1],[403,17,403,79,1],[404,17,404,57,1],[405,17,405,37,1],[407,24,407,69,1],[408,17,408,18,1],[409,21,418,39,1],[420,21,427,39,1],[430,21,430,76,1],[431,21,431,56,1],[432,17,432,18,1],[433,13,433,14,1],[434,9,434,10,1],[438,9,438,10,1],[439,13,439,67,1],[440,13,440,55,1],[442,20,442,106,1],[443,13,443,14,1],[445,17,445,94,1],[446,17,446,64,1],[447,17,447,37,1],[448,17,448,79,1],[449,17,449,57,1],[450,17,450,79,1],[451,17,451,57,1],[452,17,452,37,1],[454,24,454,69,1],[455,17,455,18,1],[456,21,465,39,1],[467,21,467,54,1],[468,21,468,56,1],[469,17,469,18,1],[470,13,470,14,1],[471,9,471,10,1],[475,9,475,10,1],[476,13,476,67,1],[477,13,477,55,1],[479,20,479,106,1],[480,13,480,14,1],[482,17,482,94,1],[483,17,483,64,1],[484,17,484,37,1],[485,17,485,79,1],[486,17,486,57,1],[487,17,487,79,1],[488,17,488,57,1],[489,17,489,37,1],[491,24,491,69,1],[492,17,492,18,1],[493,21,499,23,1],[500,21,503,38,1],[507,21,507,61,1],[509,21,509,95,1],[510,21,510,56,1],[511,17,511,18,1],[512,13,512,14,1],[513,9,513,10,1],[517,9,517,10,1],[518,13,518,67,1],[519,13,519,55,1],[521,20,521,106,1],[522,13,522,14,1],[524,17,524,94,1],[525,17,525,64,1],[526,17,526,37,1],[527,17,527,79,1],[528,17,528,57,1],[529,17,529,79,1],[530,17,530,57,1],[531,17,531,37,1],[533,24,533,69,1],[534,17,534,18,1],[535,21,544,39,1],[546,21,553,39,1],[555,21,555,84,1],[556,21,556,56,1],[557,17,557,18,1],[558,13,558,14,1],[559,9,559,10,1],[563,9,563,10,1],[564,13,564,67,1],[565,13,565,55,1],[567,20,567,106,1],[568,13,568,14,1],[570,17,570,94,1],[571,17,571,64,1],[572,17,572,37,1],[573,17,573,79,1],[574,17,574,57,1],[575,17,575,37,1],[577,24,577,69,1],[578,17,578,18,1],[579,21,588,39,1],[590,21,597,39,1],[599,21,599,129,1],[600,21,600,128,1],[601,21,601,57,1],[602,21,602,57,1],[603,17,603,18,1],[604,13,604,14,1],[606,9,606,10,1],[610,9,610,10,1],[611,13,611,67,1],[612,13,612,55,1],[614,20,614,106,1],[615,13,615,14,1],[617,17,617,94,1],[618,17,618,64,1],[619,17,619,37,1],[620,17,620,79,1],[621,17,621,57,1],[622,17,622,37,1],[624,24,624,69,1],[625,17,625,18,1],[626,21,635,39,1],[637,21,644,39,1],[646,21,646,130,1],[647,21,647,129,1],[648,21,648,57,1],[649,21,649,57,1],[650,17,650,18,1],[651,13,651,14,1],[653,9,653,10,1],[657,9,657,10,1],[658,13,658,67,1],[659,13,659,55,1],[661,20,661,106,1],[662,13,662,14,1],[664,17,664,94,1],[665,17,665,64,1],[666,17,666,37,1],[667,17,667,79,1],[668,17,668,57,1],[669,17,669,37,1],[671,24,671,69,1],[672,17,672,18,1],[673,21,682,39,1],[684,21,691,39,1],[693,21,693,138,1],[694,21,694,137,1],[696,21,696,57,1],[697,21,697,57,1],[699,17,699,18,1],[700,13,700,14,1],[702,9,702,10,1],[706,9,706,10,1],[707,13,707,67,1],[708,13,708,55,1],[711,20,711,106,1],[712,20,712,100,1],[713,13,713,14,1],[715,17,715,94,1],[716,17,716,64,1],[717,17,717,37,1],[718,17,718,79,1],[719,17,719,57,1],[720,17,720,37,1],[721,17,721,83,1],[722,17,722,60,1],[723,17,723,37,1],[724,17,724,74,1],[725,17,725,53,1],[726,17,726,37,1],[728,24,728,69,1],[729,17,729,18,1],[730,21,738,39,1],[740,21,747,39,1],[749,21,749,106,1],[750,21,750,104,1],[751,21,751,102,1],[753,21,753,57,1],[754,21,754,57,1],[755,21,755,57,1],[757,21,757,60,1],[757,60,757,76,1],[757,76,757,89,1],[757,21,757,89,1],[758,21,758,60,1],[758,60,758,76,1],[758,76,758,89,1],[758,21,758,89,1],[759,21,759,60,1],[759,60,759,76,1],[759,76,759,89,1],[759,21,759,89,1],[761,17,761,18,1],[762,13,762,14,1],[764,9,764,10,1],[768,9,768,10,1],[769,13,769,67,1],[770,13,770,55,1],[773,20,773,106,1],[774,20,774,100,1],[775,13,775,14,1],[777,17,777,94,1],[778,17,778,64,1],[779,17,779,37,1],[780,17,780,79,1],[781,17,781,57,1],[782,17,782,37,1],[783,17,783,83,1],[784,17,784,60,1],[785,17,785,37,1],[786,17,786,74,1],[787,17,787,53,1],[788,17,788,37,1],[790,24,790,69,1],[791,17,791,18,1],[792,21,801,39,1],[803,21,810,39,1],[812,21,812,116,1],[813,21,813,113,1],[815,21,815,57,1],[816,21,816,57,1],[818,17,818,18,1],[819,13,819,14,1],[821,9,821,10,1],[825,9,825,10,1],[826,13,826,67,1],[827,13,827,55,1],[829,20,829,106,1],[830,13,830,14,1],[832,17,832,94,1],[833,17,833,64,1],[834,17,834,37,1],[835,17,835,79,1],[836,17,836,57,1],[837,17,837,37,1],[839,24,839,69,1],[840,17,840,18,1],[841,21,850,39,1],[852,21,852,56,1],[854,21,854,41,1],[856,21,858,107,1],[859,17,859,18,1],[860,13,860,14,1],[862,9,862,10,1],[866,9,866,10,1],[867,13,867,67,1],[868,13,868,55,1],[871,20,871,106,1],[872,20,872,100,1],[873,13,873,14,1],[875,17,875,94,1],[876,17,876,64,1],[877,17,877,37,1],[879,17,879,79,1],[880,17,880,57,1],[881,17,881,37,1],[883,17,883,79,1],[884,17,884,57,1],[885,17,885,37,1],[887,17,887,83,1],[888,17,888,60,1],[889,17,889,37,1],[890,17,890,74,1],[891,17,891,53,1],[892,17,892,37,1],[894,24,894,69,1],[895,17,895,18,1],[896,21,904,39,1],[906,21,914,39,1],[916,21,923,39,1],[925,21,925,128,1],[927,21,927,64,1],[929,21,929,71,1],[929,71,929,89,1],[929,89,929,100,1],[929,21,929,100,1],[931,21,931,71,1],[931,71,931,89,1],[931,89,931,107,1],[931,107,931,113,1],[931,113,931,127,1],[931,127,931,131,1],[931,131,931,153,1],[931,21,931,153,1],[933,21,933,130,1],[935,21,935,65,1],[937,21,937,72,1],[937,72,937,90,1],[937,90,937,101,1],[937,21,937,101,1],[939,21,939,72,1],[939,72,939,90,1],[939,90,939,108,1],[939,108,939,114,1],[939,114,939,128,1],[939,128,939,132,1],[939,132,939,154,1],[939,21,939,154,1],[941,21,941,114,1],[942,21,942,62,1],[944,21,944,116,1],[945,21,945,63,1],[946,17,946,18,1],[947,13,947,14,1],[949,9,949,10,1],[953,9,953,10,1],[954,13,954,67,1],[955,13,955,55,1],[958,20,958,106,1],[959,20,959,100,1],[960,13,960,14,1],[962,17,962,94,1],[963,17,963,64,1],[964,17,964,37,1],[966,17,966,79,1],[967,17,967,57,1],[968,17,968,37,1],[970,17,970,79,1],[971,17,971,57,1],[972,17,972,37,1],[974,17,974,83,1],[975,17,975,60,1],[976,17,976,37,1],[977,17,977,74,1],[978,17,978,53,1],[979,17,979,37,1],[981,24,981,69,1],[982,17,982,18,1],[983,21,991,39,1],[993,21,1000,39,1],[1002,21,1009,39,1],[1011,21,1011,123,1],[1013,21,1013,64,1],[1015,21,1015,71,1],[1015,71,1015,89,1],[1015,89,1015,100,1],[1015,21,1015,100,1],[1017,21,1017,71,1],[1017,71,1017,89,1],[1017,89,1017,107,1],[1017,107,1017,113,1],[1017,113,1017,127,1],[1017,127,1017,131,1],[1017,131,1017,153,1],[1017,21,1017,153,1],[1019,21,1019,124,1],[1021,21,1021,65,1],[1023,21,1023,72,1],[1023,72,1023,90,1],[1023,90,1023,101,1],[1023,21,1023,101,1],[1025,21,1025,72,1],[1025,72,1025,90,1],[1025,90,1025,108,1],[1025,108,1025,114,1],[1025,114,1025,128,1],[1025,128,1025,132,1],[1025,132,1025,154,1],[1025,21,1025,154,1],[1027,21,1027,109,1],[1028,21,1028,62,1],[1030,17,1030,18,1],[1031,13,1031,14,1],[1033,9,1033,10,1],[1036,9,1036,10,1],[1037,13,1037,223,1],[1038,13,1038,135,1],[1039,13,1039,167,1],[1040,13,1040,222,1],[1041,13,1041,31,1],[1042,9,1042,10,1],[1045,9,1045,10,1],[1046,13,1046,135,1],[1047,13,1047,143,1],[1048,13,1048,198,1],[1049,13,1049,31,1],[1050,9,1050,10,1]]);
    </script>
  </body>
</html>