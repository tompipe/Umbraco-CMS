<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.businesslogic\UserType.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Globalization;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Web;
using System.Web.Caching;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Events;
using umbraco.DataLayer;

namespace umbraco.BusinessLogic
{
    /// &lt;summary&gt;
    /// Represents a umbraco Usertype
    /// &lt;/summary&gt;
    [Obsolete(&quot;Use the UserService instead&quot;)]
    public class UserType
    {

        internal Umbraco.Core.Models.Membership.IUserType UserTypeItem;

        /// &lt;summary&gt;
        /// Creates a new empty instance of a UserType
        /// &lt;/summary&gt;
        public UserType()
        {
            UserTypeItem = new Umbraco.Core.Models.Membership.UserType();
        }

        internal UserType(Umbraco.Core.Models.Membership.IUserType userType)
        {
            UserTypeItem = userType;
        }

        /// &lt;summary&gt;
        /// Creates a new instance of a UserType and attempts to 
        /// load it&#39;s values from the database cache.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// If the UserType is not found in the existing ID list, then this object 
        /// will remain an empty object
        /// &lt;/remarks&gt;
        /// &lt;param name=&quot;id&quot;&gt;The UserType id to find&lt;/param&gt;
        public UserType(int id)
        {
            this.LoadByPrimaryKey(id);
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;UserType&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The user type id.&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;The name.&lt;/param&gt;
        public UserType(int id, string name)
        {
            UserTypeItem = new Umbraco.Core.Models.Membership.UserType();
            UserTypeItem.Id = id;
            UserTypeItem.Name = name;
        }

        /// &lt;summary&gt;
        /// Creates a new instance of UserType with all parameters
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;defaultPermissions&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;alias&quot;&gt;&lt;/param&gt;
        public UserType(int id, string name, string defaultPermissions, string alias)
        {
            UserTypeItem = new Umbraco.Core.Models.Membership.UserType();
            UserTypeItem.Id = id;
            UserTypeItem.Name = name;
            UserTypeItem.Alias = alias;
            UserTypeItem.Permissions = defaultPermissions.ToCharArray().Select(x =&gt; x.ToString(CultureInfo.InvariantCulture));
        }

        /// &lt;summary&gt;
        /// The cache storage for all user types
        /// &lt;/summary&gt;
        private static List&lt;UserType&gt; UserTypes
        {
            get
            {
                return ApplicationContext.Current.Services.UserService.GetAllUserTypes()
                    .Select(x =&gt; new UserType(x))
                    .ToList();
            }
        }
        
        #region Public Properties
        /// &lt;summary&gt;
        /// Gets or sets the user type alias.
        /// &lt;/summary&gt;
        public string Alias
        {
            get { return UserTypeItem.Alias; }
            set { UserTypeItem.Alias = value; }
        }

        /// &lt;summary&gt;
        /// Gets the name of the user type.
        /// &lt;/summary&gt;
        public string Name
        {
            get { return UserTypeItem.Name; }
            set { UserTypeItem.Name = value; }
        }

        /// &lt;summary&gt;
        /// Gets the id the user type
        /// &lt;/summary&gt;
        public int Id
        {
            get { return UserTypeItem.Id; }
        }

        /// &lt;summary&gt;
        /// Gets the default permissions of the user type
        /// &lt;/summary&gt;
        public string DefaultPermissions
        {
            get { return UserTypeItem.Permissions == null ? string.Empty : string.Join(&quot;&quot;, UserTypeItem.Permissions); }
            set { UserTypeItem.Permissions = value.ToCharArray().Select(x =&gt; x.ToString(CultureInfo.InvariantCulture)); }
        }

        /// &lt;summary&gt;
        /// Returns an array of UserTypes
        /// &lt;/summary&gt;
        [Obsolete(&quot;Use the GetAll method instead&quot;)]
        public static UserType[] getAll
        {
            get { return GetAllUserTypes().ToArray(); }
        }
        #endregion

        /// &lt;summary&gt;
        /// Saves this instance.
        /// &lt;/summary&gt;
        public void Save()
        {
            //ensure that this object has an ID specified (it exists in the database)
            if (UserTypeItem.HasIdentity == false)
                throw new Exception(&quot;The current UserType object does not exist in the database. New UserTypes should be created with the MakeNew method&quot;);

            ApplicationContext.Current.Services.UserService.SaveUserType(UserTypeItem);
            
            //raise event
            OnUpdated(this, new EventArgs());
        }

        /// &lt;summary&gt;
        /// Deletes this instance.
        /// &lt;/summary&gt;
        public void Delete()
        {
            //ensure that this object has an ID specified (it exists in the database)
            if (UserTypeItem.HasIdentity == false)
                throw new Exception(&quot;The current UserType object does not exist in the database. New UserTypes should be created with the MakeNew method&quot;);

            ApplicationContext.Current.Services.UserService.DeleteUserType(UserTypeItem);

            //raise event
            OnDeleted(this, new EventArgs());
        }

        /// &lt;summary&gt;
        /// Load the data for the current UserType by it&#39;s id
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;Returns true if the UserType id was found
        /// and the data was loaded, false if it wasn&#39;t&lt;/returns&gt;
        public bool LoadByPrimaryKey(int id)
        {
            UserTypeItem = ApplicationContext.Current.Services.UserService.GetUserTypeById(id);
            return UserTypeItem != null;
        }

        /// &lt;summary&gt;
        /// Creates a new user type
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;defaultPermissions&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;alias&quot;&gt;&lt;/param&gt;
        public static UserType MakeNew(string name, string defaultPermissions, string alias)
        {
            //ensure that the current alias does not exist
            //get the id for the new user type
            var existing = UserTypes.Find(ut =&gt; (ut.Alias == alias));

            if (existing != null)
                throw new Exception(&quot;The UserType alias specified already exists&quot;);

            var userType = new Umbraco.Core.Models.Membership.UserType
            {
                Alias = alias,
                Name = name,
                Permissions = defaultPermissions.ToCharArray().Select(x =&gt; x.ToString(CultureInfo.InvariantCulture))
            };
            ApplicationContext.Current.Services.UserService.SaveUserType(userType);

            var legacy = new UserType(userType);
            
            //raise event
            OnNew(legacy, new EventArgs());

            return legacy;
        }

        /// &lt;summary&gt;
        /// Gets the user type with the specied ID
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The id.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static UserType GetUserType(int id)
        {
            return UserTypes.Find(ut =&gt; (ut.Id == id));
        }

        /// &lt;summary&gt;
        /// Returns all UserType&#39;s
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static List&lt;UserType&gt; GetAllUserTypes()
        {
            return UserTypes;
        }

        internal static event TypedEventHandler&lt;UserType, EventArgs&gt; New;
        private static void OnNew(UserType userType, EventArgs args)
        {
            if (New != null)
            {
                New(userType, args);
            }
        }

        internal static event TypedEventHandler&lt;UserType, EventArgs&gt; Deleted;
        private static void OnDeleted(UserType userType, EventArgs args)
        {
            if (Deleted != null)
            {
                Deleted(userType, args);
            }
        }

        internal static event TypedEventHandler&lt;UserType, EventArgs&gt; Updated;
        private static void OnUpdated(UserType userType, EventArgs args)
        {
            if (Updated != null)
            {
                Updated(userType, args);
            }
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[28,9,28,26,0],[29,9,29,10,0],[30,13,30,74,0],[31,9,31,10,0],[33,9,33,77,1],[34,9,34,10,1],[35,13,35,37,1],[36,9,36,10,1],[47,9,47,32,0],[48,9,48,10,0],[49,13,49,39,0],[50,9,50,10,0],[57,9,57,45,0],[58,9,58,10,0],[59,13,59,74,0],[60,13,60,34,0],[61,13,61,38,0],[62,9,62,10,0],[71,9,71,86,0],[72,9,72,10,0],[73,13,73,74,0],[74,13,74,34,0],[75,13,75,38,0],[76,13,76,40,0],[77,13,77,85,0],[77,85,77,125,0],[77,125,77,127,0],[77,13,77,127,0],[78,9,78,10,0],[86,13,86,14,1],[87,17,88,34,1],[88,34,88,49,1],[88,49,89,31,1],[87,17,89,31,1],[90,13,90,14,1],[99,17,99,18,0],[99,19,99,45,0],[99,46,99,47,0],[100,17,100,18,0],[100,19,100,46,0],[100,47,100,48,0],[108,17,108,18,0],[108,19,108,44,0],[108,45,108,46,0],[109,17,109,18,0],[109,19,109,45,0],[109,46,109,47,0],[117,17,117,18,0],[117,19,117,42,0],[117,43,117,44,0],[125,17,125,18,0],[125,19,125,118,0],[125,119,125,120,0],[126,17,126,18,0],[126,19,126,78,0],[126,78,126,118,0],[126,118,126,120,0],[126,19,126,120,0],[126,121,126,122,0],[135,17,135,18,0],[135,19,135,54,0],[135,55,135,56,0],[143,9,143,10,0],[145,13,145,51,0],[146,17,146,156,0],[148,13,148,88,0],[151,13,151,46,0],[152,9,152,10,0],[158,9,158,10,0],[160,13,160,51,0],[161,17,161,156,0],[163,13,163,90,0],[166,13,166,46,0],[167,9,167,10,0],[176,9,176,10,0],[177,13,177,96,0],[178,13,178,41,0],[179,9,179,10,0],[188,9,188,10,0],[191,13,191,49,0],[191,49,191,68,0],[191,68,191,70,0],[191,13,191,70,0],[193,13,193,34,0],[194,17,194,84,0],[196,13,200,76,0],[200,76,200,116,0],[200,116,201,15,0],[196,13,201,15,0],[202,13,202,84,0],[204,13,204,49,0],[207,13,207,44,0],[209,13,209,27,0],[210,9,210,10,0],[218,9,218,10,0],[219,13,219,41,0],[219,41,219,54,0],[219,54,219,56,0],[219,13,219,56,0],[220,9,220,10,0],[227,9,227,10,1],[228,13,228,30,1],[229,9,229,10,1],[233,9,233,10,0],[234,13,234,29,0],[235,13,235,14,0],[236,17,236,37,0],[237,13,237,14,0],[238,9,238,10,0],[242,9,242,10,0],[243,13,243,33,0],[244,13,244,14,0],[245,17,245,41,0],[246,13,246,14,0],[247,9,247,10,0],[251,9,251,10,0],[252,13,252,33,0],[253,13,253,14,0],[254,17,254,41,0],[255,13,255,14,0],[256,9,256,10,0]]);
    </script>
  </body>
</html>