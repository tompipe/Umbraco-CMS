<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Editors\RelationController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Web.Http;
using AutoMapper;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Web.Mvc;
using Umbraco.Web.WebApi.Filters;
using Constants = Umbraco.Core.Constants;
using Relation = Umbraco.Web.Models.ContentEditing.Relation;

namespace Umbraco.Web.Editors
{
	[PluginController(&quot;UmbracoApi&quot;)]
	[UmbracoApplicationAuthorizeAttribute(Constants.Applications.Content)]
    public class RelationController : UmbracoAuthorizedJsonController
	{
		public RelationController()
			: this(UmbracoContext.Current)
		{
		}

		public RelationController(UmbracoContext umbracoContext)
			: base(umbracoContext)
		{
		}

        public Relation GetById(int id)
		{
			return Mapper.Map&lt;IRelation, Relation&gt;(Services.RelationService.GetById(id));
		}

        //[EnsureUserPermissionForContent(&quot;childId&quot;)]
        public IEnumerable&lt;Relation&gt; GetByChildId(int childId, string relationTypeAlias = &quot;&quot;)
		{
		    var relations = Services.RelationService.GetByChildId(childId).ToArray();

			if (relations.Any() == false)
			{
			    return Enumerable.Empty&lt;Relation&gt;();
			}

			if (string.IsNullOrWhiteSpace(relationTypeAlias) == false)
			{
			    return
			        Mapper.Map&lt;IEnumerable&lt;IRelation&gt;, IEnumerable&lt;Relation&gt;&gt;(
			            relations.Where(x =&gt; x.RelationType.Alias.InvariantEquals(relationTypeAlias)));
			}

			return Mapper.Map&lt;IEnumerable&lt;IRelation&gt;, IEnumerable&lt;Relation&gt;&gt;(relations);
		}

		[HttpDelete]
		[HttpPost]
		public HttpResponseMessage DeleteById(int id)
		{
		    var foundRelation = Services.RelationService.GetById(id);

			if (foundRelation == null)
			{
			    return Request.CreateErrorResponse(HttpStatusCode.NotFound, &quot;No relation found with the specified id&quot;);
			}

			Services.RelationService.Delete(foundRelation);

			return Request.CreateResponse(HttpStatusCode.OK);
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,6,21,34,0],[22,3,22,4,0],[23,3,23,4,0],[26,6,26,26,0],[27,3,27,4,0],[28,3,28,4,0],[31,3,31,4,0],[32,4,32,81,0],[33,3,33,4,0],[37,3,37,4,0],[38,7,38,80,0],[40,4,40,33,0],[41,4,41,5,0],[42,8,42,44,0],[45,4,45,62,0],[46,4,46,5,0],[47,8,49,37,0],[49,37,49,92,0],[49,92,49,95,0],[47,8,49,95,0],[52,4,52,80,0],[53,3,53,4,0],[58,3,58,4,0],[59,7,59,64,0],[61,4,61,30,0],[62,4,62,5,0],[63,8,63,111,0],[66,4,66,51,0],[68,4,68,53,0],[69,3,69,4,0]]);
    </script>
  </body>
</html>