<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Cache\SingleItemsOnlyCachePolicyTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Web.Caching;
using Moq;
using NUnit.Framework;
using Umbraco.Core.Cache;
using Umbraco.Core.Models;

namespace Umbraco.Tests.Cache
{
    [TestFixture]
    public class SingleItemsOnlyCachePolicyTests
    {
        [Test]
        public void Get_All_Doesnt_Cache()
        {
            var cached = new List&lt;string&gt;();
            var cache = new Mock&lt;IRuntimeCacheProvider&gt;();
            cache.Setup(x =&gt; x.InsertCacheItem(It.IsAny&lt;string&gt;(), It.IsAny&lt;Func&lt;object&gt;&gt;(), It.IsAny&lt;TimeSpan?&gt;(), It.IsAny&lt;bool&gt;(),
                It.IsAny&lt;CacheItemPriority&gt;(), It.IsAny&lt;CacheItemRemovedCallback&gt;(), It.IsAny&lt;string[]&gt;()))
                .Callback((string cacheKey, Func&lt;object&gt; o, TimeSpan? t, bool b, CacheItemPriority cip, CacheItemRemovedCallback circ, string[] s) =&gt;
                {
                    cached.Add(cacheKey);
                });
            cache.Setup(x =&gt; x.GetCacheItemsByKeySearch(It.IsAny&lt;string&gt;())).Returns(new AuditItem[] { });

            var defaultPolicy = new SingleItemsOnlyRepositoryCachePolicy&lt;AuditItem, object&gt;(cache.Object, new RepositoryCachePolicyOptions());
            using (defaultPolicy)
            {
                var found = defaultPolicy.GetAll(new object[] { }, o =&gt; new[]
                {
                    new AuditItem(1, &quot;blah&quot;, AuditType.Copy, 123),
                    new AuditItem(2, &quot;blah2&quot;, AuditType.Copy, 123)
                });
            }

            Assert.AreEqual(0, cached.Count);
        }

        [Test]
        public void Caches_Single()
        {
            var isCached = false;
            var cache = new Mock&lt;IRuntimeCacheProvider&gt;();
            cache.Setup(x =&gt; x.InsertCacheItem(It.IsAny&lt;string&gt;(), It.IsAny&lt;Func&lt;object&gt;&gt;(), It.IsAny&lt;TimeSpan?&gt;(), It.IsAny&lt;bool&gt;(),
                It.IsAny&lt;CacheItemPriority&gt;(), It.IsAny&lt;CacheItemRemovedCallback&gt;(), It.IsAny&lt;string[]&gt;()))
                .Callback(() =&gt;
                {
                    isCached = true;
                });

            var defaultPolicy = new SingleItemsOnlyRepositoryCachePolicy&lt;AuditItem, object&gt;(cache.Object, new RepositoryCachePolicyOptions());
            using (defaultPolicy)
            {
                var found = defaultPolicy.Get(1, o =&gt; new AuditItem(1, &quot;blah&quot;, AuditType.Copy, 123));
            }
            Assert.IsTrue(isCached);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,10,1],[17,13,17,45,1],[18,13,18,59,1],[19,13,22,17,1],[22,17,22,18,0],[22,18,23,21,1],[23,21,23,42,0],[23,42,24,17,1],[24,17,24,18,0],[24,18,24,20,1],[19,13,24,20,1],[25,13,25,107,1],[27,13,27,143,1],[28,13,28,34,1],[29,13,29,14,1],[30,17,30,73,1],[30,73,34,18,1],[34,18,34,20,1],[30,17,34,20,1],[35,13,35,14,1],[37,13,37,46,1],[38,9,38,10,1],[42,9,42,10,1],[43,13,43,34,1],[44,13,44,59,1],[45,13,48,17,1],[48,17,48,18,1],[48,18,49,21,1],[49,21,49,37,1],[49,37,50,17,1],[50,17,50,18,1],[50,18,50,20,1],[45,13,50,20,1],[52,13,52,143,1],[53,13,53,34,1],[54,13,54,14,1],[55,17,55,55,1],[55,55,55,100,1],[55,100,55,102,1],[55,17,55,102,1],[56,13,56,14,1],[57,13,57,37,1],[58,9,58,10,1]]);
    </script>
  </body>
</html>