<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\CodeFirst\TypeInheritanceTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Moq;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Profiling;
using Umbraco.Tests.CodeFirst.Attributes;
using Umbraco.Tests.CodeFirst.Definitions;
using Umbraco.Tests.CodeFirst.TestModels.Composition;

namespace Umbraco.Tests.CodeFirst
{
    [TestFixture]
    public class TypeInheritanceTest
    {
        private PluginManager _pluginManager;

        [SetUp]
        public void Initialize()
        {
            var logger = new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;());

            //this ensures its reset
            _pluginManager = new PluginManager(new ActivatorServiceProvider(), new NullCacheProvider(),
                logger,
                false)
            {
                AssembliesToScan = new[]
		        {
		            typeof (ContentTypeBase).Assembly
		        }
            };

          
        }

        [Test]
        public void Can_Get_Interfaces_From_Type()
        {
            var type = typeof (News);
            var interfaces = type.GetInterfaces().ToList();

            bool hasSeo = interfaces.Any(x =&gt; x.Name == typeof(IMetaSeo).Name);
            bool hasMeta = interfaces.Any(x =&gt; x.Name == typeof(IMeta).Name);

            Assert.That(hasSeo, Is.True);
            Assert.That(hasMeta, Is.True);
            Assert.That(interfaces.Count, Is.EqualTo(3));
        }

        [Test]
        public void Can_Get_MixinAttribute_From_Types()
        {
            var type = typeof(News);
            var interfaces = type.GetInterfaces().ToList();

            var list = new List&lt;string&gt;();

            foreach (var interfaceType in interfaces)
            {
                var mixinAttribute = interfaceType.FirstAttribute&lt;MixinAttribute&gt;();
                if(mixinAttribute != null)
                {
                    var modelType = mixinAttribute.Type;
                    var contentTypeAttribute = modelType.FirstAttribute&lt;ContentTypeAttribute&gt;();
                    var contentTypeAlias = contentTypeAttribute == null ? modelType.Name.ToUmbracoAlias() : contentTypeAttribute.Alias;
                    list.Add(contentTypeAlias);
                }
            }

            Assert.That(list.Count, Is.EqualTo(3));
            Assert.Contains(&quot;Meta&quot;, list);
            Assert.Contains(&quot;MetaSeo&quot;, list);
            Assert.Contains(&quot;Base&quot;, list);
        }

        [Test]
        public void Ensure_Only_One_Type_List_Created()
        {
            var foundTypes = _pluginManager.ResolveContentTypeBaseTypes();

            Assert.That(foundTypes.Count(), Is.EqualTo(15));
            Assert.AreEqual(1,
                            _pluginManager.GetTypeLists()
                                .Count(x =&gt; x.IsTypeList&lt;ContentTypeBase&gt;(PluginManager.TypeResolutionKind.FindAllTypes)));
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[24,9,24,10,1],[25,13,25,88,1],[28,13,36,15,1],[39,9,39,10,1],[43,9,43,10,1],[44,13,44,38,1],[45,13,45,60,1],[47,13,47,47,1],[47,47,47,78,1],[47,78,47,80,1],[47,13,47,80,1],[48,13,48,48,1],[48,48,48,76,1],[48,76,48,78,1],[48,13,48,78,1],[50,13,50,42,1],[51,13,51,43,1],[52,13,52,58,1],[53,9,53,10,1],[57,9,57,10,1],[58,13,58,37,1],[59,13,59,60,1],[61,13,61,43,1],[63,13,63,20,1],[63,22,63,39,1],[63,40,63,42,1],[63,43,63,53,1],[64,13,64,14,1],[65,17,65,85,1],[66,17,66,43,1],[67,17,67,18,1],[68,21,68,57,1],[69,21,69,97,1],[70,21,70,136,1],[71,21,71,48,1],[72,17,72,18,1],[73,13,73,14,1],[75,13,75,52,1],[76,13,76,43,1],[77,13,77,46,1],[78,13,78,43,1],[79,9,79,10,1],[83,9,83,10,1],[84,13,84,75,1],[86,13,86,61,1],[87,13,89,45,1],[89,45,89,121,1],[89,121,89,124,1],[87,13,89,124,1],[90,9,90,10,1]]);
    </script>
  </body>
</html>