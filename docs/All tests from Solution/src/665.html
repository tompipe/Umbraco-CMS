<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\developer\RelationTypes\NewRelationType.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.UI.WebControls;
using Umbraco.Core;
using Umbraco.Web.UI.Pages;
using umbraco.BusinessLogic;
using Umbraco.Core.Models;

namespace umbraco.cms.presentation.developer.RelationTypes
{
	/// &lt;summary&gt;
	/// Add a new Relation Type
	/// &lt;/summary&gt;
    [WebformsPageTreeAuthorize(Constants.Trees.RelationTypes)]
	public partial class NewRelationType : UmbracoEnsuredPage
	{
		/// &lt;summary&gt;
		/// On Load event
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;sender&quot;&gt;this aspx page&lt;/param&gt;
		/// &lt;param name=&quot;e&quot;&gt;EventArgs (expect empty)&lt;/param&gt;
		protected void Page_Load(object sender, EventArgs e)
		{
			if (!this.Page.IsPostBack)
			{
				this.Form.DefaultFocus = this.descriptionTextBox.ClientID;
			}

			this.AppendUmbracoObjectTypes(this.parentDropDownList);
			this.AppendUmbracoObjectTypes(this.childDropDownList);
		}

		/// &lt;summary&gt;
		/// Server side validation to ensure there are no existing relationshipTypes with the alias of
		/// the relation type being added
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;source&quot;&gt;the aliasCustomValidator control&lt;/param&gt;
		/// &lt;param name=&quot;args&quot;&gt;to set validation respose&lt;/param&gt;
		protected void AliasCustomValidator_ServerValidate(object source, ServerValidateEventArgs args)
		{
		    var relationService = Services.RelationService;
			args.IsValid = relationService.GetRelationTypeByAlias(this.aliasTextBox.Text.Trim()) == null;
		}

		/// &lt;summary&gt;
		/// Add a new relation type into the database, and redirects to it&#39;s editing page.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;sender&quot;&gt;expects the addButton control&lt;/param&gt;
		/// &lt;param name=&quot;e&quot;&gt;expects EventArgs for addButton&lt;/param&gt;
		protected void AddButton_Click(object sender, EventArgs e)
		{
			if (Page.IsValid)
			{
                var newRelationTypeAlias = this.aliasTextBox.Text.Trim();

			    var relationService = Services.RelationService;
			    var relationType = new RelationType(new Guid(this.childDropDownList.SelectedValue),
			        new Guid(this.parentDropDownList.SelectedValue), newRelationTypeAlias, this.descriptionTextBox.Text)
			                       {
			                           IsBidirectional = this.dualRadioButtonList.SelectedValue == &quot;1&quot;
			                       };

                relationService.Save(relationType);

			    var newRelationTypeId = relationService.GetRelationTypeByAlias(newRelationTypeAlias).Id;

				ClientTools.ChangeContentFrameUrl(&quot;developer/RelationTypes/EditRelationType.aspx?id=&quot; + newRelationTypeId).CloseModalWindow().ChildNodeCreated();
			}
		}

		/// &lt;summary&gt;
		/// Adds the Umbraco Object types to a drop down list
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;dropDownList&quot;&gt;control for which to add the Umbraco object types&lt;/param&gt;
		private void AppendUmbracoObjectTypes(ListControl dropDownList)
		{
            dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.Document.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.Document));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.Media.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.Media));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.Member.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.Member));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.MediaType.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.MediaType));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.DocumentType.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.DocumentType));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.MemberType.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.MemberType));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.DataType.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.DataType));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.MemberGroup.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.MemberGroup));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.Stylesheet.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.Stylesheet));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.Template.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.Template));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.ROOT.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.SystemRoot));
		    dropDownList.Items.Add(new ListItem(UmbracoObjectTypes.RecycleBin.GetFriendlyName(), Umbraco.Core.Constants.ObjectTypes.ContentRecycleBin));
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[22,3,22,4,0],[23,4,23,30,0],[24,4,24,5,0],[25,5,25,63,0],[26,4,26,5,0],[28,4,28,59,0],[29,4,29,58,0],[30,3,30,4,0],[39,3,39,4,0],[40,7,40,54,0],[41,4,41,97,0],[42,3,42,4,0],[50,3,50,4,0],[51,4,51,21,0],[52,4,52,5,0],[53,17,53,74,0],[55,8,55,55,0],[56,8,60,29,0],[62,17,62,52,0],[64,8,64,96,0],[66,5,66,150,0],[67,4,67,5,0],[68,3,68,4,0],[75,3,75,4,0],[76,13,76,142,0],[77,7,77,130,0],[78,7,78,132,0],[79,7,79,138,0],[80,7,80,144,0],[81,7,81,140,0],[82,7,82,136,0],[83,7,83,142,0],[84,7,84,140,0],[85,7,85,136,0],[86,7,86,134,0],[87,7,87,147,0],[88,3,88,4,0]]);
    </script>
  </body>
</html>