<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Resolvers\SingleResolverTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

using Umbraco.Core;
using Umbraco.Core.ObjectResolution;
using NUnit.Framework;

namespace Umbraco.Tests.Resolvers
{
    [TestFixture]
    public class SingleResolverTests
    {
        [SetUp]
        public void Setup()
        {
            SingleResolver.Reset();
        }

        [TearDown]
        public void TearDown()
        {
            SingleResolver.Reset();
        }

        #region Resolvers and Resolved

        public class Resolved
        { }

        public sealed class SingleResolver : SingleObjectResolverBase&lt;SingleResolver, Resolved&gt;
        {
            public SingleResolver()
                : base()
            { }

            public SingleResolver(bool canBeNull)
                : base(canBeNull)
            { }

            public SingleResolver(Resolved value)
                : base(value)
            { }

            public SingleResolver(Resolved value, bool canBeNull)
                : base(value, canBeNull)
            { }

            public Resolved Resolved { get { return Value; } set { Value = value; } }
        }

        #endregion

        #region Test SingleResolver

        [Test]
        public void SingleResolverCanSetValueBeforeFreeze()
        {
            var resolver = new SingleResolver();
            resolver.Resolved = new Resolved();
        }

        [Test] // is this normal?
        public void SingleResolverCanInitializeWithNullValueEvenIfCannotBeNull()
        {
            var resolver = new SingleResolver(null, false);
        }

        [Test]
        [ExpectedException(typeof(ArgumentNullException))]
        public void SingleResolverCannotSetValueToNullIfCannotBeNull()
        {
            var resolver = new SingleResolver();
            resolver.Resolved = null; // throws
        }

        [Test]
        public void SingleResolverCanSetValueToNullIfCanBeNull()
        {
            var resolver = new SingleResolver(true);
            resolver.Resolved = null;
        }

        [Test]
        [ExpectedException(typeof(InvalidOperationException))]
        public void SingleResolverCannotSetValueOnceFrozen()
        {
            var resolver = new SingleResolver();
            Resolution.Freeze();
            resolver.Resolved = new Resolved(); // throws
        }

        [Test]
        [ExpectedException(typeof(InvalidOperationException))]
        public void SingleResolverCannotGetValueBeforeFreeze()
        {
            var resolver = new SingleResolver();
            resolver.Resolved = new Resolved();
            var resolved = resolver.Resolved; // throws
        }

        [Test]
        public void SingleResolverCanGetValueOnceFrozen()
        {
            var resolver = new SingleResolver();
            var resolved = resolver.Resolved = new Resolved();
            Resolution.Freeze();
            Assert.AreSame(resolved, resolver.Resolved);
        }

        [Test]
        [ExpectedException(typeof(InvalidOperationException))]
        public void SingleResolverCannotGetNullValueIfCannotBeNull()
        {
            var resolver = new SingleResolver();
            Resolution.Freeze();
            var resolved = resolver.Resolved; // throws
        }

        [Test]
        public void SingleResolverCanGetNullValueIfCanBeNull()
        {
            var resolver = new SingleResolver(true);
            Resolution.Freeze();
            Assert.IsNull(resolver.Resolved);
        }

        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[18,13,18,36,1],[19,9,19,10,1],[23,9,23,10,1],[24,13,24,36,1],[25,9,25,10,1],[35,19,35,25,1],[36,13,36,14,1],[36,15,36,16,1],[39,19,39,34,1],[40,13,40,14,1],[40,15,40,16,1],[43,19,43,30,0],[44,13,44,14,0],[44,15,44,16,0],[47,19,47,41,1],[48,13,48,14,1],[48,15,48,16,1],[50,44,50,45,1],[50,46,50,59,1],[50,60,50,61,1],[50,66,50,67,1],[50,68,50,82,1],[50,83,50,84,1],[59,9,59,10,1],[60,13,60,49,1],[61,13,61,48,1],[62,9,62,10,1],[66,9,66,10,1],[67,13,67,60,1],[68,9,68,10,1],[73,9,73,10,1],[74,13,74,49,1],[75,13,75,38,1],[76,9,76,10,0],[80,9,80,10,1],[81,13,81,53,1],[82,13,82,38,1],[83,9,83,10,1],[88,9,88,10,1],[89,13,89,49,1],[90,13,90,33,1],[91,13,91,48,1],[92,9,92,10,0],[97,9,97,10,1],[98,13,98,49,1],[99,13,99,48,1],[100,13,100,46,1],[101,9,101,10,0],[105,9,105,10,1],[106,13,106,49,1],[107,13,107,63,1],[108,13,108,33,1],[109,13,109,57,1],[110,9,110,10,1],[115,9,115,10,1],[116,13,116,49,1],[117,13,117,33,1],[118,13,118,46,1],[119,9,119,10,0],[123,9,123,10,1],[124,13,124,53,1],[125,13,125,33,1],[126,13,126,46,1],[127,9,127,10,1]]);
    </script>
  </body>
</html>