<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\dialogs\notifications.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using umbraco.BasePages;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.workflow;

namespace umbraco.dialogs
{
    /// &lt;summary&gt;
    /// Summary description for cruds.
    /// &lt;/summary&gt;
    public partial class notifications : UmbracoEnsuredPage
    {
        private ArrayList actions = new ArrayList();
        private CMSNode node;

        public notifications()
        {
            CurrentApp = BusinessLogic.DefaultApps.content.ToString();

        }

        protected void Page_Load(object sender, EventArgs e)
        {
            Button1.Text = ui.Text(&quot;update&quot;);
            pane_form.Text = ui.Text(&quot;notifications&quot;, &quot;editNotifications&quot;, node.Text, base.getUser());
        }

        #region Web Form Designer generated code

        protected override void OnInit(EventArgs e)
        {
            //
            // CODEGEN: This call is required by the ASP.NET Web Form Designer.
            //
            InitializeComponent();
            base.OnInit(e);

            node = new cms.businesslogic.CMSNode(int.Parse(helper.Request(&quot;id&quot;)));

            ArrayList actionList = BusinessLogic.Actions.Action.GetAll();
            
            foreach (interfaces.IAction a in actionList)
            {
                if (a.ShowInNotifier)
                {
                   
                    CheckBox c = new CheckBox();
                    c.ID = a.Letter.ToString();
                    
                    if (base.getUser().GetNotifications(node.Path).IndexOf(a.Letter) &gt; -1)
                        c.Checked = true;

                    uicontrols.PropertyPanel pp = new umbraco.uicontrols.PropertyPanel();
                    pp.CssClass = &quot;inline&quot;;
                    pp.Text = ui.Text(&quot;actions&quot;, a.Alias);
                    pp.Controls.Add(c);

                    pane_form.Controls.Add(pp);
                    
                    actions.Add(c);
                 
                }
            }
          
        }

        /// &lt;summary&gt;
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// &lt;/summary&gt;
        private void InitializeComponent()
        {
        }

        #endregion

        protected void Button1_Click(object sender, EventArgs e)
        {
            string notifications = &quot;&quot;;

            // First off - load all users
            foreach (CheckBox c in actions)
            {
                // Update the user with the new permission
                if (c.Checked)
                    notifications += c.ID;
            }
            Notification.UpdateNotifications(base.getUser(), node, notifications);
            getUser().resetNotificationCache();
            base.getUser().initNotifications();

            var feedback = new umbraco.uicontrols.Feedback();
            feedback.Text = ui.Text(&quot;notifications&quot;) + &quot; &quot; + ui.Text(&quot;ok&quot;) + &quot;&lt;/p&gt;&lt;p&gt;&lt;a href=&#39;#&#39; class=&#39;btn btn-primary&#39; onclick=&#39;&quot; + ClientTools.Scripts.CloseModalWindow() + &quot;&#39;&gt;&quot; + ui.Text(&quot;closeThisWindow&quot;) + &quot;&lt;/a&gt;&quot;;
            feedback.type = umbraco.uicontrols.Feedback.feedbacktype.success;

            pane_form.Controls.Clear();
            pane_form.Controls.Add(feedback);

            //pane_form.Visible = false;
            pl_buttons.Visible = false;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,53,0],[20,9,20,31,0],[21,9,21,10,0],[22,13,22,71,0],[24,9,24,10,0],[27,9,27,10,0],[28,13,28,46,0],[29,13,29,103,0],[30,9,30,10,0],[35,9,35,10,0],[39,13,39,35,0],[40,13,40,28,0],[42,13,42,83,0],[44,13,44,74,0],[46,13,46,20,0],[46,22,46,42,0],[46,43,46,45,0],[46,46,46,56,0],[47,13,47,14,0],[48,17,48,38,0],[49,17,49,18,0],[51,21,51,49,0],[52,21,52,48,0],[54,21,54,91,0],[55,25,55,42,0],[57,21,57,90,0],[58,21,58,44,0],[59,21,59,59,0],[60,21,60,40,0],[62,21,62,48,0],[64,21,64,36,0],[66,17,66,18,0],[67,13,67,14,0],[69,9,69,10,0],[76,9,76,10,0],[77,9,77,10,0],[82,9,82,10,0],[83,13,83,39,0],[86,13,86,20,0],[86,22,86,32,0],[86,33,86,35,0],[86,36,86,43,0],[87,13,87,14,0],[89,17,89,31,0],[90,21,90,43,0],[91,13,91,14,0],[92,13,92,83,0],[93,13,93,48,0],[94,13,94,48,0],[96,13,96,62,0],[97,13,97,219,0],[98,13,98,78,0],[100,13,100,40,0],[101,13,101,46,0],[104,13,104,40,0],[105,9,105,10,0]]);
    </script>
  </body>
</html>