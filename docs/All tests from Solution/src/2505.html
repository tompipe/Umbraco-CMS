<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.businesslogic\Utils\fileHelper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Text;
using System.Security;
using System.IO;
using System.Security.AccessControl;
using System.Security.Authentication;
using System.Security.Cryptography;
using System.Security.Permissions;
using System.Security.Policy;
using System.Security.Principal;

namespace umbraco.Utils {
    public class fileHelper {

        public static bool TestReadWriteAccces(string filePath) {
            FileInfo fi = new FileInfo(filePath);
            if (!fi.IsReadOnly)
                return HasAccces(fi, FileSystemRights.Modify);
            else
                return false;
        }

        public static bool HasAccces(FileInfo fileInfo, FileSystemRights fileSystemRights) {
            string identityName = System.Security.Principal.WindowsIdentity.GetCurrent().Name.ToUpper();

            AuthorizationRuleCollection authorizationRuleCollection = fileInfo.GetAccessControl().GetAccessRules(true, true, typeof(NTAccount));

            foreach (FileSystemAccessRule fileSystemAccessRule in authorizationRuleCollection) {
                if (identityName == fileSystemAccessRule.IdentityReference.Value.ToUpper())
                    return AccessControlType.Allow == fileSystemAccessRule.AccessControlType &amp;&amp; fileSystemRights == (fileSystemAccessRule.FileSystemRights &amp; fileSystemRights);
            }

            return false;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,65,16,66,0],[17,13,17,50,0],[18,13,18,32,0],[19,17,19,63,0],[21,17,21,30,0],[22,9,22,10,0],[24,92,24,93,0],[25,13,25,105,0],[27,13,27,145,0],[29,13,29,20,0],[29,22,29,63,0],[29,64,29,66,0],[29,67,29,94,0],[29,96,29,97,0],[30,17,30,92,0],[31,21,31,176,0],[32,13,32,14,0],[34,13,34,26,0],[35,9,35,10,0]]);
    </script>
  </body>
</html>