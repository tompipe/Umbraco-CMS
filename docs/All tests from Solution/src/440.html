<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\create\stylesheetPropertyTasks.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using System.Web;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Web.UI;
using umbraco.BusinessLogic;

namespace umbraco
{
    public class stylesheetPropertyTasks : LegacyDialogTask
    {
        public override bool PerformSave()
        {
            var stylesheetName = AdditionalValues[&quot;nodeId&quot;].ToString();
            
            var s = ApplicationContext.Current.Services.FileService.GetStylesheetByName(stylesheetName.EnsureEndsWith(&quot;.css&quot;));
            s.AddProperty(new StylesheetProperty(Alias, &quot;.&quot; + Alias.ToSafeAlias(), &quot;&quot;));
            ApplicationContext.Current.Services.FileService.SaveStylesheet(s);

            // SJ - Note: The Alias is NOT in fact the alias but the name of the new property, need to UrlEncode it!
            _returnUrl = string.Format(&quot;settings/stylesheet/property/EditStyleSheetProperty.aspx?id={0}&amp;prop={1}&quot;, HttpUtility.UrlEncode(s.Path), HttpUtility.UrlEncode(Alias));
            return true;
        }

        public override bool PerformDelete()
        {
            var parts = Alias.Split(&#39;_&#39;);

            var stylesheet = ApplicationContext.Current.Services.FileService.GetStylesheetByName(parts[0].EnsureEndsWith(&quot;.css&quot;));
            if (stylesheet == null) throw new InvalidOperationException(&quot;No stylesheet found by name: &quot; + parts[0]);

            var property = HttpUtility.UrlDecode(parts[1]);
            var prop = stylesheet.Properties.FirstOrDefault(x =&gt; x.Name == property);
            if (prop == null) throw new InvalidOperationException(&quot;No stylesheet property found by name: &quot; + property);

            stylesheet.RemoveProperty(prop.Name);

            ApplicationContext.Current.Services.FileService.SaveStylesheet(stylesheet);

            return true;
        }

        private string _returnUrl = &quot;&quot;;
            
        public override string ReturnUrl
        {
            get { return _returnUrl; }
        }

        public override string AssignedApp
        {
            get { return DefaultApps.settings.ToString(); }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,10,0],[15,13,15,72,0],[17,13,17,128,0],[18,13,18,89,0],[19,13,19,79,0],[22,13,22,177,0],[23,13,23,25,0],[24,9,24,10,0],[27,9,27,10,0],[28,13,28,42,0],[30,13,30,131,0],[31,13,31,36,0],[31,37,31,117,0],[33,13,33,60,0],[34,13,34,66,0],[34,66,34,84,0],[34,84,34,86,0],[34,13,34,86,0],[35,13,35,30,0],[35,31,35,120,0],[37,13,37,50,0],[39,13,39,88,0],[41,13,41,25,0],[42,9,42,10,0],[44,9,44,40,1],[48,17,48,18,0],[48,19,48,37,0],[48,38,48,39,0],[53,17,53,18,1],[53,19,53,58,1],[53,59,53,60,1]]);
    </script>
  </body>
</html>