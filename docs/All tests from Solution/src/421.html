<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\uQuery\uQuery-Members.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using umbraco.cms.businesslogic.member;

namespace umbraco
{
	public static partial class uQuery
	{
		/// &lt;summary&gt;
		/// Get a collection of members from an XPath expression (note XML source is currently a flat structure)
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;xPath&quot;&gt;XPath expression&lt;/param&gt;
		/// &lt;returns&gt;collection or empty collection&lt;/returns&gt;
		public static IEnumerable&lt;Member&gt; GetMembersByXPath(string xPath)
		{
			var members = new List&lt;Member&gt;();
			var xmlDocument = uQuery.GetPublishedXml(UmbracoObjectType.Member);
			var xPathNavigator = xmlDocument.CreateNavigator();
			var xPathNodeIterator = xPathNavigator.Select(xPath);

			while (xPathNodeIterator.MoveNext())
			{
				var member = uQuery.GetMember(xPathNodeIterator.Current.Evaluate(&quot;string(@id)&quot;).ToString());
				if (member != null)
				{
					members.Add(member);
				}
			}

			return members;
		}

		/// &lt;summary&gt;
		/// Get collection of member objects from the supplied CSV of IDs
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;csv&quot;&gt;string csv of IDs&lt;/param&gt;
		/// &lt;returns&gt;collection or emtpy collection&lt;/returns&gt;
		public static IEnumerable&lt;Member&gt; GetMembersByCsv(string csv)
		{
			var members = new List&lt;Member&gt;();
			var ids = uQuery.GetCsvIds(csv);

			if (ids != null)
			{
				foreach (string id in ids)
				{
					var member = uQuery.GetMember(id);
					if (member != null)
					{
						members.Add(member);
					}
				}
			}

			return members;
		}

		/// &lt;summary&gt;
		/// Gets the members by XML.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;xml&quot;&gt;The XML.&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static IEnumerable&lt;Member&gt; GetMembersByXml(string xml)
		{
			var members = new List&lt;Member&gt;();
			var ids = uQuery.GetXmlIds(xml);

			foreach (int id in ids)
			{
				var member = uQuery.GetMember(id);
				if (member != null)
				{
					members.Add(member);
				}
			}

			return members;
		}

		/// &lt;summary&gt;
		/// Get Members by member type alias
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;memberTypeAlias&quot;&gt;The member type alias&lt;/param&gt;
		/// &lt;returns&gt;list of members, or empty list&lt;/returns&gt;
		public static IEnumerable&lt;Member&gt; GetMembersByType(string memberTypeAlias)
		{
			// Both XML schema versions have this attribute
			return uQuery.GetMembersByXPath(string.Concat(&quot;descendant::*[@nodeTypeAlias=&#39;&quot;, memberTypeAlias, &quot;&#39;]&quot;));
		}

		// public static Member GetCurrentMember() { }

		/// &lt;summary&gt;
		/// Get member from an ID
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;memberId&quot;&gt;string representation of an umbraco.cms.businesslogic.member.Member object Id&lt;/param&gt;
		/// &lt;returns&gt;member or null&lt;/returns&gt;
		public static Member GetMember(string memberId)
		{
			int id;
			Member member = null;

			// suppress error if member with supplied id doesn&#39;t exist
			if (int.TryParse(memberId, out id))
			{
				member = uQuery.GetMember(id);
			}

			return member;
		}

		/// &lt;summary&gt;
		/// Get member from an ID
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;id&quot;&gt;ID of member item to get&lt;/param&gt;
		/// &lt;returns&gt;member or null&lt;/returns&gt;
		public static Member GetMember(int id)
		{
			// suppress error if member with supplied id doesn&#39;t exist
			try
			{
				return new Member(id);
			}
			catch
			{
				return null;
			}
		}

		/// &lt;summary&gt;
		/// Extension method on Member collection to return key value pairs of: member.Id / member.loginName
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;members&quot;&gt;generic list of Member objects&lt;/param&gt;
		/// &lt;returns&gt;a collection of memberIDs and their login names&lt;/returns&gt;
		public static Dictionary&lt;int, string&gt; ToNameIds(this IEnumerable&lt;Member&gt; members)
		{
			var dictionary = new Dictionary&lt;int, string&gt;();

			foreach (var member in members)
			{
				if (member != null)
				{
					dictionary.Add(member.Id, member.LoginName);
				}
			}

			return dictionary;
		}

		public static class Members
		{
			/// &lt;summary&gt;
			/// Adds the member to group.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberId&quot;&gt;The member id.&lt;/param&gt;
			/// &lt;param name=&quot;groupId&quot;&gt;The group id.&lt;/param&gt;
			public static void AddMemberToGroup(int memberId, int groupId)
			{
				AddMembersToGroup(new int[] { memberId }, groupId);
			}

			/// &lt;summary&gt;
			/// Adds the members to group.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberIds&quot;&gt;The member ids.&lt;/param&gt;
			/// &lt;param name=&quot;groupId&quot;&gt;The group id.&lt;/param&gt;
			public static void AddMembersToGroup(int[] memberIds, int groupId)
			{
				AddMembersToGroups(memberIds, new int[] { groupId });
			}

			/// &lt;summary&gt;
			/// Adds the members to groups.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberIds&quot;&gt;The member ids.&lt;/param&gt;
			/// &lt;param name=&quot;groupIds&quot;&gt;The group ids.&lt;/param&gt;
			public static void AddMembersToGroups(int[] memberIds, int[] groupIds)
			{
				foreach (var memberId in memberIds)
				{
					if (memberId &gt; 0)
					{
						var member = GetMember(memberId);

						if (member != null)
						{
							foreach (var groupId in groupIds)
							{
#pragma warning disable 0618
								member.AddGroup(groupId);
#pragma warning restore 0618
							}
						}
					}
				}
			}

			/// &lt;summary&gt;
			/// Adds the members to groups.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberIds&quot;&gt;The member ids.&lt;/param&gt;
			/// &lt;param name=&quot;groupNames&quot;&gt;The group names.&lt;/param&gt;
			public static void AddMembersToGroups(int[] memberIds, string[] groupNames)
			{
				var groupIds = new List&lt;int&gt;();

				foreach (var groupName in groupNames)
				{
					var group = MemberGroup.GetByName(groupName);

					if (group != null)
					{
						groupIds.Add(group.Id);
					}
				}

				AddMembersToGroups(memberIds, groupIds.ToArray());
			}

			/// &lt;summary&gt;
			/// Removes the member from group.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberId&quot;&gt;The member id.&lt;/param&gt;
			/// &lt;param name=&quot;groupId&quot;&gt;The group id.&lt;/param&gt;
			public static void RemoveMemberFromGroup(int memberId, int groupId)
			{
				RemoveMembersFromGroup(new int[] { memberId }, groupId);
			}

			/// &lt;summary&gt;
			/// Removes the members from group.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberIds&quot;&gt;The member ids.&lt;/param&gt;
			/// &lt;param name=&quot;groupId&quot;&gt;The group id.&lt;/param&gt;
			public static void RemoveMembersFromGroup(int[] memberIds, int groupId)
			{
				RemoveMembersFromGroups(memberIds, new int[] { groupId });
			}

			/// &lt;summary&gt;
			/// Removes the members from groups.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberIds&quot;&gt;The member ids.&lt;/param&gt;
			/// &lt;param name=&quot;groupIds&quot;&gt;The group ids.&lt;/param&gt;
			public static void RemoveMembersFromGroups(int[] memberIds, int[] groupIds)
			{
				foreach (var memberId in memberIds)
				{
					if (memberId &gt; 0)
					{
						var member = GetMember(memberId);

						if (member != null)
						{
							foreach (var groupId in groupIds)
							{
#pragma warning disable 0618
								member.RemoveGroup(groupId);
#pragma warning restore 0618
							}
						}
					}
				}
			}

			/// &lt;summary&gt;
			/// Removes the members from groups.
			/// &lt;/summary&gt;
			/// &lt;param name=&quot;memberIds&quot;&gt;The member ids.&lt;/param&gt;
			/// &lt;param name=&quot;groupNames&quot;&gt;The group names.&lt;/param&gt;
			public static void RemoveMembersFromGroups(int[] memberIds, string[] groupNames)
			{
				var groupIds = new List&lt;int&gt;();

				foreach (var groupName in groupNames)
				{
					var group = MemberGroup.GetByName(groupName);

					if (group != null)
					{
						groupIds.Add(group.Id);
					}
				}

				RemoveMembersFromGroups(memberIds, groupIds.ToArray());
			}
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,3,14,4,0],[15,4,15,37,0],[16,4,16,71,0],[17,4,17,55,0],[18,4,18,57,0],[20,4,20,40,0],[21,4,21,5,0],[22,5,22,97,0],[23,5,23,24,0],[24,5,24,6,0],[25,6,25,26,0],[26,5,26,6,0],[27,4,27,5,0],[29,4,29,19,0],[30,3,30,4,0],[38,3,38,4,0],[39,4,39,37,0],[40,4,40,36,0],[42,4,42,20,0],[43,4,43,5,0],[44,5,44,12,0],[44,14,44,23,0],[44,24,44,26,0],[44,27,44,30,0],[45,5,45,6,0],[46,6,46,40,0],[47,6,47,25,0],[48,6,48,7,0],[49,7,49,27,0],[50,6,50,7,0],[51,5,51,6,0],[52,4,52,5,0],[54,4,54,19,0],[55,3,55,4,0],[63,3,63,4,0],[64,4,64,37,0],[65,4,65,36,0],[67,4,67,11,0],[67,13,67,19,0],[67,20,67,22,0],[67,23,67,26,0],[68,4,68,5,0],[69,5,69,39,0],[70,5,70,24,0],[71,5,71,6,0],[72,6,72,26,0],[73,5,73,6,0],[74,4,74,5,0],[76,4,76,19,0],[77,3,77,4,0],[85,3,85,4,0],[87,4,87,108,0],[88,3,88,4,0],[98,3,98,4,0],[100,4,100,25,0],[103,4,103,39,0],[104,4,104,5,0],[105,5,105,35,0],[106,4,106,5,0],[108,4,108,18,0],[109,3,109,4,0],[117,3,117,4,0],[120,4,120,5,0],[121,5,121,27,0],[123,4,123,9,0],[124,4,124,5,0],[125,5,125,17,0],[127,3,127,4,0],[135,3,135,4,0],[136,4,136,51,0],[138,4,138,11,0],[138,13,138,23,0],[138,24,138,26,0],[138,27,138,34,0],[139,4,139,5,0],[140,5,140,24,0],[141,5,141,6,0],[142,6,142,50,0],[143,5,143,6,0],[144,4,144,5,0],[146,4,146,22,0],[147,3,147,4,0],[157,4,157,5,0],[158,5,158,56,0],[159,4,159,5,0],[167,4,167,5,0],[168,5,168,58,0],[169,4,169,5,0],[177,4,177,5,0],[178,5,178,12,0],[178,14,178,26,0],[178,27,178,29,0],[178,30,178,39,0],[179,5,179,6,0],[180,6,180,23,0],[181,6,181,7,0],[182,7,182,40,0],[184,7,184,26,0],[185,7,185,8,0],[186,8,186,15,0],[186,17,186,28,0],[186,29,186,31,0],[186,32,186,40,0],[187,8,187,9,0],[189,9,189,34,0],[191,8,191,9,0],[192,7,192,8,0],[193,6,193,7,0],[194,5,194,6,0],[195,4,195,5,0],[203,4,203,5,0],[204,5,204,36,0],[206,5,206,12,0],[206,14,206,27,0],[206,28,206,30,0],[206,31,206,41,0],[207,5,207,6,0],[208,6,208,51,0],[210,6,210,24,0],[211,6,211,7,0],[212,7,212,30,0],[213,6,213,7,0],[214,5,214,6,0],[216,5,216,55,0],[217,4,217,5,0],[225,4,225,5,0],[226,5,226,61,0],[227,4,227,5,0],[235,4,235,5,0],[236,5,236,63,0],[237,4,237,5,0],[245,4,245,5,0],[246,5,246,12,0],[246,14,246,26,0],[246,27,246,29,0],[246,30,246,39,0],[247,5,247,6,0],[248,6,248,23,0],[249,6,249,7,0],[250,7,250,40,0],[252,7,252,26,0],[253,7,253,8,0],[254,8,254,15,0],[254,17,254,28,0],[254,29,254,31,0],[254,32,254,40,0],[255,8,255,9,0],[257,9,257,37,0],[259,8,259,9,0],[260,7,260,8,0],[261,6,261,7,0],[262,5,262,6,0],[263,4,263,5,0],[271,4,271,5,0],[272,5,272,36,0],[274,5,274,12,0],[274,14,274,27,0],[274,28,274,30,0],[274,31,274,41,0],[275,5,275,6,0],[276,6,276,51,0],[278,6,278,24,0],[279,6,279,7,0],[280,7,280,30,0],[281,6,281,7,0],[282,5,282,6,0],[284,5,284,60,0],[285,4,285,5,0]]);
    </script>
  </body>
</html>