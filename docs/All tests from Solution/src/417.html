<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\uQuery\uQuery-DataTypes.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Umbraco.Core.Logging;
using Umbraco.Web;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic.datatype;

namespace umbraco
{
	/// &lt;summary&gt;
	/// Static helper methods
	/// &lt;/summary&gt;
	public static partial class uQuery
	{
		/// &lt;summary&gt;
		/// Gets all datatypes sorted by a specified property name
		/// &lt;/summary&gt;
		/// &lt;returns&gt;
		/// A sorted list of datatypes. Null if property name is wrong.
		/// &lt;/returns&gt;
		public static IEnumerable&lt;KeyValuePair&lt;int, string&gt;&gt; GetAllDataTypes()
		{
			return GetAllDataTypes(true);
		}

		/// &lt;summary&gt;
		/// Gets all datatypes sorted by a specified property name
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;sortByName&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; [sort by name].&lt;/param&gt;
		/// &lt;returns&gt;
		/// A sorted list of datatypes. Null if property name is wrong.
		/// &lt;/returns&gt;
		public static IEnumerable&lt;KeyValuePair&lt;int, string&gt;&gt; GetAllDataTypes(bool sortByName)
		{
			var datatypes = new Dictionary&lt;int, string&gt;();

            using (var sqlHelper = Application.SqlHelper)
            using (var reader = sqlHelper.ExecuteReader(&quot;SELECT d.nodeId, n.text FROM cmsDataType d, umbracoNode n WHERE d.nodeId = n.id&quot;))
			{
				// Go through the values from the database and store them in the array.
				while (reader.Read())
				{
					if (!reader.GetInt(&quot;nodeId&quot;).Equals(new Guid()) &amp;&amp; !string.IsNullOrEmpty(reader.GetString(&quot;text&quot;)))
					{
						datatypes.Add(reader.GetInt(&quot;nodeId&quot;), reader.GetString(&quot;text&quot;));
					}
				}
			}

			if (sortByName)
			{
				return datatypes.OrderBy(x =&gt; x.Value);
			}

			return datatypes.OrderBy(x =&gt; x.Key);
		}

		/// &lt;summary&gt;
		/// Gets the data type GUID.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;datatypeNodeId&quot;&gt;The datatype node id.&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static Guid GetBaseDataTypeGuid(int datatypeNodeId)
		{
			var dataTypes = DataTypeDefinition.GetAll();

			foreach (var dataTypeDefinition in dataTypes)
			{
				try
				{
					var dataType = dataTypeDefinition.DataType;
					if (dataType != null &amp;&amp; dataType.DataTypeDefinitionId == datatypeNodeId)
					{
						return dataTypeDefinition.DataType.Id;
					}
				}
				catch (Exception ex)
				{
                    LogHelper.Error&lt;UmbracoHelper&gt;(string.Format(&quot;uQuery error in datatype definition {0}&quot;, dataTypeDefinition.Id), ex);
				}
			}

			return new Guid();
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[23,3,23,4,0],[24,4,24,33,0],[25,3,25,4,0],[35,3,35,4,0],[36,4,36,50,0],[38,20,38,57,0],[39,20,39,139,0],[40,4,40,5,0],[42,5,42,26,0],[43,5,43,6,0],[44,6,44,105,0],[45,6,45,7,0],[46,7,46,72,0],[47,6,47,7,0],[48,5,48,6,0],[49,4,49,5,0],[51,4,51,19,0],[52,4,52,5,0],[53,5,53,35,0],[53,35,53,42,0],[53,42,53,44,0],[53,5,53,44,0],[56,4,56,34,0],[56,34,56,39,0],[56,39,56,41,0],[56,4,56,41,0],[57,3,57,4,0],[65,3,65,4,0],[66,4,66,48,0],[68,4,68,11,0],[68,13,68,35,0],[68,36,68,38,0],[68,39,68,48,0],[69,4,69,5,0],[71,5,71,6,0],[72,6,72,49,0],[73,6,73,78,0],[74,6,74,7,0],[75,7,75,45,0],[77,5,77,6,0],[78,5,78,25,0],[79,5,79,6,0],[80,21,80,137,0],[81,5,81,6,0],[82,4,82,5,0],[84,4,84,22,0],[85,3,85,4,0]]);
    </script>
  </body>
</html>