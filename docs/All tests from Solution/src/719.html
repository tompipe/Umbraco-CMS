<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\UrlHelperRenderExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Web.Models;
using Umbraco.Web.Mvc;

namespace Umbraco.Web
{
    /// &lt;summary&gt;
    /// Extension methods for UrlHelper for use in templates
    /// &lt;/summary&gt;
    public static class UrlHelperRenderExtensions
    {

        #region GetCropUrl

        /// &lt;summary&gt;
        /// Gets the ImageProcessor Url of a media item by the crop alias (using default media item property alias of &quot;umbracoFile&quot;)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;urlHelper&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;mediaItem&quot;&gt;
        /// The IPublishedContent item.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;cropAlias&quot;&gt;
        /// The crop alias e.g. thumbnail
        /// &lt;/param&gt;
        /// &lt;param name=&quot;htmlEncode&quot;&gt;
        /// Whether to HTML encode this URL - default is true - w3c standards require html attributes to be html encoded but this can be 
        /// set to false if using the result of this method for CSS.
        /// &lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static IHtmlString GetCropUrl(this UrlHelper urlHelper, IPublishedContent mediaItem, string cropAlias, bool htmlEncode = true)
        {
            var url = mediaItem.GetCropUrl(cropAlias: cropAlias, useCropDimensions: true);
            return htmlEncode ? new HtmlString(HttpUtility.HtmlEncode(url)) : new HtmlString(url);
        }

        /// &lt;summary&gt;
        /// Gets the ImageProcessor Url by the crop alias using the specified property containing the image cropper Json data on the IPublishedContent item.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;urlHelper&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;mediaItem&quot;&gt;
        /// The IPublishedContent item.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;propertyAlias&quot;&gt;
        /// The property alias of the property containing the Json data e.g. umbracoFile
        /// &lt;/param&gt;
        /// &lt;param name=&quot;cropAlias&quot;&gt;
        /// The crop alias e.g. thumbnail
        /// &lt;/param&gt;
        /// &lt;param name=&quot;htmlEncode&quot;&gt;
        /// Whether to HTML encode this URL - default is true - w3c standards require html attributes to be html encoded but this can be 
        /// set to false if using the result of this method for CSS.
        /// &lt;/param&gt;
        /// &lt;returns&gt;
        /// The ImageProcessor.Web Url.
        /// &lt;/returns&gt;
        public static IHtmlString GetCropUrl(this UrlHelper urlHelper, IPublishedContent mediaItem, string propertyAlias, string cropAlias, bool htmlEncode = true)
        {
            var url = mediaItem.GetCropUrl(propertyAlias: propertyAlias, cropAlias: cropAlias, useCropDimensions: true);
            return htmlEncode ? new HtmlString(HttpUtility.HtmlEncode(url)) : new HtmlString(url);
        }

        /// &lt;summary&gt;
        /// Gets the ImageProcessor Url from the image path.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;mediaItem&quot;&gt;
        /// The IPublishedContent item.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;width&quot;&gt;
        /// The width of the output image.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;height&quot;&gt;
        /// The height of the output image.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;propertyAlias&quot;&gt;
        /// Property alias of the property containing the Json data.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;cropAlias&quot;&gt;
        /// The crop alias.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;quality&quot;&gt;
        /// Quality percentage of the output image.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;imageCropMode&quot;&gt;
        /// The image crop mode.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;imageCropAnchor&quot;&gt;
        /// The image crop anchor.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;preferFocalPoint&quot;&gt;
        /// Use focal point to generate an output image using the focal point instead of the predefined crop if there is one
        /// &lt;/param&gt;
        /// &lt;param name=&quot;useCropDimensions&quot;&gt;
        /// Use crop dimensions to have the output image sized according to the predefined crop sizes, this will override the width and height parameters
        /// &lt;/param&gt;
        /// &lt;param name=&quot;cacheBuster&quot;&gt;
        /// Add a serialised date of the last edit of the item to ensure client cache refresh when updated
        /// &lt;/param&gt;
        /// &lt;param name=&quot;furtherOptions&quot;&gt;
        /// The further options.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;ratioMode&quot;&gt;
        /// Use a dimension as a ratio
        /// &lt;/param&gt;
        /// &lt;param name=&quot;upScale&quot;&gt;
        /// If the image should be upscaled to requested dimensions
        /// &lt;/param&gt;
        /// &lt;param name=&quot;urlHelper&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;htmlEncode&quot;&gt;
        /// Whether to HTML encode this URL - default is true - w3c standards require html attributes to be html encoded but this can be 
        /// set to false if using the result of this method for CSS.
        /// &lt;/param&gt;
        /// &lt;returns&gt;
        /// The &lt;see cref=&quot;string&quot;/&gt;.
        /// &lt;/returns&gt;
        public static IHtmlString GetCropUrl(this UrlHelper urlHelper,
            IPublishedContent mediaItem,
            int? width = null,
            int? height = null,
            string propertyAlias = Umbraco.Core.Constants.Conventions.Media.File,
            string cropAlias = null,
            int? quality = null,
            ImageCropMode? imageCropMode = null,
            ImageCropAnchor? imageCropAnchor = null,
            bool preferFocalPoint = false,
            bool useCropDimensions = false,
            bool cacheBuster = true,
            string furtherOptions = null,
            ImageCropRatioMode? ratioMode = null,
            bool upScale = true,
            bool htmlEncode = true)
        {
            var url = mediaItem.GetCropUrl(width, height, propertyAlias, cropAlias, quality, imageCropMode,
                imageCropAnchor, preferFocalPoint, useCropDimensions, cacheBuster, furtherOptions, ratioMode,
                upScale);
            return htmlEncode ? new HtmlString(HttpUtility.HtmlEncode(url)) : new HtmlString(url);
        }

        /// &lt;summary&gt;
        /// Gets the ImageProcessor Url from the image path.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;imageUrl&quot;&gt;
        /// The image url.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;width&quot;&gt;
        /// The width of the output image.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;height&quot;&gt;
        /// The height of the output image.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;imageCropperValue&quot;&gt;
        /// The Json data from the Umbraco Core Image Cropper property editor
        /// &lt;/param&gt;
        /// &lt;param name=&quot;cropAlias&quot;&gt;
        /// The crop alias.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;quality&quot;&gt;
        /// Quality percentage of the output image.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;imageCropMode&quot;&gt;
        /// The image crop mode.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;imageCropAnchor&quot;&gt;
        /// The image crop anchor.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;preferFocalPoint&quot;&gt;
        /// Use focal point to generate an output image using the focal point instead of the predefined crop if there is one
        /// &lt;/param&gt;
        /// &lt;param name=&quot;useCropDimensions&quot;&gt;
        /// Use crop dimensions to have the output image sized according to the predefined crop sizes, this will override the width and height parameters
        /// &lt;/param&gt;
        /// &lt;param name=&quot;cacheBusterValue&quot;&gt;
        /// Add a serialised date of the last edit of the item to ensure client cache refresh when updated
        /// &lt;/param&gt;
        /// &lt;param name=&quot;furtherOptions&quot;&gt;
        /// The further options.
        /// &lt;/param&gt;
        /// &lt;param name=&quot;ratioMode&quot;&gt;
        /// Use a dimension as a ratio
        /// &lt;/param&gt;
        /// &lt;param name=&quot;upScale&quot;&gt;
        /// If the image should be upscaled to requested dimensions
        /// &lt;/param&gt;
        /// &lt;param name=&quot;urlHelper&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;htmlEncode&quot;&gt;
        /// Whether to HTML encode this URL - default is true - w3c standards require html attributes to be html encoded but this can be 
        /// set to false if using the result of this method for CSS.
        /// &lt;/param&gt;
        /// &lt;returns&gt;
        /// The &lt;see cref=&quot;string&quot;/&gt;.
        /// &lt;/returns&gt;
        public static IHtmlString GetCropUrl(this UrlHelper urlHelper,
            string imageUrl,
            int? width = null,
            int? height = null,
            string imageCropperValue = null,
            string cropAlias = null,
            int? quality = null,
            ImageCropMode? imageCropMode = null,
            ImageCropAnchor? imageCropAnchor = null,
            bool preferFocalPoint = false,
            bool useCropDimensions = false,
            string cacheBusterValue = null,
            string furtherOptions = null,
            ImageCropRatioMode? ratioMode = null,
            bool upScale = true,
            bool htmlEncode = true)
        {
            var url = imageUrl.GetCropUrl(width, height, imageCropperValue, cropAlias, quality, imageCropMode,
                imageCropAnchor, preferFocalPoint, useCropDimensions, cacheBusterValue, furtherOptions, ratioMode,
                upScale);
            return htmlEncode ? new HtmlString(HttpUtility.HtmlEncode(url)) : new HtmlString(url);            
        }

        #endregion

        /// &lt;summary&gt;
        /// Generates a URL based on the current Umbraco URL with a custom query string that will route to the specified SurfaceController
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;controllerName&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string SurfaceAction(this UrlHelper url, string action, string controllerName)
        {
            return url.SurfaceAction(action, controllerName, null);
        }

        /// &lt;summary&gt;
        /// Generates a URL based on the current Umbraco URL with a custom query string that will route to the specified SurfaceController
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;controllerName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;additionalRouteVals&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string SurfaceAction(this UrlHelper url, string action, string controllerName, object additionalRouteVals)
        {
            return url.SurfaceAction(action, controllerName, &quot;&quot;, additionalRouteVals);
        }

        /// &lt;summary&gt;
        /// Generates a URL based on the current Umbraco URL with a custom query string that will route to the specified SurfaceController
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;controllerName&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;area&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;additionalRouteVals&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string SurfaceAction(this UrlHelper url, string action, string controllerName, string area, object additionalRouteVals)
        {
            Mandate.ParameterNotNullOrEmpty(action, &quot;action&quot;);
            Mandate.ParameterNotNullOrEmpty(controllerName, &quot;controllerName&quot;);

            var encryptedRoute = UmbracoHelper.CreateEncryptedRouteString(controllerName, action, area, additionalRouteVals);

            var result = UmbracoContext.Current.OriginalRequestUrl.AbsolutePath.EnsureEndsWith(&#39;?&#39;) + &quot;ufprt=&quot; + encryptedRoute;
            return result;
        }

        /// &lt;summary&gt;
        /// Generates a URL based on the current Umbraco URL with a custom query string that will route to the specified SurfaceController
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;surfaceType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string SurfaceAction(this UrlHelper url, string action, Type surfaceType)
        {
            return url.SurfaceAction(action, surfaceType, null);
        }

        /// &lt;summary&gt;
        /// Generates a URL based on the current Umbraco URL with a custom query string that will route to the specified SurfaceController
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;surfaceType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;additionalRouteVals&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string SurfaceAction(this UrlHelper url, string action, Type surfaceType, object additionalRouteVals)
        {
            Mandate.ParameterNotNullOrEmpty(action, &quot;action&quot;);
            Mandate.ParameterNotNull(surfaceType, &quot;surfaceType&quot;);

            var area = &quot;&quot;;

            var surfaceController = SurfaceControllerResolver.Current.RegisteredSurfaceControllers
                                                             .SingleOrDefault(x =&gt; x == surfaceType);
            if (surfaceController == null)
                throw new InvalidOperationException(&quot;Could not find the surface controller of type &quot; + surfaceType.FullName);
            var metaData = PluginController.GetMetadata(surfaceController);
            if (metaData.AreaName.IsNullOrWhiteSpace() == false)
            {
                //set the area to the plugin area
                area = metaData.AreaName;
            }

            var encryptedRoute = UmbracoHelper.CreateEncryptedRouteString(metaData.ControllerName, action, area, additionalRouteVals);

            var result = UmbracoContext.Current.OriginalRequestUrl.AbsolutePath.EnsureEndsWith(&#39;?&#39;) + &quot;ufprt=&quot; + encryptedRoute;
            return result;
        }

        /// &lt;summary&gt;
        /// Generates a URL based on the current Umbraco URL with a custom query string that will route to the specified SurfaceController
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string SurfaceAction&lt;T&gt;(this UrlHelper url, string action)
            where T : SurfaceController
        {
            return url.SurfaceAction(action, typeof (T));
        }

        /// &lt;summary&gt;
        /// Generates a URL based on the current Umbraco URL with a custom query string that will route to the specified SurfaceController
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;url&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;additionalRouteVals&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string SurfaceAction&lt;T&gt;(this UrlHelper url, string action, object additionalRouteVals)
            where T : SurfaceController
        {
            return url.SurfaceAction(action, typeof (T), additionalRouteVals);
        }


    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[36,9,36,10,0],[37,13,37,91,0],[38,13,38,99,0],[39,9,39,10,0],[62,9,62,10,0],[63,13,63,121,0],[64,13,64,99,0],[65,9,65,10,0],[136,9,136,10,0],[137,13,139,26,0],[140,13,140,99,0],[141,9,141,10,0],[212,9,212,10,0],[213,13,215,26,0],[216,13,216,99,0],[217,9,217,10,0],[229,9,229,10,0],[230,13,230,68,0],[231,9,231,10,0],[242,9,242,10,0],[243,13,243,87,0],[244,9,244,10,0],[256,9,256,10,0],[257,13,257,63,0],[258,13,258,79,0],[260,13,260,126,0],[262,13,262,129,0],[263,13,263,27,0],[264,9,264,10,0],[274,9,274,10,0],[275,13,275,65,0],[276,9,276,10,0],[287,9,287,10,0],[288,13,288,63,0],[289,13,289,66,0],[291,13,291,27,0],[293,13,294,84,0],[294,84,294,100,0],[294,100,294,102,0],[293,13,294,102,0],[295,13,295,43,0],[296,17,296,126,0],[297,13,297,76,0],[298,13,298,65,0],[299,13,299,14,0],[301,17,301,42,0],[302,13,302,14,0],[304,13,304,135,0],[306,13,306,129,0],[307,13,307,27,0],[308,9,308,10,0],[319,9,319,10,0],[320,13,320,58,0],[321,9,321,10,0],[333,9,333,10,0],[334,13,334,79,0],[335,9,335,10,0]]);
    </script>
  </body>
</html>