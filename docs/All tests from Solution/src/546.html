<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\urlRewriter\UrlRewriterFormWriter.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

namespace umbraco.presentation.urlRewriter
{
    public class FormRewriterControlAdapter : System.Web.UI.Adapters.ControlAdapter
    {
        protected override void Render(HtmlTextWriter writer)
        {
            base.Render(new UrlRewriterFormWriter(writer));
        }
    }

    public class UrlRewriterFormWriter : HtmlTextWriter
    {

        public UrlRewriterFormWriter(HtmlTextWriter writer) : base(writer)
        {
            base.InnerWriter = writer.InnerWriter;

        }

        public UrlRewriterFormWriter(System.IO.TextWriter writer)
            : base(writer)
        {

            base.InnerWriter = writer;

        }
        public override void WriteAttribute(string name, string value, bool fEncode)
        {
            if (name == &quot;action&quot;)
            {
                HttpContext Context;
                Context = HttpContext.Current;
                if (Context.Items[&quot;ActionAlreadyWritten&quot;] == null)
                {
                    string formAction = &quot;&quot;;
                    if (Context.Items[&quot;VirtualUrl&quot;] != null &amp;&amp; !String.IsNullOrEmpty(Context.Items[&quot;VirtualUrl&quot;].ToString()))
                    {
                        formAction = Context.Items[&quot;VirtualUrl&quot;].ToString();
                    }
                    else
                    {
                        formAction = Context.Items[requestModule.ORIGINAL_URL_CXT_KEY].ToString();
                        if (!String.IsNullOrEmpty(Context.Request.Url.Query))
                        {
                            formAction += Context.Request.Url.Query;
                        }
                    }
                    value = formAction;
                    Context.Items[&quot;ActionAlreadyWritten&quot;] = true;
                }
            }
            base.WriteAttribute(name, value, fEncode);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,10,0],[17,13,17,60,0],[18,9,18,10,0],[24,63,24,75,0],[25,9,25,10,0],[26,13,26,51,0],[28,9,28,10,0],[31,15,31,27,0],[32,9,32,10,0],[34,13,34,39,0],[36,9,36,10,0],[38,9,38,10,0],[39,13,39,34,0],[40,13,40,14,0],[42,17,42,47,0],[43,17,43,67,0],[44,17,44,18,0],[45,21,45,44,0],[46,21,46,126,0],[47,21,47,22,0],[48,25,48,77,0],[49,21,49,22,0],[51,21,51,22,0],[52,25,52,99,0],[53,25,53,78,0],[54,25,54,26,0],[55,29,55,69,0],[56,25,56,26,0],[57,21,57,22,0],[58,21,58,40,0],[59,21,59,66,0],[60,17,60,18,0],[61,13,61,14,0],[62,13,62,55,0],[63,9,63,10,0]]);
    </script>
  </body>
</html>