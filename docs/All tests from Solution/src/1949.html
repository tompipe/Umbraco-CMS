<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Media\Exif\ImageFileDirectory.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;

namespace Umbraco.Core.Media.Exif
{
    /// &lt;summary&gt;
    /// Represents an image file directory.
    /// &lt;/summary&gt;
    internal class ImageFileDirectory
    {
        /// &lt;summary&gt;
        /// The fields contained in this IFD.
        /// &lt;/summary&gt;
        public List&lt;ImageFileDirectoryEntry&gt; Fields { get; private set; }
        /// &lt;summary&gt;
        /// Offset to the next IFD.
        /// &lt;/summary&gt;
        public uint NextIFDOffset { get; private set; }
        /// &lt;summary&gt;
        /// Compressed image data.
        /// &lt;/summary&gt;
        public List&lt;TIFFStrip&gt; Strips { get; private set; }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;ImageFileDirectory&quot;/&gt; class.
        /// &lt;/summary&gt;
        public ImageFileDirectory()
        {
            Fields = new List&lt;ImageFileDirectoryEntry&gt;();
            Strips = new List&lt;TIFFStrip&gt;();
        }

        /// &lt;summary&gt;
        /// Returns a &lt;see cref=&quot;ImageFileDirectory&quot;/&gt; initialized from the given byte data.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;data&quot;&gt;The data.&lt;/param&gt;
        /// &lt;param name=&quot;offset&quot;&gt;The offset into &lt;paramref name=&quot;data&quot;/&gt;.&lt;/param&gt;
        /// &lt;param name=&quot;byteOrder&quot;&gt;The byte order of &lt;paramref name=&quot;data&quot;/&gt;.&lt;/param&gt;
        /// &lt;returns&gt;A &lt;see cref=&quot;ImageFileDirectory&quot;/&gt; initialized from the given byte data.&lt;/returns&gt;
        public static ImageFileDirectory FromBytes(byte[] data, uint offset, BitConverterEx.ByteOrder byteOrder)
        {
            ImageFileDirectory ifd = new ImageFileDirectory();
            BitConverterEx conv = new BitConverterEx(byteOrder, BitConverterEx.SystemByteOrder);

            List&lt;uint&gt; stripOffsets = new List&lt;uint&gt;();
            List&lt;uint&gt; stripLengths = new List&lt;uint&gt;();

            // Count
            ushort fieldcount = conv.ToUInt16(data, offset);

            // Read fields
            for (uint i = 0; i &lt; fieldcount; i++)
            {
                uint fieldoffset = offset + 2 + 12 * i;
                ImageFileDirectoryEntry field = ImageFileDirectoryEntry.FromBytes(data, fieldoffset, byteOrder);
                ifd.Fields.Add(field);

                // Read strip offsets
                if (field.Tag == 273)
                {
                    int baselen = field.Data.Length / (int)field.Count;
                    for (uint j = 0; j &lt; field.Count; j++)
                    {
                        byte[] val = new byte[baselen];
                        Array.Copy(field.Data, j * baselen, val, 0, baselen);
                        uint stripOffset = (field.Type == 3 ? (uint)BitConverter.ToUInt16(val, 0) : BitConverter.ToUInt32(val, 0));
                        stripOffsets.Add(stripOffset);
                    }
                }

                // Read strip lengths
                if (field.Tag == 279)
                {
                    int baselen = field.Data.Length / (int)field.Count;
                    for (uint j = 0; j &lt; field.Count; j++)
                    {
                        byte[] val = new byte[baselen];
                        Array.Copy(field.Data, j * baselen, val, 0, baselen);
                        uint stripLength = (field.Type == 3 ? (uint)BitConverter.ToUInt16(val, 0) : BitConverter.ToUInt32(val, 0));
                        stripLengths.Add(stripLength);
                    }
                }
            }

            // Save strips
            if (stripOffsets.Count != stripLengths.Count)
                throw new NotValidTIFFileException();
            for (int i = 0; i &lt; stripOffsets.Count; i++)
                ifd.Strips.Add(new TIFFStrip(data, stripOffsets[i], stripLengths[i]));

            // Offset to next ifd
            ifd.NextIFDOffset = conv.ToUInt32(data, offset + 2 + 12 * fieldcount);

            return ifd;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,55,14,59,0],[14,60,14,72,0],[18,37,18,41,0],[18,42,18,54,0],[22,41,22,45,0],[22,46,22,58,0],[27,9,27,36,0],[28,9,28,10,0],[29,13,29,58,0],[30,13,30,44,0],[31,9,31,10,0],[41,9,41,10,0],[42,13,42,63,0],[43,13,43,97,0],[45,13,45,56,0],[46,13,46,56,0],[49,13,49,61,0],[52,18,52,28,0],[52,30,52,44,0],[52,46,52,49,0],[53,13,53,14,0],[54,17,54,56,0],[55,17,55,113,0],[56,17,56,39,0],[59,17,59,38,0],[60,17,60,18,0],[61,21,61,72,0],[62,26,62,36,0],[62,38,62,53,0],[62,55,62,58,0],[63,21,63,22,0],[64,25,64,56,0],[65,25,65,78,0],[66,25,66,132,0],[67,25,67,55,0],[68,21,68,22,0],[69,17,69,18,0],[72,17,72,38,0],[73,17,73,18,0],[74,21,74,72,0],[75,26,75,36,0],[75,38,75,53,0],[75,55,75,58,0],[76,21,76,22,0],[77,25,77,56,0],[78,25,78,78,0],[79,25,79,132,0],[80,25,80,55,0],[81,21,81,22,0],[82,17,82,18,0],[83,13,83,14,0],[86,13,86,58,0],[87,17,87,54,0],[88,18,88,27,0],[88,29,88,51,0],[88,53,88,56,0],[89,17,89,87,0],[92,13,92,83,0],[94,13,94,24,0],[95,9,95,10,0]]);
    </script>
  </body>
</html>