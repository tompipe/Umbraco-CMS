<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Routing\RoutesCacheTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using NUnit.Framework;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web.PublishedCache.XmlPublishedCache;

namespace Umbraco.Tests.Routing
{
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerFixture)]
    [TestFixture]
    public class RoutesCacheTests : BaseRoutingTest
    {
        [Test]
        public void U4_7939()
        {
            //var routingContext = GetRoutingContext(&quot;/test&quot;, 1111);
            var umbracoContext = GetUmbracoContext(&quot;/test&quot;, 0);
            var cache = umbracoContext.ContentCache.InnerCache as PublishedContentCache;
            if (cache == null) throw new Exception(&quot;Unsupported IPublishedContentCache, only the Xml one is supported.&quot;);

            PublishedContentCache.UnitTesting = false; // else does not write to routes cache
            Assert.IsFalse(PublishedContentCache.UnitTesting);

            var z = cache.GetByRoute(umbracoContext, false, &quot;/home/sub1&quot;);
            Assert.IsNotNull(z);
            Assert.AreEqual(1173, z.Id);

            var routes = cache.RoutesCache.GetCachedRoutes();
            Assert.AreEqual(1, routes.Count);

            // before the fix, the following assert would fail because the route would
            // have been stored as { 0, &quot;/home/sub1&quot; } - essentially meaning we were NOT
            // storing anything in the route cache!

            Assert.AreEqual(1173, routes.Keys.First());
            Assert.AreEqual(&quot;/home/sub1&quot;, routes.Values.First());
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,10,1],[20,13,20,64,1],[21,13,21,89,1],[22,13,22,31,1],[22,32,22,122,0],[24,13,24,55,1],[25,13,25,63,1],[27,13,27,75,1],[28,13,28,33,1],[29,13,29,41,1],[31,13,31,62,1],[32,13,32,46,1],[38,13,38,56,1],[39,13,39,66,1],[40,9,40,10,1]]);
    </script>
  </body>
</html>