<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.businesslogic\IO\FileMonitor.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Web;
using System.Web.Caching;
using System.Web.Hosting;

namespace umbraco.IO
{
    /// &lt;summary&gt;
    /// This class can be used to monitor file changes and update accordingly. This is copied
    /// from http://haacked.com/archive/2010/01/17/editable-routes.aspx and based on work in Dynamic Data
    /// &lt;/summary&gt;
    [Obsolete(&quot;This class is no longer used and will be removed from the codebase in the future&quot;)]
    public class FileMonitor
    {
        private FileMonitor(Action&lt;string&gt; changeCallback)
            : this(HostingEnvironment.VirtualPathProvider, changeCallback)
        {
        }

        private FileMonitor(VirtualPathProvider vpp,
            Action&lt;string&gt; changeCallback)
        {
            _vpp = vpp;
            _changeCallback = changeCallback;
        }

        VirtualPathProvider _vpp;
        Action&lt;string&gt; _changeCallback;

        // When the file at the given path changes, 
        // we&#39;ll call the supplied action.
        public static void Listen(string virtualPath, Action&lt;string&gt; action)
        {
            var notifier = new FileMonitor(action);
            notifier.ListenForChanges(virtualPath);
        }

        void ListenForChanges(string virtualPath)
        {
            // Get a CacheDependency from the BuildProvider, 
            // so that we know anytime something changes
            var virtualPathDependencies = new List&lt;string&gt;();
            virtualPathDependencies.Add(virtualPath);
            CacheDependency cacheDependency = _vpp.GetCacheDependency(
              virtualPath, virtualPathDependencies, DateTime.UtcNow);
            HttpRuntime.Cache.Insert(virtualPath /*key*/,
              virtualPath /*value*/,
              cacheDependency,
              Cache.NoAbsoluteExpiration,
              Cache.NoSlidingExpiration,
              CacheItemPriority.NotRemovable,
              new CacheItemRemovedCallback(OnConfigFileChanged));
        }

        void OnConfigFileChanged(string key, object value,
          CacheItemRemovedReason reason)
        {
            // We only care about dependency changes
            if (reason != CacheItemRemovedReason.DependencyChanged)
                return;

            _changeCallback(key);

            // Need to listen for the next change
            ListenForChanges(key);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,15,19,75,0],[20,9,20,10,0],[21,9,21,10,0],[23,9,24,43,0],[25,9,25,10,0],[26,13,26,24,0],[27,13,27,46,0],[28,9,28,10,0],[36,9,36,10,0],[37,13,37,52,0],[38,13,38,52,0],[39,9,39,10,0],[42,9,42,10,0],[45,13,45,62,0],[46,13,46,54,0],[47,13,48,70,0],[49,13,55,66,0],[56,9,56,10,0],[60,9,60,10,0],[62,13,62,68,0],[63,17,63,24,0],[65,13,65,34,0],[68,13,68,35,0],[69,9,69,10,0]]);
    </script>
  </body>
</html>