<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\XmlExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml;
using System.Xml.Linq;
using System.Xml.XPath;
using Umbraco.Core.Xml;

namespace Umbraco.Core
{
	/// &lt;summary&gt;
	/// Extension methods for xml objects
	/// &lt;/summary&gt;
	internal static class XmlExtensions
	{
        public static bool HasAttribute(this XmlAttributeCollection attributes, string attributeName)
        {
            return attributes.Cast&lt;XmlAttribute&gt;().Any(x =&gt; x.Name == attributeName);
        }	
		
        /// &lt;summary&gt;
        /// Selects a list of XmlNode matching an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The list of XmlNode matching the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNodeList SelectNodes(this XmlNode source, string expression, IEnumerable&lt;XPathVariable&gt; variables)
        {
            var av = variables == null ? null : variables.ToArray();
            return SelectNodes(source, expression, av);
        }

        /// &lt;summary&gt;
        /// Selects a list of XmlNode matching an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The list of XmlNode matching the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNodeList SelectNodes(this XmlNode source, XPathExpression expression, IEnumerable&lt;XPathVariable&gt; variables)
        {
            var av = variables == null ? null : variables.ToArray();
            return SelectNodes(source, expression, av);
        }

        /// &lt;summary&gt;
        /// Selects a list of XmlNode matching an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The list of XmlNode matching the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNodeList SelectNodes(this XmlNode source, string expression, params XPathVariable[] variables)
        {
            if (variables == null || variables.Length == 0 || variables[0] == null)
                return source.SelectNodes(expression);

            var iterator = source.CreateNavigator().Select(expression, variables);
            return XmlNodeListFactory.CreateNodeList(iterator);
        }

        /// &lt;summary&gt;
        /// Selects a list of XmlNode matching an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The list of XmlNode matching the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNodeList SelectNodes(this XmlNode source, XPathExpression expression, params XPathVariable[] variables)
        {
            if (variables == null || variables.Length == 0 || variables[0] == null)
                return source.SelectNodes(expression);

            var iterator = source.CreateNavigator().Select(expression, variables);
            return XmlNodeListFactory.CreateNodeList(iterator);
        }

        /// &lt;summary&gt;
        /// Selects the first XmlNode that matches an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The first XmlNode that matches the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNode SelectSingleNode(this XmlNode source, string expression, IEnumerable&lt;XPathVariable&gt; variables)
        {
            var av = variables == null ? null : variables.ToArray();
            return SelectSingleNode(source, expression, av);
        }

        /// &lt;summary&gt;
        /// Selects the first XmlNode that matches an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The first XmlNode that matches the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNode SelectSingleNode(this XmlNode source, XPathExpression expression, IEnumerable&lt;XPathVariable&gt; variables)
        {
            var av = variables == null ? null : variables.ToArray();
            return SelectSingleNode(source, expression, av);
        }

        /// &lt;summary&gt;
        /// Selects the first XmlNode that matches an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The first XmlNode that matches the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNode SelectSingleNode(this XmlNode source, string expression, params XPathVariable[] variables)
        {
            if (variables == null || variables.Length == 0 || variables[0] == null)
                return source.SelectSingleNode(expression);

            return SelectNodes(source, expression, variables).Cast&lt;XmlNode&gt;().FirstOrDefault();
        }

        /// &lt;summary&gt;
        /// Selects the first XmlNode that matches an XPath expression.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;source&quot;&gt;A source XmlNode.&lt;/param&gt;
        /// &lt;param name=&quot;expression&quot;&gt;An XPath expression.&lt;/param&gt;
        /// &lt;param name=&quot;variables&quot;&gt;A set of XPathVariables.&lt;/param&gt;
        /// &lt;returns&gt;The first XmlNode that matches the XPath expression.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;If &lt;param name=&quot;variables&quot; /&gt; is &lt;c&gt;null&lt;/c&gt;, or is empty, or contains only one single
        /// value which itself is &lt;c&gt;null&lt;/c&gt;, then variables are ignored.&lt;/para&gt;
        /// &lt;para&gt;The XPath expression should reference variables as &lt;c&gt;$var&lt;/c&gt;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public static XmlNode SelectSingleNode(this XmlNode source, XPathExpression expression, params XPathVariable[] variables)
        {
            if (variables == null || variables.Length == 0 || variables[0] == null)
                return source.SelectSingleNode(expression);

            return SelectNodes(source, expression, variables).Cast&lt;XmlNode&gt;().FirstOrDefault();
        }

        /// &lt;summary&gt;
        /// Converts from an XDocument to an XmlDocument
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;xDocument&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static XmlDocument ToXmlDocument(this XDocument xDocument)
        {
            var xmlDocument = new XmlDocument();
            using (var xmlReader = xDocument.CreateReader())
            {
                xmlDocument.Load(xmlReader);
            }
            return xmlDocument;
        }

        /// &lt;summary&gt;
        /// Converts from an XmlDocument to an XDocument
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;xmlDocument&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static XDocument ToXDocument(this XmlDocument xmlDocument)
        {
            using (var nodeReader = new XmlNodeReader(xmlDocument))
            {
                nodeReader.MoveToContent();
                return XDocument.Load(nodeReader);
            }
        }

        ///// &lt;summary&gt;
        ///// Converts from an XElement to an XmlElement
        ///// &lt;/summary&gt;
        ///// &lt;param name=&quot;xElement&quot;&gt;&lt;/param&gt;
        ///// &lt;returns&gt;&lt;/returns&gt;
        //public static XmlNode ToXmlElement(this XContainer xElement)
        //{
        //    var xmlDocument = new XmlDocument();
        //    using (var xmlReader = xElement.CreateReader())
        //    {
        //        xmlDocument.Load(xmlReader);
        //    }
        //    return xmlDocument.DocumentElement;
        //}

        /// &lt;summary&gt;
        /// Converts from an XmlElement to an XElement
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;xmlElement&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static XElement ToXElement(this XmlNode xmlElement)
        {
            using (var nodeReader = new XmlNodeReader(xmlElement))
            {
                nodeReader.MoveToContent();
                return XElement.Load(nodeReader);
            }
        }

        public static T AttributeValue&lt;T&gt;(this XElement xml, string attributeName)
        {
            if (xml == null) throw new ArgumentNullException(&quot;xml&quot;);
            if (xml.HasAttributes == false) return default(T);

            if (xml.Attribute(attributeName) == null)
                return default(T);

            var val = xml.Attribute(attributeName).Value;
            var result = val.TryConvertTo&lt;T&gt;();
            if (result.Success)
                return result.Result;

            return default(T);
        }
		public static T AttributeValue&lt;T&gt;(this XmlNode xml, string attributeName)
		{
			if (xml == null) throw new ArgumentNullException(&quot;xml&quot;);
			if (xml.Attributes == null) return default(T);

			if (xml.Attributes[attributeName] == null)
				return default(T);

			var val = xml.Attributes[attributeName].Value;
			var result = val.TryConvertTo&lt;T&gt;();
			if (result.Success)
				return result.Result;

			return default(T);
		}

        public static XElement GetXElement(this XmlNode node)
        {
            XDocument xDoc = new XDocument();
            using (XmlWriter xmlWriter = xDoc.CreateWriter())
                node.WriteTo(xmlWriter);
            return xDoc.Root;
        }

        public static XmlNode GetXmlNode(this XContainer element)
        {
            using (var xmlReader = element.CreateReader())
            {
                var xmlDoc = new XmlDocument();
                xmlDoc.Load(xmlReader);
                return xmlDoc.DocumentElement;
            }
        }

        public static XmlNode GetXmlNode(this XContainer element, XmlDocument xmlDoc)
        {
            return xmlDoc.ImportNode(element.GetXmlNode(), true);
        }

        // this exists because
        // new XElement(&quot;root&quot;, &quot;a\nb&quot;).Value is &quot;a\nb&quot; but
        // .ToString(SaveOptions.*) is &quot;a\r\nb&quot; and cannot figure out how to get rid of &quot;\r&quot;
        // and when saving data we want nothing to change
        // this method will produce a string that respects the \r and \n in the data value
	    public static string ToDataString(this XElement xml)
	    {
	        var settings = new XmlWriterSettings
	        {
                OmitXmlDeclaration = true,
	            NewLineHandling = NewLineHandling.None,
                Indent = false
	        };
	        var output = new StringBuilder();
	        using (var writer = XmlWriter.Create(output, settings))
	        {
                xml.WriteTo(writer);
            }
	        return output.ToString();
	    }
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,10,0],[21,13,21,61,0],[21,61,21,84,0],[21,84,21,86,0],[21,13,21,86,0],[22,9,22,10,0],[37,9,37,10,0],[38,13,38,69,0],[39,13,39,56,0],[40,9,40,10,0],[55,9,55,10,0],[56,13,56,69,0],[57,13,57,56,0],[58,9,58,10,0],[73,9,73,10,0],[74,13,74,84,0],[75,17,75,55,0],[77,13,77,83,0],[78,13,78,64,0],[79,9,79,10,0],[94,9,94,10,0],[95,13,95,84,0],[96,17,96,55,0],[98,13,98,83,0],[99,13,99,64,0],[100,9,100,10,0],[115,9,115,10,0],[116,13,116,69,0],[117,13,117,61,0],[118,9,118,10,0],[133,9,133,10,0],[134,13,134,69,0],[135,13,135,61,0],[136,9,136,10,0],[151,9,151,10,1],[152,13,152,84,1],[153,17,153,60,1],[155,13,155,96,0],[156,9,156,10,1],[171,9,171,10,0],[172,13,172,84,0],[173,17,173,60,0],[175,13,175,96,0],[176,9,176,10,0],[184,9,184,10,0],[185,13,185,49,0],[186,20,186,60,0],[187,13,187,14,0],[188,17,188,45,0],[189,13,189,14,0],[190,13,190,32,0],[191,9,191,10,0],[199,9,199,10,0],[200,20,200,67,0],[201,13,201,14,0],[202,17,202,44,0],[203,17,203,51,0],[205,9,205,10,0],[228,9,228,10,0],[229,20,229,66,0],[230,13,230,14,0],[231,17,231,44,0],[232,17,232,50,0],[234,9,234,10,0],[237,9,237,10,1],[238,13,238,29,1],[238,30,238,69,0],[239,13,239,44,1],[239,45,239,63,0],[241,13,241,54,1],[242,17,242,35,0],[244,13,244,58,1],[245,13,245,48,1],[246,13,246,32,1],[247,17,247,38,1],[249,13,249,31,0],[250,9,250,10,1],[252,3,252,4,1],[253,4,253,20,1],[253,21,253,60,0],[254,4,254,31,1],[254,32,254,50,0],[256,4,256,46,1],[257,5,257,23,0],[259,4,259,50,1],[260,4,260,39,1],[261,4,261,23,1],[262,5,262,26,1],[264,4,264,22,0],[265,3,265,4,1],[268,9,268,10,0],[269,13,269,46,0],[270,20,270,61,0],[271,17,271,41,0],[272,13,272,30,0],[273,9,273,10,0],[276,9,276,10,1],[277,20,277,58,1],[278,13,278,14,1],[279,17,279,48,1],[280,17,280,40,1],[281,17,281,47,1],[283,9,283,10,1],[286,9,286,10,1],[287,13,287,66,1],[288,9,288,10,1],[296,6,296,7,1],[297,10,302,12,1],[303,10,303,43,1],[304,17,304,64,1],[305,10,305,11,1],[306,17,306,37,1],[307,13,307,14,1],[308,10,308,35,1],[309,6,309,7,1]]);
    </script>
  </body>
</html>