<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Membership\DynamicMemberContentTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Web.Security;
using Lucene.Net.Util;
using Moq;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Core.Models.PublishedContent;
using Umbraco.Tests.PublishedContent;
using Umbraco.Tests.TestHelpers;
using Umbraco.Tests.TestHelpers.Entities;
using Umbraco.Web;
using Umbraco.Web.Models;
using Umbraco.Web.PublishedCache;

namespace Umbraco.Tests.Membership
{
    [DatabaseTestBehavior(DatabaseBehavior.NoDatabasePerFixture)]
    [TestFixture]
    public class DynamicMemberContentTests : PublishedContentTestBase
    {

        public override void Initialize()
        {
            // required so we can access property.Value
            //PropertyValueConvertersResolver.Current = new PropertyValueConvertersResolver();

            base.Initialize();

            // need to specify a custom callback for unit tests
            // AutoPublishedContentTypes generates properties automatically
            // when they are requested, but we must declare those that we
            // explicitely want to be here...

            var propertyTypes = new[]
                {
                    // AutoPublishedContentType will auto-generate other properties
                    new PublishedPropertyType(&quot;title&quot;, 0, &quot;?&quot;), 
                    new PublishedPropertyType(&quot;bodyText&quot;, 0, &quot;?&quot;), 
                    new PublishedPropertyType(&quot;author&quot;, 0, &quot;?&quot;)
                };
            var type = new AutoPublishedContentType(0, &quot;anything&quot;, propertyTypes);
            PublishedContentType.GetPublishedContentTypeCallback = (alias) =&gt; type;

        }

        [Test]
        public void Can_Get_Built_In_Properties()
        {
            var date = DateTime.Now;

            var member = new Member(&quot;test name&quot;, &quot;test@email.com&quot;, &quot;test username&quot;, &quot;test password&quot;,
                GetMemberType());
            member.Comments = &quot;test comment&quot;;
            member.IsApproved = true;
            member.IsLockedOut = false;
            member.CreateDate = date;
            member.LastLoginDate = date.AddMinutes(1);
            member.LastLockoutDate = date.AddMinutes(2);
            //NOTE: Last activity date is always the same as last login date since we don&#39;t have a place to store that data
            //member.LastLoginDate = date.AddMinutes(3);
            member.LastPasswordChangeDate = date.AddMinutes(4);
            member.PasswordQuestion = &quot;test question&quot;;

            var mpc = new MemberPublishedContent(member);                

            var d = mpc.AsDynamic();

            Assert.AreEqual(&quot;test comment&quot;, d.Comments);
            Assert.AreEqual(date, d.CreationDate);
            Assert.AreEqual(&quot;test@email.com&quot;, d.Email);
            Assert.AreEqual(true, d.IsApproved);
            Assert.AreEqual(false, d.IsLockedOut);
            Assert.AreEqual(date.AddMinutes(1), d.LastActivityDate);
            Assert.AreEqual(date.AddMinutes(2), d.LastLockoutDate);
            Assert.AreEqual(date.AddMinutes(1), d.LastLoginDate);
            Assert.AreEqual(date.AddMinutes(4), d.LastPasswordChangedDate);
            Assert.AreEqual(&quot;test name&quot;, d.Name);
            Assert.AreEqual(&quot;test question&quot;, d.PasswordQuestion);
            Assert.AreEqual(&quot;test username&quot;, d.UserName);

        }

        [Test]
        public void Can_Get_Built_In_Properties_Camel_Case()
        {
            var date = DateTime.Now;

            var member = new Member(&quot;test name&quot;, &quot;test@email.com&quot;, &quot;test username&quot;, &quot;test password&quot;,
               GetMemberType());
            member.Comments = &quot;test comment&quot;;
            member.IsApproved = true;
            member.IsLockedOut = false;
            member.CreateDate = date;
            member.LastLoginDate = date.AddMinutes(1);
            member.LastLockoutDate = date.AddMinutes(2);
            //NOTE: Last activity date is always the same as last login date since we don&#39;t have a place to store that data
            //member.LastLoginDate = date.AddMinutes(3);
            member.LastPasswordChangeDate = date.AddMinutes(4);
            member.PasswordQuestion = &quot;test question&quot;;

            var mpc = new MemberPublishedContent(member);

            var d = mpc.AsDynamic();

            Assert.AreEqual(&quot;test comment&quot;, d.comments);
            Assert.AreEqual(date, d.creationDate);
            Assert.AreEqual(&quot;test@email.com&quot;, d.email);
            Assert.AreEqual(true, d.isApproved);
            Assert.AreEqual(false, d.isLockedOut);
            Assert.AreEqual(date.AddMinutes(1), d.lastActivityDate);
            Assert.AreEqual(date.AddMinutes(2), d.lastLockoutDate);
            Assert.AreEqual(date.AddMinutes(1), d.lastLoginDate);
            Assert.AreEqual(date.AddMinutes(4), d.lastPasswordChangedDate);
            Assert.AreEqual(&quot;test name&quot;, d.name);
            Assert.AreEqual(&quot;test question&quot;, d.passwordQuestion);
            Assert.AreEqual(&quot;test username&quot;, d.userName);

        }

        [Test]
        public void Can_Get_Custom_Properties()
        {
            var date = DateTime.Now;

            var memberType = MockedContentTypes.CreateSimpleMemberType(&quot;Member&quot;, &quot;Member&quot;);
            var member = MockedMember.CreateSimpleMember(memberType, &quot;test name&quot;, &quot;test@email.com&quot;, &quot;test password&quot;, &quot;test username&quot;);
            member.Comments = &quot;test comment&quot;;
            member.IsApproved = true;
            member.IsLockedOut = false;
            member.CreateDate = date;
            member.LastLoginDate = date.AddMinutes(1);
            member.LastLockoutDate = date.AddMinutes(2);
            //NOTE: Last activity date is always the same as last login date since we don&#39;t have a place to store that data
            //member.LastLoginDate = date.AddMinutes(3);
            member.LastPasswordChangeDate = date.AddMinutes(4);
            member.PasswordQuestion = &quot;test question&quot;;

            member.Properties[&quot;title&quot;].Value = &quot;Test Value 1&quot;;
            member.Properties[&quot;bodyText&quot;].Value = &quot;Test Value 2&quot;;
            member.Properties[&quot;author&quot;].Value = &quot;Test Value 3&quot;;
            var mpc = new MemberPublishedContent(member);

            var d = mpc.AsDynamic();

            Assert.AreEqual(&quot;Test Value 1&quot;, d.title);
            Assert.AreEqual(&quot;Test Value 1&quot;, d.Title);
            Assert.AreEqual(&quot;Test Value 2&quot;, d.bodyText);
            Assert.AreEqual(&quot;Test Value 2&quot;, d.BodyText);
            Assert.AreEqual(&quot;Test Value 3&quot;, d.author);
            Assert.AreEqual(&quot;Test Value 3&quot;, d.Author);


        }

        private IMemberType GetMemberType()
        {
            var entity = new MemberType(-1)
            {
                Alias = &quot;Member&quot;
            };

            entity.AddPropertyGroup(Umbraco.Core.Constants.Conventions.Member.StandardPropertiesGroupName);
            var standardPropertyTypes = Umbraco.Core.Constants.Conventions.Member.GetStandardPropertyTypeStubs();
            foreach (var standardPropertyType in standardPropertyTypes)
            {
                entity.AddPropertyType(standardPropertyType.Value, Umbraco.Core.Constants.Conventions.Member.StandardPropertiesGroupName);
            }
            return entity;
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[30,13,30,31,1],[37,13,43,19,1],[44,13,44,83,1],[45,13,45,79,1],[45,79,45,83,1],[45,83,45,84,1],[45,13,45,84,1],[47,9,47,10,1],[51,9,51,10,1],[52,13,52,37,1],[54,13,55,34,1],[56,13,56,46,1],[57,13,57,38,1],[58,13,58,40,1],[59,13,59,38,1],[60,13,60,55,1],[61,13,61,57,1],[64,13,64,64,1],[65,13,65,55,1],[67,13,67,58,1],[69,13,69,37,1],[71,13,71,57,1],[72,13,72,51,1],[73,13,73,56,1],[74,13,74,49,1],[75,13,75,51,1],[76,13,76,69,1],[77,13,77,68,1],[78,13,78,66,1],[79,13,79,76,1],[80,13,80,50,1],[81,13,81,66,1],[82,13,82,58,1],[84,9,84,10,1],[88,9,88,10,1],[89,13,89,37,1],[91,13,92,33,1],[93,13,93,46,1],[94,13,94,38,1],[95,13,95,40,1],[96,13,96,38,1],[97,13,97,55,1],[98,13,98,57,1],[101,13,101,64,1],[102,13,102,55,1],[104,13,104,58,1],[106,13,106,37,1],[108,13,108,57,1],[109,13,109,51,1],[110,13,110,56,1],[111,13,111,49,1],[112,13,112,51,1],[113,13,113,69,1],[114,13,114,68,1],[115,13,115,66,1],[116,13,116,76,1],[117,13,117,50,1],[118,13,118,66,1],[119,13,119,58,1],[121,9,121,10,1],[125,9,125,10,1],[126,13,126,37,1],[128,13,128,92,1],[129,13,129,135,1],[130,13,130,46,1],[131,13,131,38,1],[132,13,132,40,1],[133,13,133,38,1],[134,13,134,55,1],[135,13,135,57,1],[138,13,138,64,1],[139,13,139,55,1],[141,13,141,63,1],[142,13,142,66,1],[143,13,143,64,1],[144,13,144,58,1],[146,13,146,37,1],[148,13,148,54,1],[149,13,149,54,1],[150,13,150,57,1],[151,13,151,57,1],[152,13,152,55,1],[153,13,153,55,1],[156,9,156,10,1],[159,9,159,10,1],[160,13,163,15,1],[165,13,165,108,1],[166,13,166,114,1],[167,13,167,20,1],[167,22,167,46,1],[167,47,167,49,1],[167,50,167,71,1],[168,13,168,14,1],[169,17,169,139,1],[170,13,170,14,1],[171,13,171,27,1],[172,9,172,10,1]]);
    </script>
  </body>
</html>