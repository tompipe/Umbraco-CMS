<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\Packager\PackageInstance\InstalledPackage.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using Umbraco.Core.Auditing;
using Umbraco.Core.Logging;
using Umbraco.Core.IO;

namespace umbraco.cms.businesslogic.packager {
    public class InstalledPackage
    {

        private int _saveHitCount = 0;

        public static InstalledPackage GetById(int id) {
            InstalledPackage pack = new InstalledPackage();
            pack.Data = data.Package(id, IOHelper.MapPath(Settings.InstalledPackagesSettings));
            return pack;
        }

        public static InstalledPackage GetByGuid(string packageGuid) {
            InstalledPackage pack = new InstalledPackage();
            pack.Data = data.Package(packageGuid, IOHelper.MapPath(Settings.InstalledPackagesSettings));
            return pack;
        }

        public static InstalledPackage MakeNew(string name) {
            InstalledPackage pack = new InstalledPackage();
            pack.Data = data.MakeNew(name, IOHelper.MapPath(Settings.InstalledPackagesSettings));
            pack.OnNew(EventArgs.Empty);
            return pack;
        }

        public void Save()
        {
#if DEBUG
            _saveHitCount++;
            LogHelper.Info&lt;InstalledPackage&gt;(&quot;The InstalledPackage class save method has been hit &quot; + _saveHitCount + &quot; times.&quot;);
#endif
            this.FireBeforeSave(EventArgs.Empty);
            data.Save(this.Data, IOHelper.MapPath(Settings.InstalledPackagesSettings));
            this.FireAfterSave(EventArgs.Empty);
        }

        public static List&lt;InstalledPackage&gt; GetAllInstalledPackages() {

            List&lt;InstalledPackage&gt; val = new List&lt;InstalledPackage&gt;();

            foreach (PackageInstance pack in data.GetAllPackages(IOHelper.MapPath(Settings.InstalledPackagesSettings)))
            {
                InstalledPackage insPackage = new InstalledPackage();
                insPackage.Data = pack;
                val.Add(insPackage);
            }

            return val;
        }

        private PackageInstance m_data;
        public PackageInstance Data {
            get { return m_data; }
            set { m_data = value; }
        }

        public void Delete(int userId)
        {
            Audit.Add(AuditTypes.PackagerUninstall, string.Format(&quot;Package &#39;{0}&#39; uninstalled. Package guid: {1}&quot;, Data.Name, Data.PackageGuid), userId, -1);
            Delete();
        }

        public void Delete() {
            this.FireBeforeDelete(EventArgs.Empty);
            data.Delete(this.Data.Id, IOHelper.MapPath(Settings.InstalledPackagesSettings));
            this.FireAfterDelete(EventArgs.Empty);
        }

        public static bool isPackageInstalled(string packageGuid) {
			try
			{
				if (data.GetFromGuid(packageGuid, IOHelper.MapPath(Settings.InstalledPackagesSettings), true) == null)
					return false;
				else
					return true;
			}
			catch (Exception ex)
			{
				LogHelper.Error&lt;InstalledPackage&gt;(&quot;An error occured in isPackagedInstalled&quot;, ex);
				return false;
			}
        }

        //EVENTS
        public delegate void SaveEventHandler(InstalledPackage sender, EventArgs e);
        public delegate void NewEventHandler(InstalledPackage sender, EventArgs e);
        public delegate void DeleteEventHandler(InstalledPackage sender, EventArgs e);

        /// &lt;summary&gt;
        /// Occurs when a macro is saved.
        /// &lt;/summary&gt;
        public static event SaveEventHandler BeforeSave;
        protected virtual void FireBeforeSave(EventArgs e) {
            if (BeforeSave != null)
                BeforeSave(this, e);
        }

        public static event SaveEventHandler AfterSave;
        protected virtual void FireAfterSave(EventArgs e) {
            if (AfterSave != null)
                AfterSave(this, e);
        }

        public static event NewEventHandler New;
        protected virtual void OnNew(EventArgs e) {
            if (New != null)
                New(this, e);
        }

        public static event DeleteEventHandler BeforeDelete;
        protected virtual void FireBeforeDelete(EventArgs e) {
            if (BeforeDelete != null)
                BeforeDelete(this, e);
        }

        public static event DeleteEventHandler AfterDelete;
        protected virtual void FireAfterDelete(EventArgs e) {
            if (AfterDelete != null)
                AfterDelete(this, e);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[11,9,11,39,0],[13,56,13,57,0],[14,13,14,60,0],[15,13,15,96,0],[16,13,16,25,0],[17,9,17,10,0],[19,70,19,71,0],[20,13,20,60,0],[21,13,21,105,0],[22,13,22,25,0],[23,9,23,10,0],[25,61,25,62,0],[26,13,26,60,0],[27,13,27,98,0],[28,13,28,41,0],[29,13,29,25,0],[30,9,30,10,0],[33,9,33,10,0],[35,13,35,29,0],[36,13,36,130,0],[38,13,38,50,0],[39,13,39,88,0],[40,13,40,49,0],[41,9,41,10,0],[43,72,43,73,0],[45,13,45,71,0],[47,13,47,20,0],[47,22,47,42,0],[47,43,47,45,0],[47,46,47,119,0],[48,13,48,14,0],[49,17,49,70,0],[50,17,50,40,0],[51,17,51,37,0],[52,13,52,14,0],[54,13,54,24,0],[55,9,55,10,0],[59,17,59,18,0],[59,19,59,33,0],[59,34,59,35,0],[60,17,60,18,0],[60,19,60,34,0],[60,35,60,36,0],[64,9,64,10,0],[65,13,65,157,0],[66,13,66,22,0],[67,9,67,10,0],[69,30,69,31,0],[70,13,70,52,0],[71,13,71,93,0],[72,13,72,51,0],[73,9,73,10,0],[75,67,75,68,0],[77,4,77,5,0],[78,5,78,107,0],[79,6,79,19,0],[81,6,81,18,0],[83,4,83,24,0],[84,4,84,5,0],[85,5,85,86,0],[86,5,86,18,0],[88,9,88,10,0],[99,60,99,61,0],[100,13,100,36,0],[101,17,101,37,0],[102,9,102,10,0],[105,59,105,60,0],[106,13,106,35,0],[107,17,107,36,0],[108,9,108,10,0],[111,51,111,52,0],[112,13,112,29,0],[113,17,113,30,0],[114,9,114,10,0],[117,62,117,63,0],[118,13,118,38,0],[119,17,119,39,0],[120,9,120,10,0],[123,61,123,62,0],[124,13,124,37,0],[125,17,125,38,0],[126,9,126,10,0]]);
    </script>
  </body>
</html>