<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\UmbracoExamine\UmbracoContentIndexerTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using System.Xml.Linq;
using Moq;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Models;
using UmbracoExamine;

namespace Umbraco.Tests.UmbracoExamine
{
    [TestFixture]
    public class UmbracoContentIndexerTests : ExamineBaseTest
    {
        [Test]
        public void Get_Serialized_Content_No_Published_Content()
        {
            var contentSet = new List&lt;IContent&gt;
            {
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 1 &amp;&amp; c.Path == &quot;-1,1&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 1),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 2 &amp;&amp; c.Path == &quot;-1,2&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 1),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 3 &amp;&amp; c.Path == &quot;-1,3&quot; &amp;&amp; c.Published == false &amp;&amp; c.Level == 1),      // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 4 &amp;&amp; c.Path == &quot;-1,4&quot; &amp;&amp; c.Published == false &amp;&amp; c.Level == 1),      // no

                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 5 &amp;&amp; c.Path == &quot;-1,1,5&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 6 &amp;&amp; c.Path == &quot;-1,2,6&quot; &amp;&amp; c.Published == false &amp;&amp; c.Level == 2),    // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 7 &amp;&amp; c.Path == &quot;-1,3,7&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),             // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 8 &amp;&amp; c.Path == &quot;-1,4,8&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),             // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 9 &amp;&amp; c.Path == &quot;-1,4,9&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),             // no

                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 10 &amp;&amp; c.Path == &quot;-1,1,5,10&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 15 &amp;&amp; c.Path == &quot;-1,1,5,15&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 11 &amp;&amp; c.Path == &quot;-1,2,6,11&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 16 &amp;&amp; c.Path == &quot;-1,2,6,16&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 12 &amp;&amp; c.Path == &quot;-1,3,7,12&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 17 &amp;&amp; c.Path == &quot;-1,3,7,17&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 13 &amp;&amp; c.Path == &quot;-1,4,8,13&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 18 &amp;&amp; c.Path == &quot;-1,4,8,18&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 14 &amp;&amp; c.Path == &quot;-1,4,9,14&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 19 &amp;&amp; c.Path == &quot;-1,4,9,19&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         // no
            };

            //ensure the rest of the required values are populted
            foreach (var content in contentSet)
            {
                var mock = Mock.Get(content);
                mock.Setup(x =&gt; x.ContentType).Returns(Mock.Of&lt;IContentType&gt;(type =&gt; type.Icon == &quot;hello&quot;));
            }

            contentSet.Sort((a, b) =&gt; Comparer&lt;int&gt;.Default.Compare(a.Level, b.Level));

            var published = new HashSet&lt;string&gt;();

            var result = UmbracoContentIndexer.GetSerializedContent(false, content =&gt; new XElement(&quot;test&quot;), contentSet, published)
                .WhereNotNull()
                .ToArray();

            Assert.AreEqual(5, result.Length);
        }

        [Test]
        public void Get_Serialized_Content_With_Published_Content()
        {
            var contentSet = new List&lt;IContent&gt;
            {
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 1 &amp;&amp; c.Path == &quot;-1,1&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 1),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 2 &amp;&amp; c.Path == &quot;-1,2&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 1),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 3 &amp;&amp; c.Path == &quot;-1,3&quot; &amp;&amp; c.Published == false &amp;&amp; c.Level == 1),      
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 4 &amp;&amp; c.Path == &quot;-1,4&quot; &amp;&amp; c.Published == false &amp;&amp; c.Level == 1),      

                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 5 &amp;&amp; c.Path == &quot;-1,1,5&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 6 &amp;&amp; c.Path == &quot;-1,2,6&quot; &amp;&amp; c.Published == false &amp;&amp; c.Level == 2),    
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 7 &amp;&amp; c.Path == &quot;-1,3,7&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),             
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 8 &amp;&amp; c.Path == &quot;-1,4,8&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),             
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 9 &amp;&amp; c.Path == &quot;-1,4,9&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 2),             

                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 10 &amp;&amp; c.Path == &quot;-1,1,5,10&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 15 &amp;&amp; c.Path == &quot;-1,1,5,15&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 11 &amp;&amp; c.Path == &quot;-1,2,6,11&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 16 &amp;&amp; c.Path == &quot;-1,2,6,16&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 12 &amp;&amp; c.Path == &quot;-1,3,7,12&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 17 &amp;&amp; c.Path == &quot;-1,3,7,17&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 13 &amp;&amp; c.Path == &quot;-1,4,8,13&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 18 &amp;&amp; c.Path == &quot;-1,4,8,18&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 14 &amp;&amp; c.Path == &quot;-1,4,9,14&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),         
                Mock.Of&lt;IContent&gt;(c =&gt; c.Id == 19 &amp;&amp; c.Path == &quot;-1,4,9,19&quot; &amp;&amp; c.Published &amp;&amp; c.Level == 3),          
            };

            //ensure the rest of the required values are populted
            foreach (var content in contentSet)
            {
                var mock = Mock.Get(content);
                mock.Setup(x =&gt; x.ContentType).Returns(Mock.Of&lt;IContentType&gt;(type =&gt; type.Icon == &quot;hello&quot;));
            }

            contentSet.Sort((a, b) =&gt; Comparer&lt;int&gt;.Default.Compare(a.Level, b.Level));

            var published = new HashSet&lt;string&gt;();

            var result = UmbracoContentIndexer.GetSerializedContent(true, content =&gt; new XElement(&quot;test&quot;), contentSet, published)
                .WhereNotNull()
                .ToArray();

            Assert.AreEqual(19, result.Length);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[18,13,41,15,1],[44,13,44,20,1],[44,22,44,33,1],[44,34,44,36,1],[44,37,44,47,1],[45,13,45,14,1],[46,17,46,46,1],[47,17,47,109,1],[48,13,48,14,1],[50,13,50,39,1],[50,39,50,86,1],[50,86,50,88,1],[50,13,50,88,1],[52,13,52,51,1],[54,13,54,87,1],[54,87,54,107,1],[54,107,56,28,1],[54,13,56,28,1],[58,13,58,47,1],[59,9,59,10,1],[63,9,63,10,1],[64,13,87,15,1],[90,13,90,20,1],[90,22,90,33,1],[90,34,90,36,1],[90,37,90,47,1],[91,13,91,14,1],[92,17,92,46,1],[93,17,93,109,1],[94,13,94,14,1],[96,13,96,39,1],[96,39,96,86,1],[96,86,96,88,1],[96,13,96,88,1],[98,13,98,51,1],[100,13,100,86,1],[100,86,100,106,1],[100,106,102,28,1],[100,13,102,28,1],[104,13,104,48,1],[105,9,105,10,1]]);
    </script>
  </body>
</html>