<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Models\Mapping\LockedCompositionsResolver.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using AutoMapper;
using System.Collections.Generic;
using System.Linq;
using Umbraco.Core;
using Umbraco.Core.Models;

namespace Umbraco.Web.Models.Mapping
{
    internal class LockedCompositionsResolver : ValueResolver&lt;IContentTypeComposition, IEnumerable&lt;string&gt;&gt;
    {
        private readonly ApplicationContext _applicationContext;

        public LockedCompositionsResolver(ApplicationContext applicationContext)
        {
            _applicationContext = applicationContext;
        }

        protected override IEnumerable&lt;string&gt; ResolveCore(IContentTypeComposition source)
        {
            var aliases = new List&lt;string&gt;();
            // get ancestor ids from path of parent if not root
            if (source.ParentId != Constants.System.Root)
            {
                var parent = _applicationContext.Services.ContentTypeService.GetContentType(source.ParentId);
                if (parent != null)
                {
                    var ancestorIds = parent.Path.Split(&#39;,&#39;).Select(int.Parse);
                    // loop through all content types and return ordered aliases of ancestors
                    var allContentTypes = _applicationContext.Services.ContentTypeService.GetAllContentTypes().ToArray();
                    foreach (var ancestorId in ancestorIds)
                    {
                        var ancestor = allContentTypes.FirstOrDefault(x =&gt; x.Id == ancestorId);
                        if (ancestor != null)
                        {
                            aliases.Add(ancestor.Alias);
                        }
                    }
                }
            }
            return aliases.OrderBy(x =&gt; x);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,81,1],[14,9,14,10,1],[15,13,15,54,1],[16,9,16,10,1],[19,9,19,10,1],[20,13,20,46,1],[22,13,22,58,1],[23,13,23,14,1],[24,17,24,110,1],[25,17,25,36,1],[26,17,26,18,0],[27,21,27,80,0],[29,21,29,122,0],[30,21,30,28,0],[30,30,30,44,0],[30,45,30,47,0],[30,48,30,59,0],[31,21,31,22,0],[32,25,32,76,0],[32,76,32,94,0],[32,94,32,96,0],[32,25,32,96,0],[33,25,33,46,0],[34,25,34,26,0],[35,29,35,57,0],[36,25,36,26,0],[37,21,37,22,0],[38,17,38,18,0],[39,13,39,14,1],[40,13,40,41,1],[40,41,40,42,0],[40,42,40,44,1],[40,13,40,44,1],[41,9,41,10,1]]);
    </script>
  </body>
</html>