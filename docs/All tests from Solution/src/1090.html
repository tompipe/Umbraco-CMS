<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Mvc\RenderMvcController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.Mvc;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Web.Models;
using Umbraco.Web.Routing;

namespace Umbraco.Web.Mvc
{

    /// &lt;summary&gt;
    /// The default controller to render front-end requests
    /// &lt;/summary&gt;
    [PreRenderViewActionFilter]    
    public class RenderMvcController : UmbracoController, IRenderMvcController
    {

        public RenderMvcController()
            : base()
        {
            ActionInvoker = new RenderActionInvoker();
        }

        public RenderMvcController(UmbracoContext umbracoContext, UmbracoHelper umbracoHelper)
            : base(umbracoContext, umbracoHelper)
        {
        }

        public RenderMvcController(UmbracoContext umbracoContext)
            : base(umbracoContext)
        {

        }

        private PublishedContentRequest _publishedContentRequest;

        /// &lt;summary&gt;
        /// Returns the current UmbracoContext
        /// &lt;/summary&gt;
        public override UmbracoContext UmbracoContext
        {
            get { return PublishedContentRequest.RoutingContext.UmbracoContext; }
        }

        /// &lt;summary&gt;
        /// Returns the Current published content item for rendering the content
        /// &lt;/summary&gt;
        protected IPublishedContent CurrentPage
        {
            get { return PublishedContentRequest.PublishedContent; }
        }

        /// &lt;summary&gt;
        /// Returns the current PublishedContentRequest
        /// &lt;/summary&gt;
        protected internal virtual PublishedContentRequest PublishedContentRequest
        {
            get
            {
                if (_publishedContentRequest != null)
                    return _publishedContentRequest;
                if (RouteData.DataTokens.ContainsKey(Core.Constants.Web.PublishedDocumentRequestDataToken) == false)
                {
                    throw new InvalidOperationException(&quot;DataTokens must contain an &#39;umbraco-doc-request&#39; key with a PublishedContentRequest object&quot;);
                }
                _publishedContentRequest = (PublishedContentRequest)RouteData.DataTokens[Core.Constants.Web.PublishedDocumentRequestDataToken];
                return _publishedContentRequest;
            }
        }

        /// &lt;summary&gt;
        /// Checks to make sure the physical view file exists on disk
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;template&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        protected bool EnsurePhsyicalViewExists(string template)
        {
            var result = ViewEngines.Engines.FindView(ControllerContext, template, null);
            if (result.View == null)
            {
                LogHelper.Warn&lt;RenderMvcController&gt;(&quot;No physical template file was found for template &quot; + template);
                return false;
            }
            return true;
        }

        /// &lt;summary&gt;
        /// Returns an ActionResult based on the template name found in the route values and the given model.
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;model&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// If the template found in the route values doesn&#39;t physically exist, then an empty ContentResult will be returned.
        /// &lt;/remarks&gt;
        protected ActionResult CurrentTemplate&lt;T&gt;(T model)
        {
            var template = ControllerContext.RouteData.Values[&quot;action&quot;].ToString();
            if (EnsurePhsyicalViewExists(template) == false)
                throw new Exception(&quot;No physical template file was found for template &quot; + template);
            return View(template, model);
        }

        /// &lt;summary&gt;
        /// The default action to render the front-end view
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;model&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [RenderIndexActionSelector]
        public virtual ActionResult Index(RenderModel model)
        {
            return CurrentTemplate(model);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,15,19,21,0],[20,9,20,10,0],[21,13,21,55,0],[22,9,22,10,0],[25,15,25,50,0],[26,9,26,10,0],[27,9,27,10,0],[30,15,30,35,1],[31,9,31,10,1],[33,9,33,10,1],[42,17,42,18,0],[42,19,42,80,0],[42,81,42,82,0],[50,17,50,18,0],[50,19,50,67,0],[50,68,50,69,0],[59,13,59,14,0],[60,17,60,54,0],[61,21,61,53,0],[62,17,62,117,0],[63,17,63,18,0],[64,21,64,151,0],[66,17,66,144,0],[67,17,67,49,0],[68,13,68,14,0],[77,9,77,10,0],[78,13,78,90,0],[79,13,79,37,0],[80,13,80,14,0],[81,17,81,117,0],[82,17,82,30,0],[84,13,84,25,0],[85,9,85,10,0],[97,9,97,10,0],[98,13,98,84,0],[99,13,99,61,0],[100,17,100,101,0],[101,13,101,42,0],[102,9,102,10,0],[111,9,111,10,0],[112,13,112,43,0],[113,9,113,10,0]]);
    </script>
  </body>
</html>