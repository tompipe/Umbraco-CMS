<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Editors\LegacyController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Net;
using System.Net.Http;
using System.Web;
using System.Web.Http;
using Umbraco.Core;
using Umbraco.Web.Mvc;
using Umbraco.Web.UI;
using Umbraco.Web.WebApi;
using Umbraco.Web.WebApi.Filters;

namespace Umbraco.Web.Editors
{
    /// &lt;summary&gt;
    /// The API controller used for dealing with legacy content
    /// &lt;/summary&gt;    
    [PluginController(&quot;UmbracoApi&quot;)]
    [ValidationFilter]
    public class LegacyController : UmbracoAuthorizedJsonController
    {

        /// &lt;summary&gt;
        /// Constructor
        /// &lt;/summary&gt;
        public LegacyController()
            : this(UmbracoContext.Current)
        {
        }

        /// &lt;summary&gt;
        /// Constructor
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;umbracoContext&quot;&gt;&lt;/param&gt;
        internal LegacyController(UmbracoContext umbracoContext)
            : base(umbracoContext)
        {
        }

        /// &lt;summary&gt;
        /// This will perform the delete operation for legacy items which include any item that
        /// has functionality included in the ui.xml structure.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [HttpPost]
        public HttpResponseMessage DeleteLegacyItem(string nodeId, string alias, string nodeType)
        {
            //U4-2686 - alias is html encoded, make sure to decode 
            alias = HttpUtility.HtmlDecode(alias);

            //In order to process this request we MUST have an HttpContext available
            var httpContextAttempt = TryGetHttpContext();
            if (httpContextAttempt.Success)
            {
                //this is a hack check based on legacy
                if (nodeType == &quot;memberGroups&quot;)
                {
                    LegacyDialogHandler.Delete(httpContextAttempt.Result, UmbracoUser, nodeType, 0, alias);
                    return Request.CreateResponse(HttpStatusCode.OK);
                }

                int id;
                if (int.TryParse(nodeId, out id))
                {
                    LegacyDialogHandler.Delete(httpContextAttempt.Result, UmbracoUser, nodeType, id, alias);
                    return Request.CreateResponse(HttpStatusCode.OK);
                }

                //the way this legacy stuff used to work is that if the node id didn&#39;t parse, we would     
                //pass the node id as the alias with an id of zero = sure whatevs.
                LegacyDialogHandler.Delete(httpContextAttempt.Result, UmbracoUser, nodeType, 0, nodeId);
                return Request.CreateResponse(HttpStatusCode.OK);
            }

            //We must have an HttpContext available for this to work.
            return Request.CreateErrorResponse(HttpStatusCode.InternalServerError, new InvalidOperationException(&quot;No HttpContext found in the current request&quot;));
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,15,26,43,0],[27,9,27,10,0],[28,9,28,10,0],[35,15,35,35,0],[36,9,36,10,0],[37,9,37,10,0],[46,9,46,10,0],[48,13,48,51,0],[51,13,51,58,0],[52,13,52,44,0],[53,13,53,14,0],[55,17,55,48,0],[56,17,56,18,0],[57,21,57,108,0],[58,21,58,70,0],[62,17,62,50,0],[63,17,63,18,0],[64,21,64,109,0],[65,21,65,70,0],[70,17,70,105,0],[71,17,71,66,0],[75,13,75,162,0],[76,9,76,10,0]]);
    </script>
  </body>
</html>