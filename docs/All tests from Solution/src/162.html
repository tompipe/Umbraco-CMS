<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Services\FileServiceTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;
using NUnit.Framework;
using Umbraco.Tests.TestHelpers;

namespace Umbraco.Tests.Services
{
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerTest)]
    [TestFixture, RequiresSTA]
    public class FileServiceTests : BaseServiceTest
    {

        [SetUp]
        public override void Initialize()
        {
            base.Initialize();
        }

        [TearDown]
        public override void TearDown()
        {
            base.TearDown();
        }

        [Test]
        public void Create_Template_Then_Assign_Child()
        {
            var child = ServiceContext.FileService.CreateTemplateWithIdentity(&quot;child&quot;, &quot;test&quot;);
            var parent = ServiceContext.FileService.CreateTemplateWithIdentity(&quot;parent&quot;, &quot;test&quot;);

            child.SetMasterTemplate(parent);
            ServiceContext.FileService.SaveTemplate(child);

            child = ServiceContext.FileService.GetTemplate(child.Id);

            Assert.AreEqual(parent.Alias, child.MasterTemplateAlias);

        }

        [Test]
        public void Create_Template_With_Child_Then_Unassign()
        {
            var parent = ServiceContext.FileService.CreateTemplateWithIdentity(&quot;parent&quot;, &quot;test&quot;);
            var child = ServiceContext.FileService.CreateTemplateWithIdentity(&quot;child&quot;, &quot;test&quot;, parent);

            child.SetMasterTemplate(null);
            ServiceContext.FileService.SaveTemplate(child);

            child = ServiceContext.FileService.GetTemplate(child.Id);

            Assert.AreEqual(null, child.MasterTemplateAlias);
        }

        [Test]
        public void Can_Query_Template_Children()
        {
            var parent = ServiceContext.FileService.CreateTemplateWithIdentity(&quot;parent&quot;, &quot;test&quot;);
            var child1 = ServiceContext.FileService.CreateTemplateWithIdentity(&quot;child1&quot;, &quot;test&quot;, parent);
            var child2 = ServiceContext.FileService.CreateTemplateWithIdentity(&quot;child2&quot;, &quot;test&quot;, parent);

            var children = ServiceContext.FileService.GetTemplates(parent.Id).Select(x =&gt; x.Id).ToArray();

            Assert.IsTrue(children.Contains(child1.Id));
            Assert.IsTrue(children.Contains(child2.Id));
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,10,1],[20,13,20,31,1],[21,9,21,10,1],[25,9,25,10,1],[26,13,26,29,1],[27,9,27,10,1],[31,9,31,10,1],[32,13,32,96,1],[33,13,33,98,1],[35,13,35,45,1],[36,13,36,60,1],[38,13,38,70,1],[40,13,40,70,1],[42,9,42,10,1],[46,9,46,10,1],[47,13,47,98,1],[48,13,48,104,1],[50,13,50,43,1],[51,13,51,60,1],[53,13,53,70,1],[55,13,55,62,1],[56,9,56,10,1],[60,9,60,10,1],[61,13,61,98,1],[62,13,62,106,1],[63,13,63,106,1],[65,13,65,91,1],[65,91,65,95,1],[65,95,65,107,1],[65,13,65,107,1],[67,13,67,57,1],[68,13,68,57,1],[69,9,69,10,1]]);
    </script>
  </body>
</html>