<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Models\PropertyGroupTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Diagnostics;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Core.Serialization;
using Umbraco.Tests.TestHelpers;

namespace Umbraco.Tests.Models
{
    [TestFixture]
    public class PropertyGroupTests : BaseUmbracoConfigurationTest
    {
        [Test]
        public void Can_Deep_Clone()
        {
            var pg = new PropertyGroup(
                new PropertyTypeCollection(new[]
                {
                    new PropertyType(&quot;TestPropertyEditor&quot;, DataTypeDatabaseType.Nvarchar, &quot;test&quot;)
                    {
                        Id = 3,
                        CreateDate = DateTime.Now,
                        DataTypeDefinitionId = 5,
                        PropertyEditorAlias = &quot;propTest&quot;,
                        Description = &quot;testing&quot;,
                        Key = Guid.NewGuid(),
                        Mandatory = true,
                        Name = &quot;Test&quot;,
                        PropertyGroupId = new Lazy&lt;int&gt;(() =&gt; 11),
                        SortOrder = 9,
                        UpdateDate = DateTime.Now,
                        ValidationRegExp = &quot;xxxx&quot;,
                        DataTypeDatabaseType = DataTypeDatabaseType.Nvarchar
                    },
                    new PropertyType(&quot;TestPropertyEditor&quot;, DataTypeDatabaseType.Nvarchar, &quot;test2&quot;)
                    {
                        Id = 4,
                        CreateDate = DateTime.Now,
                        DataTypeDefinitionId = 6,
                        PropertyEditorAlias = &quot;propTest&quot;,
                        Description = &quot;testing2&quot;,
                        Key = Guid.NewGuid(),
                        Mandatory = true,
                        Name = &quot;Test2&quot;,
                        PropertyGroupId = new Lazy&lt;int&gt;(() =&gt; 12),
                        SortOrder = 10,
                        UpdateDate = DateTime.Now,
                        ValidationRegExp = &quot;yyyy&quot;,
                        DataTypeDatabaseType = DataTypeDatabaseType.Nvarchar
                    }
                }))
            {
                Id = 77,
                CreateDate = DateTime.Now,
                Key = Guid.NewGuid(),
                Name = &quot;Group1&quot;,
                SortOrder = 555,
                UpdateDate = DateTime.Now
            };

            var clone = (PropertyGroup)pg.DeepClone();

            Assert.AreNotSame(clone, pg);
            Assert.AreEqual(clone, pg);
            Assert.AreEqual(clone.Id, pg.Id);
            Assert.AreEqual(clone.CreateDate, pg.CreateDate);
            Assert.AreEqual(clone.Key, pg.Key);
            Assert.AreEqual(clone.Name, pg.Name);
            Assert.AreEqual(clone.SortOrder, pg.SortOrder);
            Assert.AreEqual(clone.UpdateDate, pg.UpdateDate);
            Assert.AreNotSame(clone.PropertyTypes, pg.PropertyTypes);
            Assert.AreEqual(clone.PropertyTypes, pg.PropertyTypes);
            Assert.AreEqual(clone.PropertyTypes.Count, pg.PropertyTypes.Count);
            for (var i = 0; i &lt; pg.PropertyTypes.Count; i++)
            {
                Assert.AreNotSame(clone.PropertyTypes[i], pg.PropertyTypes[i]);
                Assert.AreEqual(clone.PropertyTypes[i], pg.PropertyTypes[i]);
            }

            //This double verifies by reflection
            var allProps = clone.GetType().GetProperties();
            foreach (var propertyInfo in allProps)
            {
                Assert.AreEqual(propertyInfo.GetValue(clone, null), propertyInfo.GetValue(pg, null));
            }
        }

        [Test]
        public void Can_Serialize_Without_Error()
        {
            var ss = new SerializationService(new JsonNetSerializer());

            var pg = new PropertyGroup(
                new PropertyTypeCollection(new[]
                {
                    new PropertyType(&quot;TestPropertyEditor&quot;, DataTypeDatabaseType.Nvarchar, &quot;test&quot;)
                    {
                        Id = 3,
                        CreateDate = DateTime.Now,
                        DataTypeDefinitionId = 5,
                        PropertyEditorAlias = &quot;propTest&quot;,
                        Description = &quot;testing&quot;,
                        Key = Guid.NewGuid(),
                        Mandatory = true,
                        Name = &quot;Test&quot;,
                        PropertyGroupId = new Lazy&lt;int&gt;(() =&gt; 11),
                        SortOrder = 9,
                        UpdateDate = DateTime.Now,
                        ValidationRegExp = &quot;xxxx&quot;,
                        DataTypeDatabaseType = DataTypeDatabaseType.Nvarchar
                    },
                    new PropertyType(&quot;TestPropertyEditor2&quot;, DataTypeDatabaseType.Nvarchar, &quot;test2&quot;)
                    {
                        Id = 4,
                        CreateDate = DateTime.Now,
                        DataTypeDefinitionId = 6,
                        PropertyEditorAlias = &quot;propTest&quot;,
                        Description = &quot;testing2&quot;,
                        Key = Guid.NewGuid(),
                        Mandatory = true,
                        Name = &quot;Test2&quot;,
                        PropertyGroupId = new Lazy&lt;int&gt;(() =&gt; 12),
                        SortOrder = 10,
                        UpdateDate = DateTime.Now,
                        ValidationRegExp = &quot;yyyy&quot;,
                        DataTypeDatabaseType = DataTypeDatabaseType.Nvarchar
                    }
                }))
            {
                Id = 77,
                CreateDate = DateTime.Now,
                Key = Guid.NewGuid(),
                Name = &quot;Group1&quot;,
                SortOrder = 555,
                UpdateDate = DateTime.Now
            };

            var result = ss.ToStream(pg);
            var json = result.ResultStream.ToJsonString();
            Debug.Print(json);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,1],[16,13,29,63,1],[29,63,29,65,0],[29,65,45,63,1],[45,63,45,65,0],[45,65,59,15,1],[16,13,59,15,1],[61,13,61,55,1],[63,13,63,42,1],[64,13,64,40,1],[65,13,65,46,1],[66,13,66,62,1],[67,13,67,48,1],[68,13,68,50,1],[69,13,69,60,1],[70,13,70,62,1],[71,13,71,70,1],[72,13,72,68,1],[73,13,73,80,1],[74,18,74,27,1],[74,29,74,55,1],[74,57,74,60,1],[75,13,75,14,1],[76,17,76,80,1],[77,17,77,78,1],[78,13,78,14,1],[81,13,81,60,1],[82,13,82,20,1],[82,22,82,38,1],[82,39,82,41,1],[82,42,82,50,1],[83,13,83,14,1],[84,17,84,102,1],[85,13,85,14,1],[86,9,86,10,1],[90,9,90,10,1],[91,13,91,72,1],[93,13,106,63,1],[106,63,106,65,0],[106,65,122,63,1],[122,63,122,65,0],[122,65,136,15,1],[93,13,136,15,1],[138,13,138,42,1],[139,13,139,59,1],[140,13,140,31,1],[141,9,141,10,1]]);
    </script>
  </body>
</html>