<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Services\ExternalLoginService.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using Microsoft.AspNet.Identity;
using Umbraco.Core.Events;
using Umbraco.Core.Logging;
using Umbraco.Core.Models.Identity;
using Umbraco.Core.Persistence;
using Umbraco.Core.Persistence.Querying;
using Umbraco.Core.Persistence.UnitOfWork;

namespace Umbraco.Core.Services
{
    public class ExternalLoginService : RepositoryService, IExternalLoginService
    {
        public ExternalLoginService(IDatabaseUnitOfWorkProvider provider, RepositoryFactory repositoryFactory, ILogger logger, IEventMessagesFactory eventMessagesFactory)
            : base(provider, repositoryFactory, logger, eventMessagesFactory)
        {
        }

        /// &lt;summary&gt;
        /// Returns all user logins assigned
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public IEnumerable&lt;IIdentityUserLogin&gt; GetAll(int userId)
        {            
            using (var repo = RepositoryFactory.CreateExternalLoginRepository(UowProvider.GetUnitOfWork()))
            {
                return repo.GetByQuery(new Query&lt;IIdentityUserLogin&gt;().Where(x =&gt; x.UserId == userId));
            }
        }

        /// &lt;summary&gt;
        /// Returns all logins matching the login info - generally there should only be one but in some cases 
        /// there might be more than one depending on if an adminstrator has been editing/removing members
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;login&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public IEnumerable&lt;IIdentityUserLogin&gt; Find(UserLoginInfo login)
        {
            using (var repo = RepositoryFactory.CreateExternalLoginRepository(UowProvider.GetUnitOfWork()))
            {
                return repo.GetByQuery(new Query&lt;IIdentityUserLogin&gt;()
                    .Where(x =&gt; x.ProviderKey == login.ProviderKey &amp;&amp; x.LoginProvider == login.LoginProvider));
            }
        }

        /// &lt;summary&gt;
        /// Save user logins
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;logins&quot;&gt;&lt;/param&gt;
        public void SaveUserLogins(int userId, IEnumerable&lt;UserLoginInfo&gt; logins)
        {
            var uow = UowProvider.GetUnitOfWork();
            using (var repo = RepositoryFactory.CreateExternalLoginRepository(uow))
            {
                repo.SaveUserLogins(userId, logins);
                uow.Commit();
            }
        }

        /// &lt;summary&gt;
        /// Deletes all user logins - normally used when a member is deleted
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;&lt;/param&gt;
        public void DeleteUserLogins(int userId)
        {
            var uow = UowProvider.GetUnitOfWork();
            using (var repo = RepositoryFactory.CreateExternalLoginRepository(uow))
            {
                repo.DeleteUserLogins(userId);
                uow.Commit();
            }
        }

        
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,15,16,78,0],[17,9,17,10,0],[18,9,18,10,0],[26,9,26,10,0],[27,20,27,107,0],[28,13,28,14,0],[29,17,29,104,0],[31,9,31,10,0],[40,9,40,10,0],[41,20,41,107,0],[42,13,42,14,0],[43,17,44,112,0],[46,9,46,10,0],[54,9,54,10,0],[55,13,55,51,0],[56,20,56,83,0],[57,13,57,14,0],[58,17,58,53,0],[59,17,59,30,0],[60,13,60,14,0],[61,9,61,10,0],[68,9,68,10,0],[69,13,69,51,0],[70,20,70,83,0],[71,13,71,14,0],[72,17,72,47,0],[73,17,73,30,0],[74,13,74,14,0],[75,9,75,10,0]]);
    </script>
  </body>
</html>