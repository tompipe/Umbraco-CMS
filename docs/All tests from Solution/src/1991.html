<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\DictionaryTranslation.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Reflection;
using System.Runtime.Serialization;
using Umbraco.Core.Models.EntityBase;
using Umbraco.Core.Persistence.Mappers;

namespace Umbraco.Core.Models
{
    /// &lt;summary&gt;
    /// Represents a translation for a &lt;see cref=&quot;DictionaryItem&quot;/&gt;
    /// &lt;/summary&gt;
    [Serializable]
    [DataContract(IsReference = true)]
    public class DictionaryTranslation : Entity, IDictionaryTranslation
    {
        internal Func&lt;int, ILanguage&gt; GetLanguage { get; set; }

        private ILanguage _language;
        private string _value;
        //note: this will be memberwise cloned
        private int _languageId;
        
        public DictionaryTranslation(ILanguage language, string value)
        {
            if (language == null) throw new ArgumentNullException(&quot;language&quot;);
            _language = language;
            _languageId = _language.Id;
            _value = value;
        }

        public DictionaryTranslation(ILanguage language, string value, Guid uniqueId)
        {
            if (language == null) throw new ArgumentNullException(&quot;language&quot;);
            _language = language;
            _languageId = _language.Id;
            _value = value;
            Key = uniqueId;
        }

        internal DictionaryTranslation(int languageId, string value)
        {            
            _languageId = languageId;
            _value = value;
        }

        internal DictionaryTranslation(int languageId, string value, Guid uniqueId)
        {            
            _languageId = languageId;
            _value = value;
            Key = uniqueId;
        }

        private static readonly Lazy&lt;PropertySelectors&gt; Ps = new Lazy&lt;PropertySelectors&gt;();

        private class PropertySelectors
        {
            public readonly PropertyInfo LanguageSelector = ExpressionHelper.GetPropertyInfo&lt;DictionaryTranslation, ILanguage&gt;(x =&gt; x.Language);
            public readonly PropertyInfo ValueSelector = ExpressionHelper.GetPropertyInfo&lt;DictionaryTranslation, string&gt;(x =&gt; x.Value);
        }

        /// &lt;summary&gt;
        /// Gets or sets the &lt;see cref=&quot;Language&quot;/&gt; for the translation
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Marked as DoNotClone - TODO: this member shouldn&#39;t really exist here in the first place, the DictionaryItem
        /// class will have a deep hierarchy of objects which all get deep cloned which we don&#39;t want. This should have simply
        /// just referenced a language ID not the actual language object. In v8 we need to fix this.
        /// We&#39;re going to have to do the same hacky stuff we had to do with the Template/File contents so that this is returned 
        /// on a callback.
        /// &lt;/remarks&gt;
        [DataMember]
        [DoNotClone]
        public ILanguage Language
        {
            get
            {
                if (_language != null)
                    return _language;

                // else, must lazy-load
                if (GetLanguage != null &amp;&amp; _languageId &gt; 0)
                    _language = GetLanguage(_languageId);
                return _language;
            }
            set
            {
                SetPropertyValueAndDetectChanges(value, ref _language, Ps.Value.LanguageSelector);
                _languageId = _language == null ? -1 : _language.Id;                
            }
        }

        public int LanguageId
        {
            get { return _languageId; }
        }

        /// &lt;summary&gt;
        /// Gets or sets the translated text
        /// &lt;/summary&gt;
        [DataMember]
        public string Value
        {
            get { return _value; }
            set { SetPropertyValueAndDetectChanges(value, ref _value, Ps.Value.ValueSelector); }
        }

        public override object DeepClone()
        {
            var clone = (DictionaryTranslation)base.DeepClone();

            // clear fields that were memberwise-cloned and that we don&#39;t want to clone
            clone._language = null;

            // turn off change tracking
            clone.DisableChangeTracking();
            
            // this shouldn&#39;t really be needed since we&#39;re not tracking
            clone.ResetDirtyProperties(false);

            // re-enable tracking
            clone.EnableChangeTracking();

            return clone;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,53,16,57,1],[16,58,16,62,1],[23,9,23,71,1],[24,9,24,10,1],[25,13,25,34,1],[25,35,25,79,0],[26,13,26,34,1],[27,13,27,40,1],[28,13,28,28,1],[29,9,29,10,1],[31,9,31,86,0],[32,9,32,10,0],[33,13,33,34,0],[33,35,33,79,0],[34,13,34,34,0],[35,13,35,40,0],[36,13,36,28,0],[37,13,37,28,0],[38,9,38,10,0],[40,9,40,69,0],[41,9,41,10,0],[42,13,42,38,0],[43,13,43,28,0],[44,9,44,10,0],[46,9,46,84,1],[47,9,47,10,1],[48,13,48,38,1],[49,13,49,28,1],[50,13,50,28,1],[51,9,51,10,1],[53,9,53,92,1],[57,13,57,145,1],[58,13,58,136,1],[76,13,76,14,1],[77,17,77,39,1],[78,21,78,38,1],[81,17,81,60,1],[82,21,82,58,1],[83,17,83,34,1],[84,13,84,14,1],[86,13,86,14,0],[87,17,87,99,0],[88,17,88,69,0],[89,13,89,14,0],[94,17,94,18,1],[94,19,94,38,1],[94,39,94,40,1],[103,17,103,18,1],[103,19,103,33,1],[103,34,103,35,1],[104,17,104,18,1],[104,19,104,95,1],[104,96,104,97,1],[108,9,108,10,1],[109,13,109,65,1],[112,13,112,36,1],[115,13,115,43,1],[118,13,118,47,1],[121,13,121,42,1],[123,13,123,26,1],[124,9,124,10,1]]);
    </script>
  </body>
</html>