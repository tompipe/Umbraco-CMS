<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\mediapicker\MediaPickerPrevalueEditor.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using System.IO;
using umbraco.DataLayer;
using umbraco.BusinessLogic;
using umbraco.editorControls;

namespace umbraco.editorControls.mediapicker
{
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public class MediaPickerPrevalueEditor : System.Web.UI.WebControls.PlaceHolder, umbraco.interfaces.IDataPrevalue
    {
        /// &lt;summary&gt;
        /// Unused, please do not use
        /// &lt;/summary&gt;
        [Obsolete(&quot;Obsolete, For querying the database use the new UmbracoDatabase object ApplicationContext.Current.DatabaseContext.Database&quot;, false)]
        public ISqlHelper SqlHelper
        {
            get { return Application.SqlHelper; }
        }

        //private DropDownList _dropdownlist;
        private CheckBox _checkboxShowPreview;
        private CheckBox _checkboxShowAdvancedDialog;

        private umbraco.cms.businesslogic.datatype.BaseDataType _datatype;

        public MediaPickerPrevalueEditor(umbraco.cms.businesslogic.datatype.BaseDataType DataType)
        {
            _datatype = DataType;
            setupChildControls();
        }

        private void setupChildControls()
        {
            //_dropdownlist = new DropDownList();
            //_dropdownlist.ID = &quot;dbtype&quot;;
            //_dropdownlist.Items.Add(DBTypes.Date.ToString());
            //_dropdownlist.Items.Add(DBTypes.Integer.ToString());
            //_dropdownlist.Items.Add(DBTypes.Ntext.ToString());
            //_dropdownlist.Items.Add(DBTypes.Nvarchar.ToString());

            _checkboxShowPreview = new CheckBox();
            _checkboxShowPreview.ID = &quot;showpreview&quot;;

            _checkboxShowAdvancedDialog = new CheckBox();
            _checkboxShowAdvancedDialog.ID = &quot;showadvanceddialog&quot;;

            //Controls.Add(_dropdownlist);

            Controls.Add(_checkboxShowPreview);
            Controls.Add(_checkboxShowAdvancedDialog);

        }

        public Control Editor
        {
            get
            {
                return this;
            }
        }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);
            if (!Page.IsPostBack)
            {

                _checkboxShowPreview.Checked = ShowPreview;
                _checkboxShowAdvancedDialog.Checked = ShowAdvancedDialog;

            }


        }

        public void Save()
        {
            _datatype.DBType = umbraco.cms.businesslogic.datatype.DBTypes.Integer;

            // Generate data-string
            string data = _checkboxShowPreview.Checked.ToString() + &quot;|&quot; + _checkboxShowAdvancedDialog.Checked.ToString();

            using (var sqlHelper = Application.SqlHelper)
            {
                // If the add new prevalue textbox is filled out - add the value to the collection.
                IParameter[] SqlParams = new IParameter[] {
                        sqlHelper.CreateParameter(&quot;@value&quot;,data),
                        sqlHelper.CreateParameter(&quot;@dtdefid&quot;,_datatype.DataTypeDefinitionId)};
                sqlHelper.ExecuteNonQuery(&quot;delete from cmsDataTypePreValues where datatypenodeid = @dtdefid&quot;, SqlParams);

                // For SQL CE 4 support we need this again!
                SqlParams = new IParameter[] {
                            sqlHelper.CreateParameter(&quot;@value&quot;,data),
                            sqlHelper.CreateParameter(&quot;@dtdefid&quot;,_datatype.DataTypeDefinitionId)};
                sqlHelper.ExecuteNonQuery(&quot;insert into cmsDataTypePreValues (datatypenodeid,[value],sortorder,alias) values (@dtdefid,@value,0,&#39;&#39;)&quot;, SqlParams);
            }
        }

        public string Configuration
        {
            get
            {
                using (var sqlHelper = Application.SqlHelper)
                {
                    object conf =
                        sqlHelper.ExecuteScalar&lt;object&gt;(&quot;select value from cmsDataTypePreValues where datatypenodeid = @datatypenodeid&quot;,
                                                sqlHelper.CreateParameter(&quot;@datatypenodeid&quot;, _datatype.DataTypeDefinitionId));
                    if (conf != null)
                        return conf.ToString();
                    else
                        return &quot;&quot;;
                }
            }
        }

        public bool ShowPreview
        {
            get
            {
                string[] config = Configuration.Split(&quot;|&quot;.ToCharArray());
                if (config.Length &gt; 1)
                {
                    return Convert.ToBoolean(config[0]);
                }
                else
                {
                    return false;
                }

            }
        }

        public bool ShowAdvancedDialog
        {
            get
            {
                string[] config = Configuration.Split(&quot;|&quot;.ToCharArray());
                if (config.Length &gt; 1)
                {
                    return Convert.ToBoolean(config[1]);
                }
                else
                {
                    return false;
                }

            }
        }

        protected override void Render(HtmlTextWriter writer)
        {
            writer.WriteLine(&quot;&lt;table&gt;&quot;);
            //writer.WriteLine(&quot;&lt;tr&gt;&lt;th&gt;Database datatype:&lt;/th&gt;&lt;td&gt;&quot;);
            //_dropdownlist.RenderControl(writer);
            //writer.Write(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
            writer.Write(&quot;&lt;tr&gt;&lt;th&gt;Show preview:&lt;/th&gt;&lt;td&gt;&quot;);
            _checkboxShowPreview.RenderControl(writer);
            writer.Write(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
            writer.Write(&quot;&lt;tr&gt;&lt;th&gt;Show advanced dialog:&lt;/th&gt;&lt;td&gt;&quot;);
            _checkboxShowAdvancedDialog.RenderControl(writer);
            writer.Write(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);           
            writer.Write(&quot;&lt;/table&gt;&quot;);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[26,17,26,18,0],[26,19,26,48,0],[26,49,26,50,0],[35,9,35,99,0],[36,9,36,10,0],[37,13,37,34,0],[38,13,38,34,0],[39,9,39,10,0],[42,9,42,10,0],[50,13,50,51,0],[51,13,51,53,0],[53,13,53,58,0],[54,13,54,67,0],[58,13,58,48,0],[59,13,59,55,0],[61,9,61,10,0],[66,13,66,14,0],[67,17,67,29,0],[68,13,68,14,0],[72,9,72,10,0],[73,13,73,28,0],[74,13,74,34,0],[75,13,75,14,0],[77,17,77,60,0],[78,17,78,74,0],[80,13,80,14,0],[83,9,83,10,0],[86,9,86,10,0],[87,13,87,83,0],[90,13,90,122,0],[92,20,92,57,0],[93,13,93,14,0],[95,17,97,95,0],[98,17,98,122,0],[101,17,103,99,0],[104,17,104,161,0],[105,13,105,14,0],[106,9,106,10,0],[111,13,111,14,0],[112,24,112,61,0],[113,17,113,18,0],[114,21,116,127,0],[117,21,117,38,0],[118,25,118,48,0],[120,25,120,35,0],[122,13,122,14,0],[128,13,128,14,0],[129,17,129,74,0],[130,17,130,39,0],[131,17,131,18,0],[132,21,132,57,0],[135,17,135,18,0],[136,21,136,34,0],[139,13,139,14,0],[145,13,145,14,0],[146,17,146,74,0],[147,17,147,39,0],[148,17,148,18,0],[149,21,149,57,0],[152,17,152,18,0],[153,21,153,34,0],[156,13,156,14,0],[160,9,160,10,0],[161,13,161,41,0],[165,13,165,60,0],[166,13,166,56,0],[167,13,167,40,0],[168,13,168,68,0],[169,13,169,63,0],[170,13,170,40,0],[171,13,171,38,0],[172,9,172,10,0]]);
    </script>
  </body>
</html>