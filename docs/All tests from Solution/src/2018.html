<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Models\UserExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Globalization;
using Umbraco.Core.Models.Membership;
using Umbraco.Core.Services;

namespace Umbraco.Core.Models
{
    public static class UserExtensions
    {
        /// &lt;summary&gt;
        /// Returns the culture info associated with this user, based on the language they&#39;re assigned to in the back office
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;textService&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;      
        public static CultureInfo GetUserCulture(this IUser user, ILocalizedTextService textService)
        {
            if (user == null) throw new ArgumentNullException(&quot;user&quot;);
            if (textService == null) throw new ArgumentNullException(&quot;textService&quot;);
            return GetUserCulture(user.Language, textService);
        }

        internal static CultureInfo GetUserCulture(string userLanguage, ILocalizedTextService textService)
        {
            try
            {
                var culture = CultureInfo.GetCultureInfo(userLanguage.Replace(&quot;_&quot;, &quot;-&quot;));
                //TODO: This is a hack because we store the user language as 2 chars instead of the full culture 
                // which is actually stored in the language files (which are also named with 2 chars!) so we need to attempt
                // to convert to a supported full culture
                var result = textService.ConvertToSupportedCultureWithRegionCode(culture);
                return result;
            }
            catch (CultureNotFoundException)
            {
                //return the default one
                return CultureInfo.GetCultureInfo(&quot;en&quot;);
            }
        }

        /// &lt;summary&gt;
        /// Checks if the user has access to the content item based on their start noe
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;content&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal static bool HasPathAccess(this IUser user, IContent content)
        {
            if (user == null) throw new ArgumentNullException(&quot;user&quot;);
            if (content == null) throw new ArgumentNullException(&quot;content&quot;);
            return HasPathAccess(content.Path, user.StartContentId, Constants.System.RecycleBinContent);
        }

        internal static bool HasPathAccess(string path, int startNodeId, int recycleBinId)
        {
            Mandate.ParameterNotNullOrEmpty(path, &quot;path&quot;);

            var formattedPath = &quot;,&quot; + path + &quot;,&quot;;
            var formattedStartNodeId = &quot;,&quot; + startNodeId.ToInvariantString() + &quot;,&quot;;
            var formattedRecycleBinId = &quot;,&quot; + recycleBinId.ToInvariantString() + &quot;,&quot;;

            //only users with root access have access to the recycle bin
            if (formattedPath.Contains(formattedRecycleBinId))
            {
                return startNodeId == Constants.System.Root;
            }

            return formattedPath.Contains(formattedStartNodeId);
        }

        /// &lt;summary&gt;
        /// Checks if the user has access to the media item based on their start noe
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;media&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal static bool HasPathAccess(this IUser user, IMedia media)
        {
            if (user == null) throw new ArgumentNullException(&quot;user&quot;);
            if (media == null) throw new ArgumentNullException(&quot;media&quot;);
            return HasPathAccess(media.Path, user.StartMediaId, Constants.System.RecycleBinMedia);
        }


        /// &lt;summary&gt;
        /// Determines whether this user is an admin.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;user&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;
        /// 	&lt;c&gt;true&lt;/c&gt; if this user is admin; otherwise, &lt;c&gt;false&lt;/c&gt;.
        /// &lt;/returns&gt;
        public static bool IsAdmin(this IUser user)
        {
            if (user == null) throw new ArgumentNullException(&quot;user&quot;);
            return user.UserType.Alias == &quot;admin&quot;;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,0],[18,13,18,30,0],[18,31,18,71,0],[19,13,19,37,0],[19,38,19,85,0],[20,13,20,63,0],[21,9,21,10,0],[24,9,24,10,0],[26,13,26,14,0],[27,17,27,90,0],[31,17,31,91,0],[32,17,32,31,0],[34,13,34,45,0],[35,13,35,14,0],[37,17,37,57,0],[39,9,39,10,0],[48,9,48,10,1],[49,13,49,30,1],[49,31,49,71,0],[50,13,50,33,1],[50,34,50,77,0],[51,13,51,105,1],[52,9,52,10,1],[55,9,55,10,1],[56,13,56,59,1],[58,13,58,50,1],[59,13,59,84,1],[60,13,60,86,1],[63,13,63,63,1],[64,13,64,14,1],[65,17,65,61,1],[68,13,68,65,1],[69,9,69,10,1],[78,9,78,10,1],[79,13,79,30,1],[79,31,79,71,0],[80,13,80,31,1],[80,32,80,73,0],[81,13,81,99,1],[82,9,82,10,1],[93,9,93,10,0],[94,13,94,30,0],[94,31,94,71,0],[95,13,95,51,0],[96,9,96,10,0]]);
    </script>
  </body>
</html>