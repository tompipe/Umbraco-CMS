<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Models\Trees\MenuItemList.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using Umbraco.Core;
using umbraco.BusinessLogic.Actions;
using umbraco.interfaces;

namespace Umbraco.Web.Models.Trees
{
    /// &lt;summary&gt;
    /// A custom menu list
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// NOTE: We need a sub collection to the MenuItemCollection object due to how json serialization works.
    /// &lt;/remarks&gt;
    public class MenuItemList : List&lt;MenuItem&gt;
    {
        public MenuItemList()
        {           
        }

        public MenuItemList(IEnumerable&lt;MenuItem&gt; items)
            : base(items)
        {            
        }

        /// &lt;summary&gt;
        /// Adds a menu item
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;action&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;The text to display for the menu item, will default to the IAction alias if not specified&lt;/param&gt;
        internal MenuItem Add(IAction action, string name)
        {
            var item = new MenuItem(action);

            DetectLegacyActionMenu(action.GetType(), item);

            Add(item);
            return item;
        }

        /// &lt;summary&gt;
        /// Adds a menu item
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;TMenuItem&quot;&gt;&lt;/typeparam&gt;
        /// &lt;typeparam name=&quot;TAction&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;hasSeparator&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;The text to display for the menu item, will default to the IAction alias if not specified&lt;/param&gt;
        /// &lt;param name=&quot;additionalData&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public TMenuItem Add&lt;TMenuItem, TAction&gt;(string name, bool hasSeparator = false, IDictionary&lt;string, object&gt; additionalData = null)
            where TAction : IAction
            where TMenuItem : MenuItem, new()
        {
            var item = CreateMenuItem&lt;TAction&gt;(name, hasSeparator, additionalData);
            if (item == null) return null;

            var customMenuItem = new TMenuItem
                {
                    Name = item.Name,
                    Alias = item.Alias,
                    SeperatorBefore = hasSeparator,
                    Icon = item.Icon,
                    Action = item.Action
                };

            Add(customMenuItem);

            return customMenuItem;
        }

        /// &lt;summary&gt;
        /// Adds a menu item
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;The text to display for the menu item, will default to the IAction alias if not specified&lt;/param&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        public MenuItem Add&lt;T&gt;(string name)
            where T : IAction
        {
            return Add&lt;T&gt;(name, false, null);
        }

        /// &lt;summary&gt;
        /// Adds a menu item with a key value pair which is merged to the AdditionalData bag
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;The text to display for the menu item, will default to the IAction alias if not specified&lt;/param&gt;
        /// &lt;param name=&quot;hasSeparator&quot;&gt;&lt;/param&gt;
        public MenuItem Add&lt;T&gt;(string name, string key, string value, bool hasSeparator = false)
            where T : IAction
        {
            return Add&lt;T&gt;(name, hasSeparator, new Dictionary&lt;string, object&gt; { { key, value } });
        }

        /// &lt;summary&gt;
        /// Adds a menu item with a dictionary which is merged to the AdditionalData bag
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;hasSeparator&quot;&gt;&lt;/param&gt;
        /// /// &lt;param name=&quot;name&quot;&gt;The text to display for the menu item, will default to the IAction alias if not specified&lt;/param&gt;
        /// &lt;param name=&quot;additionalData&quot;&gt;&lt;/param&gt;
        public MenuItem Add&lt;T&gt;(string name, bool hasSeparator = false, IDictionary&lt;string, object&gt; additionalData = null)
            where T : IAction
        {
            var item = CreateMenuItem&lt;T&gt;(name, hasSeparator, additionalData);
            if (item != null)
            {
                Add(item);
                return item;
            }
            return null;
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;param name=&quot;hasSeparator&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;The text to display for the menu item, will default to the IAction alias if not specified&lt;/param&gt;
        /// &lt;param name=&quot;additionalData&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal MenuItem CreateMenuItem&lt;T&gt;(string name, bool hasSeparator = false, IDictionary&lt;string, object&gt; additionalData = null)
            where T : IAction
        {
            var item = ActionsResolver.Current.GetAction&lt;T&gt;();
            if (item != null)
            {
                var menuItem = new MenuItem(item, name)
                    {
                        SeperatorBefore = hasSeparator
                    };

                if (additionalData != null)
                {
                    foreach (var i in additionalData)
                    {
                        menuItem.AdditionalData[i.Key] = i.Value;
                    }
                }

                DetectLegacyActionMenu(typeof(T), menuItem);

                //TODO: Once we implement &#39;real&#39; menu items, not just IActions we can implement this since
                // people may need to pass specific data to their menu items

                ////validate the data in the meta data bag
                //item.ValidateRequiredData(AdditionalData);

                return menuItem;
            }
            return null;
        }

        /// &lt;summary&gt;
        /// Checks if the IAction type passed in is attributed with LegacyActionMenuItemAttribute and if so 
        /// ensures that the correct action metadata is added.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;actionType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;menuItem&quot;&gt;&lt;/param&gt;
        private void DetectLegacyActionMenu(Type actionType, MenuItem menuItem)
        {
            //This checks for legacy IActions that have the LegacyActionMenuItemAttribute which is a legacy hack
            // to make old IAction actions work in v7 by mapping to the JS used by the new menu items
            var attribute = actionType.GetCustomAttribute&lt;LegacyActionMenuItemAttribute&gt;(false);
            if (attribute != null)
            {
                //add the current type to the metadata
                if (attribute.MethodName.IsNullOrWhiteSpace())
                {
                    //if no method name is supplied we will assume that the menu action is the type name of the current menu class
                    menuItem.AdditionalData.Add(MenuItem.JsActionKey, string.Format(&quot;{0}.{1}&quot;, attribute.ServiceName, this.GetType().Name));
                }
                else
                {
                    menuItem.AdditionalData.Add(MenuItem.JsActionKey, string.Format(&quot;{0}.{1}&quot;, attribute.ServiceName, attribute.MethodName));
                }
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,30,0],[18,9,18,10,0],[19,9,19,10,0],[22,15,22,26,0],[23,9,23,10,0],[24,9,24,10,0],[32,9,32,10,0],[33,13,33,45,0],[35,13,35,60,0],[37,13,37,23,0],[38,13,38,25,0],[39,9,39,10,0],[53,9,53,10,0],[54,13,54,84,0],[55,13,55,30,0],[55,31,55,43,0],[57,13,64,19,0],[66,13,66,33,0],[68,13,68,35,0],[69,9,69,10,0],[78,9,78,10,0],[79,13,79,46,0],[80,9,80,10,0],[92,9,92,10,0],[93,13,93,98,0],[94,9,94,10,0],[105,9,105,10,0],[106,13,106,78,0],[107,13,107,30,0],[108,13,108,14,0],[109,17,109,27,0],[110,17,110,29,0],[112,13,112,25,0],[113,9,113,10,0],[125,9,125,10,0],[126,13,126,63,0],[127,13,127,30,0],[128,13,128,14,0],[129,17,132,23,0],[134,17,134,44,0],[135,17,135,18,0],[136,21,136,28,0],[136,30,136,35,0],[136,36,136,38,0],[136,39,136,53,0],[137,21,137,22,0],[138,25,138,66,0],[139,21,139,22,0],[140,17,140,18,0],[142,17,142,61,0],[150,17,150,33,0],[152,13,152,25,0],[153,9,153,10,0],[162,9,162,10,0],[165,13,165,97,0],[166,13,166,35,0],[167,13,167,14,0],[169,17,169,63,0],[170,17,170,18,0],[172,21,172,141,0],[173,17,173,18,0],[175,17,175,18,0],[176,21,176,142,0],[177,17,177,18,0],[178,13,178,14,0],[179,9,179,10,0]]);
    </script>
  </body>
</html>