<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\Packager\PackageActions\allowDoctype.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Linq;
using System.Xml;

namespace umbraco.cms.businesslogic.packager.standardPackageActions
{
	/// &lt;summary&gt;
	/// This class implements the IPackageAction Interface, used to execute code when packages are installed.
	/// All IPackageActions only takes a PackageName and a XmlNode as input, and executes based on the data in the xmlnode.
	/// &lt;/summary&gt;
	public class allowDoctype : umbraco.interfaces.IPackageAction
	{

		#region IPackageAction Members

		/// &lt;summary&gt;
		/// Allows a documentType to be created below another documentType.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;packageName&quot;&gt;Name of the package.&lt;/param&gt;
		/// &lt;param name=&quot;xmlData&quot;&gt;The XML data.&lt;/param&gt;
		/// &lt;example&gt;&lt;code&gt;
		/// &lt;Action runat=&quot;install&quot; alias=&quot;allowDocumenttype&quot; documentTypeAlias=&quot;MyNewDocumentType&quot; parentDocumentTypeAlias=&quot;HomePage&quot;  /&gt;
		/// &lt;/code&gt;&lt;/example&gt;
		/// &lt;returns&gt;Returns true on success&lt;/returns&gt;
		public bool Execute(string packageName, XmlNode xmlData)
		{
			string doctypeName = xmlData.Attributes[&quot;documentTypeAlias&quot;].Value;
			string parentDoctypeName = xmlData.Attributes[&quot;parentDocumentTypeAlias&quot;].Value;

			cms.businesslogic.ContentType ct = cms.businesslogic.ContentType.GetByAlias(doctypeName);
			cms.businesslogic.ContentType parentct = cms.businesslogic.ContentType.GetByAlias(parentDoctypeName);

			if (ct != null &amp;&amp; parentct != null)
			{
				bool containsId = false;
				ArrayList tmp = new ArrayList();

				foreach (int i in parentct.AllowedChildContentTypeIDs.ToList())
				{
					tmp.Add(i);
					if (i == ct.Id)
						containsId = true;
				}

				if (!containsId)
				{

					int[] ids = new int[tmp.Count + 1];
					for (int i = 0; i &lt; tmp.Count; i++) ids[i] = (int)tmp[i];
					ids[ids.Length - 1] = ct.Id;

					parentct.AllowedChildContentTypeIDs = ids;
					parentct.Save();
					return true;
				}
			}
			return false;
		}

		//this has no undo.
		/// &lt;summary&gt;
		/// This action has no undo.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;packageName&quot;&gt;Name of the package.&lt;/param&gt;
		/// &lt;param name=&quot;xmlData&quot;&gt;The XML data.&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public bool Undo(string packageName, XmlNode xmlData)
		{
			return true;
		}

		/// &lt;summary&gt;
		/// Action Alias.
		/// &lt;/summary&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public string Alias()
		{
			return &quot;allowDocumenttype&quot;;
		}

		#endregion

		public XmlNode SampleXml()
		{
			throw new NotImplementedException();
		}

	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[27,3,27,4,0],[28,4,28,71,0],[29,4,29,83,0],[31,4,31,93,0],[32,4,32,105,0],[34,4,34,39,0],[35,4,35,5,0],[36,5,36,29,0],[37,5,37,37,0],[39,5,39,12,0],[39,14,39,19,0],[39,20,39,22,0],[39,23,39,67,0],[40,5,40,6,0],[41,6,41,17,0],[42,6,42,21,0],[43,7,43,25,0],[44,5,44,6,0],[46,5,46,21,0],[47,5,47,6,0],[49,6,49,41,0],[50,11,50,20,0],[50,22,50,35,0],[50,37,50,40,0],[50,42,50,63,0],[51,6,51,34,0],[53,6,53,48,0],[54,6,54,22,0],[55,6,55,18,0],[57,4,57,5,0],[58,4,58,17,0],[59,3,59,4,0],[69,3,69,4,0],[70,4,70,16,0],[71,3,71,4,0],[78,3,78,4,0],[79,4,79,31,0],[80,3,80,4,0],[85,3,85,4,0],[86,4,86,40,0]]);
    </script>
  </body>
</html>