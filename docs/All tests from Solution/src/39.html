<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\PublishedContent\PublishedContentExtensionTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web;

namespace Umbraco.Tests.PublishedContent
{
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerFixture)]
	[TestFixture]
    public class PublishedContentExtensionTests : PublishedContentTestBase
	{
		private UmbracoContext ctx;
		private string xmlContent = &quot;&quot;;
		private bool createContentTypes = true;
        
		protected override string GetXmlContent(int templateId)
		{
			return xmlContent;
		}

		[Test]
		public void IsDocumentType_NonRecursive_ActualType_ReturnsTrue()
		{
			InitializeInheritedContentTypes();

			var publishedContent = ctx.ContentCache.GetById(1100);
            Assert.That(publishedContent.IsDocumentType(&quot;inherited&quot;, false));
		}

		[Test]
		public void IsDocumentType_NonRecursive_BaseType_ReturnsFalse()
		{
			InitializeInheritedContentTypes();

			var publishedContent = ctx.ContentCache.GetById(1100);
			Assert.That(publishedContent.IsDocumentType(&quot;base&quot;, false), Is.False);
		}

		[Test]
		public void IsDocumentType_Recursive_ActualType_ReturnsTrue()
		{
			InitializeInheritedContentTypes();

			var publishedContent = ctx.ContentCache.GetById(1100);
			Assert.That(publishedContent.IsDocumentType(&quot;inherited&quot;, true));
		}

		[Test]
		public void IsDocumentType_Recursive_BaseType_ReturnsTrue()
		{
			InitializeInheritedContentTypes();

			var publishedContent = ctx.ContentCache.GetById(1100);
			Assert.That(publishedContent.IsDocumentType(&quot;base&quot;, true));
		}
        
		[Test]
		public void IsDocumentType_Recursive_InvalidBaseType_ReturnsFalse()
		{
			InitializeInheritedContentTypes();

			var publishedContent = ctx.ContentCache.GetById(1100);
			Assert.That(publishedContent.IsDocumentType(&quot;invalidbase&quot;, true), Is.False);
		}

		private void InitializeInheritedContentTypes()
		{
			ctx = GetUmbracoContext(&quot;/&quot;, 1, null, true);
			if (createContentTypes)
			{
				var contentTypeService = ctx.Application.Services.ContentTypeService;
				var baseType = new ContentType(-1) {Alias = &quot;base&quot;, Name = &quot;Base&quot;};
			    const string contentTypeAlias = &quot;inherited&quot;;
			    var inheritedType = new ContentType(baseType, contentTypeAlias) {Alias = contentTypeAlias, Name = &quot;Inherited&quot;};
				contentTypeService.Save(baseType);
				contentTypeService.Save(inheritedType);
				createContentTypes = false;
			}
			#region setup xml content
			xmlContent = @&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;utf-8&quot;&quot;?&gt;
&lt;!DOCTYPE root[ 
&lt;!ELEMENT inherited ANY&gt;
&lt;!ATTLIST inherited id ID #REQUIRED&gt;
]&gt;
&lt;root id=&quot;&quot;-1&quot;&quot;&gt;
	&lt;inherited id=&quot;&quot;1100&quot;&quot; parentID=&quot;&quot;-1&quot;&quot; level=&quot;&quot;1&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;1&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-06-12T14:13:17&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:50:43&quot;&quot; nodeName=&quot;&quot;Home&quot;&quot; urlName=&quot;&quot;home&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1046&quot;&quot; isDoc=&quot;&quot;&quot;&quot;/&gt;
&lt;/root&gt;&quot;;
			#endregion
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[17,3,17,34,1],[18,3,18,42,1],[21,3,21,4,1],[22,4,22,22,1],[23,3,23,4,1],[27,3,27,4,1],[28,4,28,38,1],[30,4,30,58,1],[31,13,31,78,1],[32,3,32,4,1],[36,3,36,4,1],[37,4,37,38,1],[39,4,39,58,1],[40,4,40,74,1],[41,3,41,4,1],[45,3,45,4,1],[46,4,46,38,1],[48,4,48,58,1],[49,4,49,68,1],[50,3,50,4,1],[54,3,54,4,1],[55,4,55,38,1],[57,4,57,58,1],[58,4,58,63,1],[59,3,59,4,1],[63,3,63,4,1],[64,4,64,38,1],[66,4,66,58,1],[67,4,67,80,1],[68,3,68,4,1],[71,3,71,4,1],[72,4,72,48,1],[73,4,73,27,1],[74,4,74,5,1],[75,5,75,74,1],[76,5,76,72,1],[78,8,78,119,1],[79,5,79,39,1],[80,5,80,44,1],[81,5,81,32,1],[82,4,82,5,1],[84,4,91,10,1],[93,3,93,4,1]]);
    </script>
  </body>
</html>