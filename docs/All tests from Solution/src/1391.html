<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\DataTableExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using System.Threading;
using umbraco.interfaces;

namespace Umbraco.Core
{
	

	/// &lt;summary&gt;
	/// Static and extension methods for the DataTable object
	/// &lt;/summary&gt;
	internal static class DataTableExtensions
	{
		

		/// &lt;summary&gt;
		/// Creates a DataTable with the specified alias and columns and uses a callback to populate the headers.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;tableAlias&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;getHeaders&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;rowData&quot;&gt; &lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		/// &lt;remarks&gt;
		/// This has been migrated from the Node class and uses proper locking now. It is now used by the Node class and the 
		/// DynamicPublishedContent extensions for legacy reasons.
		/// &lt;/remarks&gt;
		public static DataTable GenerateDataTable(
			string tableAlias, 						
			Func&lt;string, IEnumerable&lt;KeyValuePair&lt;string, string&gt;&gt;&gt; getHeaders,
			Func&lt;IEnumerable&lt;Tuple&lt;IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;, IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;&gt;&gt;&gt; rowData)
		{			
			var dt = new DataTable(tableAlias);
			
			//get all row data
			var tableData = rowData().ToArray();
			
			//get all headers
			var propertyHeaders = GetPropertyHeaders(tableAlias, getHeaders);
			foreach(var h in propertyHeaders)
			{
				dt.Columns.Add(new DataColumn(h.Value));
			}
						
			//add row data
			foreach(var r in tableData)
			{
				dt.PopulateRow(
					propertyHeaders,
					r.Item1,
					r.Item2);
			}

			return dt;
		}

		/// &lt;summary&gt;
		/// Helper method to return this ugly object
		/// &lt;/summary&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		/// &lt;remarks&gt;
		/// This is for legacy code, I didn&#39;t want to go creating custom classes for these
		/// &lt;/remarks&gt;
		internal static List&lt;System.Tuple&lt;IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;, IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;&gt;&gt; CreateTableData()
		{
			return new List&lt;System.Tuple&lt;IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;, IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;&gt;&gt;();
		}

		/// &lt;summary&gt;
		/// Helper method to deal with these ugly objects
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;rowData&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;standardVals&quot;&gt;&lt;/param&gt;
		/// &lt;param name=&quot;userVals&quot;&gt;&lt;/param&gt;
		/// &lt;remarks&gt;
		/// This is for legacy code, I didn&#39;t want to go creating custom classes for these
		/// &lt;/remarks&gt;
		internal static void AddRowData(
			List&lt;System.Tuple&lt;IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;, IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;&gt;&gt; rowData,
			IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt; standardVals,
			IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt; userVals)
		{
			rowData.Add(new System.Tuple&lt;IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;, IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt;&gt;(
			            	standardVals,
			            	userVals
			            	));
		}

		private static IDictionary&lt;string, string&gt; GetPropertyHeaders(string alias, Func&lt;string, IEnumerable&lt;KeyValuePair&lt;string, string&gt;&gt;&gt; getHeaders)
		{			
			var headers = getHeaders(alias);
			var def = headers.ToDictionary(pt =&gt; pt.Key, pt =&gt; pt.Value);			
			return def;
		}

		private static void PopulateRow(
			this DataTable dt, 
			IDictionary&lt;string, string&gt; aliasesToNames, 
			IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt; standardVals,
			IEnumerable&lt;KeyValuePair&lt;string, object&gt;&gt; userPropertyVals)
		{
			var dr = dt.NewRow();
			foreach (var r in standardVals)
			{
				dr[r.Key] = r.Value;
			}
			foreach (var p in userPropertyVals.Where(p =&gt; p.Value != null))
			{
				dr[aliasesToNames[p.Key]] = p.Value;
			}
			dt.Rows.Add(dr);
		}

	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[37,3,37,4,1],[38,4,38,39,1],[41,4,41,40,1],[44,4,44,69,1],[45,4,45,11,1],[45,12,45,17,1],[45,18,45,20,1],[45,21,45,36,1],[46,4,46,5,1],[47,5,47,45,1],[48,4,48,5,1],[51,4,51,11,1],[51,12,51,17,1],[51,18,51,20,1],[51,21,51,30,1],[52,4,52,5,1],[53,5,56,15,1],[57,4,57,5,1],[59,4,59,14,1],[60,3,60,4,1],[70,3,70,4,1],[71,4,71,122,1],[72,3,72,4,1],[87,3,87,4,1],[88,4,91,20,1],[92,3,92,4,1],[95,3,95,4,1],[96,4,96,36,1],[97,4,97,41,1],[97,41,97,47,1],[97,47,97,55,1],[97,55,97,63,1],[97,63,97,65,1],[97,4,97,65,1],[98,4,98,15,1],[99,3,99,4,1],[106,3,106,4,1],[107,4,107,25,1],[108,4,108,11,1],[108,13,108,18,1],[108,19,108,21,1],[108,22,108,34,1],[109,4,109,5,1],[110,5,110,25,1],[111,4,111,5,1],[112,4,112,11,1],[112,13,112,18,1],[112,19,112,21,1],[112,22,112,50,1],[112,50,112,65,1],[112,65,112,66,1],[112,22,112,66,1],[113,4,113,5,1],[114,5,114,41,1],[115,4,115,5,1],[116,4,116,20,1],[117,3,117,4,1]]);
    </script>
  </body>
</html>