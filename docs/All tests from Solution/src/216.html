<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Models\TemplateTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Diagnostics;
using System.Linq;
using System.Reflection;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Core.Serialization;
using Umbraco.Tests.TestHelpers;

namespace Umbraco.Tests.Models
{
    [TestFixture]
    public class TemplateTests : BaseUmbracoConfigurationTest
    {
        [Test]
        public void Can_Deep_Clone()
        {
            var item = new Template(&quot;Test&quot;, &quot;test&quot;)
            {
                Id = 3,
                CreateDate = DateTime.Now,                
                Key = Guid.NewGuid(),
                UpdateDate = DateTime.Now,
                Content = &quot;blah&quot;,
                Path = &quot;-1,3&quot;,
                IsMasterTemplate = true,                
                MasterTemplateAlias = &quot;master&quot;,
                MasterTemplateId = new Lazy&lt;int&gt;(() =&gt; 88)                
            };

            var clone = (Template)item.DeepClone();

            Assert.AreNotSame(clone, item);
            Assert.AreEqual(clone, item);
            Assert.AreEqual(clone.Path, item.Path);
            Assert.AreEqual(clone.IsMasterTemplate, item.IsMasterTemplate);
            Assert.AreEqual(clone.CreateDate, item.CreateDate);
            Assert.AreEqual(clone.Alias, item.Alias);
            Assert.AreEqual(clone.Id, item.Id);
            Assert.AreEqual(clone.Key, item.Key);
            Assert.AreEqual(clone.MasterTemplateAlias, item.MasterTemplateAlias);
            Assert.AreEqual(clone.MasterTemplateId.Value, item.MasterTemplateId.Value);
            Assert.AreEqual(clone.Name, item.Name);
            Assert.AreEqual(clone.UpdateDate, item.UpdateDate);

            // clone.Content should be null but getting it would lazy-load
            var type = clone.GetType();
            var contentField = type.BaseType.GetField(&quot;_content&quot;, BindingFlags.Instance | BindingFlags.NonPublic);
            var value = contentField.GetValue(clone);
            Assert.IsNull(value);

            // this double verifies by reflection
            // need to exclude content else it would lazy-load
            var allProps = clone.GetType().GetProperties();
            foreach (var propertyInfo in allProps.Where(x =&gt; x.Name != &quot;Content&quot;))
            {
                Assert.AreEqual(propertyInfo.GetValue(clone, null), propertyInfo.GetValue(item, null));
            }
        }

        [Test]
        public void Can_Serialize_Without_Error()
        {
            var ss = new SerializationService(new JsonNetSerializer());

            var item = new Template(&quot;Test&quot;, &quot;test&quot;)
            {
                Id = 3,
                CreateDate = DateTime.Now,
                Key = Guid.NewGuid(),
                UpdateDate = DateTime.Now,
                Content = &quot;blah&quot;,
                MasterTemplateAlias = &quot;master&quot;,
                MasterTemplateId = new Lazy&lt;int&gt;(() =&gt; 88)
            };

            var result = ss.ToStream(item);
            var json = result.ResultStream.ToJsonString();
            Debug.Print(json);
        }

    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[18,13,28,56,1],[28,56,28,58,1],[28,58,29,15,1],[18,13,29,15,1],[31,13,31,52,1],[33,13,33,44,1],[34,13,34,42,1],[35,13,35,52,1],[36,13,36,76,1],[37,13,37,64,1],[38,13,38,54,1],[39,13,39,48,1],[40,13,40,50,1],[41,13,41,82,1],[42,13,42,88,1],[43,13,43,52,1],[44,13,44,64,1],[47,13,47,40,1],[48,13,48,115,1],[49,13,49,54,1],[50,13,50,34,1],[54,13,54,60,1],[55,13,55,20,1],[55,22,55,38,1],[55,39,55,41,1],[55,42,55,62,1],[55,62,55,81,1],[55,81,55,82,1],[55,42,55,82,1],[56,13,56,14,1],[57,17,57,104,1],[58,13,58,14,1],[59,9,59,10,1],[63,9,63,10,1],[64,13,64,72,1],[66,13,74,56,1],[74,56,74,58,1],[74,58,75,15,1],[66,13,75,15,1],[77,13,77,44,1],[78,13,78,59,1],[79,13,79,31,1],[80,9,80,10,1]]);
    </script>
  </body>
</html>