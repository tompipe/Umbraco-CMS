<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Migrations\Upgrades\TargetVersionSixTwoZero\AddChangeDocumentTypePermission.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Linq;
using Umbraco.Core.Configuration;
using Umbraco.Core.Logging;
using Umbraco.Core.Models.Rdbms;
using Umbraco.Core.Persistence.SqlSyntax;

namespace Umbraco.Core.Persistence.Migrations.Upgrades.TargetVersionSixTwoZero
{
    [Migration(&quot;7.1.0&quot;, 3, GlobalSettings.UmbracoMigrationName)]
    [Migration(&quot;6.2.0&quot;, 3, GlobalSettings.UmbracoMigrationName)]
    public class AddChangeDocumentTypePermission : MigrationBase
    {
        public AddChangeDocumentTypePermission(ISqlSyntaxProvider sqlSyntax, ILogger logger) : base(sqlSyntax, logger)
        {
        }

        public override void Up()
        {
            Execute.Code(AddChangeDocumentTypePermissionDo);
        }

        public override void Down()
        {
            Execute.Code(UndoChangeDocumentTypePermissionDo);
        }

        private static string AddChangeDocumentTypePermissionDo(Database database)
        {
            var adminUserType = database.Fetch&lt;UserTypeDto&gt;(&quot;WHERE Id = 1&quot;).FirstOrDefault();
            
            if (adminUserType != null)
            {
                if (adminUserType.DefaultPermissions.Contains(&quot;7&quot;) == false)
                {
                    adminUserType.DefaultPermissions = adminUserType.DefaultPermissions + &quot;7&quot;;
                    database.Save(adminUserType);
                }
            }

            return string.Empty;
        }

        private static string UndoChangeDocumentTypePermissionDo(Database database)
        {
            var adminUserType = database.Fetch&lt;UserTypeDto&gt;(&quot;WHERE Id = 1&quot;).FirstOrDefault();
            
            if (adminUserType != null)
            {
                if (adminUserType.DefaultPermissions.Contains(&quot;7&quot;))
                {
                    adminUserType.DefaultPermissions = adminUserType.DefaultPermissions.Replace(&quot;7&quot;, &quot;&quot;);
                    database.Save(adminUserType);
                }
            }

            return string.Empty;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,96,13,119,0],[14,9,14,10,0],[15,9,15,10,0],[18,9,18,10,0],[19,13,19,61,0],[20,9,20,10,0],[23,9,23,10,0],[24,13,24,62,0],[25,9,25,10,0],[28,9,28,10,0],[29,13,29,94,0],[31,13,31,39,0],[32,13,32,14,0],[33,17,33,77,0],[34,17,34,18,0],[35,21,35,95,0],[36,21,36,50,0],[37,17,37,18,0],[38,13,38,14,0],[40,13,40,33,0],[41,9,41,10,0],[44,9,44,10,0],[45,13,45,94,0],[47,13,47,39,0],[48,13,48,14,0],[49,17,49,68,0],[50,17,50,18,0],[51,21,51,106,0],[52,21,52,50,0],[53,17,53,18,0],[54,13,54,14,0],[56,13,56,33,0],[57,9,57,10,0]]);
    </script>
  </body>
</html>