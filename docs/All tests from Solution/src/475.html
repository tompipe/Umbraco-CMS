<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Trees\loadTranslationTasks.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Text;
using System.Web;
using System.Xml;
using System.Configuration;
using umbraco.BasePages;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.cache;
using umbraco.cms.businesslogic.contentitem;
using umbraco.cms.businesslogic.datatype;
using umbraco.cms.businesslogic.language;
using umbraco.cms.businesslogic.media;
using umbraco.cms.businesslogic.member;
using umbraco.cms.businesslogic.property;
using umbraco.cms.businesslogic.translation;
using umbraco.cms.businesslogic.task;

using umbraco.interfaces;
using umbraco.DataLayer;
using umbraco.BusinessLogic.Actions;
using umbraco.BusinessLogic.Utils;
using umbraco.cms.presentation.Trees;

namespace umbraco {
    public class loadOpenTasks : BaseTree {

        public loadOpenTasks(string application) : base(application) { }

        protected override void CreateRootNode(ref XmlTreeNode rootNode) {
            rootNode.Action = &quot;javascript:openTranslationOverview(&quot; + currentUser().Id + &quot;,&#39;open&#39;);&quot;;
            rootNode.Text = ui.Text(&quot;translation&quot;, &quot;assignedTasks&quot;);
        }

        protected override void CreateRootNodeActions(ref List&lt;IAction&gt; actions) {
            actions.Clear();
            actions.Add(ActionRefresh.Instance);
        }

        public override void RenderJS(ref StringBuilder Javascript) {
           Javascript.Append(@&quot;
                    function openTranslationTask(id) {
	                    UmbClientMgr.contentFrame(&#39;translation/details.aspx?id=&#39; + id);
                    }
                    function openTranslationOverview(id, mode) {
	                    UmbClientMgr.contentFrame(&#39;translation/default.aspx?id=&#39; + id + &#39;&amp;mode=&#39; + mode);
                    }
                    &quot;);     
        }

        private User currentUser() {
            return User.GetCurrent();
        }
        public override void Render(ref XmlTree tree) {
            foreach (Task t in Task.GetTasks(currentUser(), false)) {
                
                if (t.Type.Alias == &quot;toTranslate&quot;) {
                    XmlTreeNode xNode = XmlTreeNode.Create(this);
                    xNode.Menu.Clear();

                    xNode.NodeID = t.Id.ToString();
                    xNode.Text = t.Node.Text;
                    xNode.Action = &quot;javascript:openTranslationTask(&quot; + t.Id.ToString() + &quot;)&quot;;
                    xNode.Icon = &quot;.sprTreeSettingLanguage&quot;;
                    xNode.OpenIcon = &quot;.sprTreeSettingLanguage&quot;;

                    OnBeforeNodeRender(ref tree, ref xNode, EventArgs.Empty);
                    if (xNode != null)
                    {
                        tree.Add(xNode);
                        OnAfterNodeRender(ref tree, ref xNode, EventArgs.Empty);
                    }
                    
                }

            }
        }        
    }

    public class loadYourTasks : BaseTree {

        public loadYourTasks(string application) : base(application) { }

        protected override void CreateRootNode(ref XmlTreeNode rootNode) {
            rootNode.Action = &quot;javascript:openTranslationOverview(&quot; + currentUser().Id + &quot;, &#39;owned&#39;);&quot;;
            rootNode.Text = ui.Text(&quot;translation&quot;, &quot;ownedTasks&quot;);
        }

        protected override void CreateRootNodeActions(ref List&lt;IAction&gt; actions) {
            actions.Clear();
            actions.Add(ActionRefresh.Instance);
        }

        public override void RenderJS(ref StringBuilder Javascript) {
            Javascript.Append(@&quot;
                    function openTranslationTask(id) {
	                    UmbClientMgr.contentFrame(&#39;translation/details.aspx?id=&#39; + id);
                    }&quot;);
        }

        private User currentUser()
        {
            return User.GetCurrent();
        }

        public override void Render(ref XmlTree tree) {
            foreach (Task t in Task.GetOwnedTasks(currentUser(), false)) {

                if (t.Type.Alias == &quot;toTranslate&quot;) {
                    XmlTreeNode xNode = XmlTreeNode.Create(this);
                    xNode.Menu.Clear();
                    xNode.NodeID = t.Id.ToString();
                    xNode.Text = t.Node.Text;
                    xNode.Action = &quot;javascript:openTranslationTask(&quot; + t.Id.ToString() + &quot;)&quot;;
                    xNode.Icon = &quot;.sprTreeSettingLanguage&quot;;
                    xNode.OpenIcon = &quot;.sprTreeSettingLanguage&quot;;

                    OnBeforeNodeRender(ref tree, ref xNode, EventArgs.Empty);
                    if (xNode != null)
                    {
                        tree.Add(xNode);
                        OnAfterNodeRender(ref tree, ref xNode, EventArgs.Empty);
                    }
                    
                }

            }
        }
    }
    

}

    </pre>
    <script type="text/javascript">
      highlightRanges([[32,52,32,69,0],[32,70,32,71,0],[32,72,32,73,0],[34,74,34,75,0],[35,13,35,102,0],[36,13,36,69,0],[37,9,37,10,0],[39,82,39,83,0],[40,13,40,29,0],[41,13,41,49,0],[42,9,42,10,0],[44,69,44,70,0],[45,12,52,24,0],[53,9,53,10,0],[55,36,55,37,0],[56,13,56,38,0],[57,9,57,10,0],[58,55,58,56,0],[59,13,59,20,0],[59,22,59,28,0],[59,29,59,31,0],[59,32,59,67,0],[59,69,59,70,0],[61,17,61,51,0],[61,52,61,53,0],[62,21,62,66,0],[63,21,63,40,0],[65,21,65,52,0],[66,21,66,46,0],[67,21,67,94,0],[68,21,68,60,0],[69,21,69,64,0],[71,21,71,78,0],[72,21,72,39,0],[73,21,73,22,0],[74,25,74,41,0],[75,25,75,81,0],[76,21,76,22,0],[78,17,78,18,0],[80,13,80,14,0],[81,9,81,10,0],[86,52,86,69,0],[86,70,86,71,0],[86,72,86,73,0],[88,74,88,75,0],[89,13,89,104,0],[90,13,90,66,0],[91,9,91,10,0],[93,82,93,83,0],[94,13,94,29,0],[95,13,95,49,0],[96,9,96,10,0],[98,69,98,70,0],[99,13,102,25,0],[103,9,103,10,0],[106,9,106,10,0],[107,13,107,38,0],[108,9,108,10,0],[110,55,110,56,0],[111,13,111,20,0],[111,22,111,28,0],[111,29,111,31,0],[111,32,111,72,0],[111,74,111,75,0],[113,17,113,51,0],[113,52,113,53,0],[114,21,114,66,0],[115,21,115,40,0],[116,21,116,52,0],[117,21,117,46,0],[118,21,118,94,0],[119,21,119,60,0],[120,21,120,64,0],[122,21,122,78,0],[123,21,123,39,0],[124,21,124,22,0],[125,25,125,41,0],[126,25,126,81,0],[127,21,127,22,0],[129,17,129,18,0],[131,13,131,14,0],[132,9,132,10,0]]);
    </script>
  </body>
</html>