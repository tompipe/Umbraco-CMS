<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Routing\ContentFinderByNiceUrlWithDomainsTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web.Routing;

namespace Umbraco.Tests.Routing
{

	[TestFixture]
    public class ContentFinderByNiceUrlWithDomainsTests : UrlRoutingTestBase
	{
		void SetDomains3()
		{
		    SetupDomainServiceMock(new[]
		    {
		        new UmbracoDomain(&quot;domain1.com/&quot;) {Id = 1, LanguageId = LangDeId, RootContentId = 1001, LanguageIsoCode = &quot;de-DE&quot;}
		    });

		}

		void SetDomains4()
		{
		    SetupDomainServiceMock(new[]
		    {
		        new UmbracoDomain(&quot;domain1.com/&quot;) {Id = 1, LanguageId = LangEngId, RootContentId = 1001, LanguageIsoCode = &quot;en-US&quot;},
		        new UmbracoDomain(&quot;domain1.com/en&quot;) {Id = 1, LanguageId = LangEngId, RootContentId = 10011, LanguageIsoCode = &quot;en-US&quot;},
		        new UmbracoDomain(&quot;domain1.com/fr&quot;) {Id = 1, LanguageId = LangFrId, RootContentId =  10012, LanguageIsoCode = &quot;fr-FR&quot;},
		        new UmbracoDomain(&quot;http://domain3.com/&quot;) {Id = 1, LanguageId = LangEngId, RootContentId = 1003, LanguageIsoCode = &quot;en-US&quot;},
		        new UmbracoDomain(&quot;http://domain3.com/en&quot;) {Id = 1, LanguageId = LangEngId, RootContentId = 10031, LanguageIsoCode = &quot;en-US&quot;},
		        new UmbracoDomain(&quot;http://domain3.com/fr&quot;) {Id = 1, LanguageId = LangFrId, RootContentId = 10032, LanguageIsoCode = &quot;fr-FR&quot;}
		    });

		}

		protected override string GetXmlContent(int templateId)
		{
			return @&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;utf-8&quot;&quot;?&gt;
&lt;!DOCTYPE root[ 
&lt;!ELEMENT Doc ANY&gt;
&lt;!ATTLIST Doc id ID #REQUIRED&gt;
]&gt;
&lt;root id=&quot;&quot;-1&quot;&quot;&gt;
	&lt;Doc id=&quot;&quot;1001&quot;&quot; parentID=&quot;&quot;-1&quot;&quot; level=&quot;&quot;1&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-06-12T14:13:17&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:50:43&quot;&quot; nodeName=&quot;&quot;Home&quot;&quot; urlName=&quot;&quot;1001&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
		&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
		&lt;Doc id=&quot;&quot;10011&quot;&quot; parentID=&quot;&quot;1001&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-07-20T18:06:45&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:07:31&quot;&quot; nodeName=&quot;&quot;Sub1&quot;&quot; urlName=&quot;&quot;1001-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10011&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;content&gt;&lt;![CDATA[&lt;div&gt;This is some content&lt;/div&gt;]]&gt;&lt;/content&gt;
			&lt;Doc id=&quot;&quot;100111&quot;&quot; parentID=&quot;&quot;10011&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-07-20T18:07:54&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:27&quot;&quot; nodeName=&quot;&quot;Sub2&quot;&quot; urlName=&quot;&quot;1001-1-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10011,100111&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
			&lt;/Doc&gt;
			&lt;Doc id=&quot;&quot;100112&quot;&quot; parentID=&quot;&quot;10011&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1001-1-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10011,100112&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;Doc id=&quot;&quot;1001121&quot;&quot; parentID=&quot;&quot;100112&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1001-1-2-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10011,100112,1001121&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
				&lt;Doc id=&quot;&quot;1001122&quot;&quot; parentID=&quot;&quot;100112&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1001-1-2-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10011,100112,1001122&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
			&lt;/Doc&gt;
		&lt;/Doc&gt;
		&lt;Doc id=&quot;&quot;10012&quot;&quot; parentID=&quot;&quot;1001&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:01&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:49:32&quot;&quot; nodeName=&quot;&quot;Sub 2&quot;&quot; urlName=&quot;&quot;1001-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10012&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;content&gt;&lt;![CDATA[&lt;div&gt;This is some content&lt;/div&gt;]]&gt;&lt;/content&gt;
			&lt;Doc id=&quot;&quot;100121&quot;&quot; parentID=&quot;&quot;10012&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-07-20T18:07:54&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:27&quot;&quot; nodeName=&quot;&quot;Sub2&quot;&quot; urlName=&quot;&quot;1001-2-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10012,100121&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
			&lt;/Doc&gt;
			&lt;Doc id=&quot;&quot;100122&quot;&quot; parentID=&quot;&quot;10012&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1001-2-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10012,100122&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;Doc id=&quot;&quot;1001221&quot;&quot; parentID=&quot;&quot;100122&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1001-2-2-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10012,100122,1001221&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
				&lt;Doc id=&quot;&quot;1001222&quot;&quot; parentID=&quot;&quot;100122&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1001-2-2-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10012,100122,1001222&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
			&lt;/Doc&gt;
		&lt;/Doc&gt;
		&lt;Doc id=&quot;&quot;10013&quot;&quot; parentID=&quot;&quot;1001&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:01&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:49:32&quot;&quot; nodeName=&quot;&quot;Sub 2&quot;&quot; urlName=&quot;&quot;1001-3&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1001,10013&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
		&lt;/Doc&gt;
	&lt;/Doc&gt;
	&lt;Doc id=&quot;&quot;1002&quot;&quot; parentID=&quot;&quot;-1&quot;&quot; level=&quot;&quot;1&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1234&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-16T15:26:59&quot;&quot; updateDate=&quot;&quot;2012-07-18T14:23:35&quot;&quot; nodeName=&quot;&quot;Test&quot;&quot; urlName=&quot;&quot;1002&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1002&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
	&lt;/Doc&gt;
	&lt;Doc id=&quot;&quot;1003&quot;&quot; parentID=&quot;&quot;-1&quot;&quot; level=&quot;&quot;1&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-06-12T14:13:17&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:50:43&quot;&quot; nodeName=&quot;&quot;Home&quot;&quot; urlName=&quot;&quot;1003&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
		&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
		&lt;Doc id=&quot;&quot;10031&quot;&quot; parentID=&quot;&quot;1003&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-07-20T18:06:45&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:07:31&quot;&quot; nodeName=&quot;&quot;Sub1&quot;&quot; urlName=&quot;&quot;1003-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10031&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;content&gt;&lt;![CDATA[&lt;div&gt;This is some content&lt;/div&gt;]]&gt;&lt;/content&gt;
			&lt;Doc id=&quot;&quot;100311&quot;&quot; parentID=&quot;&quot;10031&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-07-20T18:07:54&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:27&quot;&quot; nodeName=&quot;&quot;Sub2&quot;&quot; urlName=&quot;&quot;1003-1-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10031,100311&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
			&lt;/Doc&gt;
			&lt;Doc id=&quot;&quot;100312&quot;&quot; parentID=&quot;&quot;10031&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1003-1-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10031,100312&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;Doc id=&quot;&quot;1003121&quot;&quot; parentID=&quot;&quot;100312&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1003-1-2-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10031,100312,1003121&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
				&lt;Doc id=&quot;&quot;1003122&quot;&quot; parentID=&quot;&quot;100312&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1003-1-2-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10031,100312,1003122&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
			&lt;/Doc&gt;
		&lt;/Doc&gt;
		&lt;Doc id=&quot;&quot;10032&quot;&quot; parentID=&quot;&quot;1003&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:01&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:49:32&quot;&quot; nodeName=&quot;&quot;Sub 2&quot;&quot; urlName=&quot;&quot;1003-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10032&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
			&lt;content&gt;&lt;![CDATA[&lt;div&gt;This is some content&lt;/div&gt;]]&gt;&lt;/content&gt;
			&lt;Doc id=&quot;&quot;100321&quot;&quot; parentID=&quot;&quot;10032&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-07-20T18:07:54&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:27&quot;&quot; nodeName=&quot;&quot;Sub2&quot;&quot; urlName=&quot;&quot;1003-2-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10032,100321&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
			&lt;/Doc&gt;
			&lt;Doc id=&quot;&quot;100322&quot;&quot; parentID=&quot;&quot;10032&quot;&quot; level=&quot;&quot;3&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1003-2-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10032,100322&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
				&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;Doc id=&quot;&quot;1003221&quot;&quot; parentID=&quot;&quot;100322&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;0&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1003-2-2-1&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10032,100322,1003221&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
				&lt;Doc id=&quot;&quot;1003222&quot;&quot; parentID=&quot;&quot;100322&quot;&quot; level=&quot;&quot;4&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;1&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:08&quot;&quot; updateDate=&quot;&quot;2012-07-20T19:10:52&quot;&quot; nodeName=&quot;&quot;Sub 3&quot;&quot; urlName=&quot;&quot;1003-2-2-2&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10032,100322,1003222&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
					&lt;content&gt;&lt;![CDATA[]]&gt;&lt;/content&gt;
				&lt;/Doc&gt;
			&lt;/Doc&gt;
		&lt;/Doc&gt;
		&lt;Doc id=&quot;&quot;10033&quot;&quot; parentID=&quot;&quot;1003&quot;&quot; level=&quot;&quot;2&quot;&quot; writerID=&quot;&quot;0&quot;&quot; creatorID=&quot;&quot;0&quot;&quot; nodeType=&quot;&quot;1044&quot;&quot; template=&quot;&quot;&quot; + templateId + @&quot;&quot;&quot; sortOrder=&quot;&quot;2&quot;&quot; createDate=&quot;&quot;2012-07-20T18:08:01&quot;&quot; updateDate=&quot;&quot;2012-07-20T18:49:32&quot;&quot; nodeName=&quot;&quot;Sub 2&quot;&quot; urlName=&quot;&quot;1003-3&quot;&quot; writerName=&quot;&quot;admin&quot;&quot; creatorName=&quot;&quot;admin&quot;&quot; path=&quot;&quot;-1,1003,10033&quot;&quot; isDoc=&quot;&quot;&quot;&quot;&gt;
		&lt;/Doc&gt;
	&lt;/Doc&gt;
&lt;/root&gt;&quot;;
		}

		[TestCase(&quot;http://domain1.com/&quot;, 1001)]
		[TestCase(&quot;http://domain1.com/1001-1&quot;, 10011)]
		[TestCase(&quot;http://domain1.com/1001-2/1001-2-1&quot;, 100121)]

		public void Lookup_SingleDomain(string url, int expectedId)
		{
			SetDomains3();

		    SettingsForTests.HideTopLevelNodeFromPath = true;

			var routingContext = GetRoutingContext(url);
			var uri = routingContext.UmbracoContext.CleanedUmbracoUrl; //very important to use the cleaned up umbraco url
			var pcr = new PublishedContentRequest(uri, routingContext);

			// must lookup domain else lookup by url fails
			pcr.Engine.FindDomain();

			var lookup = new ContentFinderByNiceUrl();
			var result = lookup.TryFindContent(pcr);
			Assert.IsTrue(result);
			Assert.AreEqual(expectedId, pcr.PublishedContent.Id);
		}

		[TestCase(&quot;http://domain1.com/&quot;, 1001, &quot;en-US&quot;)]
		[TestCase(&quot;http://domain1.com/en&quot;, 10011, &quot;en-US&quot;)]
		[TestCase(&quot;http://domain1.com/en/1001-1-1&quot;, 100111, &quot;en-US&quot;)]
		[TestCase(&quot;http://domain1.com/fr&quot;, 10012, &quot;fr-FR&quot;)]
		[TestCase(&quot;http://domain1.com/fr/1001-2-1&quot;, 100121, &quot;fr-FR&quot;)]
		[TestCase(&quot;http://domain1.com/1001-3&quot;, 10013, &quot;en-US&quot;)]

		[TestCase(&quot;http://domain2.com/1002&quot;, 1002, null)]

		[TestCase(&quot;http://domain3.com/&quot;, 1003, &quot;en-US&quot;)]
		[TestCase(&quot;http://domain3.com/en&quot;, 10031, &quot;en-US&quot;)]
		[TestCase(&quot;http://domain3.com/en/1003-1-1&quot;, 100311, &quot;en-US&quot;)]
		[TestCase(&quot;http://domain3.com/fr&quot;, 10032, &quot;fr-FR&quot;)]
		[TestCase(&quot;http://domain3.com/fr/1003-2-1&quot;, 100321, &quot;fr-FR&quot;)]
		[TestCase(&quot;http://domain3.com/1003-3&quot;, 10033, &quot;en-US&quot;)]

		[TestCase(&quot;https://domain1.com/&quot;, 1001, &quot;en-US&quot;)]
		[TestCase(&quot;https://domain3.com/&quot;, 1001, null)] // because domain3 is explicitely set on http

		public void Lookup_NestedDomains(string url, int expectedId, string expectedCulture)
		{
			SetDomains4();

            // defaults depend on test environment
            expectedCulture = expectedCulture ?? System.Threading.Thread.CurrentThread.CurrentUICulture.Name;

            SettingsForTests.HideTopLevelNodeFromPath = true;

			var routingContext = GetRoutingContext(url);
			var uri = routingContext.UmbracoContext.CleanedUmbracoUrl; //very important to use the cleaned up umbraco url
			var pcr = new PublishedContentRequest(uri, routingContext);

			// must lookup domain else lookup by url fails
			pcr.Engine.FindDomain();
			Assert.AreEqual(expectedCulture, pcr.Culture.Name);

			var lookup = new ContentFinderByNiceUrl();
			var result = lookup.TryFindContent(pcr);
			Assert.IsTrue(result);
			Assert.AreEqual(expectedId, pcr.PublishedContent.Id);
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,3,13,4,1],[14,7,17,10,1],[19,3,19,4,1],[22,3,22,4,1],[23,7,31,10,1],[33,3,33,4,1],[36,3,36,4,1],[37,4,115,10,1],[116,3,116,4,1],[123,3,123,4,1],[124,4,124,18,1],[126,7,126,56,1],[128,4,128,48,1],[129,4,129,62,1],[130,4,130,63,1],[133,4,133,28,1],[135,4,135,46,1],[136,4,136,44,1],[137,4,137,26,1],[138,4,138,57,1],[139,3,139,4,1],[161,3,161,4,1],[162,4,162,18,1],[165,13,165,110,1],[167,13,167,62,1],[169,4,169,48,1],[170,4,170,62,1],[171,4,171,63,1],[174,4,174,28,1],[175,4,175,55,1],[177,4,177,46,1],[178,4,178,44,1],[179,4,179,26,1],[180,4,180,57,1],[181,3,181,4,1]]);
    </script>
  </body>
</html>