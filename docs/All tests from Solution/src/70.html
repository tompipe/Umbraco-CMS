<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\DynamicsAndReflection\QueryableExtensionTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using NUnit.Framework;
using Umbraco.Core.Dynamics;
using Umbraco.Web.Dynamics;

namespace Umbraco.Tests.DynamicsAndReflection
{
    //NOTE: there&#39;s libraries in both Umbraco.Core.Dynamics and Umbraco.Web.Dynamics - the reason for this is that the Web.Dynamics
    // started with the razor macro implementation and is modified with hard coded references to dynamic node and dynamic null, though it seems
    // to still work for other regular classes I don&#39;t want to move it to the core without removing these references but that would require a lot of work.

    [TestFixture]
    public class QueryableExtensionTests
    {

        [Test]
        public void Order_By_Test_Int()
        {
            var items = new List&lt;TestModel&gt;
                {
                    new TestModel {Age = 10, Name = &quot;test1&quot;, Female = false},
                    new TestModel {Age = 31, Name = &quot;someguy&quot;, Female = true},
                    new TestModel {Age = 11, Name = &quot;test2&quot;, Female = true},                    
                    new TestModel {Age = 20, Name = &quot;anothertest&quot;, Female = false},                    
                    new TestModel {Age = 55, Name = &quot;blah&quot;, Female = false},
                    new TestModel {Age = 12, Name = &quot;test3&quot;, Female = false}
                };

            var result = items.AsQueryable().OrderBy(&quot;Age&quot;).ToArray();

            Assert.AreEqual(10, result.ElementAt(0).Age);
            Assert.AreEqual(11, result.ElementAt(1).Age);
            Assert.AreEqual(12, result.ElementAt(2).Age);
            Assert.AreEqual(20, result.ElementAt(3).Age);
            Assert.AreEqual(31, result.ElementAt(4).Age);
            Assert.AreEqual(55, result.ElementAt(5).Age);

        }

        [Test]
        public void Order_By_Test_String()
        {
            var items = new List&lt;TestModel&gt;
                {
                    new TestModel {Age = 10, Name = &quot;test1&quot;, Female = false},
                    new TestModel {Age = 31, Name = &quot;someguy&quot;, Female = true},
                    new TestModel {Age = 11, Name = &quot;test2&quot;, Female = true},                    
                    new TestModel {Age = 20, Name = &quot;anothertest&quot;, Female = false},                    
                    new TestModel {Age = 55, Name = &quot;blah&quot;, Female = false},
                    new TestModel {Age = 12, Name = &quot;test3&quot;, Female = false}
                };

            var result = items.AsQueryable().OrderBy(&quot;Name&quot;).ToArray();

            Assert.AreEqual(&quot;anothertest&quot;, result.ElementAt(0).Name);
            Assert.AreEqual(&quot;blah&quot;, result.ElementAt(1).Name);
            Assert.AreEqual(&quot;someguy&quot;, result.ElementAt(2).Name);
            Assert.AreEqual(&quot;test1&quot;, result.ElementAt(3).Name);
            Assert.AreEqual(&quot;test2&quot;, result.ElementAt(4).Name);
            Assert.AreEqual(&quot;test3&quot;, result.ElementAt(5).Name);

        }

        [Test]
        public void Where_Test_String()
        {
            var items = new List&lt;TestModel&gt;
                {
                    new TestModel {Age = 10, Name = &quot;test1&quot;, Female = false},
                    new TestModel {Age = 31, Name = &quot;someguy&quot;, Female = true},
                    new TestModel {Age = 11, Name = &quot;test2&quot;, Female = true},                    
                    new TestModel {Age = 20, Name = &quot;anothertest&quot;, Female = false},                    
                    new TestModel {Age = 55, Name = &quot;blah&quot;, Female = false},
                    new TestModel {Age = 12, Name = &quot;test3&quot;, Female = false}
                };

            var result = items.AsQueryable().Where(&quot;Name = \&quot;test1\&quot;&quot;).ToArray();

            Assert.AreEqual(1, result.Count());
            Assert.AreEqual(&quot;test1&quot;, result.ElementAt(0).Name);
            

        }

        [Test]
        public void Where_Test_String_With_Params()
        {
            var items = new List&lt;TestModel&gt;
                {
                    new TestModel {Age = 10, Name = &quot;test1&quot;, Female = false},
                    new TestModel {Age = 31, Name = &quot;someguy&quot;, Female = true},
                    new TestModel {Age = 11, Name = &quot;test2&quot;, Female = true},                    
                    new TestModel {Age = 20, Name = &quot;anothertest&quot;, Female = false},                    
                    new TestModel {Age = 55, Name = &quot;blah&quot;, Female = false},
                    new TestModel {Age = 12, Name = &quot;test3&quot;, Female = false}
                };

            //NOTE: Currently the object query structure is not supported
            //var result = items.AsQueryable().Where(&quot;Name = @name&quot;, new {name = &quot;test1&quot;}).ToArray();
            var result = items.AsQueryable().Where(&quot;Name = @Name&quot;, new Dictionary&lt;string, object&gt; { { &quot;Name&quot;, &quot;test1&quot; } }).ToArray();

            Assert.AreEqual(1, result.Count());
            Assert.AreEqual(&quot;test1&quot;, result.ElementAt(0).Name);


        }

        [Test]
        public void Where_Test_Int_With_Params()
        {
            var items = new List&lt;TestModel&gt;
                {
                    new TestModel {Age = 10, Name = &quot;test1&quot;, Female = false},
                    new TestModel {Age = 31, Name = &quot;someguy&quot;, Female = true},
                    new TestModel {Age = 11, Name = &quot;test2&quot;, Female = true},                    
                    new TestModel {Age = 20, Name = &quot;anothertest&quot;, Female = false},                    
                    new TestModel {Age = 55, Name = &quot;blah&quot;, Female = false},
                    new TestModel {Age = 12, Name = &quot;test3&quot;, Female = false}
                };

            var result = items.AsQueryable().Where(&quot;Age = @Age&quot;, new Dictionary&lt;string, object&gt; { { &quot;Age&quot;, 10 } }).ToArray();

            Assert.AreEqual(1, result.Count());
            Assert.AreEqual(&quot;test1&quot;, result.ElementAt(0).Name);


        }

        [Test]
        public void Where_Test_Bool_With_Params()
        {
            var items = new List&lt;TestModel&gt;
                {
                    new TestModel {Age = 10, Name = &quot;test1&quot;, Female = false},
                    new TestModel {Age = 31, Name = &quot;someguy&quot;, Female = true},
                    new TestModel {Age = 11, Name = &quot;test2&quot;, Female = true},                    
                    new TestModel {Age = 20, Name = &quot;anothertest&quot;, Female = false},                    
                    new TestModel {Age = 55, Name = &quot;blah&quot;, Female = false},
                    new TestModel {Age = 12, Name = &quot;test3&quot;, Female = false}
                };

            var result = items.AsQueryable().Where(&quot;Female = @Female&quot;, new Dictionary&lt;string, object&gt; { { &quot;Female&quot;, true } }).ToArray();

            Assert.AreEqual(2, result.Count());


        }

        private class TestModel
        {
            public string Name { get; set; }
            public int Age { get; set; }
            public bool Female { get; set; }
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,10,1],[20,13,28,19,1],[30,13,30,71,1],[32,13,32,58,1],[33,13,33,58,1],[34,13,34,58,1],[35,13,35,58,1],[36,13,36,58,1],[37,13,37,58,1],[39,9,39,10,1],[43,9,43,10,1],[44,13,52,19,1],[54,13,54,72,1],[56,13,56,70,1],[57,13,57,63,1],[58,13,58,66,1],[59,13,59,64,1],[60,13,60,64,1],[61,13,61,64,1],[63,9,63,10,1],[67,9,67,10,1],[68,13,76,19,1],[78,13,78,82,1],[80,13,80,48,1],[81,13,81,64,1],[84,9,84,10,1],[88,9,88,10,1],[89,13,97,19,1],[101,13,101,134,1],[103,13,103,48,1],[104,13,104,64,1],[107,9,107,10,1],[111,9,111,10,1],[112,13,120,19,1],[122,13,122,126,1],[124,13,124,48,1],[125,13,125,64,1],[128,9,128,10,1],[132,9,132,10,1],[133,13,141,19,1],[143,13,143,137,1],[145,13,145,48,1],[148,9,148,10,1],[152,34,152,38,1],[152,39,152,43,1],[153,30,153,34,1],[153,35,153,39,1],[154,34,154,38,1],[154,39,154,43,1]]);
    </script>
  </body>
</html>