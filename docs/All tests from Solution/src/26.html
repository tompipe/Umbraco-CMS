<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\TreesAndSections\BaseContentTreeTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using NUnit.Framework;
using umbraco.cms.presentation.Trees;

namespace Umbraco.Tests.TreesAndSections
{
    [TestFixture]
    public class BaseContentTreeTests 
    {
        
        [TearDown]
        public void TestTearDown()
        {
            BaseTree.AfterTreeRender -= EventHandler;
            BaseTree.BeforeTreeRender -= EventHandler;
        }

        [Test]
        public void Run_Optimized()
        {
            var tree1 = new MyOptimizedContentTree1(&quot;content&quot;);
            var tree2 = new MyOptimizedContentTree2(&quot;content&quot;);

            Assert.IsTrue(tree1.UseOptimizedRendering);
            Assert.IsTrue(tree2.UseOptimizedRendering);
        }

        [Test]
        public void Not_Optimized_Events_AfterRender()
        {
            var tree = new MyOptimizedContentTree1(&quot;content&quot;);

            BaseTree.AfterTreeRender += EventHandler;

            Assert.IsFalse(tree.UseOptimizedRendering);
        }

        [Test]
        public void Not_Optimized_Events_BeforeRender()
        {
            var tree = new MyOptimizedContentTree1(&quot;content&quot;);

            BaseTree.BeforeTreeRender += EventHandler;

            Assert.IsFalse(tree.UseOptimizedRendering);
        }

        [Test]
        public void Not_Optimized_Overriden_Method()
        {
            var tree = new MyNotOptimizedContentTree(&quot;content&quot;);

            Assert.IsFalse(tree.UseOptimizedRendering);
        }

        private void EventHandler(object sender, TreeEventArgs treeEventArgs)
        {

        }

        //optimized because we are not overriding OnRenderNode
        public class MyOptimizedContentTree1 : BaseContentTree
        {
            public MyOptimizedContentTree1(string application)
                : base(application)
            {
            }

            protected override void CreateRootNode(ref XmlTreeNode rootNode)
            {

            }
        }

        public class MyOptimizedContentTree2 : BaseContentTree
        {
            public MyOptimizedContentTree2(string application)
                : base(application)
            {
            }

            protected override bool LoadMinimalDocument
            {
                get { return true; }
            }

            protected override void CreateRootNode(ref XmlTreeNode rootNode)
            {
                
            }

            //even if we override it will still be optimized because of the LoadMinimalDocument flag
            protected override void OnRenderNode(ref XmlTreeNode xNode, umbraco.cms.businesslogic.web.Document doc)
            {
                base.OnRenderNode(ref xNode, doc);
            }
        }

        public class MyNotOptimizedContentTree : BaseContentTree
        {
            public MyNotOptimizedContentTree(string application)
                : base(application)
            {
            }

            protected override void CreateRootNode(ref XmlTreeNode rootNode)
            {

            }

            protected override bool LoadMinimalDocument
            {
                get { return false; }
            }

            protected override void OnRenderNode(ref XmlTreeNode xNode, umbraco.cms.businesslogic.web.Document doc)
            {
                base.OnRenderNode(ref xNode, doc);
            }
        }

        
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,10,1],[13,13,13,54,1],[14,13,14,55,1],[15,9,15,10,1],[19,9,19,10,1],[20,13,20,64,1],[21,13,21,64,1],[23,13,23,56,1],[24,13,24,56,1],[25,9,25,10,1],[29,9,29,10,1],[30,13,30,63,1],[32,13,32,54,1],[34,13,34,56,1],[35,9,35,10,1],[39,9,39,10,1],[40,13,40,63,1],[42,13,42,55,1],[44,13,44,56,1],[45,9,45,10,1],[49,9,49,10,1],[50,13,50,65,1],[52,13,52,56,1],[53,9,53,10,1],[56,9,56,10,0],[58,9,58,10,0],[64,19,64,36,1],[65,13,65,14,1],[66,13,66,14,1],[69,13,69,14,0],[71,13,71,14,0],[77,19,77,36,1],[78,13,78,14,1],[79,13,79,14,1],[83,21,83,22,1],[83,23,83,35,1],[83,36,83,37,1],[87,13,87,14,0],[89,13,89,14,0],[93,13,93,14,0],[94,17,94,51,0],[95,13,95,14,0],[101,19,101,36,1],[102,13,102,14,1],[103,13,103,14,1],[106,13,106,14,0],[108,13,108,14,0],[112,21,112,22,1],[112,23,112,36,1],[112,37,112,38,1],[116,13,116,14,0],[117,17,117,51,0],[118,13,118,14,0]]);
    </script>
  </body>
</html>