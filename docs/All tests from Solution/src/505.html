<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\controls\Images\ImageViewer.ascx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.UI;
using System.Web.UI.WebControls;
using Umbraco.Core.IO;
using umbraco.cms.businesslogic.media;
using Umbraco.Core;

namespace umbraco.controls.Images
{
	public partial class ImageViewer : UserControl
	{

		public ImageViewer()
		{
			MediaItemPath = &quot;#&quot;;
            MediaItemThumbnailPath = IOHelper.ResolveUrl(SystemDirectories.Umbraco) + &quot;/images/blank.png&quot;;
			AltText = &quot;No Image&quot;;
			ImageFound = false;
            ViewerStyle = Style.Basic;
			LinkTarget = &quot;_blank&quot;;
		}
		

		/// &lt;summary&gt;
		/// A JS method to invoke when the image is loaded. The method should accept the media ID.
		/// &lt;/summary&gt;
		public string ClientCallbackMethod { get; set; }

		public int MediaId { get; set; }

        /// &lt;summary&gt;
        /// The style to render the image viewer in
        /// &lt;/summary&gt;
        public enum Style 
        { 
            Basic = 0, 
            ImageLink = 1, 
            ThumbnailPreview = 2
        }

        public Style ViewerStyle { get; set; }

		public string LinkTarget { get; set; }
		
		public string MediaItemPath { get; private set; }
		public string MediaItemThumbnailPath { get; private set; }
		public string AltText { get; private set; }
		public int FileWidth { get { return m_FileWidth; } }
		public int FileHeight { get { return m_FileHeight; } }

		protected bool ImageFound { get; private set; }
		

		private int m_FileWidth;
		private int m_FileHeight;
		private bool m_IsBound;

		/// &lt;summary&gt;
		/// automatically bind if it&#39;s not explicitly called.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
		protected override void OnPreRender(EventArgs e)
		{
			base.OnPreRender(e);

		    View view = FindControl(ViewerStyle.ToString()) as View;
            MultiView.SetActiveView(view);

			if (m_IsBound == false)
			{
				DataBind();
			}          
		}

		public override void DataBind()
		{
			LookupData();
			base.DataBind();
			this.m_IsBound = true;
		}

		private void LookupData()
		{
            if (MediaId &gt; 0 &amp;&amp; Media.IsNode(MediaId))
            {
                Media m = new Media(MediaId);

                // TODO: Remove &quot;Magic strings&quot; from code.
                var pFile = m.getProperty(&quot;fileName&quot;);
                if (pFile == null) pFile = m.getProperty(Constants.Conventions.Media.File);
                if (pFile == null) pFile = m.getProperty(&quot;file&quot;);
                if (pFile == null)
                {
                    //the media requested does not correspond with the standard umbraco properties
                    return;
                }

                MediaItemPath = pFile.Value != null &amp;&amp; !string.IsNullOrEmpty(pFile.Value.ToString())
                    ? IOHelper.ResolveUrl(pFile.Value.ToString())
                    : &quot;#&quot;;
                AltText = MediaItemPath != &quot;#&quot; ? m.Text : ui.GetText(&quot;no&quot;) + &quot; &quot; + ui.GetText(&quot;media&quot;);

                var pWidth = m.getProperty(Constants.Conventions.Media.Width);
                var pHeight = m.getProperty(Constants.Conventions.Media.Height);

                if (pWidth != null &amp;&amp; pWidth.Value != null &amp;&amp; pHeight != null &amp;&amp; pHeight.Value != null)
                {
                    int.TryParse(pWidth.Value.ToString(), out m_FileWidth);
                    int.TryParse(pHeight.Value.ToString(), out m_FileHeight);
                }

                string ext = MediaItemPath.Substring(MediaItemPath.LastIndexOf(&quot;.&quot;) + 1, MediaItemPath.Length - MediaItemPath.LastIndexOf(&quot;.&quot;) - 1);
                MediaItemThumbnailPath = MediaItemPath.Replace(&quot;.&quot; + ext, &quot;_thumb.&quot; + ext);

                ImageFound = true;
            }
            else
            {
                ImageFound = false;
            }
        }

        #region Controls

        /// &lt;summary&gt;
        /// JsInclude1 control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::ClientDependency.Core.Controls.JsInclude JsInclude1;

        /// &lt;summary&gt;
        /// MultiView control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.MultiView MultiView;

        /// &lt;summary&gt;
        /// Basic control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.View Basic;

        /// &lt;summary&gt;
        /// ImageLink control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.View ImageLink;

        /// &lt;summary&gt;
        /// ThumbnailPreview control.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// &lt;/remarks&gt;
        protected global::System.Web.UI.WebControls.View ThumbnailPreview;

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,3,13,23,0],[14,3,14,4,0],[15,4,15,24,0],[16,13,16,107,0],[17,4,17,25,0],[18,4,18,23,0],[19,13,19,39,0],[20,4,20,26,0],[21,3,21,4,0],[27,40,27,44,0],[27,45,27,49,0],[29,24,29,28,0],[29,29,29,33,0],[41,36,41,40,0],[41,41,41,45,0],[43,30,43,34,0],[43,35,43,39,0],[45,33,45,37,0],[45,38,45,50,0],[46,42,46,46,0],[46,47,46,59,0],[47,27,47,31,0],[47,32,47,44,0],[48,30,48,31,0],[48,32,48,51,0],[48,52,48,53,0],[49,31,49,32,0],[49,33,49,53,0],[49,54,49,55,0],[51,31,51,35,0],[51,36,51,48,0],[63,3,63,4,0],[64,4,64,24,0],[66,7,66,63,0],[67,13,67,43,0],[69,4,69,27,0],[70,4,70,5,0],[71,5,71,16,0],[72,4,72,5,0],[73,3,73,4,0],[76,3,76,4,0],[77,4,77,17,0],[78,4,78,20,0],[79,4,79,26,0],[80,3,80,4,0],[83,3,83,4,0],[84,13,84,54,0],[85,13,85,14,0],[86,17,86,46,0],[89,17,89,55,0],[90,17,90,35,0],[90,36,90,92,0],[91,17,91,35,0],[91,36,91,66,0],[92,17,92,35,0],[93,17,93,18,0],[95,21,95,28,0],[98,17,100,27,0],[101,17,101,104,0],[103,17,103,79,0],[104,17,104,81,0],[106,17,106,104,0],[107,17,107,18,0],[108,21,108,76,0],[109,21,109,78,0],[110,17,110,18,0],[112,17,112,149,0],[113,17,113,92,0],[115,17,115,35,0],[116,13,116,14,0],[118,13,118,14,0],[119,17,119,36,0],[120,13,120,14,0],[121,9,121,10,0]]);
    </script>
  </body>
</html>