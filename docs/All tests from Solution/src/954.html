<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Routing\UrlProvider.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Umbraco.Core.Configuration;
using Umbraco.Core.Configuration.UmbracoSettings;
using Umbraco.Web.PublishedCache;
using Umbraco.Core;

namespace Umbraco.Web.Routing
{
    /// &lt;summary&gt;
    /// Provides urls.
    /// &lt;/summary&gt;
    public class UrlProvider
    {
        #region Ctor and configuration

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;UrlProvider&quot;/&gt; class with an Umbraco context and a list of url providers.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;umbracoContext&quot;&gt;The Umbraco context.&lt;/param&gt;
        /// &lt;param name=&quot;routingSettings&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;urlProviders&quot;&gt;The list of url providers.&lt;/param&gt;
        public UrlProvider(UmbracoContext umbracoContext, IWebRoutingSection routingSettings, IEnumerable&lt;IUrlProvider&gt; urlProviders)
        {
            if (umbracoContext == null) throw new ArgumentNullException(&quot;umbracoContext&quot;);

            _umbracoContext = umbracoContext;
            _urlProviders = urlProviders;

            var provider = UrlProviderMode.Auto;
            Mode = provider;

            if (Enum&lt;UrlProviderMode&gt;.TryParse(routingSettings.UrlProviderMode, out provider))
            {
                Mode = provider;
            }    
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;UrlProvider&quot;/&gt; class with an Umbraco context and a list of url providers.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;umbracoContext&quot;&gt;The Umbraco context.&lt;/param&gt;
        /// &lt;param name=&quot;urlProviders&quot;&gt;The list of url providers.&lt;/param&gt;
        /// &lt;param name=&quot;provider&quot;&gt;&lt;/param&gt;
        public UrlProvider(UmbracoContext umbracoContext, IEnumerable&lt;IUrlProvider&gt; urlProviders, UrlProviderMode provider = UrlProviderMode.Auto)
        {
            if (umbracoContext == null) throw new ArgumentNullException(&quot;umbracoContext&quot;);

            _umbracoContext = umbracoContext;
            _urlProviders = urlProviders;

            Mode = provider;
        }

        private readonly UmbracoContext _umbracoContext;
        private readonly IEnumerable&lt;IUrlProvider&gt; _urlProviders;

        /// &lt;summary&gt;
        /// Gets or sets the provider url mode.
        /// &lt;/summary&gt;
        public UrlProviderMode Mode { get; set; }

        #endregion

        #region GetUrl

        /// &lt;summary&gt;
        /// Gets the url of a published content.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The published content identifier.&lt;/param&gt;
        /// &lt;returns&gt;The url for the published content.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;The url is absolute or relative depending on &lt;c&gt;Mode&lt;/c&gt; and on the current url.&lt;/para&gt;
        /// &lt;para&gt;If the provider is unable to provide a url, it returns &quot;#&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public string GetUrl(int id)
        {
            return GetUrl(id, _umbracoContext.CleanedUmbracoUrl, Mode);
        }

        /// &lt;summary&gt;
        /// Gets the nice url of a published content.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The published content identifier.&lt;/param&gt;
        /// &lt;param name=&quot;absolute&quot;&gt;A value indicating whether the url should be absolute in any case.&lt;/param&gt;
        /// &lt;returns&gt;The url for the published content.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;The url is absolute or relative depending on &lt;c&gt;Mode&lt;/c&gt; and on &lt;c&gt;current&lt;/c&gt;, unless
        /// &lt;c&gt;absolute&lt;/c&gt; is true, in which case the url is always absolute.&lt;/para&gt;
        /// &lt;para&gt;If the provider is unable to provide a url, it returns &quot;#&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public string GetUrl(int id, bool absolute)
        {
            var mode = absolute ? UrlProviderMode.Absolute : Mode;
            return GetUrl(id, _umbracoContext.CleanedUmbracoUrl, mode);
        }

        /// &lt;summary&gt;
        /// Gets the nice url of a published content.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The published content id.&lt;/param&gt;
        /// &lt;param name=&quot;current&quot;&gt;The current absolute url.&lt;/param&gt;
        /// &lt;param name=&quot;absolute&quot;&gt;A value indicating whether the url should be absolute in any case.&lt;/param&gt;
        /// &lt;returns&gt;The url for the published content.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;The url is absolute or relative depending on &lt;c&gt;Mode&lt;/c&gt; and on &lt;c&gt;current&lt;/c&gt;, unless
        /// &lt;c&gt;absolute&lt;/c&gt; is true, in which case the url is always absolute.&lt;/para&gt;
        /// &lt;para&gt;If the provider is unable to provide a url, it returns &quot;#&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public string GetUrl(int id, Uri current, bool absolute)
        {
            var mode = absolute ? UrlProviderMode.Absolute : Mode;
            return GetUrl(id, current, mode);
        }

        /// &lt;summary&gt;
        /// Gets the nice url of a published content.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The published content identifier.&lt;/param&gt;
        /// &lt;param name=&quot;mode&quot;&gt;The url mode.&lt;/param&gt;
        /// &lt;returns&gt;The url for the published content.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;The url is absolute or relative depending on &lt;c&gt;mode&lt;/c&gt; and on the current url.&lt;/para&gt;
        /// &lt;para&gt;If the provider is unable to provide a url, it returns &quot;#&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public string GetUrl(int id, UrlProviderMode mode)
        {
            return GetUrl(id, _umbracoContext.CleanedUmbracoUrl, mode);
        }

        /// &lt;summary&gt;
        /// Gets the nice url of a published content.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The published content id.&lt;/param&gt;
        /// &lt;param name=&quot;current&quot;&gt;The current absolute url.&lt;/param&gt;
        /// &lt;param name=&quot;mode&quot;&gt;The url mode.&lt;/param&gt;
        /// &lt;returns&gt;The url for the published content.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;The url is absolute or relative depending on &lt;c&gt;mode&lt;/c&gt; and on &lt;c&gt;current&lt;/c&gt;.&lt;/para&gt;
        /// &lt;para&gt;If the provider is unable to provide a url, it returns &quot;#&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public string GetUrl(int id, Uri current, UrlProviderMode mode)
        {
            var url = _urlProviders.Select(provider =&gt; provider.GetUrl(_umbracoContext, id, current, mode))
                .FirstOrDefault(u =&gt; u != null);
            return url ?? &quot;#&quot;; // legacy wants this
        }

        internal string GetUrlFromRoute(int id, string route)
        {
            var provider = _urlProviders.OfType&lt;DefaultUrlProvider&gt;().FirstOrDefault();
            var url = provider == null 
                ? route // what else?
                : provider.GetUrlFromRoute(route, UmbracoContext.Current, id, _umbracoContext.CleanedUmbracoUrl, Mode);
            return url ?? &quot;#&quot;;
        }

        #endregion

        #region GetOtherUrls

        /// &lt;summary&gt;
        /// Gets the other urls of a published content.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The published content id.&lt;/param&gt;
        /// &lt;returns&gt;The other urls for the published content.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;Other urls are those that &lt;c&gt;GetUrl&lt;/c&gt; would not return in the current context, but would be valid
        /// urls for the node in other contexts (different domain for current request, umbracoUrlAlias...).&lt;/para&gt;
        /// &lt;para&gt;The results depend on the current url.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public IEnumerable&lt;string&gt; GetOtherUrls(int id)
        {
            return GetOtherUrls(id, _umbracoContext.CleanedUmbracoUrl);
        }

        /// &lt;summary&gt;
        /// Gets the other urls of a published content.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;id&quot;&gt;The published content id.&lt;/param&gt;
        /// &lt;param name=&quot;current&quot;&gt;The current absolute url.&lt;/param&gt;
        /// &lt;returns&gt;The other urls for the published content.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;Other urls are those that &lt;c&gt;GetUrl&lt;/c&gt; would not return in the current context, but would be valid
        /// urls for the node in other contexts (different domain for current request, umbracoUrlAlias...).&lt;/para&gt;
        /// &lt;/remarks&gt;
        public IEnumerable&lt;string&gt; GetOtherUrls(int id, Uri current)
        {
            // providers can return null or an empty list or a non-empty list, be prepared
            var urls = _urlProviders.SelectMany(provider =&gt; provider.GetOtherUrls(_umbracoContext, id, current) ?? Enumerable.Empty&lt;string&gt;());

            return urls;
        }

        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[24,9,24,134,1],[25,9,25,10,1],[26,13,26,40,1],[26,41,26,91,0],[28,13,28,46,1],[29,13,29,42,1],[31,13,31,49,1],[32,13,32,29,1],[34,13,34,95,1],[35,13,35,14,1],[36,17,36,33,1],[37,13,37,14,1],[38,9,38,10,1],[46,9,46,147,1],[47,9,47,10,1],[48,13,48,40,1],[48,41,48,91,0],[50,13,50,46,1],[51,13,51,42,1],[53,13,53,29,1],[54,9,54,10,1],[62,39,62,43,1],[62,44,62,48,1],[78,9,78,10,1],[79,13,79,72,1],[80,9,80,10,1],[94,9,94,10,1],[95,13,95,67,1],[96,13,96,72,1],[97,9,97,10,1],[112,9,112,10,1],[113,13,113,67,1],[114,13,114,46,1],[115,9,115,10,1],[128,9,128,10,0],[129,13,129,72,0],[130,9,130,10,0],[144,9,144,10,1],[145,13,145,56,1],[145,56,145,107,1],[145,107,146,38,1],[146,38,146,47,1],[146,47,146,49,1],[145,13,146,49,1],[147,13,147,31,1],[148,9,148,10,1],[151,9,151,10,0],[152,13,152,88,0],[153,13,155,120,0],[156,13,156,31,0],[157,9,157,10,0],[174,9,174,10,1],[175,13,175,72,1],[176,9,176,10,1],[189,9,189,10,1],[191,13,191,61,1],[191,61,191,142,1],[191,142,191,144,1],[191,13,191,144,1],[193,13,193,25,1],[194,9,194,10,1]]);
    </script>
  </body>
</html>