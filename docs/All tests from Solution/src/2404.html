<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\web\Domain.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Runtime.InteropServices;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Logging;
using umbraco.BusinessLogic;
using umbraco.BusinessLogic.Actions;
using umbraco.cms.businesslogic.cache;
using Umbraco.Core.Models;
using umbraco.interfaces;
using umbraco.DataLayer;
using System.Runtime.CompilerServices;
using Language = umbraco.cms.businesslogic.language.Language;


namespace umbraco.cms.businesslogic.web
{
    /// &lt;summary&gt;
    /// Summary description for Domain.
    /// &lt;/summary&gt;
    [Obsolete(&quot;Use Umbraco.Core.Models.IDomain and Umbraco.Core.Services.IDomainService instead&quot;)]
    public class Domain
    {
        public IDomain DomainEntity { get; set; }
       
		/// &lt;summary&gt;
		/// Empty ctor used for unit tests to create a custom domain
		/// &lt;/summary&gt;
		internal Domain()
		{			
		}

        internal Domain(IDomain domain)
        {
            DomainEntity = domain;
        }

        public Domain(int Id)
        {
            DomainEntity = ApplicationContext.Current.Services.DomainService.GetById(Id);
            if (DomainEntity == null)
            {
                throw new Exception(string.Format(&quot;Domain name &#39;{0}&#39; does not exists&quot;, Id));
            }
        }

        public Domain(string DomainName)
        {
            DomainEntity = ApplicationContext.Current.Services.DomainService.GetByName(DomainName);
            if (DomainEntity == null)
            {
                throw new Exception(string.Format(&quot;Domain name &#39;{0}&#39; does not exists&quot;, DomainName));
            }
        }

        public string Name
        {
            get { return DomainEntity.DomainName; }
            set { DomainEntity.DomainName = value; }
        }

        public Language Language
        {
            get
            {
                if (DomainEntity.LanguageId.HasValue == false) return null;
                var lang = ApplicationContext.Current.Services.LocalizationService.GetLanguageById(DomainEntity.LanguageId.Value);
                if (lang == null) throw new InvalidOperationException(&quot;No language exists with id &quot; + DomainEntity.LanguageId.Value);
                return new Language(lang);
            }
            set
            {
                DomainEntity.LanguageId = value.LanguageEntity.Id;
            }
        }

        public int RootNodeId
        {
            get { return DomainEntity.RootContentId ?? -1; }
            set { DomainEntity.RootContentId = value; }
        }

        public int Id
        {
            get { return DomainEntity.Id; }
        }

        public void Delete()
        {
            var e = new DeleteEventArgs();
            FireBeforeDelete(e);

            if (!e.Cancel)
            {
                ApplicationContext.Current.Services.DomainService.Delete(DomainEntity);

                FireAfterDelete(e);
            }
        }

        public void Save(){
            var e = new SaveEventArgs();
            FireBeforeSave(e);

            if (!e.Cancel) 
            {
                if (ApplicationContext.Current.Services.DomainService.Save(DomainEntity))
                {
                    FireAfterSave(e);
                }
            }
        }

        #region Statics


        public static IEnumerable&lt;Domain&gt; GetDomains()
        {
            return GetDomains(false);
        }

        public static IEnumerable&lt;Domain&gt; GetDomains(bool includeWildcards)
        {
            return ApplicationContext.Current.Services.DomainService.GetAll(includeWildcards)
                .Select(x =&gt; new Domain(x));
        }

        public static Domain GetDomain(string DomainName)
        {
            var found = ApplicationContext.Current.Services.DomainService.GetByName(DomainName);
            return found == null ? null : new Domain(found);
        }

        public static int GetRootFromDomain(string DomainName)
        {
            var found = ApplicationContext.Current.Services.DomainService.GetByName(DomainName);
            return found == null ? -1 : found.RootContentId ?? -1;
        }

        public static Domain[] GetDomainsById(int nodeId)
        {
            return ApplicationContext.Current.Services.DomainService.GetAssignedDomains(nodeId, true)
                .Select(x =&gt; new Domain(x))
                .ToArray();
        }

        public static Domain[] GetDomainsById(int nodeId, bool includeWildcards)
        {
            return ApplicationContext.Current.Services.DomainService.GetAssignedDomains(nodeId, includeWildcards)
                .Select(x =&gt; new Domain(x))
                .ToArray();
        }

        public static bool Exists(string DomainName)
        {
            return ApplicationContext.Current.Services.DomainService.Exists(DomainName);
        }

        public static void MakeNew(string DomainName, int RootNodeId, int LanguageId)
        {
            var domain = new UmbracoDomain(DomainName)
            {
                RootContentId = RootNodeId,
                LanguageId = LanguageId
            };
            if (ApplicationContext.Current.Services.DomainService.Save(domain))
            {
                var e = new NewEventArgs();
                var legacyModel = new Domain(domain);
                legacyModel.OnNew(e);
            }
            
        }

        #endregion

        //EVENTS
        public delegate void SaveEventHandler(Domain sender, SaveEventArgs e);
        public delegate void NewEventHandler(Domain sender, NewEventArgs e);
        public delegate void DeleteEventHandler(Domain sender, DeleteEventArgs e);

        /// &lt;summary&gt;
        /// Occurs when a macro is saved.
        /// &lt;/summary&gt;
        public static event SaveEventHandler BeforeSave;
        protected virtual void FireBeforeSave(SaveEventArgs e) {
            if (BeforeSave != null)
                BeforeSave(this, e);
        }

        public static event SaveEventHandler AfterSave;
        protected virtual void FireAfterSave(SaveEventArgs e) {
            if (AfterSave != null)
                AfterSave(this, e);
        }

        public static event NewEventHandler New;
        protected virtual void OnNew(NewEventArgs e) {
            if (New != null)
                New(this, e);
        }

        public static event DeleteEventHandler BeforeDelete;
        protected virtual void FireBeforeDelete(DeleteEventArgs e) {
            if (BeforeDelete != null)
                BeforeDelete(this, e);
        }

        public static event DeleteEventHandler AfterDelete;
        protected virtual void FireAfterDelete(DeleteEventArgs e) {
            if (AfterDelete != null)
                AfterDelete(this, e);
        }

        #region Pipeline Refactoring

        // NOTE: the wildcard name thing should be managed by the Domain class
        // internally but that would break too much backward compatibility, so
        // we don&#39;t do it now. Will do it when the Domain class migrates to the
        // new Core.Models API.

        /// &lt;summary&gt;
        /// Gets a value indicating whether the domain is a wildcard domain.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;A value indicating whether the domain is a wildcard domain.&lt;/returns&gt;
        public bool IsWildcard
        {
            get { return DomainEntity.IsWildcard; }
        }

        #endregion
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[27,39,27,43,1],[27,44,27,48,1],[32,3,32,20,0],[33,3,33,4,0],[34,3,34,4,0],[36,9,36,40,1],[37,9,37,10,1],[38,13,38,35,1],[39,9,39,10,1],[41,9,41,30,0],[42,9,42,10,0],[43,13,43,90,0],[44,13,44,38,0],[45,13,45,14,0],[46,17,46,93,0],[48,9,48,10,0],[50,9,50,41,0],[51,9,51,10,0],[52,13,52,100,0],[53,13,53,38,0],[54,13,54,14,0],[55,17,55,101,0],[57,9,57,10,0],[61,17,61,18,0],[61,19,61,50,0],[61,51,61,52,0],[62,17,62,18,0],[62,19,62,51,0],[62,52,62,53,0],[68,13,68,14,0],[69,17,69,63,0],[69,64,69,76,0],[70,17,70,131,0],[71,17,71,34,0],[71,35,71,134,0],[72,17,72,43,0],[73,13,73,14,0],[75,13,75,14,0],[76,17,76,67,0],[77,13,77,14,0],[82,17,82,18,1],[82,19,82,59,1],[82,60,82,61,1],[83,17,83,18,0],[83,19,83,54,0],[83,55,83,56,0],[88,17,88,18,0],[88,19,88,42,0],[88,43,88,44,0],[92,9,92,10,0],[93,13,93,43,0],[94,13,94,33,0],[96,13,96,27,0],[97,13,97,14,0],[98,17,98,88,0],[100,17,100,36,0],[101,13,101,14,0],[102,9,102,10,0],[104,27,104,28,0],[105,13,105,41,0],[106,13,106,31,0],[108,13,108,27,0],[109,13,109,14,0],[110,17,110,90,0],[111,17,111,18,0],[112,21,112,38,0],[113,17,113,18,0],[114,13,114,14,0],[115,9,115,10,0],[121,9,121,10,0],[122,13,122,38,0],[123,9,123,10,0],[126,9,126,10,0],[127,13,128,30,0],[128,30,128,43,0],[128,43,128,45,0],[127,13,128,45,0],[129,9,129,10,0],[132,9,132,10,0],[133,13,133,97,0],[134,13,134,61,0],[135,9,135,10,0],[138,9,138,10,0],[139,13,139,97,0],[140,13,140,67,0],[141,9,141,10,0],[144,9,144,10,0],[145,13,146,30,0],[146,30,146,43,0],[146,43,147,28,0],[145,13,147,28,0],[148,9,148,10,0],[151,9,151,10,0],[152,13,153,30,0],[153,30,153,43,0],[153,43,154,28,0],[152,13,154,28,0],[155,9,155,10,0],[158,9,158,10,0],[159,13,159,89,0],[160,9,160,10,0],[163,9,163,10,0],[164,13,168,15,0],[169,13,169,80,0],[170,13,170,14,0],[171,17,171,44,0],[172,17,172,54,0],[173,17,173,38,0],[174,13,174,14,0],[176,9,176,10,0],[189,64,189,65,0],[190,13,190,36,0],[191,17,191,37,0],[192,9,192,10,0],[195,63,195,64,0],[196,13,196,35,0],[197,17,197,36,0],[198,9,198,10,0],[201,54,201,55,0],[202,13,202,29,0],[203,17,203,30,0],[204,9,204,10,0],[207,68,207,69,0],[208,13,208,38,0],[209,17,209,39,0],[210,9,210,10,0],[213,67,213,68,0],[214,13,214,37,0],[215,17,215,38,0],[216,9,216,10,0],[231,17,231,18,0],[231,19,231,50,0],[231,51,231,52,0]]);
    </script>
  </body>
</html>