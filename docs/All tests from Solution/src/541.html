<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\UmbracoServerUtility.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web;
using System.Xml.Linq;
using Umbraco.Core.IO;
using umbraco.presentation.preview;
using umbraco.BusinessLogic;
using System.Xml;

namespace umbraco.presentation
{

    /// &lt;summary&gt;
    /// A custom HttpServerUtilityBase object which exposes some additional methods and also overrides
    /// some such as MapPath to use the IOHelper.
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// Unforunately when this class was created it 
    /// inherited from HttpServerUtilityWrapper intead of HttpServerUtilityBase which meant that this is not unit testable
    /// and still has a dependency on a real HttpRequest. So now it inherits from HttpRequestBase which 
    /// means we need to override all of the methods and just wrap them with the _server object passed in.
    /// 
    /// This now needs to exist only because of backwards compatibility
    /// &lt;/remarks&gt;
    [Obsolete(&quot;This class is no longer used, for the overridden MapPath methods and custom methods use IOHelper&quot;)]
    public class UmbracoServerUtility : HttpServerUtilityBase
    {
        private readonly HttpServerUtilityBase _server;

        #region Constructor

        public UmbracoServerUtility(HttpServerUtilityBase server)
        {
            _server = server;
        }

        [Obsolete(&quot;Use the alternate constructor which accepts a HttpServerUtilityBase object instead&quot;)]
        public UmbracoServerUtility(HttpServerUtility server)
        {
            _server = new HttpServerUtilityWrapper(server);
        } 

        #endregion

        #region Wrapped methods

        public override object CreateObject(string progID)
        {
            return _server.CreateObject(progID);
        }

        public override object CreateObject(Type type)
        {
            return _server.CreateObject(type);
        }

        public override object CreateObjectFromClsid(string clsid)
        {
            return _server.CreateObjectFromClsid(clsid);
        }

        public override bool Equals(object obj)
        {
            return _server.Equals(obj);
        }

        public override void Execute(IHttpHandler handler, System.IO.TextWriter writer, bool preserveForm)
        {
            _server.Execute(handler, writer, preserveForm);
        }

        public override void Execute(string path)
        {
            _server.Execute(path);
        }

        public override void Execute(string path, bool preserveForm)
        {
            _server.Execute(path, preserveForm);
        }

        public override void Execute(string path, System.IO.TextWriter writer)
        {
            _server.Execute(path, writer);
        }

        public override void Execute(string path, System.IO.TextWriter writer, bool preserveForm)
        {
            _server.Execute(path, writer, preserveForm);
        }

        public override int GetHashCode()
        {
            return _server.GetHashCode();
        }

        public override Exception GetLastError()
        {
            return _server.GetLastError();
        }

        public override string HtmlDecode(string s)
        {
            return _server.HtmlDecode(s);
        }

        public override void HtmlDecode(string s, System.IO.TextWriter output)
        {
            _server.HtmlDecode(s, output);
        }

        public override string HtmlEncode(string s)
        {
            return _server.HtmlEncode(s);
        }

        public override void ClearError()
        {
            _server.ClearError();
        }

        public override void HtmlEncode(string s, System.IO.TextWriter output)
        {
            _server.HtmlEncode(s, output);
        }

        public override string MachineName
        {
            get
            {
                return _server.MachineName;
            }
        }

        public override int ScriptTimeout
        {
            get
            {
                return _server.ScriptTimeout;
            }
            set
            {
                _server.ScriptTimeout = value;
            }
        }

        public override string ToString()
        {
            return _server.ToString();
        }

        public override void Transfer(IHttpHandler handler, bool preserveForm)
        {
            _server.Transfer(handler, preserveForm);
        }

        public override void Transfer(string path)
        {
            _server.Transfer(path);
        }

        public override void Transfer(string path, bool preserveForm)
        {
            _server.Transfer(path, preserveForm);
        }

        public override void TransferRequest(string path)
        {
            _server.TransferRequest(path);
        }

        public override void TransferRequest(string path, bool preserveForm)
        {
            _server.TransferRequest(path, preserveForm);
        }

        public override void TransferRequest(string path, bool preserveForm, string method, System.Collections.Specialized.NameValueCollection headers)
        {
            _server.TransferRequest(path, preserveForm, method, headers);
        }

        public override string UrlDecode(string s)
        {
            return _server.UrlDecode(s);
        }

        public override void UrlDecode(string s, System.IO.TextWriter output)
        {
            _server.UrlDecode(s, output);
        }

        public override string UrlEncode(string s)
        {
            return _server.UrlEncode(s);
        }

        public override void UrlEncode(string s, System.IO.TextWriter output)
        {
            _server.UrlEncode(s, output);
        }

        public override string UrlPathEncode(string s)
        {
            return _server.UrlPathEncode(s);
        }

        public override byte[] UrlTokenDecode(string input)
        {
            return _server.UrlTokenDecode(input);
        }

        public override string UrlTokenEncode(byte[] input)
        {
            return _server.UrlTokenEncode(input);
        }

        #endregion

        #region Overridden methods

        /// &lt;summary&gt;
        /// Returns the physical file path that corresponds to the specified virtual path on the Web server.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;path&quot;&gt;The virtual path of the Web server.&lt;/param&gt;
        /// &lt;returns&gt;
        /// The physical file path that corresponds to &lt;paramref name=&quot;path&quot;/&gt;.
        /// &lt;/returns&gt;
        /// &lt;exception cref=&quot;T:System.Web.HttpException&quot;&gt;
        /// The current &lt;see cref=&quot;T:System.Web.HttpContext&quot;/&gt; is null.
        /// &lt;/exception&gt;
        public override string MapPath(string path)
        {
            return IOHelper.MapPath(path);
        }  
       
        #endregion

        public string UmbracoPath
        {
            get
            {
                return IOHelper.ResolveUrl( SystemDirectories.Umbraco );
            }
        }

        public string ContentXmlPath
        {
            get
            {
                return IOHelper.ResolveUrl( SystemFiles.ContentCacheXml );
            }
        }

		[Obsolete(&quot;This is no longer used in the codebase and will be removed. &quot;)]
        private const string XDocumentCacheKey = &quot;XDocumentCache&quot;;

        /// &lt;summary&gt;
        /// Gets the Umbraco XML cache
        /// &lt;/summary&gt;
        /// &lt;value&gt;The content XML.&lt;/value&gt;
        [Obsolete(&quot;This is no longer used in the codebase and will be removed. If you need to access the current XML cache document you can use the Umbraco.Web.Umbraco.Context.GetXml() method.&quot;)]
        public XDocument ContentXml
        {
            get
            {
                if (UmbracoContext.Current.InPreviewMode)
                {
                    var pc = new PreviewContent(new Guid(StateHelper.Cookies.Preview.GetValue()));
                    pc.LoadPreviewset();
                    return XmlDocumentToXDocument(pc.XmlContent);
                }
                else
                {
                    if (HttpContext.Current == null)
                        return XDocument.Load(ContentXmlPath);
                    var xml = HttpContext.Current.Items[XDocumentCacheKey] as XDocument;
                    if (xml == null)
                    {
                        xml = XmlDocumentToXDocument(content.Instance.XmlContent);
                        HttpContext.Current.Items[XDocumentCacheKey] = xml;
                    }
                    return xml;
                }
            }
        }

        private XDocument XmlDocumentToXDocument(XmlDocument xml)
        {
            using (var nodeReader = new XmlNodeReader(xml))
            {
                nodeReader.MoveToContent();
                return XDocument.Load(nodeReader);
            }
        }
        public string DataFolder
        {
            get
            {
                return IOHelper.ResolveUrl( SystemDirectories.Data );
            }
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[31,9,31,66,0],[32,9,32,10,0],[33,13,33,30,0],[34,9,34,10,0],[37,9,37,62,0],[38,9,38,10,0],[39,13,39,60,0],[40,9,40,10,0],[47,9,47,10,0],[48,13,48,49,0],[49,9,49,10,0],[52,9,52,10,0],[53,13,53,47,0],[54,9,54,10,0],[57,9,57,10,0],[58,13,58,57,0],[59,9,59,10,0],[62,9,62,10,0],[63,13,63,40,0],[64,9,64,10,0],[67,9,67,10,0],[68,13,68,60,0],[69,9,69,10,0],[72,9,72,10,0],[73,13,73,35,0],[74,9,74,10,0],[77,9,77,10,0],[78,13,78,49,0],[79,9,79,10,0],[82,9,82,10,0],[83,13,83,43,0],[84,9,84,10,0],[87,9,87,10,0],[88,13,88,57,0],[89,9,89,10,0],[92,9,92,10,0],[93,13,93,42,0],[94,9,94,10,0],[97,9,97,10,0],[98,13,98,43,0],[99,9,99,10,0],[102,9,102,10,0],[103,13,103,42,0],[104,9,104,10,0],[107,9,107,10,0],[108,13,108,43,0],[109,9,109,10,0],[112,9,112,10,0],[113,13,113,42,0],[114,9,114,10,0],[117,9,117,10,0],[118,13,118,34,0],[119,9,119,10,0],[122,9,122,10,0],[123,13,123,43,0],[124,9,124,10,0],[129,13,129,14,0],[130,17,130,44,0],[131,13,131,14,0],[137,13,137,14,0],[138,17,138,46,0],[139,13,139,14,0],[141,13,141,14,0],[142,17,142,47,0],[143,13,143,14,0],[147,9,147,10,0],[148,13,148,39,0],[149,9,149,10,0],[152,9,152,10,0],[153,13,153,53,0],[154,9,154,10,0],[157,9,157,10,0],[158,13,158,36,0],[159,9,159,10,0],[162,9,162,10,0],[163,13,163,50,0],[164,9,164,10,0],[167,9,167,10,0],[168,13,168,43,0],[169,9,169,10,0],[172,9,172,10,0],[173,13,173,57,0],[174,9,174,10,0],[177,9,177,10,0],[178,13,178,74,0],[179,9,179,10,0],[182,9,182,10,0],[183,13,183,41,0],[184,9,184,10,0],[187,9,187,10,0],[188,13,188,42,0],[189,9,189,10,0],[192,9,192,10,0],[193,13,193,41,0],[194,9,194,10,0],[197,9,197,10,0],[198,13,198,42,0],[199,9,199,10,0],[202,9,202,10,0],[203,13,203,45,0],[204,9,204,10,0],[207,9,207,10,0],[208,13,208,50,0],[209,9,209,10,0],[212,9,212,10,0],[213,13,213,50,0],[214,9,214,10,0],[231,9,231,10,0],[232,13,232,43,0],[233,9,233,10,0],[240,13,240,14,0],[241,17,241,73,0],[242,13,242,14,0],[248,13,248,14,0],[249,17,249,75,0],[250,13,250,14,0],[264,13,264,14,0],[265,17,265,58,0],[266,17,266,18,0],[267,21,267,99,0],[268,21,268,41,0],[269,21,269,66,0],[272,17,272,18,0],[273,21,273,53,0],[274,25,274,63,0],[275,21,275,89,0],[276,21,276,37,0],[277,21,277,22,0],[278,25,278,83,0],[279,25,279,76,0],[280,21,280,22,0],[281,21,281,32,0],[283,13,283,14,0],[287,9,287,10,0],[288,20,288,59,0],[289,13,289,14,0],[290,17,290,44,0],[291,17,291,51,0],[293,9,293,10,0],[297,13,297,14,0],[298,17,298,70,0],[299,13,299,14,0]]);
    </script>
  </body>
</html>