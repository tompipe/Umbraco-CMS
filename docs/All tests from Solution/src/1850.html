<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Migrations\Upgrades\TargetVersionSevenThreeZero\AddUserColumns.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Linq;
using Umbraco.Core.Configuration;
using Umbraco.Core.Logging;
using Umbraco.Core.Persistence.SqlSyntax;

namespace Umbraco.Core.Persistence.Migrations.Upgrades.TargetVersionSevenThreeZero
{
    [Migration(&quot;7.3.0&quot;, 10, GlobalSettings.UmbracoMigrationName)]
    public class AddUserColumns : MigrationBase
    {
        public AddUserColumns(ISqlSyntaxProvider sqlSyntax, ILogger logger)
            : base(sqlSyntax, logger)
        {
        }

        public override void Up()
        {
            //Don&#39;t exeucte if the column is already there
            var columns = SqlSyntax.GetColumnsInSchema(Context.Database).ToArray();

            if (columns.Any(x =&gt; x.TableName.InvariantEquals(&quot;umbracoUser&quot;) &amp;&amp; x.ColumnName.InvariantEquals(&quot;securityStampToken&quot;)) == false)
                Create.Column(&quot;securityStampToken&quot;).OnTable(&quot;umbracoUser&quot;).AsString(255).Nullable();

            if (columns.Any(x =&gt; x.TableName.InvariantEquals(&quot;umbracoUser&quot;) &amp;&amp; x.ColumnName.InvariantEquals(&quot;failedLoginAttempts&quot;)) == false)
                Create.Column(&quot;failedLoginAttempts&quot;).OnTable(&quot;umbracoUser&quot;).AsInt32().Nullable();
            
            if (columns.Any(x =&gt; x.TableName.InvariantEquals(&quot;umbracoUser&quot;) &amp;&amp; x.ColumnName.InvariantEquals(&quot;lastLockoutDate&quot;)) == false)
                Create.Column(&quot;lastLockoutDate&quot;).OnTable(&quot;umbracoUser&quot;).AsDateTime().Nullable();

            if (columns.Any(x =&gt; x.TableName.InvariantEquals(&quot;umbracoUser&quot;) &amp;&amp; x.ColumnName.InvariantEquals(&quot;lastPasswordChangeDate&quot;)) == false)
                Create.Column(&quot;lastPasswordChangeDate&quot;).OnTable(&quot;umbracoUser&quot;).AsDateTime().Nullable();

            if (columns.Any(x =&gt; x.TableName.InvariantEquals(&quot;umbracoUser&quot;) &amp;&amp; x.ColumnName.InvariantEquals(&quot;lastLoginDate&quot;)) == false)
                Create.Column(&quot;lastLoginDate&quot;).OnTable(&quot;umbracoUser&quot;).AsDateTime().Nullable();
        }

        public override void Down()
        {
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,15,12,38,0],[13,9,13,10,0],[14,9,14,10,0],[17,9,17,10,0],[19,13,19,84,0],[21,13,21,34,0],[21,34,21,130,0],[21,130,21,141,0],[21,13,21,141,0],[22,17,22,101,0],[24,13,24,34,0],[24,34,24,131,0],[24,131,24,142,0],[24,13,24,142,0],[25,17,25,98,0],[27,13,27,34,0],[27,34,27,127,0],[27,127,27,138,0],[27,13,27,138,0],[28,17,28,97,0],[30,13,30,34,0],[30,34,30,134,0],[30,134,30,145,0],[30,13,30,145,0],[31,17,31,104,0],[33,13,33,34,0],[33,34,33,125,0],[33,125,33,136,0],[33,13,33,136,0],[34,17,34,95,0],[35,9,35,10,0],[38,9,38,10,0],[39,9,39,10,0]]);
    </script>
  </body>
</html>