<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\VersionExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using Semver;

namespace Umbraco.Core
{
    internal static class VersionExtensions
    {
        public static Version GetVersion(this SemVersion semVersion, int maxParts = 4)
        {
            int build = 0;
            int.TryParse(semVersion.Build, out build);

            if (maxParts &gt;= 4)
            {
                return new Version(semVersion.Major, semVersion.Minor, semVersion.Patch, build);    
            }
            if (maxParts == 3)
            {
                return new Version(semVersion.Major, semVersion.Minor, semVersion.Patch);
            }

            return new Version(semVersion.Major, semVersion.Minor);
        }

        public static Version SubtractRevision(this Version version)
        {
            var parts = new List&lt;int&gt;(new[] {version.Major, version.Minor, version.Build, version.Revision});
            
            //remove all prefixed zero parts
            while (parts[0] &lt;= 0)
            {
                parts.RemoveAt(0);
                if (parts.Count == 0) break;
            }

            for (int index = 0; index &lt; parts.Count; index++)
            {
                var part = parts[index];
                if (part &lt;= 0)
                {
                    parts.RemoveAt(index);
                    index++;
                }
                else
                {
                    //break when there isn&#39;t a zero part
                    break;
                }
            }

            if (parts.Count == 0) throw new InvalidOperationException(&quot;Cannot subtract a revision from a zero version&quot;);

            var lastNonZero = parts.FindLastIndex(i =&gt; i &gt; 0);

            //subtract 1 from the last non-zero
            parts[lastNonZero] = parts[lastNonZero] - 1;

            //the last non zero is actually the revision so we can just return 
            if (lastNonZero == (parts.Count -1))
            {
                return FromList(parts);
            }
            
            //the last non zero isn&#39;t the revision so the remaining zero&#39;s need to be replaced with int.max
            for (var i = lastNonZero + 1; i &lt; parts.Count; i++)
            {
                parts[i] = int.MaxValue;
            }

            return FromList(parts);
        }

        private static Version FromList(IList&lt;int&gt; parts)
        {
            while (parts.Count &lt; 4)
            {
                parts.Insert(0, 0);
            }
            return new Version(parts[0], parts[1], parts[2], parts[3]);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,9,11,10,1],[12,13,12,27,1],[13,13,13,55,1],[15,13,15,31,1],[16,13,16,14,0],[17,17,17,97,0],[19,13,19,31,1],[20,13,20,14,1],[21,17,21,90,1],[24,13,24,68,0],[25,9,25,10,1],[28,9,28,10,1],[29,13,29,110,1],[32,13,32,34,1],[33,13,33,14,1],[34,17,34,35,1],[35,17,35,38,1],[35,39,35,45,0],[36,13,36,14,1],[38,18,38,31,1],[38,33,38,52,1],[38,54,38,61,0],[39,13,39,14,1],[40,17,40,41,1],[41,17,41,31,1],[42,17,42,18,0],[43,21,43,43,0],[44,21,44,29,0],[45,17,45,18,0],[47,17,47,18,1],[49,21,49,27,1],[51,13,51,14,0],[53,13,53,34,1],[53,35,53,121,0],[55,13,55,56,1],[55,56,55,61,1],[55,61,55,63,1],[55,13,55,63,1],[58,13,58,57,1],[61,13,61,49,1],[62,13,62,14,1],[63,17,63,40,1],[67,18,67,41,1],[67,43,67,58,1],[67,60,67,63,1],[68,13,68,14,1],[69,17,69,41,1],[70,13,70,14,1],[72,13,72,36,1],[73,9,73,10,1],[76,9,76,10,1],[77,13,77,36,1],[78,13,78,14,1],[79,17,79,36,1],[80,13,80,14,1],[81,13,81,72,1],[82,9,82,10,1]]);
    </script>
  </body>
</html>