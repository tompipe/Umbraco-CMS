<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Relators\PropertyTypePropertyGroupRelator.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using Umbraco.Core.Models.Rdbms;

namespace Umbraco.Core.Persistence.Relators
{
    internal class PropertyTypePropertyGroupRelator
    {
        internal MemberTypeReadOnlyDto Current;

        internal MemberTypeReadOnlyDto Map(MemberTypeReadOnlyDto a, PropertyTypeReadOnlyDto p, PropertyTypeGroupReadOnlyDto g)
        {
            // Terminating call.  Since we can return null from this function
            // we need to be ready for PetaPoco to callback later with null
            // parameters
            if (a == null)
                return Current;

            // Is this the same MemberTypeReadOnlyDto as the current one we&#39;re processing
            if (Current != null &amp;&amp; Current.UniqueId == a.UniqueId)
            {
                //This property may already be added so we need to check for that
                if (p.Id.HasValue &amp;&amp; Current.PropertyTypes.Any(x =&gt; x.Id == p.Id.Value) == false)
                {
                    // Add this PropertyTypeReadOnlyDto to the current MemberTypeReadOnlyDto&#39;s collection
                    Current.PropertyTypes.Add(p);
                }
                
                if (g.Id.HasValue &amp;&amp; Current.PropertyTypeGroups != null &amp;&amp; Current.PropertyTypeGroups.Any(x =&gt; x.Id == g.Id.Value) == false)
                {
                    Current.PropertyTypeGroups.Add(g);
                }

                // Return null to indicate we&#39;re not done with this MemberTypeReadOnlyDto yet
                return null;
            }

            // This is a different MemberTypeReadOnlyDto to the current one, or this is the 
            // first time through and we don&#39;t have a Tab yet

            // Save the current MemberTypeReadOnlyDto
            var prev = Current;

            // Setup the new current MemberTypeReadOnlyDto
            Current = a;
            Current.PropertyTypes = new List&lt;PropertyTypeReadOnlyDto&gt;();
            //this can be null since we are doing a left join
            if (p.Id.HasValue)
            {
                Current.PropertyTypes.Add(p);
            }

            Current.PropertyTypeGroups = new List&lt;PropertyTypeGroupReadOnlyDto&gt;();
            if (g.Id.HasValue)
            {
                Current.PropertyTypeGroups.Add(g);
            }

            // Return the now populated previous MemberTypeReadOnlyDto (or null if first time through)
            return prev;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,10,1],[16,13,16,27,1],[17,17,17,32,1],[20,13,20,67,1],[21,13,21,14,1],[23,17,23,69,1],[23,69,23,87,1],[23,87,23,98,1],[23,17,23,98,1],[24,17,24,18,1],[26,21,26,50,1],[27,17,27,18,1],[29,17,29,112,1],[29,112,29,130,1],[29,130,29,141,1],[29,17,29,141,1],[30,17,30,18,1],[31,21,31,55,1],[32,17,32,18,1],[35,17,35,29,1],[42,13,42,32,1],[45,13,45,25,1],[46,13,46,73,1],[48,13,48,31,1],[49,13,49,14,1],[50,17,50,46,1],[51,13,51,14,1],[53,13,53,83,1],[54,13,54,31,1],[55,13,55,14,1],[56,17,56,51,1],[57,13,57,14,1],[60,13,60,25,1],[61,9,61,10,1]]);
    </script>
  </body>
</html>