<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\task\Task.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.Text;
using System.Runtime.CompilerServices;

using umbraco.BusinessLogic;
using Umbraco.Core;
using umbraco.DataLayer;

namespace umbraco.cms.businesslogic.task
{
    /// &lt;summary&gt;
    /// An umbraco task is currently only used with the translation workflow in umbraco. But is extendable to cover other taskbased system as well.
    /// A task represent a simple job, it will always be assigned to a user, related to a node, and contain a comment about the task.
    /// The user attached to the task can complete the task, and the author of the task can reopen tasks that are not complete correct.
    /// 
    /// Tasks can in umbraco be used for setting up simple workflows, and contains basic controls structures to determine if the task is completed or not.
    /// &lt;/summary&gt;
    [Obsolete(&quot;Use Umbraco.Core.Service.ITaskService instead&quot;)]
    public class Task
    {

        internal Umbraco.Core.Models.Task TaskEntity;

        #region Properties

        /// &lt;summary&gt;
        /// Gets or sets the id.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The id.&lt;/value&gt;
        public int Id
        {
            get { return TaskEntity.Id; }
            set { TaskEntity.Id = value; }
        }
        
        /// &lt;summary&gt;
        /// Gets or sets a value indicating whether this &lt;see cref=&quot;Task&quot;/&gt; is closed.
        /// &lt;/summary&gt;
        /// &lt;value&gt;&lt;c&gt;true&lt;/c&gt; if closed; otherwise, &lt;c&gt;false&lt;/c&gt;.&lt;/value&gt;
        public bool Closed
        {
            get { return TaskEntity.Closed; }
            set { TaskEntity.Closed = value; }
        }
	

        private CMSNode _node;

        /// &lt;summary&gt;
        /// Gets or sets the node.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The node.&lt;/value&gt;
        public CMSNode Node
        {
            get { return _node ?? (_node = new CMSNode(TaskEntity.EntityId)); }
            set
            {
                _node = value;
                TaskEntity.EntityId = value.Id;
            }
        }

        private TaskType _type;

        /// &lt;summary&gt;
        /// Gets or sets the type.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The type.&lt;/value&gt;
        public TaskType Type
        {
            get { return _type ?? (_type = new TaskType(TaskEntity.TaskType)); }
            set
            {
                _type = value;
                TaskEntity.TaskType = new Umbraco.Core.Models.TaskType(_type.Alias)
                {
                    Id = _type.Id
                };
            }
        }
	

        private User _parentUser;

        /// &lt;summary&gt;
        /// Gets or sets the parent user.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The parent user.&lt;/value&gt;
        public User ParentUser
        {
            get { return _parentUser ?? (_parentUser = new User(TaskEntity.OwnerUserId)); }
            set
            {
                _parentUser = value;
                TaskEntity.OwnerUserId = _parentUser.Id;
            }
        }
        
        /// &lt;summary&gt;
        /// Gets or sets the comment.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The comment.&lt;/value&gt;
        public string Comment
        {
            get { return TaskEntity.Comment; }
            set { TaskEntity.Comment = value; }
        }
	
        /// &lt;summary&gt;
        /// Gets or sets the date.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The date.&lt;/value&gt;
        public DateTime Date
        {
            get { return TaskEntity.CreateDate; }
            set { TaskEntity.CreateDate = value; }
        }
	
        private User _user;

        /// &lt;summary&gt;
        /// Gets or sets the user.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The user.&lt;/value&gt;
        public User User
        {
            get { return _user ?? (_user = new User(TaskEntity.AssigneeUserId)); }
            set
            {
                _user = value;
                TaskEntity.AssigneeUserId = _user.Id;
            }
        }

        /// &lt;summary&gt;
        /// Unused, please do not use
        /// &lt;/summary&gt;
        [Obsolete(&quot;Obsolete, For querying the database use the new UmbracoDatabase object ApplicationContext.Current.DatabaseContext.Database&quot;, false)]
        protected static ISqlHelper SqlHelper
        {
            get { return Application.SqlHelper; }
        }

        #endregion

        #region Constructors

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;Task&quot;/&gt; class.
        /// &lt;/summary&gt;
        public Task()
        {
        }

        internal Task(Umbraco.Core.Models.Task task)
        {
            TaskEntity = task;
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;Task&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;TaskId&quot;&gt;The task id.&lt;/param&gt;
        public Task(int TaskId)
        {
            TaskEntity = ApplicationContext.Current.Services.TaskService.GetTaskById(TaskId);
            if (TaskEntity == null) throw new NullReferenceException(&quot;No task found with id &quot; + TaskId);
        }

        #endregion

        #region Public Methods

        /// &lt;summary&gt;
        /// Deletes the current task.
        /// Generally tasks should not be deleted and closed instead.
        /// &lt;/summary&gt;
        public void Delete()
        {
            ApplicationContext.Current.Services.TaskService.Delete(TaskEntity);
        }

        /// &lt;summary&gt;
        /// Saves this instance.
        /// &lt;/summary&gt;
        public void Save()
        {
            ApplicationContext.Current.Services.TaskService.Save(TaskEntity);
        }

        #endregion

        #region static methods

        /// &lt;summary&gt;
        /// Returns all tasks by type
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;taskType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static Tasks GetTasksByType(int taskType)
        {
            var foundTaskType = ApplicationContext.Current.Services.TaskService.GetTaskTypeById(taskType);
            if (foundTaskType == null) return null;

            var result = new Tasks();
            var tasks = ApplicationContext.Current.Services.TaskService.GetTasks(taskTypeAlias: foundTaskType.Alias);
            foreach (var task in tasks)
            {
                result.Add(new Task(task));
            }

            return result;
        }

        /// &lt;summary&gt;
        /// Get all tasks assigned to a node
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;nodeId&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static Tasks GetTasks(int nodeId)
        {
            var result = new Tasks();
            var tasks = ApplicationContext.Current.Services.TaskService.GetTasks(itemId:nodeId);
            foreach (var task in tasks)
            {
                result.Add(new Task(task));
            }

            return result;
        }

        /// &lt;summary&gt;
        /// Retrieves a collection of open tasks assigned to the user
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;User&quot;&gt;The User who have the tasks assigned&lt;/param&gt;
        /// &lt;param name=&quot;IncludeClosed&quot;&gt;If true both open and closed tasks will be returned&lt;/param&gt;
        /// &lt;returns&gt;A collections of tasks&lt;/returns&gt;
        public static Tasks GetTasks(User User, bool IncludeClosed) 
        {
            var result = new Tasks();
            var tasks = ApplicationContext.Current.Services.TaskService.GetTasks(assignedUser:User.Id, includeClosed:IncludeClosed);
            foreach (var task in tasks)
            {
                result.Add(new Task(task));
            }

            return result;
        }

        /// &lt;summary&gt;
        /// Retrieves a collection of open tasks assigned to the user
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;User&quot;&gt;The User who have the tasks assigned&lt;/param&gt;
        /// &lt;param name=&quot;IncludeClosed&quot;&gt;If true both open and closed tasks will be returned&lt;/param&gt;
        /// &lt;returns&gt;A collections of tasks&lt;/returns&gt;
        public static Tasks GetOwnedTasks(User User, bool IncludeClosed) 
        {
            var result = new Tasks();
            var tasks = ApplicationContext.Current.Services.TaskService.GetTasks(ownerUser:User.Id, includeClosed: IncludeClosed);
            foreach (var task in tasks)
            {
                result.Add(new Task(task));
            }
            return result;
        }

        #endregion
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[35,17,35,18,0],[35,19,35,40,0],[35,41,35,42,0],[36,17,36,18,0],[36,19,36,41,0],[36,42,36,43,0],[45,17,45,18,0],[45,19,45,44,0],[45,45,45,46,0],[46,17,46,18,0],[46,19,46,45,0],[46,46,46,47,0],[58,17,58,18,0],[58,19,58,78,0],[58,79,58,80,0],[60,13,60,14,0],[61,17,61,31,0],[62,17,62,48,0],[63,13,63,14,0],[74,17,74,18,0],[74,19,74,79,0],[74,80,74,81,0],[76,13,76,14,0],[77,17,77,31,0],[78,17,81,19,0],[82,13,82,14,0],[94,17,94,18,0],[94,19,94,90,0],[94,91,94,92,0],[96,13,96,14,0],[97,17,97,37,0],[98,17,98,57,0],[99,13,99,14,0],[108,17,108,18,0],[108,19,108,45,0],[108,46,108,47,0],[109,17,109,18,0],[109,19,109,46,0],[109,47,109,48,0],[118,17,118,18,0],[118,19,118,48,0],[118,49,118,50,0],[119,17,119,18,0],[119,19,119,49,0],[119,50,119,51,0],[130,17,130,18,0],[130,19,130,81,0],[130,82,130,83,0],[132,13,132,14,0],[133,17,133,31,0],[134,17,134,54,0],[135,13,135,14,0],[144,17,144,18,0],[144,19,144,48,0],[144,49,144,50,0],[154,9,154,22,0],[155,9,155,10,0],[156,9,156,10,0],[158,9,158,53,0],[159,9,159,10,0],[160,13,160,31,0],[161,9,161,10,0],[167,9,167,32,0],[168,9,168,10,0],[169,13,169,94,0],[170,13,170,36,0],[170,37,170,105,0],[171,9,171,10,0],[182,9,182,10,0],[183,13,183,80,0],[184,9,184,10,0],[190,9,190,10,0],[191,13,191,78,0],[192,9,192,10,0],[204,9,204,10,0],[205,13,205,107,0],[206,13,206,39,0],[206,40,206,52,0],[208,13,208,38,0],[209,13,209,118,0],[210,13,210,20,0],[210,22,210,30,0],[210,31,210,33,0],[210,34,210,39,0],[211,13,211,14,0],[212,17,212,44,0],[213,13,213,14,0],[215,13,215,27,0],[216,9,216,10,0],[224,9,224,10,0],[225,13,225,38,0],[226,13,226,97,0],[227,13,227,20,0],[227,22,227,30,0],[227,31,227,33,0],[227,34,227,39,0],[228,13,228,14,0],[229,17,229,44,0],[230,13,230,14,0],[232,13,232,27,0],[233,9,233,10,0],[242,9,242,10,0],[243,13,243,38,0],[244,13,244,133,0],[245,13,245,20,0],[245,22,245,30,0],[245,31,245,33,0],[245,34,245,39,0],[246,13,246,14,0],[247,17,247,44,0],[248,13,248,14,0],[250,13,250,27,0],[251,9,251,10,0],[260,9,260,10,0],[261,13,261,38,0],[262,13,262,131,0],[263,13,263,20,0],[263,22,263,30,0],[263,31,263,33,0],[263,34,263,39,0],[264,13,264,14,0],[265,17,265,44,0],[266,13,266,14,0],[267,13,267,27,0],[268,9,268,10,0]]);
    </script>
  </body>
</html>