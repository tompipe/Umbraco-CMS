<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Persistence\Migrations\Syntax\Delete\Expressions\DeleteForeignKeyExpression.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using Umbraco.Core.Logging;
using Umbraco.Core.Persistence.DatabaseModelDefinitions;
using Umbraco.Core.Persistence.SqlSyntax;

namespace Umbraco.Core.Persistence.Migrations.Syntax.Delete.Expressions
{
    public class DeleteForeignKeyExpression : MigrationExpressionBase
    {
        //public DeleteForeignKeyExpression(ISqlSyntaxProvider sqlSyntax)
        //    : base(sqlSyntax)
        //{
        //    ForeignKey = new ForeignKeyDefinition();
        //}

        public DeleteForeignKeyExpression(DatabaseProviders current, DatabaseProviders[] databaseProviders, ISqlSyntaxProvider sqlSyntax)
            : base(current, databaseProviders, sqlSyntax)
        {   
            ForeignKey = new ForeignKeyDefinition();
        }

        public ForeignKeyDefinition ForeignKey { get; set; }

        public override string ToString()
        {
            if (IsExpressionSupported() == false)
                return string.Empty;

            if (ForeignKey.ForeignTable == null)
                throw new ArgumentNullException(&quot;Table name not specified, ensure you have appended the OnTable extension. Format should be Delete.ForeignKey(KeyName).OnTable(TableName)&quot;);

            if (CurrentDatabaseProvider == DatabaseProviders.MySql)
            {
                //MySql naming &quot;convention&quot; for foreignkeys, which aren&#39;t explicitly named                
                if (string.IsNullOrEmpty(ForeignKey.Name))
                    ForeignKey.Name = string.Format(&quot;{0}_ibfk_1&quot;, ForeignKey.ForeignTable.ToLower());

                return string.Format(SqlSyntax.DeleteConstraint,
                                 SqlSyntax.GetQuotedTableName(ForeignKey.ForeignTable),
                                 &quot;FOREIGN KEY&quot;,
                                 SqlSyntax.GetQuotedName(ForeignKey.Name));
            }

            if (string.IsNullOrEmpty(ForeignKey.Name))
            {
                ForeignKey.Name = string.Format(&quot;FK_{0}_{1}_{2}&quot;, ForeignKey.ForeignTable, ForeignKey.PrimaryTable, ForeignKey.PrimaryColumns.First());
            }

            return string.Format(SqlSyntax.DeleteConstraint,
                                 SqlSyntax.GetQuotedTableName(ForeignKey.ForeignTable),
                                 SqlSyntax.GetQuotedName(ForeignKey.Name));
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,15,18,58,1],[19,9,19,10,1],[20,13,20,53,1],[21,9,21,10,1],[23,50,23,54,1],[23,55,23,59,1],[26,9,26,10,1],[27,13,27,50,1],[28,17,28,37,1],[30,13,30,49,1],[31,17,31,189,0],[33,13,33,68,1],[34,13,34,14,0],[36,17,36,59,0],[37,21,37,102,0],[39,17,42,76,0],[45,13,45,55,1],[46,13,46,14,1],[47,17,47,152,1],[48,13,48,14,1],[50,13,52,76,1],[53,9,53,10,1]]);
    </script>
  </body>
</html>