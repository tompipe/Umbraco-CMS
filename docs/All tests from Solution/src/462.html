<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Trees\loadMacros.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Text;
using System.Web;
using System.Xml;
using System.Configuration;
using umbraco.BasePages;
using umbraco.BusinessLogic;
using umbraco.businesslogic;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.cache;
using umbraco.cms.businesslogic.contentitem;
using umbraco.cms.businesslogic.datatype;
using umbraco.cms.businesslogic.language;
using umbraco.cms.businesslogic.media;
using umbraco.cms.businesslogic.member;
using umbraco.cms.businesslogic.property;
using umbraco.cms.businesslogic.web;
using umbraco.interfaces;
using umbraco.DataLayer;
using umbraco.BusinessLogic.Actions;
using umbraco.BusinessLogic.Utils;
using umbraco.cms.presentation.Trees;
using Umbraco.Core;


namespace umbraco
{
	/// &lt;summary&gt;
	/// Handles loading of the cache application into the developer application tree
	/// &lt;/summary&gt;
    [Tree(Constants.Applications.Developer, &quot;macros&quot;, &quot;Macros&quot;, sortOrder: 2)]
    public class loadMacros : BaseTree
	{

        public loadMacros(string application) : base(application) { }

        protected override void CreateRootNode(ref XmlTreeNode rootNode)
        {   
            rootNode.NodeType = &quot;init&quot; + TreeAlias;
            rootNode.NodeID = &quot;init&quot;;
        }

        /// &lt;summary&gt;
        /// Unused, please do not use
        /// &lt;/summary&gt;
        [Obsolete(&quot;Obsolete, For querying the database use the new UmbracoDatabase object ApplicationContext.Current.DatabaseContext.Database&quot;, false)]
        protected static ISqlHelper SqlHelper
        {
            get { return Application.SqlHelper; }
        }

        /// &lt;summary&gt;
        /// Renders the JS.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;Javascript&quot;&gt;The javascript.&lt;/param&gt;
        public override void RenderJS(ref StringBuilder Javascript)
        {
            Javascript.Append(
                @&quot;
function openMacro(id) {
	UmbClientMgr.contentFrame(&#39;developer/macros/editMacro.aspx?macroID=&#39; + id);
}
&quot;);
        }

        /// &lt;summary&gt;
        /// This will call the normal Render method by passing the converted XmlTree to an XmlDocument.
        /// TODO: need to update this render method to do everything that the obsolete render method does and remove the obsolete method
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tree&quot;&gt;&lt;/param&gt;
        public override void Render(ref XmlTree tree)
        {
            using (var sqlHelper = Application.SqlHelper)
            using (IRecordsReader macros = sqlHelper.ExecuteReader(&quot;select id, macroName from cmsMacro order by macroName&quot;))
            {
                while (macros.Read())
                {
                    XmlTreeNode xNode = XmlTreeNode.Create(this);
                    xNode.NodeID = macros.GetInt(&quot;id&quot;).ToString();
                    xNode.Text = macros.GetString(&quot;macroName&quot;);
                    xNode.Action = &quot;javascript:openMacro(&quot; + macros.GetInt(&quot;id&quot;) + &quot;);&quot;;
                    xNode.Icon = &quot; icon-settings-alt&quot;;
                    xNode.OpenIcon = &quot;icon-settings-alt&quot;;
                    OnBeforeNodeRender(ref tree, ref xNode, EventArgs.Empty);
                    if (xNode != null)
                    {
                        tree.Add(xNode);
                    }
                    OnAfterNodeRender(ref tree, ref xNode, EventArgs.Empty);
                }
            }
        }

	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[39,49,39,66,0],[39,67,39,68,0],[39,69,39,70,0],[42,9,42,10,0],[43,13,43,52,0],[44,13,44,38,0],[45,9,45,10,0],[53,17,53,18,0],[53,19,53,48,0],[53,49,53,50,0],[61,9,61,10,0],[62,13,67,4,0],[68,9,68,10,0],[76,9,76,10,0],[77,20,77,57,0],[78,20,78,124,0],[79,13,79,14,0],[80,17,80,38,0],[81,17,81,18,0],[82,21,82,66,0],[83,21,83,67,0],[84,21,84,64,0],[85,21,85,89,0],[86,21,86,55,0],[87,21,87,58,0],[88,21,88,78,0],[89,21,89,39,0],[90,21,90,22,0],[91,25,91,41,0],[92,21,92,22,0],[93,21,93,77,0],[94,17,94,18,0],[95,13,95,14,0],[96,9,96,10,0]]);
    </script>
  </body>
</html>