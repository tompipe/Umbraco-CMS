<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\Packager\PackageActions\helper.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Xml;

namespace umbraco.cms.businesslogic.packager.standardPackageActions
{
	public class helper
	{
		//Helper method to replace umbraco tags that breaks the xml format..
		public static string parseToValidXml(template.Template templateObj, ref bool hasAspNetContentBeginning, string template, bool toValid)
		{
			string retVal = template;
			if (toValid)
			{
				// test for asp:content as the first part of the design
				if (retVal.StartsWith(&quot;&lt;asp:content&quot;, StringComparison.OrdinalIgnoreCase))
				{
					hasAspNetContentBeginning = true;
					retVal = retVal.Substring(retVal.IndexOf(&quot;&gt;&quot;) + 1);
					retVal = retVal.Substring(0, retVal.Length - 14);
				}
				//shorten empty macro tags.. 
				retVal = retVal.Replace(&quot;&gt;&lt;/umbraco:macro&gt;&quot;, &quot; /&gt;&quot;);
				retVal = retVal.Replace(&quot;&gt;&lt;/umbraco:Macro&gt;&quot;, &quot; /&gt;&quot;);

				retVal = retVal.Replace(&quot;&lt;umbraco:&quot;, &quot;&lt;umbraco__&quot;);
				retVal = retVal.Replace(&quot;&lt;/umbraco:&quot;, &quot;&lt;/umbraco__&quot;);
				retVal = retVal.Replace(&quot;&lt;asp:&quot;, &quot;&lt;asp__&quot;);
				retVal = retVal.Replace(&quot;&lt;/asp:&quot;, &quot;&lt;/asp__&quot;);

				retVal = retVal.Replace(&quot;?UMBRACO_GETITEM&quot;, &quot;UMBRACO_GETITEM&quot;);
				retVal = retVal.Replace(&quot;?UMBRACO_TEMPLATE_LOAD_CHILD&quot;, &quot;UMBRACO_TEMPLATE_LOAD_CHILD&quot;);
				retVal = retVal.Replace(&quot;?UMBRACO_MACRO&quot;, &quot;UMBRACO_MACRO&quot;);
				retVal = retVal.Replace(&quot;?ASPNET_FORM&quot;, &quot;ASPNET_FORM&quot;);
				retVal = retVal.Replace(&quot;?ASPNET_HEAD&quot;, &quot;ASPNET_HEAD&quot;);


			}
			else
			{
				retVal = retVal.Replace(&quot;&lt;umbraco__&quot;, &quot;&lt;umbraco:&quot;);
				retVal = retVal.Replace(&quot;&lt;/umbraco__&quot;, &quot;&lt;/umbraco:&quot;);
				retVal = retVal.Replace(&quot;&lt;asp__&quot;, &quot;&lt;asp:&quot;);
				retVal = retVal.Replace(&quot;&lt;/asp__&quot;, &quot;&lt;/asp:&quot;);
				retVal = retVal.Replace(&quot;UMBRACO_GETITEM&quot;, &quot;?UMBRACO_GETITEM&quot;);
				retVal = retVal.Replace(&quot;UMBRACO_TEMPLATE_LOAD_CHILD&quot;, &quot;?UMBRACO_TEMPLATE_LOAD_CHILD&quot;);
				retVal = retVal.Replace(&quot;UMBRACO_MACRO&quot;, &quot;?UMBRACO_MACRO&quot;);
				retVal = retVal.Replace(&quot;ASPNET_FORM&quot;, &quot;?ASPNET_FORM&quot;);
				retVal = retVal.Replace(&quot;ASPNET_HEAD&quot;, &quot;?ASPNET_HEAD&quot;);
				retVal = retVal.Replace(&quot;&lt;root&gt;&quot;, &quot;&quot;);
				retVal = retVal.Replace(&quot;&lt;root xmlns:asp=\&quot;http://microsoft.com\&quot;&gt;&quot;, &quot;&quot;);
				retVal = retVal.Replace(&quot;&lt;/root&gt;&quot;, &quot;&quot;);

				// add asp content element
				if (hasAspNetContentBeginning)
				{
					retVal = templateObj.GetMasterContentElement(templateObj.MasterTemplate) + retVal + &quot;&lt;/asp:content&gt;&quot;;
				}
			}

			return retVal;
		}

		public static XmlNode parseStringToXmlNode(string value)
		{
			XmlDocument doc = new XmlDocument();
			XmlNode node = xmlHelper.addTextNode(doc, &quot;error&quot;, &quot;&quot;);

			try
			{
				doc.LoadXml(value);
				return doc.SelectSingleNode(&quot;.&quot;);
			}
			catch
			{
				return node;
			}

		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[10,3,10,4,0],[11,4,11,29,0],[12,4,12,16,0],[13,4,13,5,0],[15,5,15,79,0],[16,5,16,6,0],[17,6,17,39,0],[18,6,18,57,0],[19,6,19,55,0],[20,5,20,6,0],[22,5,22,57,0],[23,5,23,57,0],[25,5,25,56,0],[26,5,26,58,0],[27,5,27,48,0],[28,5,28,50,0],[30,5,30,68,0],[31,5,31,92,0],[32,5,32,64,0],[33,5,33,60,0],[34,5,34,60,0],[37,4,37,5,0],[39,4,39,5,0],[40,5,40,56,0],[41,5,41,58,0],[42,5,42,48,0],[43,5,43,50,0],[44,5,44,68,0],[45,5,45,92,0],[46,5,46,64,0],[47,5,47,60,0],[48,5,48,60,0],[49,5,49,43,0],[50,5,50,78,0],[51,5,51,44,0],[54,5,54,35,0],[55,5,55,6,0],[56,6,56,107,0],[57,5,57,6,0],[58,4,58,5,0],[60,4,60,18,0],[61,3,61,4,0],[64,3,64,4,0],[65,4,65,40,0],[66,4,66,59,0],[69,4,69,5,0],[70,5,70,24,0],[71,5,71,38,0],[73,4,73,9,0],[74,4,74,5,0],[75,5,75,17,0],[78,3,78,4,0]]);
    </script>
  </body>
</html>