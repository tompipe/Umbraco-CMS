<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Models\Collections\Item.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Reflection;
using System.Runtime.Serialization;
using Umbraco.Core;
using Umbraco.Core.Models.EntityBase;

namespace Umbraco.Tests.Models.Collections
{
    public abstract class Item : IEntity, ICanBeDirty
    {
        private bool _hasIdentity;
        private int? _hash;
        private int _id;
        private Guid _key;

        protected Item()
        {
            _propertyChangedInfo = new Dictionary&lt;string, bool&gt;();
        }

        /// &lt;summary&gt;
        /// Integer Id
        /// &lt;/summary&gt;
        [DataMember]
        public int Id
        {
            get
            {
                return _id;
            }
            set
            {
                _id = value;
                HasIdentity = true;
            }
        }

        /// &lt;summary&gt;
        /// Guid based Id
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;The key is currectly used to store the Unique Id from the 
        /// umbracoNode table, which many of the entities are based on.&lt;/remarks&gt;
        [DataMember]
        public Guid Key
        {
            get
            {
                if (_key == Guid.Empty)
                    return _id.ToGuid();

                return _key;
            }
            set { _key = value; }
        }

        /// &lt;summary&gt;
        /// Gets or sets the Created Date
        /// &lt;/summary&gt;
        [DataMember]
        public DateTime CreateDate { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the Modified Date
        /// &lt;/summary&gt;
        [DataMember]
        public DateTime UpdateDate { get; set; }

        /// &lt;summary&gt;
        /// Gets or sets the WasCancelled flag, which is used to track
        /// whether some action against an entity was cancelled through some event.
        /// This only exists so we have a way to check if an event was cancelled through
        /// the new api, which also needs to take effect in the legacy api.
        /// &lt;/summary&gt;
        [IgnoreDataMember]
        internal bool WasCancelled { get; set; }

        /// &lt;summary&gt;
        /// Property changed event
        /// &lt;/summary&gt;
        public event PropertyChangedEventHandler PropertyChanged;

        /// &lt;summary&gt;
        /// Method to call on a property setter.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;propertyInfo&quot;&gt;The property info.&lt;/param&gt;
        protected virtual void OnPropertyChanged(PropertyInfo propertyInfo)
        {
            _propertyChangedInfo[propertyInfo.Name] = true;

            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(propertyInfo.Name));
            }
        }

        internal virtual void ResetIdentity()
        {
            _hasIdentity = false;
            _id = default(int);
        }

        /// &lt;summary&gt;
        /// Method to call on entity saved when first added
        /// &lt;/summary&gt;
        internal virtual void AddingEntity()
        {
            CreateDate = DateTime.Now;
            UpdateDate = DateTime.Now;
        }

        /// &lt;summary&gt;
        /// Method to call on entity saved/updated
        /// &lt;/summary&gt;
        internal virtual void UpdatingEntity()
        {
            UpdateDate = DateTime.Now;
        }

        /// &lt;summary&gt;
        /// Tracks the properties that have changed
        /// &lt;/summary&gt;
        //private readonly IDictionary&lt;string, bool&gt; _propertyChangedInfo = new Dictionary&lt;string, bool&gt;();
        private IDictionary&lt;string, bool&gt; _propertyChangedInfo;

        /// &lt;summary&gt;
        /// Indicates whether a specific property on the current entity is dirty.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;propertyName&quot;&gt;Name of the property to check&lt;/param&gt;
        /// &lt;returns&gt;True if Property is dirty, otherwise False&lt;/returns&gt;
        public virtual bool IsPropertyDirty(string propertyName)
        {
            return _propertyChangedInfo.Any(x =&gt; x.Key == propertyName);
        }

        /// &lt;summary&gt;
        /// Indicates whether the current entity is dirty.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;True if entity is dirty, otherwise False&lt;/returns&gt;
        public virtual bool IsDirty()
        {
            return _propertyChangedInfo.Any();
        }

        /// &lt;summary&gt;
        /// Resets dirty properties by clearing the dictionary used to track changes.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Please note that resetting the dirty properties could potentially
        /// obstruct the saving of a new or updated entity.
        /// &lt;/remarks&gt;
        public virtual void ResetDirtyProperties()
        {
            _propertyChangedInfo.Clear();
        }

        /// &lt;summary&gt;
        /// Indicates whether the current entity has an identity, eg. Id.
        /// &lt;/summary&gt;
        public virtual bool HasIdentity
        {
            get
            {
                return _hasIdentity;
            }
            protected set
            {
                _hasIdentity = value;
            }
        }

        public static bool operator ==(Item left, Item right)
        {
            /*if (ReferenceEquals(null, left))
                return false;

            if(ReferenceEquals(null, right))
                return false;*/

            return ReferenceEquals(left, right);

            return left.Equals(right);
        }

        public static bool operator !=(Item left, Item right)
        {
            return !(left == right);
        }

        /*public virtual bool SameIdentityAs(IEntity other)
        {
            if (ReferenceEquals(null, other))
                return false;
            if (ReferenceEquals(this, other))
                return true;

            return SameIdentityAs(other as Entity);
        }

        public virtual bool Equals(Entity other)
        {
            if (ReferenceEquals(null, other))
                return false;
            if (ReferenceEquals(this, other))
                return true;

            return SameIdentityAs(other);
        }

        public virtual Type GetRealType()
        {
            return GetType();
        }

        public virtual bool SameIdentityAs(Entity other)
        {
            if (ReferenceEquals(null, other))
                return false;

            if (ReferenceEquals(this, other))
                return true;

            if (GetType() == other.GetRealType() &amp;&amp; HasIdentity &amp;&amp; other.HasIdentity)
                return other.Id.Equals(Id);

            return false;
        }

        public override bool Equals(object obj)
        {
            if (ReferenceEquals(null, obj))
                return false;
            if (ReferenceEquals(this, obj))
                return true;

            return SameIdentityAs(obj as IEntity);
        }

        public override int GetHashCode()
        {
            if (!_hash.HasValue)
                _hash = !HasIdentity ? new int?(base.GetHashCode()) : new int?(Id.GetHashCode() * 397 ^ GetType().GetHashCode());
            return _hash.Value;
        }*/
        
        public object DeepClone()
        {
            return this.MemberwiseClone();
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,25,0],[20,9,20,10,0],[21,13,21,67,0],[22,9,22,10,0],[31,13,31,14,0],[32,17,32,28,0],[33,13,33,14,0],[35,13,35,14,0],[36,17,36,29,0],[37,17,37,36,0],[38,13,38,14,0],[50,13,50,14,0],[51,17,51,40,0],[52,21,52,41,0],[54,17,54,29,0],[55,13,55,14,0],[56,17,56,18,0],[56,19,56,32,0],[56,33,56,34,0],[63,38,63,42,0],[63,43,63,47,0],[69,38,69,42,0],[69,43,69,47,0],[78,38,78,42,0],[78,43,78,47,0],[90,9,90,10,0],[91,13,91,60,0],[93,13,93,41,0],[94,13,94,14,0],[95,17,95,88,0],[96,13,96,14,0],[97,9,97,10,0],[100,9,100,10,0],[101,13,101,34,0],[102,13,102,32,0],[103,9,103,10,0],[109,9,109,10,0],[110,13,110,39,0],[111,13,111,39,0],[112,9,112,10,0],[118,9,118,10,0],[119,13,119,39,0],[120,9,120,10,0],[134,9,134,10,0],[135,13,135,50,0],[135,50,135,71,0],[135,71,135,73,0],[135,13,135,73,0],[136,9,136,10,0],[143,9,143,10,0],[144,13,144,47,0],[145,9,145,10,0],[155,9,155,10,0],[156,13,156,42,0],[157,9,157,10,0],[165,13,165,14,0],[166,17,166,37,0],[167,13,167,14,0],[169,13,169,14,0],[170,17,170,38,0],[171,13,171,14,0],[175,9,175,10,1],[182,13,182,49,1],[185,9,185,10,1],[188,9,188,10,0],[189,13,189,37,0],[190,9,190,10,0],[249,9,249,10,0],[250,13,250,43,0],[251,9,251,10,0]]);
    </script>
  </body>
</html>