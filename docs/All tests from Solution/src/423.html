<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\uQuery\uQuery-PreValues.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic.datatype;
using umbraco.cms.businesslogic.propertytype;
using umbraco.NodeFactory;

namespace umbraco
{
	/// &lt;summary&gt;
	/// Static helper methods
	/// &lt;/summary&gt;
	public static partial class uQuery
	{
		/// &lt;summary&gt;
		/// Makes a new PreValue.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;dataTypeDefinitionId&quot;&gt;The datatype definition id.&lt;/param&gt;
		/// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
		/// &lt;param name=&quot;alias&quot;&gt;The alias.&lt;/param&gt;
		/// &lt;param name=&quot;sortOrder&quot;&gt;The sort order.&lt;/param&gt;
		/// &lt;returns&gt;
		/// The inserted prevalue or null if the operation failed.
		/// &lt;/returns&gt;
		public static PreValue MakeNewPreValue(int dataTypeDefinitionId, string value, string alias = &quot;&quot;, int sortOrder = 0)
		{
		    using (var sqlHelper = Application.SqlHelper)
		    {
		        var result =
		            sqlHelper.ExecuteNonQuery(
		                &quot;INSERT INTO cmsDataTypePreValues (datatypeNodeId, value, alias, sortorder) VALUES (@dtdefid, @value, @alias, @sortorder)&quot;,
		                sqlHelper.CreateParameter(&quot;@dtdefid&quot;, dataTypeDefinitionId),
		                sqlHelper.CreateParameter(&quot;@value&quot;, value),
		                sqlHelper.CreateParameter(&quot;@alias&quot;, alias),
		                sqlHelper.CreateParameter(&quot;@sortorder&quot;, sortOrder));

		        if (result &gt; -1)
		        {
		            return uQuery.GetPreValues(dataTypeDefinitionId).Single(x =&gt; x.Value.Equals(value) &amp;&amp; x.GetAlias().Equals(alias) &amp;&amp; x.SortOrder == sortOrder);
		        }

		        return null;
		    }
		}

		/// &lt;summary&gt;
		/// Gets the prevalues for a specified datatype as a strongly typed list.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;dataTypeDefinitionId&quot;&gt;The datatype definition id.&lt;/param&gt;
		/// &lt;returns&gt;The list of PreValues.&lt;/returns&gt;
		public static PreValue[] GetPreValues(int dataTypeDefinitionId)
		{
			var values = new List&lt;PreValue&gt;();

			foreach (var entry in PreValues.GetPreValues(dataTypeDefinitionId))
			{
				var prevalue = ((DictionaryEntry)entry).Value as PreValue;
				values.Add(prevalue);
			}

			return values.ToArray();
		}

		/// &lt;summary&gt;
		/// Gets the pre values.
		/// TODO: [OA] Document on Codeplex
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;nodeId&quot;&gt;The node id.&lt;/param&gt;
		/// &lt;param name=&quot;propertyAlias&quot;&gt;The property alias.&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static PreValue[] GetPreValues(int nodeId, string propertyAlias)
		{
			var node = new Node(nodeId);
			var xml = node.ToXml();

			if (xml != null &amp;&amp; xml.Attributes != null)
			{
				int nodeType;
				int.TryParse(xml.Attributes[&quot;nodeType&quot;].Value, out nodeType);

				foreach (var property in PropertyType.GetAll().Where(x =&gt; x.ContentTypeId.Equals(nodeType) &amp;&amp; x.Alias.Equals(propertyAlias)))
				{
					var dtd = property.DataTypeDefinition;

					return GetPreValues(dtd.Id);
				}
			}

			return new List&lt;PreValue&gt;().ToArray();
		} 

		/// &lt;summary&gt;
		/// Reorders the prevalue.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;preValueId&quot;&gt;The prevalue id.&lt;/param&gt;
		/// &lt;param name=&quot;sortOrder&quot;&gt;The sort order.&lt;/param&gt;
		/// &lt;returns&gt;&lt;/returns&gt;
		public static bool ReorderPreValue(int preValueId, int sortOrder)
		{
            using (var sqlHelper = Application.SqlHelper) { 
                var result =
				    sqlHelper.ExecuteNonQuery(
					    &quot;UPDATE cmsDataTypePreValues SET sortorder = @sortorder WHERE id = @prevalueid&quot;,
					    sqlHelper.CreateParameter(&quot;@prevalueid&quot;, preValueId),
					    sqlHelper.CreateParameter(&quot;@sortorder&quot;, sortOrder));

			    if (result &gt; 0)
			    {
				    return true;
			    }
            }
			return false;
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[27,3,27,4,0],[28,14,28,51,0],[29,7,29,8,0],[30,11,36,71,0],[38,11,38,27,0],[39,11,39,12,0],[40,15,40,76,0],[40,76,40,155,0],[40,155,40,157,0],[40,15,40,157,0],[43,11,43,23,0],[45,3,45,4,0],[53,3,53,4,0],[54,4,54,38,0],[56,4,56,11,0],[56,13,56,22,0],[56,23,56,25,0],[56,26,56,70,0],[57,4,57,5,0],[58,5,58,63,0],[59,5,59,26,0],[60,4,60,5,0],[62,4,62,28,0],[63,3,63,4,0],[73,3,73,4,0],[74,4,74,32,0],[75,4,75,27,0],[77,4,77,46,0],[78,4,78,5,0],[80,5,80,66,0],[82,5,82,12,0],[82,14,82,26,0],[82,27,82,29,0],[82,30,82,63,0],[82,63,82,128,0],[82,128,82,129,0],[82,30,82,129,0],[83,5,83,6,0],[84,6,84,44,0],[86,6,86,34,0],[88,4,88,5,0],[90,4,90,42,0],[91,3,91,4,0],[100,3,100,4,0],[101,20,101,57,0],[101,59,101,60,0],[102,17,106,62,0],[108,8,108,23,0],[109,8,109,9,0],[110,9,110,21,0],[112,13,112,14,0],[113,4,113,17,0],[114,3,114,4,0]]);
    </script>
  </body>
</html>