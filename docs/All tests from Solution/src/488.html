<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\developer\Xslt\xsltChooseExtension.aspx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;
using System.Text;
using System.Web.UI;
using System.Web.UI.WebControls;
using Umbraco.Core;

namespace umbraco.developer
{
    /// &lt;summary&gt;
    /// Summary description for xsltChooseExtension.
    /// &lt;/summary&gt;
    [WebformsPageTreeAuthorize(Constants.Trees.Xslt)]
	public partial class xsltChooseExtension : BasePages.UmbracoEnsuredPage
	{

		protected void Page_Load(object sender, System.EventArgs e)
		{
            SortedList&lt;string, List&lt;string&gt;&gt; ht = GetXsltAssembliesAndMethods();
			if (!IsPostBack) 
			{
				assemblies.Attributes.Add(&quot;onChange&quot;, &quot;document.forms[0].submit()&quot;);
				foreach(string s in ht.Keys)
					assemblies.Items.Add(new ListItem(s));

				// Select the umbraco extensions as default
				assemblies.Items[0].Selected = true;
			}

			string selectedMethod = &quot;&quot;;
			if (methods.SelectedValue != &quot;&quot;) 
			{
				selectedMethod = methods.SelectedValue;
				PlaceHolderParamters.Controls.Clear();
				PlaceHolderParamters.Controls.Add(new LiteralControl(&quot;&lt;div class=&#39;code&#39;&gt;&quot; + assemblies.SelectedItem + &quot;:&quot; + methods.SelectedValue.Substring(0, methods.SelectedValue.IndexOf(&quot;(&quot;)) + &quot;(&quot;));
                PlaceHolderParamters.Controls.Add(new LiteralControl(&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;selectedMethod\&quot; id=\&quot;selectedMethod\&quot; value=\&quot;&quot; + methods.SelectedValue.Substring(0, methods.SelectedValue.IndexOf(&quot;(&quot;)) + &quot;\&quot;/&gt;&quot;));

				int counter = 0;
                string[] props = methods.SelectedValue.Substring(methods.SelectedValue.IndexOf(&quot;(&quot;) + 1, methods.SelectedValue.IndexOf(&quot;)&quot;) - methods.SelectedValue.IndexOf(&quot;(&quot;) - 1).Split(&#39;,&#39;);               
                
                foreach (string s in props) 
				{
					if (s.Trim() != &quot;&quot;) 
					{
						counter++;
						TextBox t = new TextBox();
						t.ID = &quot;param&quot; + Guid.NewGuid().ToString();
						t.Text = s.Trim();
						t.TabIndex = (short) counter;
						t.Attributes.Add(&quot;onFocus&quot;, &quot;if (this.value == &#39;&quot; + s.Trim() + &quot;&#39;) this.value = &#39;&#39;;&quot;);
						t.Attributes.Add(&quot;onBlur&quot;, &quot;if (this.value == &#39;&#39;) this.value = &#39;&quot; + s.Trim() + &quot;&#39;&quot;);
						t.Attributes.Add(&quot;style&quot;, &quot;width:80px;&quot;);
						PlaceHolderParamters.Controls.Add(t);

                        if(counter &lt; props.Length)
                            PlaceHolderParamters.Controls.Add(new LiteralControl(&quot;,&quot;));
					}
				}

				counter++;

				//PlaceHolderParamters.Controls.Add(new LiteralControl(&quot;)&lt;/div&gt; &lt;br/&gt;&lt;input type=\&quot;button\&quot; style=\&quot;font-size: XX-Small\&quot; tabIndex=\&quot;&quot; + counter.ToString() + &quot;\&quot; value=\&quot;Insert\&quot; onClick=\&quot;returnResult();\&quot;/&gt;&quot;));
                PlaceHolderParamters.Controls.Add(new LiteralControl(&quot;)&lt;/div&gt;&quot;));
                bt_insert.Enabled = true;
			} 
			else
				PlaceHolderParamters.Controls.Clear();


			if (assemblies.SelectedValue != &quot;&quot;) 
			{
				methods.Items.Clear();
				methods.Items.Add(new ListItem(&quot;Choose method&quot;, &quot;&quot;));
				methods.Attributes.Add(&quot;onChange&quot;, &quot;document.forms[0].submit()&quot;);
				List&lt;string&gt; methodList = ht[assemblies.SelectedValue];
                foreach (string method in methodList)
				{
					ListItem li = new ListItem(method);
                    if (method == selectedMethod)
						li.Selected = true;
					methods.Items.Add(li);
				}
			}
		}

        /// &lt;summary&gt;
        /// Gets the XSLT assemblies and their methods.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;A list of assembly names linked to a list of method signatures.&lt;/returns&gt;
        private SortedList&lt;string, List&lt;string&gt;&gt; GetXsltAssembliesAndMethods() 
		{
            SortedList&lt;string, List&lt;string&gt;&gt; _tempAssemblies = new SortedList&lt;string, List&lt;string&gt;&gt;();

            // add all extensions definied by macro
            foreach(KeyValuePair&lt;string, object&gt; extension in macro.GetXsltExtensions())
                _tempAssemblies.Add(extension.Key, GetStaticMethods(extension.Value.GetType()));

            // add the Umbraco library (not included in macro extensions)
            _tempAssemblies.Add(&quot;umbraco.library&quot;, GetStaticMethods(typeof(umbraco.library)));

			return _tempAssemblies;

		}

        /// &lt;summary&gt;
        /// Gets the static methods of the specified type, alphabetically sorted.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;type&quot;&gt;The type.&lt;/param&gt;
        /// &lt;returns&gt;A sortd list with method signatures.&lt;/returns&gt;
        private List&lt;string&gt; GetStaticMethods(Type type)
        {
            List&lt;string&gt; methods = new List&lt;string&gt;();
            foreach (MethodInfo method in type.GetMethods())
            {
                if (method.IsStatic)
                {
                    // add method name to signature
                    StringBuilder methodSignature = new StringBuilder(method.Name);

                    // add parameters to signature
                    methodSignature.Append(&#39;(&#39;);
                    ParameterInfo[] parameters = method.GetParameters();
                    for(int i=0; i&lt;parameters.Length; i++)
                    {
                        ParameterInfo parameter = parameters[i];
                        methodSignature.Append(i == 0 ? String.Empty : &quot;, &quot;)
                                       .Append(parameter.ParameterType.Name)
                                       .Append(&#39; &#39;)
                                       .Append(parameter.Name);
                    }
                    methodSignature.Append(&#39;)&#39;);

                    // add method signature to list
                    methods.Add(methodSignature.ToString());
                }
            }
            methods.Sort();
            return methods;
        }
	

		#region Web Form Designer generated code
		override protected void OnInit(EventArgs e)
		{
			//
			// CODEGEN: This call is required by the ASP.NET Web Form Designer.
			//
			InitializeComponent();
			base.OnInit(e);
		}
		
		/// &lt;summary&gt;
		/// Required method for Designer support - do not modify
		/// the contents of this method with the code editor.
		/// &lt;/summary&gt;
		private void InitializeComponent()
		{    
		}
		#endregion
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[20,3,20,4,0],[21,13,21,81,0],[22,4,22,20,0],[23,4,23,5,0],[24,5,24,73,0],[25,5,25,12,0],[25,13,25,21,0],[25,22,25,24,0],[25,25,25,32,0],[26,6,26,44,0],[29,5,29,41,0],[30,4,30,5,0],[32,4,32,31,0],[33,4,33,36,0],[34,4,34,5,0],[35,5,35,44,0],[36,5,36,43,0],[37,5,37,192,0],[38,17,38,234,0],[40,5,40,21,0],[41,17,41,194,0],[43,17,43,24,0],[43,26,43,34,0],[43,35,43,37,0],[43,38,43,43,0],[44,5,44,6,0],[45,6,45,25,0],[46,6,46,7,0],[47,7,47,17,0],[48,7,48,33,0],[49,7,49,50,0],[50,7,50,25,0],[51,7,51,36,0],[52,7,52,93,0],[53,7,53,91,0],[54,7,54,48,0],[55,7,55,44,0],[57,25,57,51,0],[58,29,58,88,0],[59,6,59,7,0],[60,5,60,6,0],[62,5,62,15,0],[65,17,65,82,0],[66,17,66,42,0],[67,4,67,5,0],[69,5,69,43,0],[72,4,72,39,0],[73,4,73,5,0],[74,5,74,27,0],[75,5,75,58,0],[76,5,76,70,0],[77,5,77,60,0],[78,17,78,24,0],[78,26,78,39,0],[78,40,78,42,0],[78,43,78,53,0],[79,5,79,6,0],[80,6,80,41,0],[81,21,81,50,0],[82,7,82,26,0],[83,6,83,28,0],[84,5,84,6,0],[85,4,85,5,0],[86,3,86,4,0],[93,3,93,4,0],[94,13,94,103,0],[97,13,97,20,0],[97,21,97,59,0],[97,60,97,62,0],[97,63,97,88,0],[98,17,98,97,0],[101,13,101,95,0],[103,4,103,27,0],[105,3,105,4,0],[113,9,113,10,0],[114,13,114,55,0],[115,13,115,20,0],[115,22,115,39,0],[115,40,115,42,0],[115,43,115,60,0],[116,13,116,14,0],[117,17,117,37,0],[118,17,118,18,0],[120,21,120,84,0],[123,21,123,49,0],[124,21,124,73,0],[125,25,125,32,0],[125,34,125,53,0],[125,55,125,58,0],[126,21,126,22,0],[127,25,127,65,0],[128,25,131,64,0],[132,21,132,22,0],[133,21,133,49,0],[136,21,136,61,0],[137,17,137,18,0],[138,13,138,14,0],[139,13,139,28,0],[140,13,140,28,0],[141,9,141,10,0],[146,3,146,4,0],[150,4,150,26,0],[151,4,151,19,0],[152,3,152,4,0],[159,3,159,4,0],[160,3,160,4,0]]);
    </script>
  </body>
</html>