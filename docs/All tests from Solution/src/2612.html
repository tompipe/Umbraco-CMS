<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\listbox\dropdownMultiple.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.ComponentModel;
using System.Collections;
using System.Collections.Generic;

namespace umbraco.editorControls
{
	/// &lt;summary&gt;
	/// Summary description for dropdownMultiple.
	/// &lt;/summary&gt;
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
	public class dropdownMultiple : System.Web.UI.WebControls.ListBox, interfaces.IDataEditor	
	{
		private String _text;

		interfaces.IData _data;
		SortedList _prevalues;
		public dropdownMultiple(interfaces.IData Data,SortedList Prevalues)
		{
			_data = Data;
			_prevalues = Prevalues;
		}

        List&lt;KeyValuePair&lt;int, String&gt;&gt; Prevalues;
        public dropdownMultiple(interfaces.IData Data, List&lt;KeyValuePair&lt;int, String&gt;&gt; Prevalues)
        {
            _data = Data;
            this.Prevalues = Prevalues;
        }

		public Control Editor { get {return this;}}

		public virtual bool TreatAsRichTextEditor 
		{
			get {return false;}
		}
		public virtual bool ShowLabel 
		{
			get {return true;}
		}

		//public override String Text 
		//{
		//     get {
				
		//          return _data.Value.ToString();
			
		//     }
		//     set {_text = value;}
		//}

		public void Save() 
		{
				_text = &quot;&quot;;
				foreach(ListItem li in base.Items) 
				{
					if (li.Selected) 
					{
						_text += li.Value + &quot;,&quot;;
					}
				}

				if (_text.Length &gt; 0)
					_text = _text.Substring(0, _text.Length-1);
				_data.Value = _text;
			
			
		}

		protected override void OnInit(EventArgs e)
		{
			base.SelectionMode = System.Web.UI.WebControls.ListSelectionMode.Multiple;
			
			if (_data != null &amp;&amp; _data.Value != null)
				_text = _data.Value.ToString();

			base.OnInit(e);

            if (_prevalues != null)
            {
                foreach (object key in _prevalues.Keys)
                {
                    ListItem li = new ListItem(_prevalues[key].ToString(), key.ToString());

                    if ((&quot;,&quot; + _text + &quot;,&quot;).IndexOf(&quot;,&quot; + li.Value.ToString() + &quot;,&quot;) &gt; -1)
                        li.Selected = true;

                    Items.Add(li);
                }
            }
            else if (Prevalues != null)
            {
                foreach (KeyValuePair&lt;int, String&gt; item in Prevalues)
                {
                    ListItem li = new ListItem(item.Value, item.Key.ToString());

                    if ((&quot;,&quot; + _text + &quot;,&quot;).IndexOf(&quot;,&quot; + li.Value.ToString() + &quot;,&quot;) &gt; -1)
                        li.Selected = true;

                    Items.Add(li);
                }
            }
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[20,3,20,70,0],[21,3,21,4,0],[22,4,22,17,0],[23,4,23,27,0],[24,3,24,4,0],[27,9,27,98,0],[28,9,28,10,0],[29,13,29,26,0],[30,13,30,40,0],[31,9,31,10,0],[33,31,33,32,0],[33,32,33,44,0],[33,44,33,45,0],[37,8,37,9,0],[37,9,37,22,0],[37,22,37,23,0],[41,8,41,9,0],[41,9,41,21,0],[41,21,41,22,0],[55,3,55,4,0],[56,5,56,16,0],[57,5,57,12,0],[57,13,57,24,0],[57,25,57,27,0],[57,28,57,38,0],[58,5,58,6,0],[59,6,59,22,0],[60,6,60,7,0],[61,7,61,31,0],[62,6,62,7,0],[63,5,63,6,0],[65,5,65,26,0],[66,6,66,49,0],[67,5,67,25,0],[70,3,70,4,0],[73,3,73,4,0],[74,4,74,78,0],[76,4,76,45,0],[77,5,77,36,0],[79,4,79,19,0],[81,13,81,36,0],[82,13,82,14,0],[83,17,83,24,0],[83,26,83,36,0],[83,37,83,39,0],[83,40,83,55,0],[84,17,84,18,0],[85,21,85,92,0],[87,21,87,91,0],[88,25,88,44,0],[90,21,90,35,0],[91,17,91,18,0],[92,13,92,14,0],[93,18,93,40,0],[94,13,94,14,0],[95,17,95,24,0],[95,26,95,56,0],[95,57,95,59,0],[95,60,95,69,0],[96,17,96,18,0],[97,21,97,81,0],[99,21,99,91,0],[100,25,100,44,0],[102,21,102,35,0],[103,17,103,18,0],[104,13,104,14,0],[105,3,105,4,0]]);
    </script>
  </body>
</html>