<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\UmbracoExamine\EventsTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using Examine;
using Lucene.Net.Analysis.Standard;
using Lucene.Net.Index;
using Lucene.Net.Store;
using NUnit.Framework;
using Umbraco.Tests.TestHelpers;
using UmbracoExamine;

namespace Umbraco.Tests.UmbracoExamine
{
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerTest)]
    [TestFixture]
	public class EventsTest : ExamineBaseTest
	{
		[Test]
		public void Events_Ignoring_Node()
		{
            using (var luceneDir = new RandomIdRAMDirectory())
            using (var writer = new IndexWriter(luceneDir, new StandardAnalyzer(Lucene.Net.Util.Version.LUCENE_29), IndexWriter.MaxFieldLength.LIMITED))
            using (var indexer = IndexInitializer.GetUmbracoIndexer(writer))
		    using (var searcher = IndexInitializer.GetUmbracoSearcher(writer))
		    {
                //change the parent id so that they are all ignored
                var existingCriteria = indexer.IndexerData;
                indexer.IndexerData = new IndexCriteria(existingCriteria.StandardFields, existingCriteria.UserFields, existingCriteria.IncludeNodeTypes, existingCriteria.ExcludeNodeTypes,
                    999); //change to 999

                var isIgnored = false;

                EventHandler&lt;IndexingNodeDataEventArgs&gt; ignoringNode = (s, e) =&gt;
                {
                    isIgnored = true;
                };

                indexer.IgnoringNode += ignoringNode;

                //get a node from the data repo
                var node = _contentService.GetPublishedContentByXPath(&quot;//*[string-length(@id)&gt;0 and number(@id)&gt;0]&quot;)
                                          .Root
                                          .Elements()
                                          .First();

                indexer.ReIndexNode(node, IndexTypes.Content);


                Assert.IsTrue(isIgnored);
            }
		}

		private readonly TestContentService _contentService = new TestContentService();
        
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,3,19,4,1],[20,20,20,62,1],[21,20,21,152,1],[22,20,22,76,1],[23,14,23,72,1],[24,7,24,8,1],[26,17,26,60,1],[27,17,28,26,1],[30,17,30,39,1],[32,17,33,17,1],[33,17,33,18,1],[33,18,34,21,1],[34,21,34,38,1],[34,38,35,17,1],[35,17,35,18,1],[35,18,35,19,1],[32,17,35,19,1],[37,17,37,54,1],[40,17,43,52,1],[45,17,45,63,1],[48,17,48,42,1],[49,13,49,14,1],[50,3,50,4,1],[52,3,52,82,1]]);
    </script>
  </body>
</html>