<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\uQuery\RelationTypeExtensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic.relation;

namespace umbraco
{
	/// &lt;summary&gt;
	/// uQuery extensions for the RelationType object.
	/// &lt;/summary&gt;
	public static class RelationTypeExtensions
	{
		/// &lt;summary&gt;
		/// Extension method to return the Parent UmbracoObjectType
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;returns&gt;an UmbracoObjectType value&lt;/returns&gt;
		public static uQuery.UmbracoObjectType GetParentUmbracoObjectType(this RelationType relationType)
		{
		    using (var sqlHelper = Application.SqlHelper)
		    {
		        var guid = sqlHelper.ExecuteScalar&lt;Guid&gt;(
		            string.Concat(&quot;SELECT parentObjectType FROM umbracoRelationType WHERE id = &quot;, relationType.Id));
		        return uQuery.GetUmbracoObjectType(guid);
		    }
		}

		/// &lt;summary&gt;
		/// Extension method to return the Child UmbracoObjectType
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;returns&gt;an UmbracoObjectType value&lt;/returns&gt;
		public static uQuery.UmbracoObjectType GetChildUmbracoObjectType(this RelationType relationType)
		{
		    using (var sqlHelper = Application.SqlHelper)
		    {
		        var guid = sqlHelper.ExecuteScalar&lt;Guid&gt;(
		            string.Concat(&quot;SELECT childObjectType FROM umbracoRelationType WHERE id = &quot;, relationType.Id));
		        return uQuery.GetUmbracoObjectType(guid);
		    }
		}

		/// &lt;summary&gt;
		/// Creates a new relation for this relation type - also performs objectype validation
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;param name=&quot;parentId&quot;&gt;parentId of relation&lt;/param&gt;
		/// &lt;param name=&quot;childId&quot;&gt;child Id of relation&lt;/param&gt;
		public static void CreateRelation(this RelationType relationType, int parentId, int childId)
		{
			if ((uQuery.GetUmbracoObjectType(parentId) == relationType.GetParentUmbracoObjectType()) &amp;&amp;
			   (uQuery.GetUmbracoObjectType(childId) == relationType.GetChildUmbracoObjectType()))
			{
				Relation.MakeNew(parentId, childId, relationType, string.Empty);
			}
		}

		/// &lt;summary&gt;
		/// Determines whether the specified id exists as a relation for the current relation type
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;Type of the relation.&lt;/param&gt;
		/// &lt;param name=&quot;id&quot;&gt;The id.&lt;/param&gt;
		/// &lt;returns&gt;
		///   &lt;c&gt;true&lt;/c&gt; if the specified relation type has relations; otherwise, &lt;c&gt;false&lt;/c&gt;.
		/// &lt;/returns&gt;
		public static bool HasRelations(this RelationType relationType, int id)
		{
			if (Relation.GetRelations(id, relationType).Count() &gt; 0)
			{
				return true;
			}
			else
			{
				return false;
			}
		}

		/// &lt;summary&gt;
		/// Wrapper for Relation.IsRelated(int, int, RelationType)
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;param name=&quot;parentId&quot;&gt;parentId to test&lt;/param&gt;
		/// &lt;param name=&quot;childId&quot;&gt;childId to test&lt;/param&gt;
		public static bool IsRelated(this RelationType relationType, int parentId, int childId)
		{
			return Relation.IsRelated(parentId, childId, relationType);
		}

		/// &lt;summary&gt;
		/// Extension method to get a relation from it&#39;s parent and child Ids
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;param name=&quot;parentId&quot;&gt;parentId of relation&lt;/param&gt;
		/// &lt;param name=&quot;childId&quot;&gt;child Id of relation&lt;/param&gt;
		/// &lt;returns&gt;null or the Relation matching supplied parentId and childId&lt;/returns&gt;
		public static Relation GetRelation(this RelationType relationType, int parentId, int childId)
		{
			return Relation.GetRelations(parentId, relationType).Where(relation =&gt; relation.Child.Id == childId).First();
		}

		/// &lt;summary&gt;
		/// Gets the relations for the supplied id (wrapper for Relation.GetRelations)
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;param name=&quot;id&quot;&gt;the id&lt;/param&gt;
		/// &lt;returns&gt;relations for the id&lt;/returns&gt;
		public static Relation[] GetRelations(this RelationType relationType, int id)
		{
			return Relation.GetRelations(id, relationType);
		}

		/// &lt;summary&gt;
		/// Extension method to delete a relation, found by it&#39;s parent and child Ids
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;param name=&quot;parentId&quot;&gt;parent id of relation to delete&lt;/param&gt;
		/// &lt;param name=&quot;childId&quot;&gt;child id of relation to delte&lt;/param&gt;
		public static void DeleteRelation(this RelationType relationType, int parentId, int childId)
		{
			var relation = relationType.GetRelation(parentId, childId);
			if (relation != null)
			{
				relation.Delete();
			}
		}

		/// &lt;summary&gt;
		/// Wipes all relations associated with the id supplied in this relation type
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;relationType&quot;&gt;an instance of umbraco.cms.businesslogic.relation.RelationType&lt;/param&gt;
		/// &lt;param name=&quot;id&quot;&gt;key id to wipe&lt;/param&gt;
		public static void ClearRelations(this RelationType relationType, int id)
		{
			foreach (var relation in Relation.GetRelations(id, relationType))
			{
				relation.Delete();
			}
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,3,19,4,0],[20,14,20,51,0],[21,7,21,8,0],[22,11,23,111,0],[24,11,24,52,0],[26,3,26,4,0],[34,3,34,4,0],[35,14,35,51,0],[36,7,36,8,0],[37,11,38,110,0],[39,11,39,52,0],[41,3,41,4,0],[50,3,50,4,0],[51,4,52,90,0],[53,4,53,5,0],[54,5,54,69,0],[55,4,55,5,0],[56,3,56,4,0],[67,3,67,4,0],[68,4,68,60,0],[69,4,69,5,0],[70,5,70,17,0],[73,4,73,5,0],[74,5,74,18,0],[76,3,76,4,0],[85,3,85,4,0],[86,4,86,63,0],[87,3,87,4,0],[97,3,97,4,0],[98,4,98,75,0],[98,75,98,103,0],[98,103,98,113,0],[98,4,98,113,0],[99,3,99,4,0],[108,3,108,4,0],[109,4,109,51,0],[110,3,110,4,0],[119,3,119,4,0],[120,4,120,63,0],[121,4,121,25,0],[122,4,122,5,0],[123,5,123,23,0],[124,4,124,5,0],[125,3,125,4,0],[133,3,133,4,0],[134,4,134,11,0],[134,13,134,25,0],[134,26,134,28,0],[134,29,134,68,0],[135,4,135,5,0],[136,5,136,23,0],[137,4,137,5,0],[138,3,138,4,0]]);
    </script>
  </body>
</html>