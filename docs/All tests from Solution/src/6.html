<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\MockTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Web;
using System.Web.Security;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Configuration.UmbracoSettings;
using Umbraco.Core.Logging;
using Umbraco.Core.Dictionary;
using Umbraco.Core.Models;
using Umbraco.Core.Persistence;
using Umbraco.Core.Persistence.SqlSyntax;
using Umbraco.Core.Persistence.UnitOfWork;
using Umbraco.Core.Profiling;
using Umbraco.Core.Services;
using Moq;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web;
using Umbraco.Web.Routing;
using Umbraco.Web.Security;

namespace Umbraco.Tests
{
    [TestFixture]
    public class MockTests
    {

        [Test]
        public void Can_Create_Empty_App_Context()
        {
            var appCtx = new ApplicationContext(
               CacheHelper.CreateDisabledCacheHelper(),
               new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));
            Assert.Pass();
        }

        [Test]
        public void Can_Create_Service_Context()
        {
            var svcCtx = MockHelper.GetMockedServiceContext();
            Assert.Pass();
        }

        [Test]
        public void Can_Create_Db_Context()
        {
            var dbCtx = new DatabaseContext(new Mock&lt;IDatabaseFactory&gt;().Object, Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;ISqlSyntaxProvider&gt;(), &quot;test&quot;);
            Assert.Pass();
        }

        [Test]
        public void Can_Create_App_Context_With_Services()
        {
            var appCtx = new ApplicationContext(
                new DatabaseContext(new Mock&lt;IDatabaseFactory&gt;().Object, Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;ISqlSyntaxProvider&gt;(), &quot;test&quot;),
                MockHelper.GetMockedServiceContext(),
                CacheHelper.CreateDisabledCacheHelper(),
                new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));
            
            Assert.Pass();
        }
        
        [Test]
        public void Can_Assign_App_Context_Singleton()
        {
            var appCtx = new ApplicationContext(
                CacheHelper.CreateDisabledCacheHelper(),
                new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));
            var result = ApplicationContext.EnsureContext(appCtx, true);
            Assert.AreEqual(appCtx, result);
        }

        [Test]
        public void Does_Not_Overwrite_App_Context_Singleton()
        {
            ApplicationContext.EnsureContext(
                new ApplicationContext(
                    CacheHelper.CreateDisabledCacheHelper(), 
                    new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;())), true);

            var appCtx = new ApplicationContext(
               CacheHelper.CreateDisabledCacheHelper(),
               new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));
            var result = ApplicationContext.EnsureContext(appCtx, false);
            Assert.AreNotEqual(appCtx, result);
        }

        [Test]
        public void Can_Get_Umbraco_Context()
        {
            var appCtx = new ApplicationContext(
               CacheHelper.CreateDisabledCacheHelper(),
               new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));
            
            var umbCtx = UmbracoContext.EnsureContext(
                Mock.Of&lt;HttpContextBase&gt;(),
                appCtx,
                new Mock&lt;WebSecurity&gt;(null, null).Object,
                Mock.Of&lt;IUmbracoSettingsSection&gt;(),
                Enumerable.Empty&lt;IUrlProvider&gt;(),
                true);
            
            Assert.AreEqual(umbCtx, UmbracoContext.Current);
        }

        [Test]
        public void Can_Mock_Umbraco_Helper()
        {
            var appCtx = new ApplicationContext(
               CacheHelper.CreateDisabledCacheHelper(),
               new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));

            var umbCtx = UmbracoContext.EnsureContext(
                Mock.Of&lt;HttpContextBase&gt;(),
                appCtx,
                new Mock&lt;WebSecurity&gt;(null, null).Object,
                Mock.Of&lt;IUmbracoSettingsSection&gt;(),
                Enumerable.Empty&lt;IUrlProvider&gt;(),
                true);

            var helper = new UmbracoHelper(umbCtx,
                Mock.Of&lt;IPublishedContent&gt;(),
                Mock.Of&lt;ITypedPublishedContentQuery&gt;(),
                Mock.Of&lt;IDynamicPublishedContentQuery&gt;(),
                Mock.Of&lt;ITagQuery&gt;(),
                Mock.Of&lt;IDataTypeService&gt;(),
                new UrlProvider(umbCtx, new[] {Mock.Of&lt;IUrlProvider&gt;()}, UrlProviderMode.Auto), Mock.Of&lt;ICultureDictionary&gt;(),
                Mock.Of&lt;IUmbracoComponentRenderer&gt;(),
                new MembershipHelper(umbCtx, Mock.Of&lt;MembershipProvider&gt;(), Mock.Of&lt;RoleProvider&gt;()));

            Assert.Pass();
        }

        [Test]
        public void Can_Mock_Umbraco_Helper_Get_Url()
        {
            var appCtx = new ApplicationContext(
               CacheHelper.CreateDisabledCacheHelper(),
               new ProfilingLogger(Mock.Of&lt;ILogger&gt;(), Mock.Of&lt;IProfiler&gt;()));
            
            var umbCtx = UmbracoContext.EnsureContext(
                Mock.Of&lt;HttpContextBase&gt;(),
                appCtx,
                new Mock&lt;WebSecurity&gt;(null, null).Object,
                Mock.Of&lt;IUmbracoSettingsSection&gt;(),
                Enumerable.Empty&lt;IUrlProvider&gt;(),
                true);

            var urlHelper = new Mock&lt;IUrlProvider&gt;();
            urlHelper.Setup(provider =&gt; provider.GetUrl(It.IsAny&lt;UmbracoContext&gt;(), It.IsAny&lt;int&gt;(), It.IsAny&lt;Uri&gt;(), It.IsAny&lt;UrlProviderMode&gt;()))
                .Returns(&quot;/hello/world/1234&quot;);

            var helper = new UmbracoHelper(umbCtx,
                Mock.Of&lt;IPublishedContent&gt;(),
                Mock.Of&lt;ITypedPublishedContentQuery&gt;(),
                Mock.Of&lt;IDynamicPublishedContentQuery&gt;(),
                Mock.Of&lt;ITagQuery&gt;(),
                Mock.Of&lt;IDataTypeService&gt;(),
                new UrlProvider(umbCtx, new[]
                {
                    urlHelper.Object
                }, UrlProviderMode.Auto), Mock.Of&lt;ICultureDictionary&gt;(),
                Mock.Of&lt;IUmbracoComponentRenderer&gt;(),
                new MembershipHelper(umbCtx, Mock.Of&lt;MembershipProvider&gt;(), Mock.Of&lt;RoleProvider&gt;()));

            Assert.AreEqual(&quot;/hello/world/1234&quot;, helper.Url(1234));
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[32,9,32,10,1],[33,13,35,79,1],[36,13,36,27,1],[37,9,37,10,0],[41,9,41,10,1],[42,13,42,63,1],[43,13,43,27,1],[44,9,44,10,0],[48,9,48,10,1],[49,13,49,141,1],[50,13,50,27,1],[51,9,51,10,0],[55,9,55,10,1],[56,13,60,80,1],[62,13,62,27,1],[63,9,63,10,0],[67,9,67,10,1],[68,13,70,80,1],[71,13,71,73,1],[72,13,72,45,1],[73,9,73,10,1],[77,9,77,10,1],[78,13,81,91,1],[83,13,85,79,1],[86,13,86,74,1],[87,13,87,48,1],[88,9,88,10,1],[92,9,92,10,1],[93,13,95,79,1],[97,13,103,23,1],[105,13,105,61,1],[106,9,106,10,1],[110,9,110,10,1],[111,13,113,79,1],[115,13,121,23,1],[123,13,131,103,1],[133,13,133,27,1],[134,9,134,10,0],[138,9,138,10,1],[139,13,141,79,1],[143,13,149,23,1],[151,13,151,54,1],[152,13,153,47,1],[155,13,166,103,1],[168,13,168,68,1],[169,9,169,10,1]]);
    </script>
  </body>
</html>