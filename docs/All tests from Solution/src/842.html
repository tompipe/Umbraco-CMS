<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Strategies\NotificationsHandler.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using Umbraco.Core;
using Umbraco.Core.Configuration;
using Umbraco.Core.Models.EntityBase;
using Umbraco.Core.Services;
using umbraco;
using umbraco.BusinessLogic.Actions;
using Umbraco.Core.Models;

namespace Umbraco.Web.Strategies
{
    /// &lt;summary&gt;
    /// Subscribes to the relavent events in order to send out notifications
    /// &lt;/summary&gt;
    public sealed class NotificationsHandler : ApplicationEventHandler
    {

        protected override void ApplicationStarted(UmbracoApplicationBase umbracoApplication, ApplicationContext applicationContext)
        {
            base.ApplicationStarted(umbracoApplication, applicationContext);

            ContentService.SentToPublish += (sender, args) =&gt;
                applicationContext.Services.NotificationService.SendNotification(
                    args.Entity, ActionToPublish.Instance, applicationContext);

            //Send notifications for the published action
            ContentService.Published += (sender, args) =&gt;
                                        args.PublishedEntities.ForEach(
                                            content =&gt;
                                            applicationContext.Services.NotificationService.SendNotification(
                                                content, ActionPublish.Instance, applicationContext));

            //Send notifications for the update and created actions
            ContentService.Saved += (sender, args) =&gt;
                {
                    var newEntities = new List&lt;IContent&gt;();
                    var updatedEntities =  new List&lt;IContent&gt;();

                    //need to determine if this is updating or if it is new
                    foreach (var entity in args.SavedEntities)
                    {
                        var dirty = (IRememberBeingDirty) entity;
                        if (dirty.WasPropertyDirty(&quot;Id&quot;))
                        {
                            //it&#39;s new
                            newEntities.Add(entity);
                        }
                        else
                        {
                            //it&#39;s updating
                            updatedEntities.Add(entity);
                        }
                    }
                    applicationContext.Services.NotificationService.SendNotification(newEntities, ActionNew.Instance, applicationContext);
                    applicationContext.Services.NotificationService.SendNotification(updatedEntities, ActionUpdate.Instance, applicationContext);
                };

            //Send notifications for the delete action
            ContentService.Deleted += (sender, args) =&gt;
                                      args.DeletedEntities.ForEach(
                                          content =&gt;
                                          applicationContext.Services.NotificationService.SendNotification(
                                              content, ActionDelete.Instance, applicationContext));
           
            //Send notifications for the unpublish action
            ContentService.UnPublished += (sender, args) =&gt;
                                          args.PublishedEntities.ForEach(
                                              content =&gt;
                                              applicationContext.Services.NotificationService.SendNotification(
                                                  content, ActionUnPublish.Instance, applicationContext));

        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,0],[24,13,24,77,0],[26,13,27,17,0],[27,17,28,79,0],[28,79,28,80,0],[26,13,28,80,0],[31,13,32,41,0],[32,41,34,45,0],[34,45,35,101,0],[35,101,35,102,0],[32,41,35,102,0],[35,102,35,103,0],[31,13,35,103,0],[38,13,39,17,0],[39,17,39,18,0],[39,18,40,21,0],[40,21,40,60,0],[40,60,41,21,0],[41,21,41,65,0],[41,65,44,21,0],[44,21,44,28,0],[44,28,44,30,0],[44,30,44,40,0],[44,40,44,41,0],[44,41,44,43,0],[44,43,44,44,0],[44,44,44,62,0],[44,62,45,21,0],[45,21,45,22,0],[45,22,46,25,0],[46,25,46,66,0],[46,66,47,25,0],[47,25,47,58,0],[47,58,48,25,0],[48,25,48,26,0],[48,26,50,29,0],[50,29,50,53,0],[50,53,51,25,0],[51,25,51,26,0],[51,26,53,25,0],[53,25,53,26,0],[53,26,55,29,0],[55,29,55,57,0],[55,57,56,25,0],[56,25,56,26,0],[56,26,57,21,0],[57,21,57,22,0],[57,22,58,21,0],[58,21,58,139,0],[58,139,59,21,0],[59,21,59,146,0],[59,146,60,17,0],[60,17,60,18,0],[60,18,60,19,0],[38,13,60,19,0],[63,13,64,39,0],[64,39,66,43,0],[66,43,67,98,0],[67,98,67,99,0],[64,39,67,99,0],[67,99,67,100,0],[63,13,67,100,0],[70,13,71,43,0],[71,43,73,47,0],[73,47,74,105,0],[74,105,74,106,0],[71,43,74,106,0],[74,106,74,107,0],[70,13,74,107,0],[76,9,76,10,0]]);
    </script>
  </body>
</html>