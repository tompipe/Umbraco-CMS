<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.cms\businesslogic\datatype\BaseDataType.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;

using umbraco.DataLayer;
using umbraco.BusinessLogic;
using System.Collections.Generic;


namespace umbraco.cms.businesslogic.datatype
{
    [Obsolete(&quot;This class is no longer used and will be removed from the codebase in the future.&quot;)]
	public abstract class BaseDataType
	{
		private int _datatypedefinitionid;
		private string _datafield = &quot;&quot;;
		private DBTypes _DBType;
        
		public BaseDataType()
		{}

		#region IDataType Members
		public abstract  Guid Id {get;}
		public abstract string DataTypeName{get;}
		public abstract interfaces.IDataEditor DataEditor{get;}
		public abstract interfaces.IDataPrevalue PrevalueEditor {get;}
		public abstract interfaces.IData Data{get;}
		
		public int DataTypeDefinitionId {
			set {
				_datatypedefinitionid = value;
			}
			get {
			return _datatypedefinitionid;
			}
		}

		public DBTypes DBType {
			get {
				string test= &quot;&quot;;
				if (_datafield == &quot;&quot;)
					test = DataFieldName;
				return _DBType;
			}
			set {
				_DBType = value;
                using (var sqlHelper = Application.SqlHelper)
                    sqlHelper.ExecuteNonQuery(&quot;update cmsDataType set  dbType = &#39;&quot; + value.ToString() + &quot;&#39; where nodeId = @datadefinitionid&quot;, sqlHelper.CreateParameter(&quot;@datadefinitionid&quot;,_datatypedefinitionid));
			}
		}
		// Umbraco legacy - get the datafield - the columnname of the cmsPropertyData table
		// where to find the data, since it&#39;s configurable - there is no way of telling if
		// its a bit, nvarchar, ntext or datetime field.
		// get it by lookup the value associated to the datatypedefinition id.
		public string DataFieldName 
		{
            get
            {
                if (_datafield == &quot;&quot;)
                {
                    using (var sqlHelper = Application.SqlHelper)
                    { 
                        string dbtypestr = sqlHelper.ExecuteScalar&lt;string&gt;(&quot;select dbType from cmsDataType where nodeId = @datadefinitionid&quot;, sqlHelper.CreateParameter(&quot;@datadefinitionid&quot;, _datatypedefinitionid));
                        DBTypes DataTypeSQLType = GetDBType(dbtypestr);
                        _DBType = DataTypeSQLType;
                        _datafield = GetDataFieldName(_DBType);
                    }
                }
                return _datafield;
            }            
		}
		#endregion

        /// &lt;summary&gt;
        /// This is used internally for performance reasons since we are querying for all of the data properties at once in the 
        /// DefaultData object, therefore, the DefaultDataObject will set these properties manually instead of incurring a bunch 
        /// of additional SQL calls.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dataField&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;dataType&quot;&gt;&lt;/param&gt;
        internal void SetDataTypeProperties(string dataField, DBTypes dataType)
        {
            _datafield = dataField;
            _DBType = dataType;
        }

        /// &lt;summary&gt;
        /// Returns the DBType based on the row value in the dbType column of the cmsDataType
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dbtypestr&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal static DBTypes GetDBType(string dbtypestr)
        {
            return (DBTypes)Enum.Parse(typeof(DBTypes), dbtypestr, true);
        }

        /// &lt;summary&gt;
        /// Returns the data column for the data base where the value resides based on the dbType
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;dbType&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal static string GetDataFieldName(DBTypes dbType)
        {
            switch (dbType)
            {
                case DBTypes.Date:
                    return  &quot;dataDate&quot;;
                case DBTypes.Integer:
                    return &quot;dataInt&quot;;
                case DBTypes.Ntext:
                    return &quot;dataNtext&quot;;
                case DBTypes.Nvarchar:
                    return &quot;dataNvarchar&quot;;
                default:
                    return &quot;dataNvarchar&quot;;
            }
        }

        internal bool HasSettings()
        {
            bool hasSettings = false;
            foreach (System.Reflection.PropertyInfo p in this.GetType().GetProperties())
            {
                object[] o = p.GetCustomAttributes(typeof(DataEditorSetting), true);

                if (o.Length &gt; 0)
                {
                    hasSettings = true;
                    break;
                }
            }

            return hasSettings;
        }

        internal Dictionary&lt;string, DataEditorSetting&gt; Settings()
        {
            Dictionary&lt;string, DataEditorSetting&gt; s = new Dictionary&lt;string, DataEditorSetting&gt;();

            foreach (System.Reflection.PropertyInfo p in this.GetType().GetProperties())
            {

                object[] o = p.GetCustomAttributes(typeof(DataEditorSetting), true);

                if (o.Length &gt; 0)
                    s.Add(p.Name, (DataEditorSetting)o[0]);
            }

            return s;
        }

        internal void LoadSettings(List&lt;Setting&lt;string, string&gt;&gt; settings)
        {
            foreach (Setting&lt;string, string&gt; setting in settings)
            {
                try
                {
                    this.GetType().InvokeMember(setting.Key, System.Reflection.BindingFlags.SetProperty, null, this, new object[] { setting.Value });

                }
                catch (MissingMethodException) { }
            }
        }

	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,3,15,34,1],[18,3,18,24,1],[19,3,19,4,1],[19,4,19,5,1],[29,8,29,9,0],[30,5,30,35,0],[31,4,31,5,0],[32,8,32,9,0],[33,4,33,33,0],[34,4,34,5,0],[38,8,38,9,0],[39,5,39,21,0],[40,5,40,26,0],[41,6,41,27,0],[42,5,42,20,0],[43,4,43,5,0],[44,8,44,9,0],[45,5,45,21,0],[46,24,46,61,0],[47,21,47,213,0],[48,4,48,5,0],[57,13,57,14,0],[58,17,58,38,0],[59,17,59,18,0],[60,28,60,65,0],[61,21,61,22,0],[62,25,62,214,0],[63,25,63,72,0],[64,25,64,51,0],[65,25,65,64,0],[66,21,66,22,0],[67,17,67,18,0],[68,17,68,35,0],[69,13,69,14,0],[81,9,81,10,0],[82,13,82,36,0],[83,13,83,32,0],[84,9,84,10,0],[92,9,92,10,0],[93,13,93,74,0],[94,9,94,10,0],[102,9,102,10,0],[103,13,103,28,0],[106,21,106,40,0],[108,21,108,38,0],[110,21,110,40,0],[112,21,112,43,0],[114,21,114,43,0],[116,9,116,10,0],[119,9,119,10,0],[120,13,120,38,0],[121,13,121,20,0],[121,22,121,54,0],[121,55,121,57,0],[121,58,121,88,0],[122,13,122,14,0],[123,17,123,85,0],[125,17,125,34,0],[126,17,126,18,0],[127,21,127,40,0],[128,21,128,27,0],[130,13,130,14,0],[132,13,132,32,0],[133,9,133,10,0],[136,9,136,10,0],[137,13,137,99,0],[139,13,139,20,0],[139,22,139,54,0],[139,55,139,57,0],[139,58,139,88,0],[140,13,140,14,0],[142,17,142,85,0],[144,17,144,34,0],[145,21,145,60,0],[146,13,146,14,0],[148,13,148,22,0],[149,9,149,10,0],[152,9,152,10,0],[153,13,153,20,0],[153,22,153,53,0],[153,54,153,56,0],[153,57,153,65,0],[154,13,154,14,0],[156,17,156,18,0],[157,21,157,150,0],[159,17,159,18,0],[160,17,160,47,0],[160,48,160,49,0],[160,50,160,51,0],[161,13,161,14,0],[162,9,162,10,0]]);
    </script>
  </body>
</html>