<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\CodeFirst\ContentTypeBase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using Umbraco.Core.Dynamics;
using Umbraco.Core.Models;

namespace Umbraco.Tests.CodeFirst
{
    public abstract class ContentTypeBase
    {
        private IPublishedContent _content;

        protected ContentTypeBase(){}

        internal IPublishedContent Content
        {
            set { _content = value; }
        }

        #region Standard IPublisedContent properties

        public IPublishedContent Parent
        {
            get { return _content.Parent; }
        }

        public int Id
        {
            get { return _content.Id; }
        }
        public int TemplateId
        {
            get { return _content.TemplateId; }
        }
        public int SortOrder
        {
            get { return _content.SortOrder; }
        }
        public string Name
        {
            get { return _content.Name; }
        }
        public string UrlName
        {
            get { return _content.UrlName; }
        }
        public string DocumentTypeAlias
        {
            get { return _content.DocumentTypeAlias; }
        }
        public int DocumentTypeId
        {
            get { return _content.DocumentTypeId; }
        }
        public string WriterName
        {
            get { return _content.WriterName; }
        }
        public string CreatorName
        {
            get { return _content.CreatorName; }
        }
        public int WriterId
        {
            get { return _content.WriterId; }
        }
        public int CreatorId
        {
            get { return _content.CreatorId; }
        }
        public string Path
        {
            get { return _content.Path; }
        }
        public DateTime CreateDate
        {
            get { return _content.CreateDate; }
        }
        public DateTime UpdateDate
        {
            get { return _content.UpdateDate; }
        }
        public Guid Version
        {
            get { return _content.Version; }
        }
        public int Level
        {
            get { return _content.Level; }
        }

        //Using this attribute to hide Properties from Intellisense (when compiled?)
        [EditorBrowsable(EditorBrowsableState.Never)]
        public ICollection&lt;IPublishedProperty&gt; Properties
        {
            get { return _content.Properties; }
        }

        //Using this attribute to hide Properties from Intellisense (when compiled?)
        [EditorBrowsable(EditorBrowsableState.Never)]
        public IEnumerable&lt;IPublishedContent&gt; Children
        {
            get { return _content.Children; }
        }

        //Using this attribute to hide Properties from Intellisense (when compiled?)
        [EditorBrowsable(EditorBrowsableState.Never)]
        public IPublishedProperty GetProperty(string alias)
        {
            return _content.GetProperty(alias);
        }

        #endregion

        #region Strongly typed queries
        public IEnumerable&lt;T&gt; ChildrenOfType&lt;T&gt;() where T : ContentTypeBase, new ()
        {
            var docTypeAlias = typeof (T).Name;
            return _content.Children
                .Where(x =&gt; x.DocumentTypeAlias == docTypeAlias)
                .Select(ContentTypeMapper.Map&lt;T&gt;);
        }
        public IEnumerable&lt;T&gt; Descendants&lt;T&gt;() where T : ContentTypeBase, new ()
        {
            var docTypeAlias = typeof(T).Name;
            return _content.Children.Map(x =&gt; true, (IPublishedContent n) =&gt; n.Children)
                .Where(x =&gt; x.DocumentTypeAlias == docTypeAlias)
                .Select(ContentTypeMapper.Map&lt;T&gt;);
        }
        #endregion
    }

    public static class ContentTypeBaseExtensions
    {
        public static IEnumerable&lt;T&gt; Children&lt;T&gt;(this ContentTypeBase contentTypeBase)
            where T : ContentTypeBase, new()
        {
            var docTypeAlias = typeof(T).Name;
            return contentTypeBase.Children
                .Where(x =&gt; x.DocumentTypeAlias == docTypeAlias)
                .Select(ContentTypeMapper.Map&lt;T&gt;);
        }

        public static IEnumerable&lt;TSource&gt; Map&lt;TSource&gt;(
            this IEnumerable&lt;TSource&gt; source,
            Func&lt;TSource, bool&gt; selectorFunction,
            Func&lt;TSource, IEnumerable&lt;TSource&gt;&gt; getChildrenFunction)
        {
            if (!source.Any())
            {
                return source;
            }
            // Add what we have to the stack   
            var flattenedList = source.Where(selectorFunction);
            // Go through the input enumerable looking for children,   
            // and add those if we have them   
            foreach (TSource element in source)
            {
                var secondInner = getChildrenFunction(element);
                if (secondInner.Any())
                {
                    secondInner = secondInner.Map(selectorFunction, getChildrenFunction);
                }
                flattenedList = flattenedList.Concat(secondInner);
            }
            return flattenedList;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,36,1],[15,36,15,37,1],[15,37,15,38,1],[19,17,19,18,1],[19,19,19,36,1],[19,37,19,38,1],[26,17,26,18,0],[26,19,26,42,0],[26,43,26,44,0],[31,17,31,18,0],[31,19,31,38,0],[31,39,31,40,0],[35,17,35,18,0],[35,19,35,46,0],[35,47,35,48,0],[39,17,39,18,0],[39,19,39,45,0],[39,46,39,47,0],[43,17,43,18,0],[43,19,43,40,0],[43,41,43,42,0],[47,17,47,18,0],[47,19,47,43,0],[47,44,47,45,0],[51,17,51,18,0],[51,19,51,53,0],[51,54,51,55,0],[55,17,55,18,0],[55,19,55,50,0],[55,51,55,52,0],[59,17,59,18,0],[59,19,59,46,0],[59,47,59,48,0],[63,17,63,18,0],[63,19,63,47,0],[63,48,63,49,0],[67,17,67,18,0],[67,19,67,44,0],[67,45,67,46,0],[71,17,71,18,0],[71,19,71,45,0],[71,46,71,47,0],[75,17,75,18,0],[75,19,75,40,0],[75,41,75,42,0],[79,17,79,18,0],[79,19,79,46,0],[79,47,79,48,0],[83,17,83,18,0],[83,19,83,46,0],[83,47,83,48,0],[87,17,87,18,0],[87,19,87,43,0],[87,44,87,45,0],[91,17,91,18,0],[91,19,91,41,0],[91,42,91,43,0],[98,17,98,18,0],[98,19,98,46,0],[98,47,98,48,0],[105,17,105,18,0],[105,19,105,44,0],[105,45,105,46,0],[111,9,111,10,0],[112,13,112,48,0],[113,9,113,10,0],[119,9,119,10,1],[120,13,120,48,1],[121,13,122,29,1],[122,29,122,64,1],[122,64,123,51,1],[121,13,123,51,1],[124,9,124,10,1],[126,9,126,10,1],[127,13,127,47,1],[128,13,128,47,1],[128,47,128,51,1],[128,51,128,78,1],[128,78,128,88,1],[128,88,129,29,1],[129,29,129,64,1],[129,64,130,51,1],[128,13,130,51,1],[131,9,131,10,1],[139,9,139,10,0],[140,13,140,47,0],[141,13,142,29,0],[142,29,142,64,0],[142,64,143,51,0],[141,13,143,51,0],[144,9,144,10,0],[150,9,150,10,1],[151,13,151,31,1],[152,13,152,14,0],[153,17,153,31,0],[156,13,156,64,1],[159,13,159,20,1],[159,22,159,37,1],[159,38,159,40,1],[159,41,159,47,1],[160,13,160,14,1],[161,17,161,64,1],[162,17,162,39,1],[163,17,163,18,1],[164,21,164,90,1],[165,17,165,18,1],[166,17,166,67,1],[167,13,167,14,1],[168,13,168,34,1],[169,9,169,10,1]]);
    </script>
  </body>
</html>