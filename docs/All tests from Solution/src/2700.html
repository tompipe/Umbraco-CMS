<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\umbraco.editorControls\MultipleTextstring\MultipleTextstringControl.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Web.UI;
using System.Web.UI.WebControls;
using ClientDependency.Core;
using umbraco;
using umbraco.cms.businesslogic.datatype;

[assembly: WebResource(&quot;umbraco.editorControls.MultipleTextstring.MultipleTextstring.css&quot;, &quot;text/css&quot;)]
[assembly: WebResource(&quot;umbraco.editorControls.MultipleTextstring.MultipleTextstring.js&quot;, &quot;application/x-javascript&quot;)]

namespace umbraco.editorControls.MultipleTextstring
{
    /// &lt;summary&gt;
    /// The MultipleTextstring control sets a character limit on a TextBox.
    /// &lt;/summary&gt;
    [ValidationProperty(&quot;IsValid&quot;)]
    [Obsolete(&quot;IDataType and all other references to the legacy property editors are no longer used this will be removed from the codebase in future versions&quot;)]
    public class MultipleTextstringControl : PlaceHolder
    {
        /// &lt;summary&gt;
        /// Field for the list of values.
        /// &lt;/summary&gt;
        private List&lt;string&gt; values;

        /// &lt;summary&gt;
        /// The HiddenField to store the selected values.
        /// &lt;/summary&gt;
        private HiddenField SelectedValues = new HiddenField();

        /// &lt;summary&gt;
        /// Gets or sets the options.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The options.&lt;/value&gt;
        public MultipleTextstringOptions Options { get; set; }

        /// &lt;summary&gt;
        /// Gets the value of IsValid.
        /// &lt;/summary&gt;
        /// &lt;value&gt;Returns &#39;Valid&#39; if valid, otherwise an empty string.&lt;/value&gt;
        public string IsValid
        {
            get
            {
                if (!string.IsNullOrEmpty(this.Values))
                {
                    return &quot;Valid&quot;;
                }

                return string.Empty;
            }
        }

        /// &lt;summary&gt;
        /// Gets or sets the values.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The values.&lt;/value&gt;
        public string Values
        {
            get
            {
                return this.SelectedValues.Value;
            }

            set
            {
                this.SelectedValues.Value = value;
            }
        }

        /// &lt;summary&gt;
        /// Initialize the control, make sure children are created
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;An &lt;see cref=&quot;T:System.EventArgs&quot;/&gt; object that contains the event data.&lt;/param&gt;
        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);

            this.EnsureChildControls();
        }

        /// &lt;summary&gt;
        /// Add the resources (sytles/scripts)
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;The &lt;see cref=&quot;T:System.EventArgs&quot;/&gt; object that contains the event data.&lt;/param&gt;
        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            // Adds the client dependencies.
            this.RegisterEmbeddedClientResource(&quot;umbraco.editorControls.MultipleTextstring.MultipleTextstring.css&quot;, ClientDependencyType.Css);
            this.RegisterEmbeddedClientResource(&quot;umbraco.editorControls.MultipleTextstring.MultipleTextstring.js&quot;, ClientDependencyType.Javascript);
        }

        /// &lt;summary&gt;
        /// Raises the &lt;see cref=&quot;E:System.Web.UI.Control.PreRender&quot;/&gt; event.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;e&quot;&gt;An &lt;see cref=&quot;T:System.EventArgs&quot;/&gt; object that contains the event data.&lt;/param&gt;
        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);

            // initalise the string array/list.
            this.values = new List&lt;string&gt;();

            // load the values into a string array/list.
            if (!string.IsNullOrEmpty(this.Values))
            {
                this.values.AddRange(this.Values.Split(new[] { Environment.NewLine }, StringSplitOptions.None));
            }

            // check the minimum number allowed, add extra fields.
            if (this.values.Count &lt; this.Options.Minimum &amp;&amp; this.Options.Minimum &gt; 1)
            {
                this.values.AddRange(new string(&#39;,&#39;, this.Options.Minimum - 1).Split(new[] { &#39;,&#39; }, StringSplitOptions.None));
            }

            // check the maxmimum number allowed, remove the excess.
            if (this.values.Count &gt; this.Options.Maximum &amp;&amp; this.Options.Maximum &gt; 0)
            {
                this.values.RemoveRange(this.Options.Maximum, this.values.Count - this.Options.Maximum);
            }

            // if there are no selected values...
            if (this.values.Count == 0)
            {
                // ... then add an empty string to display a single textstring box.
                this.values.Add(string.Empty);
            }
        }

        /// &lt;summary&gt;
        /// Called by the ASP.NET page framework to notify server controls that use composition-based implementation to create any child controls they contain in preparation for posting back or rendering.
        /// &lt;/summary&gt;
        protected override void CreateChildControls()
        {
            base.CreateChildControls();

            this.EnsureChildControls();

            // populate the control&#39;s attributes.
            this.SelectedValues.ID = this.SelectedValues.ClientID;

            // add the controls.
            this.Controls.Add(this.SelectedValues);
        }

        /// &lt;summary&gt;
        /// Sends server control content to a provided &lt;see cref=&quot;T:System.Web.UI.HtmlTextWriter&quot;/&gt; object, which writes the content to be rendered on the client.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;writer&quot;&gt;The &lt;see cref=&quot;T:System.Web.UI.HtmlTextWriter&quot;/&gt; object that receives the server control content.&lt;/param&gt;
        protected override void Render(HtmlTextWriter writer)
        {
            writer.AddAttribute(HtmlTextWriterAttribute.Class, &quot;MultipleTextstring&quot;);
            writer.AddAttribute(HtmlTextWriterAttribute.Id, this.ClientID);
            writer.RenderBeginTag(HtmlTextWriterTag.Div);

            // loop through each value
            foreach (string value in this.values)
            {
                writer.AddAttribute(HtmlTextWriterAttribute.Class, &quot;textstring-row&quot;);
                writer.RenderBeginTag(HtmlTextWriterTag.Div);

                // input tag
                writer.AddAttribute(HtmlTextWriterAttribute.Class, &quot;textstring-row-field&quot;);
                writer.RenderBeginTag(HtmlTextWriterTag.Div);
                writer.WriteLine(&quot;&lt;input type=&#39;text&#39; class=&#39;umbEditorTextField&#39; value=&#39;{0}&#39; /&gt;&quot;, value.Replace(&quot;&#39;&quot;, &quot;&amp;#39;&quot;));

                // append the add/remove buttons
                writer.WriteLine(&quot; &lt;a href=&#39;#add&#39; class=&#39;add_row&#39; title=&#39;Add a new row&#39;&gt;&lt;img src=&#39;{0}/images/small_plus.png&#39; /&gt;&lt;/a&gt;&quot;, GlobalSettings.Path);
                writer.WriteLine(&quot; &lt;a href=&#39;#remove&#39; class=&#39;remove_row&#39; title=&#39;Remove this row&#39;&gt;&lt;img src=&#39;{0}/images/small_minus.png&#39; /&gt;&lt;/a&gt;&quot;, GlobalSettings.Path);
                writer.RenderEndTag(); // &lt;/div&gt; .textstring-row-field

                writer.WriteLine(&quot;&lt;div class=&#39;textstring-row-sort&#39; title=&#39;Re-order this row&#39; style=&#39;background: url({0}/images/sort.png) no-repeat 0 2px;&#39;&gt;&lt;/div&gt;&quot;, GlobalSettings.Path);

                writer.RenderEndTag(); // &lt;/div&gt; .textstring-row
            }

            this.SelectedValues.RenderControl(writer);

            writer.RenderEndTag(); // &lt;/div&gt; .MultipleTextstring

            // add jquery window load event
            var javascriptMethod = string.Format(&quot;jQuery(&#39;#{0}&#39;).MultipleTextstring(&#39;#{1}&#39;, {2}, {3});&quot;, this.ClientID, this.SelectedValues.ClientID, this.Options.Minimum, this.Options.Maximum);
            var javascript = string.Concat(&quot;&lt;script type=&#39;text/javascript&#39;&gt;jQuery(window).load(function(){&quot;, javascriptMethod, &quot;});&lt;/script&gt;&quot;);
            writer.WriteLine(javascript);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[29,9,29,64,0],[35,52,35,56,0],[35,57,35,61,0],[44,13,44,14,0],[45,17,45,56,0],[46,17,46,18,0],[47,21,47,36,0],[50,17,50,37,0],[51,13,51,14,0],[61,13,61,14,0],[62,17,62,50,0],[63,13,63,14,0],[66,13,66,14,0],[67,17,67,51,0],[68,13,68,14,0],[76,9,76,10,0],[77,13,77,28,0],[79,13,79,40,0],[80,9,80,10,0],[87,9,87,10,0],[88,13,88,28,0],[91,13,91,143,0],[92,13,92,149,0],[93,9,93,10,0],[100,9,100,10,0],[101,13,101,33,0],[104,13,104,46,0],[107,13,107,52,0],[108,13,108,14,0],[109,17,109,113,0],[110,13,110,14,0],[113,13,113,86,0],[114,13,114,14,0],[115,17,115,127,0],[116,13,116,14,0],[119,13,119,86,0],[120,13,120,14,0],[121,17,121,105,0],[122,13,122,14,0],[125,13,125,40,0],[126,13,126,14,0],[128,17,128,47,0],[129,13,129,14,0],[130,9,130,10,0],[136,9,136,10,0],[137,13,137,40,0],[139,13,139,40,0],[142,13,142,67,0],[145,13,145,52,0],[146,9,146,10,0],[153,9,153,10,0],[154,13,154,86,0],[155,13,155,76,0],[156,13,156,58,0],[159,13,159,20,0],[159,22,159,34,0],[159,35,159,37,0],[159,38,159,49,0],[160,13,160,14,0],[161,17,161,86,0],[162,17,162,62,0],[165,17,165,92,0],[166,17,166,62,0],[167,17,167,127,0],[170,17,170,156,0],[171,17,171,165,0],[172,17,172,39,0],[174,17,174,186,0],[176,17,176,39,0],[177,13,177,14,0],[179,13,179,55,0],[181,13,181,35,0],[184,13,184,195,0],[185,13,185,144,0],[186,13,186,42,0],[187,9,187,10,0]]);
    </script>
  </body>
</html>