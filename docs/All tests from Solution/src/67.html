<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Macros\MacroParserTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using NUnit.Framework;
using Umbraco.Core.Macros;

namespace Umbraco.Tests.Macros
{
    [TestFixture]
    public class MacroParserTests
    {
        [Test]
        public void Format_RTE_Data_For_Editor_With_No_Macros()
        {
            var content = @&quot;&lt;p&gt;hello world&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextContentForPersistence(content);
            Assert.AreEqual(@&quot;&lt;p&gt;hello world&lt;/p&gt;&quot;, content);
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Non_AlphaNumeric_Char_In_Alias()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;My.Map.isCool eh[boy!]&quot;&quot; /&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

//            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;p&gt;asdfsadf&lt;/p&gt;
//&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
//&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;My.Map.isCool eh[boy!]&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;My.Map.isCool eh[boy!]&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; /&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;(){{&quot;test1&quot;, &quot;value1&quot;},{&quot;test2&quot;, &quot;value2&quot;}});

//            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;p&gt;asdfsadf&lt;/p&gt;
//&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
//&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));

            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_Closing_Tag()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; &gt;&lt;/?UMBRACO_MACRO&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

//            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;p&gt;asdfsadf&lt;/p&gt;
//&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
//&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Params()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

//            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;p&gt;asdfsadf&lt;/p&gt;
//&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
//&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Params_When_MacroAlias_Not_First()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; /&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

//            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;p&gt;asdfsadf&lt;/p&gt;
//&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
//&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Params_When_MacroAlias_Is_First()
        {

            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

            //            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
            //&lt;p&gt;asdfsadf&lt;/p&gt;
            //&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
            //&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
            //&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
            //&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Params_When_Multiple_Macros()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; /&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

            //            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
            //&lt;p&gt;asdfsadf&lt;/p&gt;
            //&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
            //&lt;!-- &lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
            //&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
            //&lt;p&gt;asdfsadf&lt;/p&gt;
            //&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
            //&lt;!-- &lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
            //&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
            //&lt;p&gt;asdfsadf&lt;/p&gt;
            //&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
            //&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
            //&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
            //&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));

            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO test1=&quot;&quot;value1&quot;&quot; macroAlias=&quot;&quot;Map&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Multiple_Macros()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Breadcrumb&quot;&quot; /&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;login&quot;&quot; /&gt;
&lt;p&gt;&#160;&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;());

            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Breadcrumb&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Breadcrumb&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;login&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;login&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Persistence_Multiline_Parameters()
        {
            var content = @&quot;&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;asdfasdf&lt;/h1&gt;
&lt;div class=&#39;umb-macro-holder mceNonEditable&#39; att1=&#39;asdf&#39; att2=&#39;asdfasdfasdf&#39; att3=&quot;&quot;sdfsdfd&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;myMacro&quot;&quot; param1=&quot;&quot;test1&quot;&quot; param2=&quot;&quot;test2
dfdsfds&quot;&quot; /&gt; --&gt;
asdfasdf
asdfas
&lt;span&gt;asdfasdfasdf&lt;/span&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;/div&gt;
&lt;span&gt;asdfdasf&lt;/span&gt;
&lt;div&gt;
asdfsdf
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;;
            var result = MacroTagParser.FormatRichTextContentForPersistence(content);

            Assert.AreEqual(@&quot;&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;asdfasdf&lt;/h1&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;myMacro&quot;&quot; param1=&quot;&quot;test1&quot;&quot; param2=&quot;&quot;test2
dfdsfds&quot;&quot; /&gt;
&lt;span&gt;asdfdasf&lt;/span&gt;
&lt;div&gt;
asdfsdf
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Params_Closing_Tag()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; &gt;&lt;/?UMBRACO_MACRO&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

//            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;p&gt;asdfsadf&lt;/p&gt;
//&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
//&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Editor_With_Params_Closing_Tag_And_Content()
        {
            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; &gt;&lt;img src=&#39;blah.jpg&#39;/&gt;&lt;/?UMBRACO_MACRO&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2&quot; } });

//            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;p&gt;asdfsadf&lt;/p&gt;
//&lt;div class=&quot;&quot;umb-macro-holder Map mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
//&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }


        [Test]
        public void Format_RTE_Data_For_Editor_With_Multiline_Parameters()
        {

            var content = @&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2
test&quot;&quot; /&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;;
            var result = MacroTagParser.FormatRichTextPersistedDataForEditor(content, new Dictionary&lt;string, string&gt;() { { &quot;test1&quot;, &quot;value1&quot; }, { &quot;test2&quot;, &quot;value2\r\ntest&quot; } });

            Assert.AreEqual(@&quot;&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;p&gt;asdfsadf&lt;/p&gt;
&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2
test&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Map&quot;&quot; test1=&quot;&quot;value1&quot;&quot; test2=&quot;&quot;value2
test&quot;&quot; /&gt; --&gt;
&lt;ins&gt;Macro alias: &lt;strong&gt;Map&lt;/strong&gt;&lt;/ins&gt;&lt;/div&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Persistence()
        {
//            var content = @&quot;&lt;html&gt;
//&lt;body&gt;
//&lt;h1&gt;asdfasdf&lt;/h1&gt;
//&lt;div class=&#39;umb-macro-holder Map mceNonEditable&#39; att1=&#39;asdf&#39; att2=&#39;asdfasdfasdf&#39; att3=&quot;&quot;sdfsdfd&quot;&quot;&gt;
//&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;myMacro&quot;&quot; param1=&quot;&quot;test1&quot;&quot; param2=&quot;&quot;test2&quot;&quot; /&gt; --&gt;
//asdfasdf 
//asdfas
//&lt;span&gt;asdfasdfasdf&lt;/span&gt;
//&lt;p&gt;asdfasdf&lt;/p&gt;
//&lt;/div&gt;
//&lt;span&gt;asdfdasf&lt;/span&gt;
//&lt;div&gt;
//asdfsdf
//&lt;/div&gt;
//&lt;/body&gt;
//&lt;/html&gt;&quot;;
            var content = @&quot;&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;asdfasdf&lt;/h1&gt;
&lt;div class=&#39;umb-macro-holder mceNonEditable&#39; att1=&#39;asdf&#39; att2=&#39;asdfasdfasdf&#39; att3=&quot;&quot;sdfsdfd&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;myMacro&quot;&quot; param1=&quot;&quot;test1&quot;&quot; param2=&quot;&quot;test2&quot;&quot; /&gt; --&gt;
asdfasdf 
asdfas
&lt;span&gt;asdfasdfasdf&lt;/span&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;/div&gt;
&lt;span&gt;asdfdasf&lt;/span&gt;
&lt;div&gt;
asdfsdf
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;;
            var result = MacroTagParser.FormatRichTextContentForPersistence(content);

            Assert.AreEqual(@&quot;&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;asdfasdf&lt;/h1&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;myMacro&quot;&quot; param1=&quot;&quot;test1&quot;&quot; param2=&quot;&quot;test2&quot;&quot; /&gt;
&lt;span&gt;asdfdasf&lt;/span&gt;
&lt;div&gt;
asdfsdf
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Persistence_No_Class()
        {
            var content = @&quot;&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;asdfasdf&lt;/h1&gt;
&lt;div att1=&#39;asdf&#39; att2=&#39;asdfasdfasdf&#39; att3=&quot;&quot;sdfsdfd&quot;&quot;&gt;
&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;myMacro&quot;&quot; param1=&quot;&quot;test1&quot;&quot; param2=&quot;&quot;test2&quot;&quot; /&gt; --&gt;
asdfasdf 
asdfas
&lt;span&gt;asdfasdfasdf&lt;/span&gt;
&lt;p&gt;asdfasdf&lt;/p&gt;
&lt;/div&gt;
&lt;span&gt;asdfdasf&lt;/span&gt;
&lt;div&gt;
asdfsdf
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;;
            var result = MacroTagParser.FormatRichTextContentForPersistence(content);

            Assert.AreEqual(@&quot;&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;asdfasdf&lt;/h1&gt;
&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;myMacro&quot;&quot; param1=&quot;&quot;test1&quot;&quot; param2=&quot;&quot;test2&quot;&quot; /&gt;
&lt;span&gt;asdfdasf&lt;/span&gt;
&lt;div&gt;
asdfsdf
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;.Replace(Environment.NewLine, string.Empty), result.Replace(Environment.NewLine, string.Empty));
        }

        [Test]
        public void Format_RTE_Data_For_Persistence_Custom_Single_Entry()
        {
//            var content = @&quot;&lt;div class=&quot;&quot;umb-macro-holder Test mceNonEditable umb-macro-mce_1&quot;&quot;&gt;&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Test&quot;&quot; content=&quot;&quot;1089&quot;&quot; textArea=&quot;&quot;asdfasdf&quot;&quot; title=&quot;&quot;&quot;&quot; bool=&quot;&quot;0&quot;&quot; number=&quot;&quot;&quot;&quot; contentType=&quot;&quot;&quot;&quot; multiContentType=&quot;&quot;&quot;&quot; multiProperties=&quot;&quot;&quot;&quot; properties=&quot;&quot;&quot;&quot; tabs=&quot;&quot;&quot;&quot; multiTabs=&quot;&quot;&quot;&quot; /&gt; --&gt;&lt;ins&gt;
//&lt;div class=&quot;&quot;facts-box&quot;&quot;&gt;
//&lt;div class=&quot;&quot;fatcs-box-header&quot;&quot;&gt;
//&lt;h3&gt;null&lt;/h3&gt;
//&lt;/div&gt;
//&lt;div class=&quot;&quot;fatcs-box-body&quot;&quot;&gt;1089&lt;/div&gt;
//&lt;/div&gt;
//&lt;/ins&gt;&lt;/div&gt;&quot;;
            var content = @&quot;&lt;div class=&quot;&quot;umb-macro-holder mceNonEditable umb-macro-mce_1&quot;&quot;&gt;&lt;!-- &lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Test&quot;&quot; content=&quot;&quot;1089&quot;&quot; textArea=&quot;&quot;asdfasdf&quot;&quot; title=&quot;&quot;&quot;&quot; bool=&quot;&quot;0&quot;&quot; number=&quot;&quot;&quot;&quot; contentType=&quot;&quot;&quot;&quot; multiContentType=&quot;&quot;&quot;&quot; multiProperties=&quot;&quot;&quot;&quot; properties=&quot;&quot;&quot;&quot; tabs=&quot;&quot;&quot;&quot; multiTabs=&quot;&quot;&quot;&quot; /&gt; --&gt;&lt;ins&gt;
&lt;div class=&quot;&quot;facts-box&quot;&quot;&gt;
&lt;div class=&quot;&quot;fatcs-box-header&quot;&quot;&gt;
&lt;h3&gt;null&lt;/h3&gt;
&lt;/div&gt;
&lt;div class=&quot;&quot;fatcs-box-body&quot;&quot;&gt;1089&lt;/div&gt;
&lt;/div&gt;
&lt;/ins&gt;&lt;/div&gt;&quot;;
            var result = MacroTagParser.FormatRichTextContentForPersistence(content);

            Assert.AreEqual(@&quot;&lt;?UMBRACO_MACRO macroAlias=&quot;&quot;Test&quot;&quot; content=&quot;&quot;1089&quot;&quot; textArea=&quot;&quot;asdfasdf&quot;&quot; title=&quot;&quot;&quot;&quot; bool=&quot;&quot;0&quot;&quot; number=&quot;&quot;&quot;&quot; contentType=&quot;&quot;&quot;&quot; multiContentType=&quot;&quot;&quot;&quot; multiProperties=&quot;&quot;&quot;&quot; properties=&quot;&quot;&quot;&quot; tabs=&quot;&quot;&quot;&quot; multiTabs=&quot;&quot;&quot;&quot; /&gt;&quot;, result);
        }
    
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,10,1],[14,13,14,49,1],[15,13,15,86,1],[16,13,16,61,1],[17,9,17,10,1],[21,9,21,10,1],[22,13,25,18,1],[26,13,26,170,1],[34,13,39,113,1],[40,9,40,10,1],[44,9,44,10,1],[45,13,48,18,1],[49,13,49,162,1],[58,13,63,113,1],[64,9,64,10,1],[68,9,68,10,1],[69,13,72,18,1],[73,13,73,170,1],[81,13,86,113,1],[87,9,87,10,1],[91,9,91,10,1],[92,13,95,18,1],[96,13,96,170,1],[104,13,109,113,1],[110,9,110,10,1],[114,9,114,10,1],[115,13,118,18,1],[119,13,119,170,1],[127,13,132,113,1],[133,9,133,10,1],[137,9,137,10,1],[139,13,142,18,1],[143,13,143,170,1],[151,13,156,113,1],[157,9,157,10,1],[161,9,161,10,1],[162,13,169,18,1],[170,13,170,170,1],[187,13,200,113,1],[201,9,201,10,1],[205,9,205,10,1],[206,13,211,11,1],[212,13,212,121,1],[214,13,223,106,1],[224,9,224,10,1],[228,9,228,10,1],[229,13,245,10,1],[246,13,246,86,1],[248,13,258,105,1],[259,9,259,10,1],[263,9,263,10,1],[264,13,267,18,1],[268,13,268,170,1],[276,13,281,113,1],[282,9,282,10,1],[286,9,286,10,1],[287,13,290,18,1],[291,13,291,170,1],[299,13,304,113,1],[305,9,305,10,1],[310,9,310,10,1],[312,13,316,18,1],[317,13,317,178,1],[319,13,326,113,1],[327,9,327,10,1],[331,9,331,10,1],[348,13,363,10,1],[364,13,364,86,1],[366,13,375,105,1],[376,9,376,10,1],[380,9,380,10,1],[381,13,396,10,1],[397,13,397,86,1],[399,13,408,105,1],[409,9,409,10,1],[413,9,413,10,1],[422,13,429,15,1],[430,13,430,86,1],[432,13,432,254,1],[433,9,433,10,1]]);
    </script>
  </body>
</html>