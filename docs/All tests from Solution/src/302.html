<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Routing\UrlRoutingTestBase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using Moq;
using NUnit.Framework;
using Umbraco.Core;
using Umbraco.Core.Configuration.UmbracoSettings;
using Umbraco.Core.Logging;
using Umbraco.Core.Models;
using Umbraco.Core.Persistence;
using Umbraco.Core.Persistence.SqlSyntax;
using Umbraco.Core.Services;
using Umbraco.Tests.TestHelpers;

namespace Umbraco.Tests.Routing
{
    [DatabaseTestBehavior(DatabaseBehavior.NoDatabasePerFixture)]
    [TestFixture]
    public abstract class UrlRoutingTestBase : BaseRoutingTest
    {
        /// &lt;summary&gt;
        /// Sets up the mock domain service
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;allDomains&quot;&gt;&lt;/param&gt;
        protected IDomainService SetupDomainServiceMock(IEnumerable&lt;IDomain&gt; allDomains)
        {
            var domainService = Mock.Get(ServiceContext.DomainService);
            //setup mock domain service
            domainService.Setup(service =&gt; service.GetAll(It.IsAny&lt;bool&gt;()))
                .Returns((bool incWildcards) =&gt; incWildcards ? allDomains : allDomains.Where(d =&gt; d.IsWildcard == false));
            domainService.Setup(service =&gt; service.GetAssignedDomains(It.IsAny&lt;int&gt;(), It.IsAny&lt;bool&gt;()))
                .Returns((int id, bool incWildcards) =&gt; allDomains.Where(d =&gt; d.RootContentId == id &amp;&amp; (incWildcards || d.IsWildcard == false)));
            return domainService.Object;
        }

        protected ServiceContext GetServiceContext(IUmbracoSettingsSection umbracoSettings, ILogger logger)
        {
            //get the mocked service context to get the mocked domain service
            var svcCtx = MockHelper.GetMockedServiceContext();

            var domainService = Mock.Get(svcCtx.DomainService);
            //setup mock domain service
            domainService.Setup(service =&gt; service.GetAll(It.IsAny&lt;bool&gt;()))
                .Returns((bool incWildcards) =&gt; new[]
                {
                    new UmbracoDomain(&quot;domain1.com/&quot;){Id = 1, LanguageId = LangDeId, RootContentId = 1001, LanguageIsoCode = &quot;de-DE&quot;}, 
                    new UmbracoDomain(&quot;domain1.com/en&quot;){Id = 1, LanguageId = LangEngId, RootContentId = 10011, LanguageIsoCode = &quot;en-US&quot;}, 
                    new UmbracoDomain(&quot;domain1.com/fr&quot;){Id = 1, LanguageId = LangFrId, RootContentId = 10012, LanguageIsoCode = &quot;fr-FR&quot;}
                });            

            return svcCtx;
        }

        public const int LangDeId = 333;
        public const int LangEngId = 334;
        public const int LangFrId = 335;
        public const int LangCzId = 336;
        public const int LangNlId = 337;
        public const int LangDkId = 338;

        protected override ApplicationContext CreateApplicationContext()
        {
            var settings = SettingsForTests.GetDefault();
            return new ApplicationContext(
                new DatabaseContext(Mock.Of&lt;IDatabaseFactory&gt;(), Logger, Mock.Of&lt;ISqlSyntaxProvider&gt;(), &quot;test&quot;),
                GetServiceContext(settings, Logger),
                CacheHelper,
                ProfilingLogger)
            {
                IsReady = true
            };
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[25,9,25,10,1],[26,13,26,72,1],[28,13,29,49,1],[29,49,29,99,1],[29,99,29,120,1],[29,120,29,121,1],[29,49,29,121,1],[29,121,29,123,1],[28,13,29,123,1],[30,13,31,57,1],[31,57,31,79,1],[31,79,31,143,1],[31,143,31,144,1],[31,57,31,144,1],[31,144,31,146,1],[30,13,31,146,1],[32,13,32,41,1],[33,9,33,10,1],[36,9,36,10,1],[38,13,38,63,1],[40,13,40,64,1],[42,13,43,49,1],[43,49,48,18,1],[48,18,48,20,1],[42,13,48,20,1],[50,13,50,27,1],[51,9,51,10,1],[61,9,61,10,1],[62,13,62,58,1],[63,13,70,15,1],[71,9,71,10,1]]);
    </script>
  </body>
</html>