<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Configuration\Grid\GridEditorsConfig.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using Newtonsoft.Json.Linq;
using Umbraco.Core.Cache;
using Umbraco.Core.Logging;
using Umbraco.Core.Manifest;
using Umbraco.Core.PropertyEditors;

namespace Umbraco.Core.Configuration.Grid
{
    class GridEditorsConfig : IGridEditorsConfig
    {
        private readonly ILogger _logger;
        private readonly IRuntimeCacheProvider _runtimeCache;
        private readonly DirectoryInfo _appPlugins;
        private readonly DirectoryInfo _configFolder;
        private readonly bool _isDebug;

        public GridEditorsConfig(ILogger logger, IRuntimeCacheProvider runtimeCache, DirectoryInfo appPlugins, DirectoryInfo configFolder, bool isDebug)
        {
            _logger = logger;
            _runtimeCache = runtimeCache;
            _appPlugins = appPlugins;
            _configFolder = configFolder;
            _isDebug = isDebug;
        }

        public IEnumerable&lt;IGridEditorConfig&gt; Editors
        {
            get
            {
                Func&lt;List&lt;GridEditor&gt;&gt; getResult = () =&gt;
                {
                    var editors = new List&lt;GridEditor&gt;();
                    var gridConfig = Path.Combine(_configFolder.FullName, &quot;grid.editors.config.js&quot;);
                    if (File.Exists(gridConfig))
                    {
                        try
                        {
                            var arr = JArray.Parse(File.ReadAllText(gridConfig));
                            //ensure the contents parse correctly to objects
                            var parsed = ManifestParser.GetGridEditors(arr);
                            editors.AddRange(parsed);
                        }
                        catch (Exception ex)
                        {
                            _logger.Error&lt;GridEditorsConfig&gt;(&quot;Could not parse the contents of grid.editors.config.js into a JSON array&quot;, ex);
                        }
                    }

                    var parser = new ManifestParser(_appPlugins, _runtimeCache);
                    var builder = new ManifestBuilder(_runtimeCache, parser);
                    foreach (var gridEditor in builder.GridEditors)
                    {
                        //no duplicates! (based on alias)
                        if (editors.Contains(gridEditor) == false)
                        {
                            editors.Add(gridEditor);
                        }
                    }
                    return editors;
                };

                //cache the result if debugging is disabled
                var result = _isDebug
                    ? getResult()
                    : _runtimeCache.GetCacheItem&lt;List&lt;GridEditor&gt;&gt;(
                        typeof(GridEditorsConfig) + &quot;Editors&quot;,
                        () =&gt; getResult(),
                        TimeSpan.FromMinutes(10));

                return result;
            }
            
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,153,0],[21,9,21,10,0],[22,13,22,30,0],[23,13,23,42,0],[24,13,24,38,0],[25,13,25,42,0],[26,13,26,32,0],[27,9,27,10,0],[32,13,32,14,0],[33,17,34,17,0],[34,17,34,18,0],[34,18,35,21,0],[35,21,35,58,0],[35,58,36,21,0],[36,21,36,101,0],[36,101,37,21,0],[37,21,37,49,0],[37,49,38,21,0],[38,21,38,22,0],[38,22,40,25,0],[40,25,40,26,0],[40,26,41,29,0],[41,29,41,82,0],[41,82,43,29,0],[43,29,43,77,0],[43,77,44,29,0],[44,29,44,54,0],[44,54,45,25,0],[45,25,45,26,0],[45,26,46,25,0],[46,25,46,45,0],[46,45,47,25,0],[47,25,47,26,0],[47,26,48,29,0],[48,29,48,142,0],[48,142,49,25,0],[49,25,49,26,0],[49,26,50,21,0],[50,21,50,22,0],[50,22,52,21,0],[52,21,52,81,0],[52,81,53,21,0],[53,21,53,78,0],[53,78,54,21,0],[54,21,54,28,0],[54,28,54,30,0],[54,30,54,44,0],[54,44,54,45,0],[54,45,54,47,0],[54,47,54,48,0],[54,48,54,67,0],[54,67,55,21,0],[55,21,55,22,0],[55,22,57,25,0],[57,25,57,67,0],[57,67,58,25,0],[58,25,58,26,0],[58,26,59,29,0],[59,29,59,53,0],[59,53,60,25,0],[60,25,60,26,0],[60,26,61,21,0],[61,21,61,22,0],[61,22,62,21,0],[62,21,62,36,0],[62,36,63,17,0],[63,17,63,18,0],[63,18,63,19,0],[33,17,63,19,0],[66,17,70,31,0],[70,31,70,42,0],[70,42,71,51,0],[66,17,71,51,0],[73,17,73,31,0],[74,13,74,14,0]]);
    </script>
  </body>
</html>