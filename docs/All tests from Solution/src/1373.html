<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\Cache\UserPermissionsCacheRefresher.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using Umbraco.Core;
using Umbraco.Core.Cache;
using Umbraco.Core.Models.Membership;

namespace Umbraco.Web.Cache
{
    /// &lt;summary&gt;
    /// Used only to invalidate the user permissions cache
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// The UserCacheRefresher will also clear a user&#39;s permissions cache, this refresher is for invalidating only permissions
    /// for users/content, not the users themselves.
    /// &lt;/remarks&gt;
    public sealed class UserPermissionsCacheRefresher : CacheRefresherBase&lt;UserPermissionsCacheRefresher&gt;
    {
        protected override UserPermissionsCacheRefresher Instance
        {
            get { return this; }
        }

        public override Guid UniqueIdentifier
        {
            get { return Guid.Parse(DistributedCache.UserPermissionsCacheRefresherId); }
        }


        public override string Name
        {
            get { return &quot;User permissions cache refresher&quot;; }
        }

        public override void RefreshAll()
        {
            if (UserPermissionsCache)
                UserPermissionsCache.Result.ClearCacheByKeySearch(CacheKeys.UserPermissionsCacheKey);    
            base.RefreshAll();
        }

        public override void Refresh(int id)
        {
            Remove(id);
            base.Refresh(id);
        }

        public override void Remove(int id)
        {
            if (UserPermissionsCache)
                UserPermissionsCache.Result.ClearCacheByKeySearch(string.Format(&quot;{0}{1}&quot;, CacheKeys.UserPermissionsCacheKey, id));
            base.Remove(id);
        }

        private Attempt&lt;IRuntimeCacheProvider&gt; UserPermissionsCache
        {
            get { return ApplicationContext.Current.ApplicationCache.IsolatedRuntimeCache.GetCache&lt;EntityPermission&gt;(); }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,17,19,18,0],[19,19,19,31,0],[19,32,19,33,0],[24,17,24,18,0],[24,19,24,87,0],[24,88,24,89,0],[30,17,30,18,0],[30,19,30,61,0],[30,62,30,63,0],[34,9,34,10,0],[35,13,35,38,0],[36,17,36,102,0],[37,13,37,31,0],[38,9,38,10,0],[41,9,41,10,0],[42,13,42,24,0],[43,13,43,30,0],[44,9,44,10,0],[47,9,47,10,0],[48,13,48,38,0],[49,17,49,131,0],[50,13,50,29,0],[51,9,51,10,0],[55,17,55,18,0],[55,19,55,120,0],[55,121,55,122,0]]);
    </script>
  </body>
</html>