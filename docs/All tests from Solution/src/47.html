<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\PublishedContent\PublishedContentTestElements.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;
using Umbraco.Core;
using Umbraco.Core.Models;
using Umbraco.Core.Models.PublishedContent;
using Umbraco.Web;
using Umbraco.Web.PublishedCache;

namespace Umbraco.Tests.PublishedContent
{
    class SolidPublishedCaches : IPublishedCaches
    {
        public readonly SolidPublishedContentCache ContentCache = new SolidPublishedContentCache();
        public readonly SolidPublishedMediaCache MediaCache = new SolidPublishedMediaCache();

        public ContextualPublishedContentCache CreateContextualContentCache(UmbracoContext context)
        {
            return new ContextualPublishedContentCache(ContentCache, context);
        }

        public ContextualPublishedMediaCache CreateContextualMediaCache(UmbracoContext context)
        {
            return new ContextualPublishedMediaCache(MediaCache, context);
        }
    }

    class SolidPublishedContentCache : IPublishedContentCache
    {
        private readonly Dictionary&lt;int, IPublishedContent&gt; _content = new Dictionary&lt;int, IPublishedContent&gt;();

        public void Add(SolidPublishedContent content)
        {
            _content[content.Id] = content.CreateModel();
        }

        public void Clear()
        {
            _content.Clear();
        }

        public void ContentHasChanged(UmbracoContext umbracoContext)
        {
            throw new NotImplementedException();
        }

        public IPublishedContent GetByRoute(UmbracoContext umbracoContext, bool preview, string route, bool? hideTopLevelNode = null)
        {
            throw new NotImplementedException();
        }

        public string GetRouteById(UmbracoContext umbracoContext, bool preview, int contentId)
        {
            throw new NotImplementedException();
        }

        public IPublishedContent GetById(UmbracoContext umbracoContext, bool preview, int contentId)
        {
            return _content.ContainsKey(contentId) ? _content[contentId] : null;
        }

        public IEnumerable&lt;IPublishedContent&gt; GetAtRoot(UmbracoContext umbracoContext, bool preview)
        {
            return _content.Values.Where(x =&gt; x.Parent == null);
        }

        public IPublishedContent GetSingleByXPath(UmbracoContext umbracoContext, bool preview, string xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public IPublishedContent GetSingleByXPath(UmbracoContext umbracoContext, bool preview, System.Xml.XPath.XPathExpression xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public IEnumerable&lt;IPublishedContent&gt; GetByXPath(UmbracoContext umbracoContext, bool preview, string xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public IEnumerable&lt;IPublishedContent&gt; GetByXPath(UmbracoContext umbracoContext, bool preview, System.Xml.XPath.XPathExpression xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public System.Xml.XPath.XPathNavigator GetXPathNavigator(UmbracoContext umbracoContext, bool preview)
        {
            throw new NotImplementedException();
        }

        public bool XPathNavigatorIsNavigable
        {
            get { throw new NotImplementedException(); }
        }

        public bool HasContent(UmbracoContext umbracoContext, bool preview)
        {
            return _content.Count &gt; 0;
        }

        public IPublishedProperty CreateDetachedProperty(PublishedPropertyType propertyType, object value, bool isPreviewing)
        {
            throw new NotImplementedException();
        }
    }

    class SolidPublishedMediaCache : IPublishedMediaCache
    {
        private readonly Dictionary&lt;int, IPublishedContent&gt; _media = new Dictionary&lt;int, IPublishedContent&gt;();

        public void Add(SolidPublishedContent content)
        {
            _media[content.Id] = content.CreateModel();
        }

        public void Clear()
        {
            _media.Clear();
        }

        public IPublishedContent GetById(UmbracoContext umbracoContext, bool preview, int contentId)
        {
            return _media.ContainsKey(contentId) ? _media[contentId] : null;
        }

        public IEnumerable&lt;IPublishedContent&gt; GetAtRoot(UmbracoContext umbracoContext, bool preview)
        {
            return _media.Values.Where(x =&gt; x.Parent == null);
        }

        public IPublishedContent GetSingleByXPath(UmbracoContext umbracoContext, bool preview, string xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public IPublishedContent GetSingleByXPath(UmbracoContext umbracoContext, bool preview, System.Xml.XPath.XPathExpression xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public IEnumerable&lt;IPublishedContent&gt; GetByXPath(UmbracoContext umbracoContext, bool preview, string xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public IEnumerable&lt;IPublishedContent&gt; GetByXPath(UmbracoContext umbracoContext, bool preview, System.Xml.XPath.XPathExpression xpath, Core.Xml.XPathVariable[] vars)
        {
            throw new NotImplementedException();
        }

        public System.Xml.XPath.XPathNavigator GetXPathNavigator(UmbracoContext umbracoContext, bool preview)
        {
            throw new NotImplementedException();
        }

        public bool XPathNavigatorIsNavigable
        {
            get { throw new NotImplementedException(); }
        }

        public bool HasContent(UmbracoContext umbracoContext, bool preview)
        {
            return _media.Count &gt; 0;
        }
    }

    class SolidPublishedContent : IPublishedContent
    {
        #region Constructor

        public SolidPublishedContent(PublishedContentType contentType)
        {
            // initialize boring stuff
            TemplateId = 0;
            WriterName = CreatorName = string.Empty;
            WriterId = CreatorId = 0;
            CreateDate = UpdateDate = DateTime.Now;
            Version = Guid.Empty;
            IsDraft = false;

            ContentType = contentType;
            DocumentTypeAlias = contentType.Alias;
            DocumentTypeId = contentType.Id;
        }

        #endregion

        #region Content

        public int Id { get; set; }
        public int TemplateId { get; set; }
        public int SortOrder { get; set; }
        public string Name { get; set; }
        public string UrlName { get; set; }
        public string DocumentTypeAlias { get; private set; }
        public int DocumentTypeId { get; private set; }
        public string WriterName { get; set; }
        public string CreatorName { get; set; }
        public int WriterId { get; set; }
        public int CreatorId { get; set; }
        public string Path { get; set; }
        public DateTime CreateDate { get; set; }
        public DateTime UpdateDate { get; set; }
        public Guid Version { get; set; }
        public int Level { get; set; }
        public string Url { get; set; }

        public PublishedItemType ItemType { get { return PublishedItemType.Content; } }
        public bool IsDraft { get; set; }

        public int GetIndex()
        {
            var index = this.Siblings().FindIndex(x =&gt; x.Id == Id);
            if (index &lt; 0)
                throw new IndexOutOfRangeException(&quot;Failed to find content in its siblings collection?!&quot;);
            return index;
        }

        #endregion

        #region Tree

        public int ParentId { get; set; }
        public IEnumerable&lt;int&gt; ChildIds { get; set; }

        public IPublishedContent Parent { get { return UmbracoContext.Current.ContentCache.GetById(ParentId); } }
        public IEnumerable&lt;IPublishedContent&gt; Children { get { return ChildIds.Select(id =&gt; UmbracoContext.Current.ContentCache.GetById(id)); } }

        #endregion

        #region ContentSet

        public IEnumerable&lt;IPublishedContent&gt; ContentSet { get { return this.Siblings(); } }

        #endregion

        #region ContentType

        public PublishedContentType ContentType { get; private set; }

        #endregion

        #region Properties

        public ICollection&lt;IPublishedProperty&gt; Properties { get; set; }

        public IPublishedProperty GetProperty(string alias)
        {
            return Properties.FirstOrDefault(p =&gt; p.PropertyTypeAlias.InvariantEquals(alias));
        }

        public IPublishedProperty GetProperty(string alias, bool recurse)
        {
            var property = GetProperty(alias);
            if (recurse == false) return property;

            IPublishedContent content = this;
            while (content != null &amp;&amp; (property == null || property.HasValue == false))
            {
                content = content.Parent;
                property = content == null ? null : content.GetProperty(alias);
            }

            return property;
        }

        public object this[string alias]
        {
            get
            {
                var property = GetProperty(alias);
                return property == null || property.HasValue == false ? null : property.Value;
            }
        }

        #endregion
    }

    class SolidPublishedProperty : IPublishedProperty
    {
        public SolidPublishedProperty()
        {
            // initialize boring stuff
        }

        public string PropertyTypeAlias { get; set; }
        public object DataValue { get; set; }
        public object Value { get; set; }
        public bool HasValue { get; set; }
        public object XPathValue { get; set; }
    }

    [PublishedContentModel(&quot;ContentType2&quot;)]
    internal class ContentType2 : PublishedContentModel
    {
        #region Plumbing

        public ContentType2(IPublishedContent content)
            : base(content)
        { }

        #endregion

        // fast, if you know that the appropriate IPropertyEditorValueConverter is wired
        public int Prop1 { get { return (int)this[&quot;prop1&quot;]; } }

        // almost as fast, not sure I like it as much, though
        //public int Prop1 { get { return this.GetPropertyValue&lt;int&gt;(&quot;prop1&quot;); } }
    }

    [PublishedContentModel(&quot;ContentType2Sub&quot;)]
    internal class ContentType2Sub : ContentType2
    {
        #region Plumbing

        public ContentType2Sub(IPublishedContent content)
            : base(content)
        { }

        #endregion
    }

    class PublishedContentStrong1 : PublishedContentExtended
    {
        public PublishedContentStrong1(IPublishedContent content)
            : base(content)
        { }

        public int StrongValue { get { return (int)this[&quot;strongValue&quot;]; } }
    }

    class PublishedContentStrong1Sub : PublishedContentStrong1
    {
        public PublishedContentStrong1Sub(IPublishedContent content)
            : base(content)
        { }

        public int AnotherValue { get { return (int)this[&quot;anotherValue&quot;]; } }
    }

    class PublishedContentStrong2 : PublishedContentExtended
    {
        public PublishedContentStrong2(IPublishedContent content)
            : base(content)
        { }

        public int StrongValue { get { return (int)this[&quot;strongValue&quot;]; } }
    }

    class AutoPublishedContentType : PublishedContentType
    {
        private static readonly PublishedPropertyType Default = new PublishedPropertyType(&quot;*&quot;, 0, &quot;?&quot;);

        public AutoPublishedContentType(int id, string alias, IEnumerable&lt;PublishedPropertyType&gt; propertyTypes)
            : base(id, alias, Enumerable.Empty&lt;string&gt;(), propertyTypes)
        { }

        public AutoPublishedContentType(int id, string alias, IEnumerable&lt;string&gt; compositionAliases, IEnumerable&lt;PublishedPropertyType&gt; propertyTypes)
            : base(id, alias, compositionAliases, propertyTypes)
        { }

        public override PublishedPropertyType GetPropertyType(string alias)
        {
            var propertyType = base.GetPropertyType(alias);
            return propertyType ?? Default;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,100,1],[17,9,17,94,1],[20,9,20,10,1],[21,13,21,79,1],[22,9,22,10,1],[25,9,25,10,1],[26,13,26,75,1],[27,9,27,10,1],[32,9,32,113,1],[35,9,35,10,1],[36,13,36,58,1],[37,9,37,10,1],[40,9,40,10,0],[41,13,41,30,0],[42,9,42,10,0],[45,9,45,10,0],[46,13,46,49,0],[50,9,50,10,0],[51,13,51,49,0],[55,9,55,10,0],[56,13,56,49,0],[60,9,60,10,1],[61,13,61,81,1],[62,9,62,10,1],[65,9,65,10,1],[66,13,66,47,1],[66,47,66,63,1],[66,63,66,65,1],[66,13,66,65,1],[67,9,67,10,1],[70,9,70,10,0],[71,13,71,49,0],[75,9,75,10,0],[76,13,76,49,0],[80,9,80,10,0],[81,13,81,49,0],[85,9,85,10,0],[86,13,86,49,0],[90,9,90,10,0],[91,13,91,49,0],[96,17,96,18,0],[96,19,96,55,0],[100,9,100,10,0],[101,13,101,39,0],[102,9,102,10,0],[105,9,105,10,0],[106,13,106,49,0],[112,9,112,111,1],[115,9,115,10,0],[116,13,116,56,0],[117,9,117,10,0],[120,9,120,10,0],[121,13,121,28,0],[122,9,122,10,0],[125,9,125,10,0],[126,13,126,77,0],[127,9,127,10,0],[130,9,130,10,0],[131,13,131,45,0],[131,45,131,61,0],[131,61,131,63,0],[131,13,131,63,0],[132,9,132,10,0],[135,9,135,10,0],[136,13,136,49,0],[140,9,140,10,0],[141,13,141,49,0],[145,9,145,10,0],[146,13,146,49,0],[150,9,150,10,0],[151,13,151,49,0],[155,9,155,10,0],[156,13,156,49,0],[161,17,161,18,0],[161,19,161,55,0],[165,9,165,10,0],[166,13,166,37,0],[167,9,167,10,0],[174,9,174,71,1],[175,9,175,10,1],[177,13,177,28,1],[178,13,178,53,1],[179,13,179,38,1],[180,13,180,52,1],[181,13,181,34,1],[182,13,182,29,1],[184,13,184,39,1],[185,13,185,51,1],[186,13,186,45,1],[187,9,187,10,1],[193,25,193,29,1],[193,30,193,34,1],[194,33,194,37,0],[194,38,194,42,1],[195,32,195,36,0],[195,37,195,41,1],[196,30,196,34,1],[196,35,196,39,1],[197,33,197,37,0],[197,38,197,42,1],[198,43,198,47,1],[198,48,198,60,1],[199,37,199,41,0],[199,42,199,54,1],[200,36,200,40,0],[200,41,200,45,1],[201,37,201,41,0],[201,42,201,46,1],[202,31,202,35,0],[202,36,202,40,1],[203,32,203,36,0],[203,37,203,41,1],[204,30,204,34,0],[204,35,204,39,1],[205,38,205,42,0],[205,43,205,47,1],[206,38,206,42,0],[206,43,206,47,1],[207,31,207,35,0],[207,36,207,40,1],[208,28,208,32,0],[208,33,208,37,1],[209,29,209,33,0],[209,34,209,38,1],[211,49,211,50,1],[211,51,211,84,1],[211,85,211,86,1],[212,31,212,35,0],[212,36,212,40,1],[215,9,215,10,1],[216,13,216,56,1],[216,56,216,66,1],[216,66,216,68,1],[216,13,216,68,1],[217,13,217,27,1],[218,17,218,107,0],[219,13,219,26,1],[220,9,220,10,1],[226,31,226,35,1],[226,36,226,40,1],[227,44,227,48,0],[227,49,227,53,1],[229,47,229,48,1],[229,49,229,110,1],[229,111,229,112,1],[230,62,230,63,0],[230,64,230,93,0],[230,93,230,140,0],[230,140,230,142,0],[230,64,230,142,0],[230,143,230,144,0],[236,64,236,65,1],[236,66,236,89,1],[236,90,236,91,1],[242,51,242,55,0],[242,56,242,68,1],[248,61,248,65,1],[248,66,248,70,1],[251,9,251,10,1],[252,13,252,51,1],[252,51,252,93,1],[252,93,252,95,1],[252,13,252,95,1],[253,9,253,10,1],[256,9,256,10,1],[257,13,257,47,1],[258,13,258,34,1],[258,35,258,51,1],[260,13,260,46,0],[261,13,261,88,0],[262,13,262,14,0],[263,17,263,42,0],[264,17,264,80,0],[265,13,265,14,0],[267,13,267,29,0],[268,9,268,10,1],[273,13,273,14,1],[274,17,274,51,1],[275,17,275,95,1],[276,13,276,14,1],[284,9,284,40,1],[285,9,285,10,1],[287,9,287,10,1],[289,43,289,47,1],[289,48,289,52,1],[290,35,290,39,0],[290,40,290,44,1],[291,31,291,35,1],[291,36,291,40,1],[292,32,292,36,1],[292,37,292,41,1],[293,36,293,40,0],[293,41,293,45,0],[302,15,302,28,1],[303,9,303,10,1],[303,11,303,12,1],[308,32,308,33,1],[308,34,308,60,1],[308,61,308,62,1],[320,15,320,28,1],[321,9,321,10,1],[321,11,321,12,1],[329,15,329,28,0],[330,9,330,10,0],[330,11,330,12,0],[332,38,332,39,0],[332,40,332,72,0],[332,73,332,74,0],[338,15,338,28,0],[339,9,339,10,0],[339,11,339,12,0],[341,39,341,40,0],[341,41,341,74,0],[341,75,341,76,0],[347,15,347,28,0],[348,9,348,10,0],[348,11,348,12,0],[350,38,350,39,0],[350,40,350,72,0],[350,73,350,74,0],[355,9,355,104,1],[358,15,358,73,1],[359,9,359,10,1],[359,11,359,12,1],[362,15,362,65,1],[363,9,363,10,1],[363,11,363,12,1],[366,9,366,10,1],[367,13,367,60,1],[368,13,368,44,1],[369,9,369,10,1]]);
    </script>
  </body>
</html>