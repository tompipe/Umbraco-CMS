<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Trees\loadUsers.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Text;
using System.Web;
using System.Xml;
using System.Configuration;
using Umbraco.Core.Configuration;
using umbraco.BasePages;
using umbraco.BusinessLogic;
using umbraco.businesslogic;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.cache;
using umbraco.cms.businesslogic.contentitem;
using umbraco.cms.businesslogic.datatype;
using umbraco.cms.businesslogic.language;
using umbraco.cms.businesslogic.media;
using umbraco.cms.businesslogic.member;
using umbraco.cms.businesslogic.property;
using umbraco.cms.businesslogic.web;
using umbraco.interfaces;
using umbraco.DataLayer;
using umbraco.BusinessLogic.Utils;
using umbraco.cms.presentation.Trees;
using umbraco.BusinessLogic.Actions;
using System.Linq;
using Umbraco.Core;


namespace umbraco
{
	/// &lt;summary&gt;
	/// Handles loading of all umbraco users into the users application tree
	/// &lt;/summary&gt;
    [Tree(Constants.Applications.Users, &quot;users&quot;, &quot;Users&quot;)]
    public class loadUsers : BaseTree
	{
        public loadUsers(string application) : base(application) { }

        protected override void CreateRootNode(ref XmlTreeNode rootNode)
        {                        
        }

		/// &lt;summary&gt;
		/// Renders the Javascript.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;Javascript&quot;&gt;The javascript.&lt;/param&gt;
		public override void RenderJS(ref StringBuilder Javascript)
        {
            Javascript.Append(
                @&quot;
function openUser(id) {
	UmbClientMgr.contentFrame(&#39;users/editUser.aspx?id=&#39; + id);
}
&quot;);
        }

        protected override void CreateAllowedActions(ref List&lt;IAction&gt; actions)
        {
            actions.Clear();
            actions.Add(ActionDisable.Instance);
        }

        public override void Render(ref XmlTree tree)
        {
            var users = new List&lt;User&gt;(User.getAll());

            User currUser = UmbracoEnsuredPage.CurrentUser;

            bool currUserIsAdmin = currUser.IsAdmin();
            foreach (User u in users.OrderBy(x =&gt; x.Disabled))
            {
                if (!UmbracoConfig.For.UmbracoSettings().Security.HideDisabledUsersInBackoffice
                    || (UmbracoConfig.For.UmbracoSettings().Security.HideDisabledUsersInBackoffice &amp;&amp; !u.Disabled))
                {

                    XmlTreeNode xNode = XmlTreeNode.Create(this);

                    // special check for ROOT user
                    if (u.Id == 0)
                    {
                        //if its the administrator, don&#39;t create a menu
                        xNode.Menu = null;
                        //if the current user is not the administrator, then don&#39;t add this node.
                        if (currUser.Id != 0)
                            continue;
                    }
                    // Special check for admins in general (only show admins to admins)
                    else if (!currUserIsAdmin &amp;&amp; u.IsAdmin())
                    {
                        continue;
                    }





                    //xNode.IconClass = &quot;umbraco-tree-icon-grey&quot;;

                    xNode.NodeID = u.Id.ToString();
                    xNode.Text = u.Name;
                    xNode.Action = &quot;javascript:openUser(&quot; + u.Id + &quot;);&quot;;
                    xNode.Icon = &quot;icon-user&quot;;
                    xNode.OpenIcon = &quot;icon-user&quot;;

                    if (u.Disabled) {
                        xNode.Style.DimNode();
                    }

                    OnBeforeNodeRender(ref tree, ref xNode, EventArgs.Empty);
                    if (xNode != null)
                    {
                        tree.Add(xNode);
                        OnAfterNodeRender(ref tree, ref xNode, EventArgs.Empty);
                    }
                

                }
                
                
            }
        }

	}
    
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[40,48,40,65,0],[40,66,40,67,0],[40,68,40,69,0],[43,9,43,10,0],[44,9,44,10,0],[51,9,51,10,0],[52,13,57,4,0],[58,9,58,10,0],[61,9,61,10,0],[62,13,62,29,0],[63,13,63,49,0],[64,9,64,10,0],[67,9,67,10,0],[68,13,68,55,0],[70,13,70,60,0],[72,13,72,55,0],[73,13,73,20,0],[73,22,73,28,0],[73,29,73,31,0],[73,32,73,51,0],[73,51,73,61,0],[73,61,73,62,0],[73,32,73,62,0],[74,13,74,14,0],[75,17,76,116,0],[77,17,77,18,0],[79,21,79,66,0],[82,21,82,35,0],[83,21,83,22,0],[85,25,85,43,0],[87,25,87,46,0],[88,29,88,38,0],[89,21,89,22,0],[91,26,91,62,0],[92,21,92,22,0],[93,25,93,34,0],[102,21,102,52,0],[103,21,103,41,0],[104,21,104,73,0],[105,21,105,46,0],[106,21,106,50,0],[108,21,108,36,0],[108,37,108,38,0],[109,25,109,47,0],[110,21,110,22,0],[112,21,112,78,0],[113,21,113,39,0],[114,21,114,22,0],[115,25,115,41,0],[116,25,116,81,0],[117,21,117,22,0],[120,17,120,18,0],[123,13,123,14,0],[124,9,124,10,0]]);
    </script>
  </body>
</html>