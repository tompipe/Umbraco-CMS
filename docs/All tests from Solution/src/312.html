<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Routing\ContentFinderByNiceUrlAndTemplateTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using NUnit.Framework;
using Umbraco.Tests.TestHelpers;
using Umbraco.Web.Routing;
using umbraco.BusinessLogic;
using Umbraco.Core.Models;

namespace Umbraco.Tests.Routing
{
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerFixture)]
	[TestFixture]
	public class ContentFinderByNiceUrlAndTemplateTests : BaseRoutingTest
	{
        Template CreateTemplate(string alias)
        {
            var template = new Template(alias, alias, alias);
            template.Content = &quot;&quot;; // else saving throws with a dirty internal error
            ApplicationContext.Services.FileService.SaveTemplate(template);
            return template;
        }

		[TestCase(&quot;/blah&quot;)]
		[TestCase(&quot;/default.aspx/blah&quot;)] //this one is actually rather important since this is the path that comes through when we are running in pre-IIS 7 for the root document &#39;/&#39; !
		[TestCase(&quot;/home/Sub1/blah&quot;)]
		[TestCase(&quot;/Home/Sub1/Blah&quot;)] //different cases
		[TestCase(&quot;/home/Sub1.aspx/blah&quot;)]
		public void Match_Document_By_Url_With_Template(string urlAsString)
		{
            var template = CreateTemplate(&quot;test&quot;);
            var altTemplate = CreateTemplate(&quot;blah&quot;);
			var routingContext = GetRoutingContext(urlAsString, template);
			var url = routingContext.UmbracoContext.CleanedUmbracoUrl; //very important to use the cleaned up umbraco url
			var docRequest = new PublishedContentRequest(url, routingContext);
			var lookup = new ContentFinderByNiceUrlAndTemplate();

		    SettingsForTests.HideTopLevelNodeFromPath = false;

			var result = lookup.TryFindContent(docRequest);

			Assert.IsTrue(result);
			Assert.IsNotNull(docRequest.PublishedContent);
			Assert.IsNotNull(docRequest.TemplateAlias);
			Assert.AreEqual(&quot;blah&quot;.ToUpperInvariant(), docRequest.TemplateAlias.ToUpperInvariant());
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,10,1],[15,13,15,62,1],[16,13,16,35,1],[17,13,17,76,1],[18,13,18,29,1],[19,9,19,10,1],[27,3,27,4,1],[28,13,28,51,1],[29,13,29,54,1],[30,4,30,66,1],[31,4,31,62,1],[32,4,32,70,1],[33,4,33,57,1],[35,7,35,57,1],[37,4,37,51,1],[39,4,39,26,1],[40,4,40,50,1],[41,4,41,47,1],[42,4,42,92,1],[43,3,43,4,1]]);
    </script>
  </body>
</html>