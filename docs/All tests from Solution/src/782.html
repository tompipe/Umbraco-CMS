<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\WebApi\MemberAuthorizeAttribute.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Http;
using Umbraco.Web.Security;
using umbraco.cms.businesslogic.member;
using Umbraco.Core;

namespace Umbraco.Web.WebApi
{
    /// &lt;summary&gt;
    /// Attribute for attributing controller actions to restrict them
    /// to just authenticated members, and optionally of a particular type and/or group
    /// &lt;/summary&gt;
    public sealed class MemberAuthorizeAttribute : AuthorizeAttribute
    {        
        private readonly UmbracoContext _umbracoContext;

        private UmbracoContext GetUmbracoContext()
        {
            return _umbracoContext ?? UmbracoContext.Current;
        }

        /// &lt;summary&gt;
        /// THIS SHOULD BE ONLY USED FOR UNIT TESTS
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;umbracoContext&quot;&gt;&lt;/param&gt;
        public MemberAuthorizeAttribute(UmbracoContext umbracoContext)
        {
            if (umbracoContext == null) throw new ArgumentNullException(&quot;umbracoContext&quot;);
            _umbracoContext = umbracoContext;
        }

        public MemberAuthorizeAttribute()
        {

        }

        /// &lt;summary&gt;
        /// Flag for whether to allow all site visitors or just authenticated members
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// This is the same as applying the [AllowAnonymous] attribute
        /// &lt;/remarks&gt;
        [Obsolete(&quot;Use [AllowAnonymous] instead&quot;)]
        public bool AllowAll { get; set; }

        /// &lt;summary&gt;
        /// Comma delimited list of allowed member types
        /// &lt;/summary&gt;
        public string AllowType { get; set; }

        /// &lt;summary&gt;
        /// Comma delimited list of allowed member groups
        /// &lt;/summary&gt;
        public string AllowGroup { get; set; }

        /// &lt;summary&gt;
        /// Comma delimited list of allowed members
        /// &lt;/summary&gt;
        public string AllowMembers { get; set; }

        protected override bool IsAuthorized(System.Web.Http.Controllers.HttpActionContext actionContext)
        {
            if (AllowMembers.IsNullOrWhiteSpace())
                AllowMembers = &quot;&quot;;
            if (AllowGroup.IsNullOrWhiteSpace())
                AllowGroup = &quot;&quot;;
            if (AllowType.IsNullOrWhiteSpace())
                AllowType = &quot;&quot;;

            var members = new List&lt;int&gt;();
            foreach (var s in AllowMembers.Split(&#39;,&#39;))
            {
                int id;
                if (int.TryParse(s, out id))
                {
                    members.Add(id);
                }
            }

            return GetUmbracoContext().Security.IsMemberAuthorized(AllowAll,
                                                  AllowType.Split(&#39;,&#39;),
                                                  AllowGroup.Split(&#39;,&#39;),
                                                  members);
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,10,0],[22,13,22,62,0],[23,9,23,10,0],[29,9,29,71,0],[30,9,30,10,0],[31,13,31,40,0],[31,41,31,91,0],[32,13,32,46,0],[33,9,33,10,0],[35,9,35,42,0],[36,9,36,10,0],[38,9,38,10,0],[47,32,47,36,0],[47,37,47,41,0],[52,35,52,39,0],[52,40,52,44,0],[57,36,57,40,0],[57,41,57,45,0],[62,38,62,42,0],[62,43,62,47,0],[65,9,65,10,0],[66,13,66,51,0],[67,17,67,35,0],[68,13,68,49,0],[69,17,69,33,0],[70,13,70,48,0],[71,17,71,32,0],[73,13,73,43,0],[74,13,74,20,0],[74,22,74,27,0],[74,28,74,30,0],[74,31,74,54,0],[75,13,75,14,0],[77,17,77,45,0],[78,17,78,18,0],[79,21,79,37,0],[80,17,80,18,0],[81,13,81,14,0],[83,13,86,60,0],[87,9,87,10,0]]);
    </script>
  </body>
</html>