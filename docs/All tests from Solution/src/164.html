<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Tests\Services\TagServiceTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Linq;
using NUnit.Framework;
using Umbraco.Core.Models;
using Umbraco.Core.Services;
using Umbraco.Tests.TestHelpers;
using Umbraco.Tests.TestHelpers.Entities;

namespace Umbraco.Tests.Services
{
    /// &lt;summary&gt;
    /// Tests covering methods in the TagService class.
    /// This is more of an integration test as it involves multiple layers
    /// as well as configuration.
    /// &lt;/summary&gt;
    [DatabaseTestBehavior(DatabaseBehavior.NewDbFileAndSchemaPerTest)]
    [TestFixture, RequiresSTA]
    public class TagServiceTests : BaseServiceTest
    {
        [SetUp]
        public override void Initialize()
        {
	        base.Initialize();
        }
		
		[TearDown]
		public override void TearDown()
		{   
      		base.TearDown();
		}

        [Test]
        public void TagList_Contains_NodeCount()
        {
            var contentService = ServiceContext.ContentService;
            var contentTypeService = ServiceContext.ContentTypeService;
            var tagService = ServiceContext.TagService;
            var contentType = MockedContentTypes.CreateSimpleContentType(&quot;umbMandatory&quot;, &quot;Mandatory Doc Type&quot;, true);
            contentType.PropertyGroups.First().PropertyTypes.Add(
                new PropertyType(&quot;test&quot;, DataTypeDatabaseType.Ntext, &quot;tags&quot;)
                {
                    DataTypeDefinitionId = 1041
                });
            contentTypeService.Save(contentType);

            var content1 = MockedContent.CreateSimpleContent(contentType, &quot;Tagged content 1&quot;, -1);
            content1.SetTags(&quot;tags&quot;, new[] { &quot;cow&quot;, &quot;pig&quot;, &quot;goat&quot; }, true);
            contentService.Publish(content1);

            var content2 = MockedContent.CreateSimpleContent(contentType, &quot;Tagged content 2&quot;, -1);
            content2.SetTags(&quot;tags&quot;, new[] { &quot;cow&quot;, &quot;pig&quot; }, true);
            contentService.Publish(content2);

            var content3 = MockedContent.CreateSimpleContent(contentType, &quot;Tagged content 3&quot;, -1);
            content3.SetTags(&quot;tags&quot;, new[] { &quot;cow&quot; }, true);
            contentService.Publish(content3);

            // Act            
            var tags = tagService.GetAllContentTags()
                .OrderByDescending(x =&gt; x.NodeCount)
                .ToList();

            // Assert
            Assert.AreEqual(3, tags.Count());
            Assert.AreEqual(&quot;cow&quot;, tags[0].Text);
            Assert.AreEqual(3, tags[0].NodeCount);
            Assert.AreEqual(&quot;pig&quot;, tags[1].Text);
            Assert.AreEqual(2, tags[1].NodeCount);
            Assert.AreEqual(&quot;goat&quot;, tags[2].Text);
            Assert.AreEqual(1, tags[2].NodeCount);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,10,1],[22,10,22,28,1],[23,9,23,10,1],[27,3,27,4,1],[28,9,28,25,1],[29,3,29,4,1],[33,9,33,10,1],[34,13,34,64,1],[35,13,35,72,1],[36,13,36,56,1],[37,13,37,118,1],[38,13,42,20,1],[43,13,43,50,1],[45,13,45,99,1],[46,13,46,76,1],[47,13,47,46,1],[49,13,49,99,1],[50,13,50,68,1],[51,13,51,46,1],[53,13,53,99,1],[54,13,54,61,1],[55,13,55,46,1],[58,13,59,41,1],[59,41,59,52,1],[59,52,60,27,1],[58,13,60,27,1],[63,13,63,46,1],[64,13,64,50,1],[65,13,65,51,1],[66,13,66,50,1],[67,13,67,51,1],[68,13,68,51,1],[69,13,69,51,1],[70,9,70,10,1]]);
    </script>
  </body>
</html>