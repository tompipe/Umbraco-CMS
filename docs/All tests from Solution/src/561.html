<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\webservices\trashcan.asmx.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Web.Script.Services;
using System.Web.Services;
using System.ComponentModel;
using Umbraco.Web.WebServices;
using umbraco.BasePages;
using umbraco.BusinessLogic;
using umbraco.cms.businesslogic;

namespace umbraco.presentation.webservices
{
    /// &lt;summary&gt;
    /// Summary description for trashcan
    /// &lt;/summary&gt;
    [WebService(Namespace = &quot;http://umbraco.org/webservices&quot;)]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    [ToolboxItem(false)]
    [ScriptService]
    public class trashcan : UmbracoAuthorizedWebService
    {
        [WebMethod]
        public void EmptyTrashcan(RecycleBin.RecycleBinType type)
        {
            //validate against the app type!
            switch (type)
            {
                case RecycleBin.RecycleBinType.Content:
                    if (!AuthorizeRequest(DefaultApps.content.ToString())) return;
                    break;
                case RecycleBin.RecycleBinType.Media:
                    if (!AuthorizeRequest(DefaultApps.media.ToString())) return;
                    break;
                default:
                    throw new ArgumentOutOfRangeException(&quot;type&quot;);
            }

            //TODO: This will never work in LB scenarios
            Application[&quot;trashcanEmptyLeft&quot;] = RecycleBin.Count(type).ToString();
            emptyTrashCanDo(type);
        }

        [WebMethod]
        public string GetTrashStatus()
        {
            //TODO: This will never work in LB scenarios

            if (AuthorizeRequest())
            {
                return Application[&quot;trashcanEmptyLeft&quot;] != null 
                    ? Application[&quot;trashcanEmptyLeft&quot;].ToString() 
                    : &quot;&quot;;
            }

            return &quot;-&quot;;

        }

        private void emptyTrashCanDo(RecycleBin.RecycleBinType type)
        {
            var trashCan = new RecycleBin(type);

            var callback = new Action&lt;int&gt;(x =&gt;
            {
                Application.Lock();
                Application[&quot;trashcanEmptyLeft&quot;] = x.ToString();
                Application.UnLock();
            });

            trashCan.CallTheGarbageMan(callback);
            
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,0],[25,13,25,26,0],[28,21,28,75,0],[28,76,28,83,0],[29,21,29,27,0],[31,21,31,73,0],[31,74,31,81,0],[32,21,32,27,0],[34,21,34,67,0],[38,13,38,82,0],[39,13,39,35,0],[40,9,40,10,0],[44,9,44,10,0],[47,13,47,36,0],[48,13,48,14,0],[49,17,51,26,0],[54,13,54,24,0],[56,9,56,10,0],[59,9,59,10,0],[60,13,60,49,0],[62,13,63,13,0],[63,13,63,14,0],[63,14,64,17,0],[64,17,64,36,0],[64,36,65,17,0],[65,17,65,65,0],[65,65,66,17,0],[66,17,66,38,0],[66,38,67,13,0],[67,13,67,14,0],[67,14,67,16,0],[62,13,67,16,0],[69,13,69,50,0],[71,9,71,10,0]]);
    </script>
  </body>
</html>