<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Web\umbraco.presentation\umbraco\Trees\loadPackager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Text;
using System.Web;
using System.Xml;
using System.Configuration;
using umbraco.BasePages;
using umbraco.BusinessLogic;
using umbraco.businesslogic;
using umbraco.cms.businesslogic;
using umbraco.cms.businesslogic.cache;
using umbraco.cms.businesslogic.contentitem;
using umbraco.cms.businesslogic.datatype;
using umbraco.cms.businesslogic.language;
using umbraco.cms.businesslogic.media;
using umbraco.cms.businesslogic.member;
using umbraco.cms.businesslogic.property;
using umbraco.cms.businesslogic.web;
using umbraco.interfaces;
using umbraco.DataLayer;
using umbraco.BusinessLogic.Utils;
using Umbraco.Core;
using umbraco.cms.presentation.Trees;

namespace umbraco
{
    /// &lt;summary&gt;
    /// Handles loading of the packager application into the developer application tree
    /// &lt;/summary&gt;
    //[Tree(Constants.Applications.Developer, &quot;packager&quot;, &quot;Packages&quot;, sortOrder: 3)]
    [Obsolete(&quot;This is no longer used and will be removed from the codebase in the future&quot;)]
    public class loadPackager : BaseTree
    {
        #region TreeI Members
        public loadPackager(string application) : base(application) { }
        protected override void CreateRootNode(ref XmlTreeNode rootNode)
        {
            
        }

        private int _id;
        private string _app;

        /// &lt;summary&gt;
        /// Sets the id.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The id.&lt;/value&gt;
        public int id
        {
            set { _id = value; }
        }

        /// &lt;summary&gt;
        /// Sets the app.
        /// &lt;/summary&gt;
        /// &lt;value&gt;The app.&lt;/value&gt;
        public string app
        {
            set { _app = value; }
        }

        protected override void CreateAllowedActions(ref List&lt;IAction&gt; actions)
        {
            actions.Clear();
            actions.Add(umbraco.BusinessLogic.Actions.ActionRefresh.Instance);
        }

        protected override void CreateRootNodeActions(ref List&lt;IAction&gt; actions)
        {
            actions.Clear();

            // U4-4422 : There is no variable nodes on this so no need to reload nodes
            //actions.Add(umbraco.BusinessLogic.Actions.ActionRefresh.Instance);
        }

        /// &lt;summary&gt;
        /// Renders the Javascript.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;Javascript&quot;&gt;The javascript.&lt;/param&gt;
        public override void RenderJS(ref StringBuilder Javascript)
        {
            Javascript.Append(
            @&quot;function openPackageCategory(url) {
			UmbClientMgr.contentFrame(&#39;developer/packages/&#39; + url);}&quot;
            );
        }

        /// &lt;summary&gt;
        /// Renders the specified tree item.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tree&quot;&gt;The tree.&lt;/param&gt;
        public override void Render(ref XmlTree tree)
        {            
            string[,] items = { { &quot;BrowseRepository.aspx&quot;, &quot;Install from repository&quot; }, { &quot;CreatePackage.aspx&quot;, &quot;Created Packages&quot; }, { &quot;installedPackages.aspx&quot;, &quot;Installed packages&quot; }, { &quot;StarterKits.aspx&quot;, &quot;Starter kit&quot; }, { &quot;installer.aspx&quot;, &quot;Install local package&quot; } };


            for (int i = 0; i &lt;= items.GetUpperBound(0); i++)
            {
                XmlTreeNode xNode = XmlTreeNode.Create(this);
                xNode.NodeID = (i + 1).ToInvariantString();
                xNode.Text = items[i, 1];
                xNode.Icon = &quot;icon-folder&quot;;
                xNode.OpenIcon = &quot;icon-folder&quot;;
                
                
                //Make sure the different sections load the correct childnodes.
                switch (items[i, 0])
                {
                    case &quot;installedPackages.aspx&quot;:
                        
                        if (cms.businesslogic.packager.InstalledPackage.GetAllInstalledPackages().Count &gt; 0)
                        {
                            xNode.Source = &quot;tree.aspx?app=&quot; + this._app + &quot;&amp;id=&quot; + this._id + &quot;&amp;treeType=packagerPackages&amp;packageType=installed&quot; + &quot;&amp;rnd=&quot; + Guid.NewGuid();
                            xNode.NodeType = &quot;installedPackages&quot;;                            
                            xNode.Text =  ui.Text(&quot;treeHeaders&quot;, &quot;installedPackages&quot;);
                            xNode.HasChildren = true;
                        }
                        else
                        {
                            xNode.Text = &quot;&quot;;
                        }

                        xNode.Action = &quot;javascript:void(0);&quot;;

                        break;


                    case &quot;BrowseRepository.aspx&quot;:

                        /*
                        //Gets all the repositories registered in umbracoSettings.config
                        var repos = cms.businesslogic.packager.repositories.Repository.getAll();
                        

                        //if more then one repo, then list them as child nodes under the &quot;Install from repository&quot; node.
                        // the repositories will then be fetched from the loadPackages class.
                        if (repos.Count &gt; 1)
                        {
                            xNode.Source = &quot;tree.aspx?app=&quot; + this._app + &quot;&amp;id=&quot; + this._id + &quot;&amp;treeType=packagerPackages&amp;packageType=repositories&quot; + &quot;&amp;rnd=&quot; + Guid.NewGuid();
                            xNode.NodeType = &quot;packagesRepositories&quot;;                            
                            xNode.Text = ui.Text(&quot;treeHeaders&quot;, &quot;repositories&quot;);
                            xNode.HasChildren = true;
                        }
                        */
                        //if only one repo, then just list it directly and name it as the repository.
                        //the packages will be loaded from the loadPackages class with a repoAlias querystring
                        var repos = cms.businesslogic.packager.repositories.Repository.getAll();
                        
                        xNode.Text = repos[0].Name;
                        xNode.Source = &quot;tree.aspx?app=&quot; + this._app + &quot;&amp;id=&quot; + this._id + &quot;&amp;treeType=packagerPackages&amp;packageType=repository&amp;repoGuid=&quot; + repos[0].Guid + &quot;&amp;rnd=&quot; + Guid.NewGuid();
                        xNode.NodeType = &quot;packagesRepository&quot;;
                        xNode.Action = &quot;javascript:openPackageCategory(&#39;BrowseRepository.aspx?repoGuid=&quot; + repos[0].Guid + &quot;&#39;);&quot;;
                        xNode.Icon = &quot;icon-server-alt&quot;;
                        xNode.HasChildren = true;

                        break;


                    case &quot;CreatePackage.aspx&quot;:
                        xNode.Source = &quot;tree.aspx?app=&quot; + this._app + &quot;&amp;id=&quot; + this._id + &quot;&amp;treeType=packagerPackages&amp;packageType=created&quot; + &quot;&amp;rnd=&quot; + Guid.NewGuid();
                        xNode.NodeType = &quot;createdPackages&quot;;
                        xNode.Menu.Clear();                        
                        xNode.Menu.Add(umbraco.BusinessLogic.Actions.ActionNew.Instance);
                        xNode.Menu.Add(umbraco.BusinessLogic.Actions.ActionRefresh.Instance);
                        xNode.Text = ui.Text(&quot;treeHeaders&quot;, &quot;createdPackages&quot;);
                        xNode.HasChildren = true;
                        xNode.Action = &quot;javascript:void(0);&quot;;
                        
                        break;

                    case &quot;installer.aspx&quot;:
                        xNode.Source = &quot;&quot;;
                        xNode.NodeType = &quot;uploadPackage&quot;;
                        xNode.Icon = &quot;icon-page-up&quot;;
                        xNode.Action = &quot;javascript:openPackageCategory(&#39;&quot; + items[i, 0] + &quot;&#39;);&quot;;
                        xNode.Text = ui.Text(&quot;treeHeaders&quot;, &quot;localPackage&quot;);
                        xNode.Menu.Clear();
                        break;

                    case &quot;StarterKits.aspx&quot;:
                        xNode.Source = &quot;&quot;;
                        xNode.NodeType = &quot;starterKits&quot;;
                        xNode.Action = &quot;javascript:openPackageCategory(&#39;&quot; + items[i, 0] + &quot;&#39;);&quot;;
                        xNode.Icon = &quot;icon-flash&quot;;
                        xNode.Text = ui.Text(&quot;treeHeaders&quot;, &quot;installStarterKit&quot;);
                        xNode.Menu.Clear();
                        break;

                    default:
                        break;
                }

                if (xNode.Text != &quot;&quot;)
                    tree.Add(xNode);
            }

        }
    }

        #endregion
    
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[38,51,38,68,0],[38,69,38,70,0],[38,71,38,72,0],[40,9,40,10,0],[42,9,42,10,0],[53,17,53,18,0],[53,19,53,31,0],[53,32,53,33,0],[62,17,62,18,0],[62,19,62,32,0],[62,33,62,34,0],[66,9,66,10,0],[67,13,67,29,0],[68,13,68,79,0],[69,9,69,10,0],[72,9,72,10,0],[73,13,73,29,0],[77,9,77,10,0],[84,9,84,10,0],[85,13,88,15,0],[89,9,89,10,0],[96,9,96,10,0],[97,13,97,274,0],[100,18,100,27,0],[100,29,100,56,0],[100,58,100,61,0],[101,13,101,14,0],[102,17,102,62,0],[103,17,103,60,0],[104,17,104,42,0],[105,17,105,44,0],[106,17,106,48,0],[110,17,110,37,0],[114,25,114,109,0],[115,25,115,26,0],[116,29,116,173,0],[117,29,117,66,0],[118,29,118,87,0],[119,29,119,54,0],[120,25,120,26,0],[122,25,122,26,0],[123,29,123,45,0],[124,25,124,26,0],[126,25,126,62,0],[128,25,128,31,0],[150,25,150,97,0],[152,25,152,52,0],[153,25,153,196,0],[154,25,154,63,0],[155,25,155,130,0],[156,25,156,56,0],[157,25,157,50,0],[159,25,159,31,0],[163,25,163,167,0],[164,25,164,60,0],[165,25,165,44,0],[166,25,166,90,0],[167,25,167,94,0],[168,25,168,80,0],[169,25,169,50,0],[170,25,170,62,0],[172,25,172,31,0],[175,25,175,43,0],[176,25,176,58,0],[177,25,177,53,0],[178,25,178,97,0],[179,25,179,77,0],[180,25,180,44,0],[181,25,181,31,0],[184,25,184,43,0],[185,25,185,56,0],[186,25,186,97,0],[187,25,187,51,0],[188,25,188,82,0],[189,25,189,44,0],[190,25,190,31,0],[193,25,193,31,0],[196,17,196,38,0],[197,21,197,37,0],[198,13,198,14,0],[200,9,200,10,0]]);
    </script>
  </body>
</html>