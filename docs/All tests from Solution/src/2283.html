<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tom Pipe\Documents\Hexadigital\Code\Umbraco\Umbraco-CMS\src\Umbraco.Core\Cache\IsolatedRuntimeCache.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Concurrent;

namespace Umbraco.Core.Cache
{
    /// &lt;summary&gt;
    /// Used to get/create/manipulate isolated runtime cache
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// This is useful for repository level caches to ensure that cache lookups by key are fast so 
    /// that the repository doesn&#39;t need to search through all keys on a global scale.
    /// &lt;/remarks&gt;
    public class IsolatedRuntimeCache
    {
        internal Func&lt;Type, IRuntimeCacheProvider&gt; CacheFactory { get; set; }

        /// &lt;summary&gt;
        /// Constructor that allows specifying a factory for the type of runtime isolated cache to create
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;cacheFactory&quot;&gt;&lt;/param&gt;
        public IsolatedRuntimeCache(Func&lt;Type, IRuntimeCacheProvider&gt; cacheFactory)
        {
            CacheFactory = cacheFactory;
        }

        private readonly ConcurrentDictionary&lt;Type, IRuntimeCacheProvider&gt; _isolatedCache = new ConcurrentDictionary&lt;Type, IRuntimeCacheProvider&gt;();

        /// &lt;summary&gt;
        /// Returns an isolated runtime cache for a given type
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;returns&gt;&lt;/returns&gt;        
        public IRuntimeCacheProvider GetOrCreateCache&lt;T&gt;()
        {
            return _isolatedCache.GetOrAdd(typeof(T), type =&gt; CacheFactory(type));
        }

        /// &lt;summary&gt;
        /// Returns an isolated runtime cache for a given type
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;        
        public IRuntimeCacheProvider GetOrCreateCache(Type type)
        {
            return _isolatedCache.GetOrAdd(type, t =&gt; CacheFactory(t));
        }

        /// &lt;summary&gt;
        /// Tries to get a cache by the type specified
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public Attempt&lt;IRuntimeCacheProvider&gt; GetCache&lt;T&gt;()
        {
            IRuntimeCacheProvider cache;
            if (_isolatedCache.TryGetValue(typeof(T), out cache))
            {
                return Attempt.Succeed(cache);
            }
            return Attempt&lt;IRuntimeCacheProvider&gt;.Fail();
        }

        /// &lt;summary&gt;
        /// Clears all values inside this isolated runtime cache
        /// &lt;/summary&gt;
        /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public void ClearCache&lt;T&gt;()
        {
            IRuntimeCacheProvider cache;
            if (_isolatedCache.TryGetValue(typeof(T), out cache))
            {
                cache.ClearAllCache();
            }
        }

        /// &lt;summary&gt;
        /// Clears all of the isolated caches
        /// &lt;/summary&gt;
        public void ClearAllCaches()
        {
            foreach (var key in _isolatedCache.Keys)
            {
                IRuntimeCacheProvider cache;
                if (_isolatedCache.TryRemove(key, out cache))
                {
                    cache.ClearAllCache();
                }
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,67,15,71,1],[15,72,15,76,1],[21,9,21,84,1],[22,9,22,10,1],[23,13,23,41,1],[24,9,24,10,1],[26,9,26,149,1],[34,9,34,10,1],[35,13,35,63,1],[35,63,35,81,1],[35,81,35,83,1],[35,13,35,83,1],[36,9,36,10,1],[43,9,43,10,0],[44,13,44,55,0],[44,55,44,70,0],[44,70,44,72,0],[44,13,44,72,0],[45,9,45,10,0],[53,9,53,10,1],[55,13,55,66,1],[56,13,56,14,1],[57,17,57,47,1],[59,13,59,58,0],[60,9,60,10,1],[68,9,68,10,1],[70,13,70,66,1],[71,13,71,14,1],[72,17,72,39,1],[73,13,73,14,1],[74,9,74,10,1],[80,9,80,10,1],[81,13,81,20,1],[81,22,81,29,1],[81,30,81,32,1],[81,33,81,52,1],[82,13,82,14,1],[84,17,84,62,1],[85,17,85,18,1],[86,21,86,43,1],[87,17,87,18,1],[88,13,88,14,1],[89,9,89,10,1]]);
    </script>
  </body>
</html>